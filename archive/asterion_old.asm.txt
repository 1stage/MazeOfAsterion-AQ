INCLUDE "aquarius.inc"
ORG $C000
NO_GFX:
    db          $FF
DRAGON:
    db          $04,$04,$04,$04
    db          $02,$B0,$E0,$00,$C0,$A0,$C2,$A0,$C1,$01
    db          $02,$02,$A0,$99,$A0,$C9,$D7,$98,$A0,$95,$95,$85,$A0,$81,$01
    db          $02,$02,$A0,$C3,$A4,$A8,$12,$85,$86,$85,$A0,$97,$01
    db          $02,$A0,$17,$8C,$A5," ",$94,$A0,$94,$A5,$01
    db          $02,$02,$D7,$F6,$F9,$7F,$7F,$7F,$7F,$B4,$01
    db          $02,$02,$A0,$B5,$95,$86," ",$84," ",$B0,$A0,$99,$01
    db          $02,$02,$A0,$C3,$D7,$A0,$94,$A0,$C9,$A0,$DB,$18,$A2,$C3,$01
    db          $02,$18,$00,$8D,$00,$00,$E8,$99,$01
    db          $00,$9E,$EC,$1F,$BF,$A1,$FF
DRAGON_S:
    db          $04,$04,$04,$C9,$C9,$C0,$C0,$01
    db          $ED,$A5,$A0,$95,$95,$A0,$01
    db          $A0,$92,$A0,$F9,$A0,$CA,$A0,$A7,$01
    db          $BA,$BF,$EF,$E9,$01
    db          $D9,$D9,"\a",$AB,$FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
LEVEL_99_LOOP:
    db          "Looks like this dungeon",$01
    db          "is too small for you",$01
    db          "so we will put you back",$01
    db          "into a new floor #90.",$FF
STATS_TXT:
    db          "PHYS",$D6,"SPRT",$FF
    db          $D6,$00,$00,$00,$00,"Health",$01
    db          $D6,$00,$00,$00,$00,"Shield",$01
    db          $D6,$00,$00,$00,$00,"Weapon",$FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
POOF_1:
    db          $D7,$C9,$01
    db          $C7,$D9,$FF
POOF_2:
    db          $D1,$D1,$01
    db          $D1,$D1,$FF
POOF_3:
    db          $D1,$D1,$D1,$D1,$01
    db          $D1,$D0,$D0,$D1,$01
    db          $D1,$D0,$D0,$D1,$01
    db          $D1,$D1,$D1,$D1,$FF
POOF_4:
    db          $01,$00,$D0,$D0,$01
    db          $00,$D0,$D0,$FF
POOF_5:
    db          $D0,$D0,$D0,$D0,$01
    db          $D0,$00,$00,$D0,$01
    db          $D0,$00,$00,$D0,$01
    db          $D0,$D0,$D0,$D0,$FF
POOF_6:
    db          "    ",$01
    db          "    ",$01
    db          "    ",$01
    db          "    ",$FF
RING:
    db          $01,$01,$01,$01,$01,$01,$01
    db          $00,"o",$FF
RING_S:
    db          $01,$01,$01
    db          $00,$C6,$FF
RING_T:
    db          $00,".",$FF
ARROW_FLYING_LEFT:
    db          $01,$01,$01,$01,$01,$01
    db          $9B,$AC,$FF
ARROW_FLYING_RIGHT:
    db          $01,$01,$01,$01,$01,$01
    db          $AC,$9A,$FF
QUIVER:
    db          $01,$01,$01,$01,$01,$01
    db          $7F,$7F,$A0,$D7,$A0,$06,$01
    db          $A2,$AC,$B2,$E9,$01
    db          $00,$00,$A2,$A1,$FF
QUIVER_S:
    db          $01,$01
    db          $00,$AF,$BD,$B0,$01
    db          $00,$00,$A2,$FF
QUIVER_T:
    db          $00,$F0,$FF
BUCKLER:
    db          $01,$01,$01,$01,$01
    db          $D7,$FC,$C9,$01
    db          $A0,$98,$A0,$7F,$99,$01
    db          $C7,$AF,$D9,$FF
BUCKLER_S:
    db          $01,$01
    db          $00,$96,$FF
BUCKLER_T:
    db          $00,$87,$FF
CHALICE:
    db          $01,$01,$01,$01,$01,$01
    db          $A0,$C3,$A0,$89,$97,$01
    db          $00,$9F,$01
    db          $E0,$0E,$B0,$FF
CHALICE_S:
    db          $01,$01
    db          $00,$9F,$01
    db          $00,$CC,$FF
CHALICE_T:
    db          $00,"Y",$FF
HELMET:
    db          $01,$01,$01,$01,$01,$01
    db          $00,$C0,$C1,$01
    db          $00,$BF,$EF,$FF
HELMET_S:
    db          $01,$01,$01
    db          $04,$00,$D2,$01
    db          $00,$A3,$FF
HELMET_T:
    db          $00,"^",$FF
KEY:
    db          $01,$01,$01,$01,$01,$01
    db          $90,$90,$B8,$C9,$01
    db          $10,$A0,$80,$A0,$A9,$D9,$FF
KEY_S:
    db          $01,$01,$01
    db          $BC,$C5,$FF
KEY_T:
    db          $FF,"-",$FF
BOW:
    db          $01,$01,$01,$01,$01
    db          $D7,$AC,$A3,$8E,$01
    db          $D6,$00,$CA,$01
    db          $B5,$CA,$01
    db          $9F,$00,$FF
BOW_S:
    db          $01,$01
    db          $D7,$AC,$C9,$01
    db          $D6,$CA,$01
    db          $C7,$FF
BOW_T:
    db          $00,"{",$FF
AXE:
    db          $01,$01,$01,$01,$01
    db          $00,$7F,$B7,$01
    db          $00,$D9,$98,$01
    db          $00,$00,$B5,$01
    db          $00,$00,$99,$FF
AXE_S:
    db          $01,$01
    db          $00,$A0,$D7,$A0,$B7,$01
    db          $00,$00,$98,$01
    db          $00,$00,$B5,$FF
AXE_T:
    db          $00,$11,$FF
FOOD:
    db          $01,$01,$01,$01,$01
    db          $E4,$1F,$F6,$01
    db          $A0,$C3,$CB,$DB,$A0,$97,$01
    db          $00,$BB,$A0,$1F,$A0,$A9,$FF
FOOD_S:
    db          $01,$01
    db          $E0,$BE,$B0,$01
    db          $00,$E9,$A7,$FF
FOOD_T:
    db          $00,"#",$FF
MAP:
    db          $01,$01,$01,$01,$01
    db          $F0,$1F,$C8,$98,$01
    db          $12,$C8,$CC,$B5,$01
    db          $A0,$B5,$A0,$CD,$CC,$12,$01
    db          $A0,$99,$A0,$CC,$A0,$1F,$FC,$A0,$FF
MAP_S:
    db          $01,$01
    db          $00,$D7,$01
    db          $C7,$A0,$D5,$A0,$C9,$01
    db          $00,$D9,$FF
MAP_T:
    db          $00,$D5,$FF
CHEST:
    db          $01,$01,$01,$01,$01
    db          $90,$88,$88,$90,$01
    db          $A0,$90,$88,$88,$90,$A0,$01
    db          $A0,$81,$90,$90,$A0,$91,$01
    db          $A0,$D7,$FC,$FC,$C9,$A0,$FF
LOCKED_CHEST:
    db          $01,$01,$01,$01,$01
    db          $90,$88,$88,$90,$01
    db          $A0,$90,$88,$88,$90,$A0,$01
    db          $A0,$81,$CB,$DB,$A0,$91,$01
    db          $A0,$D7,$FC,$FC,$C9,$A0,$FF
CHEST_S:
    db          $01,$E0,$1F,$1F,$B0,$01
    db          $A0,$99,$A0,$80,$80,$98,$01
    db          $A2,$00,$00,$A1,$FF
CHEST_T:
    db          $00,$FC,$FF
ARMOR:
    db          $01,$01,$01,$01,$01
    db          $A0,$C9,$C7,$D9,$D7,$A0,$01
    db          $EA,$7F,$7F,$B5,$01
    db          $A0,$C3,$88,$88,$A0,$97,$FF
ARMOR_S:
    db          $01,$01
    db          $C7,$A0,$C7,$D9,$A0,$D9,$01
    db          $00,$7F,$7F,$01
    db          $00,$D9,$C7,$FF
ARMOR_T:
    db          $00,$A0,$C7,$D9,$01
    db          $00,$97,$A0,$C3,$FF
PAVISE:
    db          $01,$01,$01,$01,$01
    db          $E8,$F0,$F0,$B4,$01
    db          $EA,$7F,$7F,$B5,$01
    db          $EA,$7F,$7F,$B5,$01
    db          $00,$EF,$BF,$FF
PAVISE_S:
    db          $01,$01
    db          $00,$F4,$F8,$01
    db          $00,$7F,$7F,$01
    db          $00,$AB,$A7,$FF
PAVISE_T:
    db          $00,$7F,$01
    db          $00,$C2,$FF
AUTHORS:
    db          "   Originally programmed by Tom Loughry ",$01
    db          "  New GFX & routines by Sean Harrington ",$FF

AMULET:
    db          $01,$01,$01,$01,$01
    db          $D7,$AC,$C9,$01
    db          $C7,$AC,$C8,$C9,$01
    db          $D7,$AC,$D9,$D6,$01
    db          $C7,$AC,$05,$D9,$FF
AMULET_S:
    db          $01,$01
    db          $00,$D7,$C9,$01
    db          $00,$C7,$C8,$C9,$01
    db          $00,$CB,$F1,$A5,$FF
AMULET_T:
    db          $00,"&",$FF
LADDER:
    db          $01,$01,$01,$01,$01
    db          $EA,$00,$00,$B5,$01
    db          $EA,$AF,$AF,$B5,$01
    db          $FA,$FC,$FC,$F5,$01
    db          $AB,$F0,$F0,$A7,$FF
LADDER_S:
    db          $01,$01
    db          $00,$B4,$E8,$01
    db          $D7,$B7,$EB,$C9,$01
    db          $C7,$AF,$AF,$D9,$FF
LADDER_T:
    db          $00,$CD,$97,$FF
MACE:
    db          $01,$01,$01,$01,$01
    db          $00,$9E,$8E,$01
    db          $00,$A0,$C3,$A0,$97,$01
    db          $00,$A0,$C3,$A0,$97,$01
    db          $00,$A0,$99,$A0,$98,$FF
MACE_S:
    db          $01,$01
    db          $00,$E0,$B0,$01
    db          $00,$A0,$91,$A0,$81,$01
    db          $00,$A0,$C3,$A0,$97,$FF
MACE_T:
    db          $00,"T",$FF
FIREBALL:
    db          $01,$01,$01,$01,$01
    db          $BA,$B9,$E1,$01
    db          $B8,$BE,$B9,$01
    db          $A8,$E1,$B6,$FF
FIREBALL_S:
    db          $01,$01
    db          $00,$D1,$FF
FIREBALL_T:
    db          $00,$D3,$FF
GFX_BUFFER:
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
SPIDER:
    db          $04,$04
    db          $00,$BE,$FD,$01
    db          $A0,$99,$A0,$F7,$EE,$98,$01
    db          $02,$B6,$B9,$FB,$F7,$E6,$E9,$01
    db          $02,$F7,$E6,$EE,$BD,$B9,$FB,$01
    db          $02,$12,$D6,$A0,$17,$8C,$A0,$D6,$12,$01
    db          $02,$A0,$99,$A0,$C7,"`'",$D9,$98,$FF
SPIDER_S:
    db          $04,$04,$04,$04
    db          $00,$D7,$C9,$01
    db          $D7,$95,$85,$C9,$01
    db          "M",$A0,$17,$8C,$A0,"M",$01
    db          "X`'X",$FF
MIMIC:
    db          $04,$02,$D7,$96,$00,$00,$96,$C9,$01
    db          $02,$12,$F0,$1F,$1F,$F0,$12,$01
    db          $02,$D6,$11,$A0,$17,$8C,$A0,$0F,$D6,$01
    db          $02,$C7,$A0,$18,$8D,$18,$8D,$A0,$D9,$01
    db          $A0,$81,$90,$90,$A0,$91,$01
    db          $A0,$D7,$FC,$FC,$C9,$A0,$FF
MIMIC_S:
    db          $01,$E0,$1F,$1F,$B0,$01
    db          $A0,$99,$A0,$80,$80,$98,$01
    db          $A2,$00,$00,$A1,$FF
MALOCCHIO:
    db          $04,$04,$04,$04
    db          $02,$A8,$B0,$B6,$00,$B6,$B0,$01
    db          $02,$B4,$E5,$BE,$EE,$B8,$E1,$01
    db          $02,$E2,$7F,$F6,$F8,$7F,$B1,$01
    db          $02,$A5,$A0,$14,$14,$14,$14,$A0,$EA,$01
    db          $02,$E8,$AB,$7F,$7F,$A7,$B4,$01
    db          $02,$C7,$A4,$00,$00,$A8,$D9,$FF
MALOCCHIO_S:
    db          $04,$04,$04,$04
    db          $00,$B6,$B8,$E0,$01
    db          $E3,$BE,$E9,$F1,$01
    db          $B9,$A0,$84,$84,$A0,$E4,$01
    db          $A2,$A6,$A1,$A5,$FF
MINOTAUR:                                                   
    db          $04,$04,$04,$04                                                                 
    db          $E8,$A1,$E9,$01                                                                 
    db          $EB,$EF,$EF,$A1,$01                                                             
    db          $02,$02,$E0,$B8,$B4,$FB,$B1,$E4,$F0,$01                                         
    db          $02,$02,$F6,$E6,$FE,$F4,$E8,$ED,$FD,$ED,$01                                     
    db          $02,$02,$E9,$B5,$BF,$E1,$EA,$FB,$FE,$FB,$01                                     
    db          $02,$02,$A1,$E0,$FE,$7F,$FD,$B9,$AD,$A1,$01                                     
    db          $02,$A2,$7F,$B4,$FE,$B7,$01,$02,$BE,$B6,$00,$A2,$BE,$B4,$FF                     
MINOTAUR_S:
    db          $04,$04,$04,$04
    db          $00,$ED,$BE,$01
    db          $D7,$E6,$B9,$D2,$01
    db          "\n",$8E,$ED,$C2,$01
    db          $00,$16,$83,$FF
SNAKE:                                                      
    db          $04,$04,$04                                                                     
    db          $02,$B8,$BE,$F7,$BD,$B0,$01                                                     
    db          $02,$11,$11,$E2,$E9,$EA,$01                                                     
    db          $02,$D7,$AD,$E1,$B7,$B6,$01                                                     
    db          $02,$8D,$00,$B6,$FA,$E0,$F0,$01                                                 
    db          $02,$02,$B8,$A6,$FB,$B2,$FA,$F1,$A4,$E9,$01                                     
    db          $02,$02,$B5,$A2,$EA,$B2,$B2,$B4,$E0,$E6,$01                                     
    db          $02,$02,$A2,$AC,$A3,$E6,$F2,$AE,$E1,$BB,$FF                                     
SNAKE_S:
    db          $04,$04,$04
    db          $00,$FE,$F9,$01
    db          $00,"\"",$A0,$85,$A0,$97,$01
    db          $B8,$B6,$F6,$E4,$01
    db          $E5,$E7,$F9,$E6,$FF
SKELETON:
    db          $04,$04,$04,$04
    db          $02,$8A,$00,$EE,$ED,$01
    db          $02,$D6,$00,$A0,$17,$A0,$A7,$01
    db          $02,$D6,$E0,$AC,$B9,$E4,$01
    db          $02,"#",$A6,$E2,$E6,$A2,$B4,$01
    db          $02,$D6,$00,$F8,$ED,$B0,"#",$01
    db          $02,$D6,$E8,$A1,$00,$E5,$01
    db          $02,$D6,$A2,$E4,$00,$BA,$01
    db          $02,$D6,$00,$A6,$A8,$F1,$FF
SKELETON_S:
    db          $04,$04,$04
    db          "\b",$E2,$A5,$01
    db          $CD,$B8,$B7,$B4,$01
    db          $D6,$B8,$A9,$B0,$01
    db          $D6,$A2,$E8,$B1,$FF
MUMMY:                                                      
    db          $04,$04,$04,$04                                                                 
    db          $D7,$FC,$C9,$01                                                                 
    db          $02,$02,$D7,$C9,$95,$A0,$93,$A0,$B4,$00,$D7,$C9,$01                             
    db          $02,$02,$A0,$97,$A0,$84,$A0,$94,$84,$94,$A0,$84,$A0,$D9,$A0,$97,$01             
    db          $02,$02,$A0,$B5,$F8,$C9,$84,$94,$D2,$D6,$A0,$01                                 
    db          $02,$02,$A0,$C3,$A0,$00,$95,$A0,$84,$94,$7F,$12,$A0,$01                         
    db          $02,$02,$A0,$91,$BF,$94,$E0,$94,$AA,$91,$A0,$01                                 
    db          $02,$95,$A0,$95,$A0,$00,$11,$A0,$95,$A0,$01                                     
    db          $02,$A0,$D9,$A0,$85,$00,"'",$A0,$85,$A0,$C9,$FF                                 
MUMMY_S:
    db          $04,$04,$04
    db          $1C,$EA,$B1,$1A,$01
    db          $11,$EF,$BF,$0F,$01
    db          $D6,$A0,$D9,$C7,$A0,"`",$01
    db          $E0,$B5,$EA,$B0,$FF
NECROMANCER:                                                
    db          $04,$04,$04,$04                                                                 
    db          $02,$D7,$D0,$A0,$11,$0F,$A0,$D0,$C9,$01                                         
    db          $02,$02,$D7,$8D,$D1,$A4,$A4,$D1,$18,$C9,$01                                     
    db          $02,$02,$D6,$E9,$A0,$D9,$A0,$9C,$D7,$A0,$C7,$A0,$B6,$D6,$01                     
    db          $02,$02,$12,$FA,$EF,$A0,$C2,$A0,$7F,$BF,$F5,$12,$01                             
    db          $02,$02,$C7,$A7,$E2,$AF,$ED,$B1,$AB,$D9,$01                                     
    db          $7F,$A0,$D6,$A0,$7F,$FD,$01                                                     
    db          $02,$A0,$99," ",$19,"  ",$A0,$98,$01,$02,$C7,$A0,$88," ",$90,$F0,$A0,$D9,$FF    
NECROMANCER_S:
    db          $04,$04,$04
    db          "\v",$E2,$DB,"\f",$01
    db          $9F,$A0,$C9,$D7,$A0,$9F,$01
    db          $00,$12,$99,$01
    db          $00,$FD,$91,$FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
SUB_ram_c869:
    LD          DE,$29                                 ;GRN on DKCYN
                                                        ;(bottom of closed door)
SUB_ram_c86c:
    LD          (HL),A
    SCF
    CCF
    SBC         HL,DE
SUB_ram_c871:
    LD          (HL),A
    SCF
    CCF
    SBC         HL,DE
    LD          (HL),A
    SBC         HL,DE
    LD          (HL),A
    RET
    LD          DE,$29                                 ;GRN on DKCYN
                                                        ;(bottom of closed door)
SUB_ram_c87e:
    LD          (HL),A
    ADD         HL,DE
LAB_ram_c880:
    LD          (HL),A
    ADD         HL,DE
    LD          (HL),A
    ADD         HL,DE
    LD          (HL),A
    RET
SUB_ram_c886:
    LD          (HL),A
    ADD         HL,DE
    LD          (HL),A
    INC         HL
    LD          (HL),A
    ADD         HL,DE
    INC         HL
    LD          (HL),A
    DEC         HL
    LD          (HL),A
    DEC         HL
    LD          (HL),A
    RET
SUB_ram_c893:
    LD          (HL),A
    ADD         HL,DE
    LD          (HL),A
    DEC         HL
    LD          (HL),A
    ADD         HL,DE
    INC         HL
    LD          (HL),A
    DEC         HL
    LD          (HL),A
    DEC         HL
    LD          (HL),A
    RET
SUB_ram_c8a0:
    LD          (HL),A
    INC         HL
    LD          (HL),A
    INC         HL
    LD          (HL),A
    ADD         HL,DE
    DEC         HL
    LD          (HL),A
    DEC         HL
    LD          (HL),A
    ADD         HL,DE
    LD          (HL),A
    RET
SUB_ram_c8ad:
    LD          (HL),A
    INC         HL
    LD          (HL),A
    INC         HL
    LD          (HL),A
    ADD         HL,DE
    DEC         HL
    LD          (HL),A
    INC         HL
    LD          (HL),A
    ADD         HL,DE
    LD          (HL),A
    RET
DRAW_ROW:
    LD          (HL),A
    DEC         B
    RET         Z
    INC         HL
    JP          DRAW_ROW
    LD          DE,$28                                 ;DE = 40 (next line) / $28
DRAW_CELL:
    LD          (HL),A
    DEC         C
    RET         Z
    ADD         HL,DE                                   ;Goto next row
    JP          DRAW_CELL
FILL_CHRCOL_RECT:
    LD          DE,$28                                 ;DE = 40 / $28 (next row)
DRAW_CHRCOLS:
    PUSH        HL
    PUSH        BC
    CALL        DRAW_ROW
    POP         BC
    POP         HL
    DEC         C
    RET         Z
    ADD         HL,DE
    JP          DRAW_CHRCOLS
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
DRAW_F0_WALL:
    LD          HL,COLRAM_F0_WALL_MAP_IDX               ;= $60    `
    LD          BC,$1010                               ;16 x 16 rectangle
    LD          A,$44                                  ;BLU on BLU
    JP          FILL_CHRCOL_RECT
DRAW_F0_WALL_AND_CLOSED_DOOR:
    CALL        DRAW_F0_WALL
    LD          A,$22                                  ;GRN on GRN
DRAW_DOOR_F0:
    LD          HL,COLRAM_F0_DOOR_IDX                   ;= $60
    LD          BC,$80c                                ;8 x 12 rectangle
    JP          FILL_CHRCOL_RECT
DRAW_WALL_F0_AND_OPEN_DOOR:
    CALL        DRAW_F0_WALL
    LD          A,$f0                                  ;DKGRY on BLK
                                                        ;WAS BLK on DKBLU
                                                        ;WAS LD A,0xb
    JR          DRAW_DOOR_F0
DRAW_WALL_F1:
    LD          HL,CHRRAM_F1_WALL_IDX                   ;= $20
    LD          BC,$808                                ;8 x 8 rectangle
    LD          A,$20                                  ;Change to SPACE 32 / $20
                                                        ;WAS d134 / $86 crosshatch char
                                                        ;WAS LD A, $86
    CALL        FILL_CHRCOL_RECT
    LD          C,0x8
    LD          HL,COLRAM_F0_DOOR_IDX                   ;= $60
    LD          A,$4b                                  ;BLU on DKBLU
    JP          DRAW_CHRCOLS
DRAW_WALL_F1_AND_CLOSED_DOOR:
    CALL        DRAW_WALL_F1
    LD          A,$2d                                  ;GRN on DKGRN
DRAW_DOOR_F1_OPEN:
    LD          HL,COLRAM_F1_DOOR_IDX                   ;= $60    `
    LD          BC,$406                                ;4 x 6 rectangle
    JP          FILL_CHRCOL_RECT
DRAW_WALL_F1_AND_OPEN_DOOR:
    CALL        DRAW_WALL_F1
    LD          A,0x0                                   ;BLK on BLK
    JR          DRAW_DOOR_F1_OPEN
DRAW_WALL_F2:
    LD          BC,$404                                ;4 x 4 rectangle
    LD          HL,COLRAM_F1_DOOR_IDX                   ;= $60    `
    LD          A,$ff                                  ;DKGRY on DKGRY
                                                        ;WAS BLK on DKBLU
                                                        ;WAS LD A,0xb
    JP          FILL_CHRCOL_RECT
DRAW_DOOR_F2_OPEN:
    LD          HL,COLRAM_F1_DOOR_IDX                   ;= $60    `
    LD          A,0x0                                   ;BLK on BLK
UPDATE_FO_ITEM:
    LD          BC,$404                                ;4 x 4 rectangle
    JP          FILL_CHRCOL_RECT
DRAW_WALL_L0:
    LD          HL,COLRAM_FL00_WALL_IDX                 ;= $60    `
    LD          A,$40                                  ;BLU on BLK
                                                        ;WAS BLU on CYN
                                                        ;WAS LD A,$46
    CALL        SUB_ram_c869
    DEC         DE
    ADD         HL,DE
    LD          A,0x4                                   ;BLK on BLU
    CALL        SUB_ram_c886
    ADD         HL,DE
    LD          BC,$410                                ;Jump into COLRAM and down one row
    CALL        DRAW_CHRCOLS
    ADD         HL,DE
    CALL        SUB_ram_c8a0
    ADD         HL,DE
    LD          A,$f4                                  ;DKGRY on BLU
                                                        ;WAS DKCYN on BLU
                                                        ;WAS LD A,$94
    DEC         DE
    CALL        SUB_ram_c86c
    LD          A,$c0
    LD          HL,DAT_ram_33c0                         ;= $20
    CALL        SUB_ram_c86c
    LD          HL,IDX_VIEWPORT_CHRRAM                  ;= $20
    LD          A,$c1
    INC         DE
    INC         DE
    JP          SUB_ram_c87e
    RET
DRAW_DOOR_FL0_HIDDEN:
    CALL        DRAW_WALL_L0
    LD          A,$f0                                  ;DKGRY on BLK
                                                        ;WAS DKCYN on DKBLU
                                                        ;WAS LD A,$9b
    EX          AF,AF'
    LD          A,0x4                                   ;BLK on BLU
                                                        ;WAS DKBLU on BLU
                                                        ;LD A,$b4
    JR          LAB_ram_c99e
SUB_ram_c996:
    CALL        DRAW_WALL_L0
    LD          A,$f2                                  ;DKGRY on GRN
                                                        ;WAS DKCYN on GRN
                                                        ;WAS LD A,$92
    EX          AF,AF'
    LD          A,$24                                  ;GRN on BLU
LAB_ram_c99e:
    LD          HL,DAT_ram_351a                         ;= $60    `
    CALL        SUB_ram_c871
    DEC         DE
    ADD         HL,DE
    EX          AF,AF'
    CALL        SUB_ram_c886
    ADD         HL,DE
    LD          BC,$30c
    CALL        DRAW_CHRCOLS
    ADD         HL,DE
    CALL        SUB_ram_c8a0
    ADD         HL,DE
    DEC         DE
    CALL        SUB_ram_c871
    LD          HL,DAT_ram_30c8                         ;= $20
    LD          A,$c1
    INC         DE
    INC         DE
    JP          LAB_ram_c880
    RET
SUB_ram_c9c5:
    LD          HL,DAT_ram_34c8                         ;= $60    `
    LD          A,0x4                                   ;BLK on BLU
    LD          BC,$410                                ;4 x 10 rectangle
    JP          FILL_CHRCOL_RECT
SUB_ram_c9d0:
    LD          HL,DAT_ram_3168                         ;= $20
    LD          BC,$408                                ;4 x 8 rectangle
    LD          A,$20                                  ;Change to SPACE 32 / $20
                                                        ;WAS d134 / $86 crosshatch char
                                                        ;WAS LD A, $86
    CALL        FILL_CHRCOL_RECT
    LD          HL,DAT_ram_3568                         ;= $60
    LD          C,0x8
    LD          A,$4b                                  ;BLU on DKBLU
    JP          DRAW_CHRCOLS
SUB_ram_c9e5:
    CALL        SUB_ram_c9d0
    LD          A,$dd                                  ;DKGRN on DKGRN
LAB_ram_c9ea:
    LD          HL,DAT_ram_35ba                         ;= $60    `
    LD          BC,$206                                ;2 x 6 rectangle
    JP          DRAW_CHRCOLS
SUB_ram_c9f3:
    CALL        SUB_ram_c9d0
    XOR         A
    JR          LAB_ram_c9ea
SUB_ram_c9f9:
    LD          HL,DAT_ram_3168                         ;= $20
    LD          A,$c1
    LD          (HL),A                    ;= $20
    LD          DE,$28
    ADD         HL,DE
    INC         HL
    LD          (HL),A                    ;= $20
    LD          HL,DAT_ram_3259                         ;= $20
    LD          A,$c0
    LD          (HL),A                    ;= $20
    ADD         HL,DE
    DEC         HL
    LD          (HL),A                    ;= $20
    LD          HL,DAT_ram_3568                         ;= $60
    LD          A,$bf                                  ;DKBLU on DKGRY
                                                        ;WAS DKBLU on DKCYN
                                                        ;WAS LD A,$b9
    LD          (HL),A                    ;= $60
    ADD         HL,DE
    INC         HL
    LD          (HL),A                    ;= $60
    DEC         HL
    LD          A,0xf                                   ;BLK on DKGRY
                                                        ;WAS BLK on DKBLU
                                                        ;WAS LD A,0xb
    LD          (HL),A                    ;= $60
    LD          BC,$204                                ;2 x 4 rectangle
    ADD         HL,DE             ;= $60    `
    CALL        DRAW_CHRCOLS
    ADD         HL,DE
    LD          (HL),A                    ;= $60
    INC         HL
    LD          A,0xf                                   ;BLK on DKGRY
                                                        ;WAS DKCYN on DKBLU
                                                        ;WAS LD A,$9b
    LD          (HL),A                    ;= $60
    ADD         HL,DE
    DEC         HL
    LD          (HL),A                    ;= $60
    LD          HL,DAT_ram_35ba                         ;= $60    `
    LD          C,0x4
    LD          A,0x0
    JP          DRAW_CHRCOLS
DRAW_WALL_FL22:
    LD          HL,COLRAM_FL22_WALL_IDX                 ;= $60    `
    LD          BC,$404                                ;4 x 4 rectangle
    LD          A,$ff                                  ;DKGRY on DKGRY
    JP          FILL_CHRCOL_RECT
DRAW_L1_WALL:
    LD          HL,CHRRAM_FL1_WALL_IDX                  ;= $20
    LD          A,$c1                                  ;LEFT angle CHR
    CALL        SUB_ram_c869
    DEC         DE
    ADD         HL,DE
    LD          A,$20                                  ;Change to SPACE 32 / $20
                                                        ;WAS d134 / $86 crosshatch char
                                                        ;WAS LD A, $86
    CALL        SUB_ram_c886
    ADD         HL,DE
    LD          BC,$408                                ;4 x 8 rectangle
    CALL        DRAW_CHRCOLS
    ADD         HL,DE
    CALL        SUB_ram_c8a0
    ADD         HL,DE
    LD          A,$c0                                  ;RIGHT angle CHR
    DEC         DE
    CALL        SUB_ram_c86c
    LD          HL,DAT_ram_3547                         ;= $60    `
    LD          A,$b0                                  ;DKBLU on BLK
                                                        ;WAS DKBLU on CYN
                                                        ;WAS LD A,$b6
    CALL        SUB_ram_c869
    DEC         DE
    ADD         HL,DE
    LD          A,$4b                                  ;BLU on DKBLU
    CALL        SUB_ram_c886
    ADD         HL,DE
    LD          BC,$408                                ;Jump to COLRAM + 32 cells
    CALL        DRAW_CHRCOLS
    ADD         HL,DE
    CALL        SUB_ram_c8a0
    ADD         HL,DE
    LD          A,$fb                                  ;DKGRY on DKBLU
                                                        ;WAS DKCYN on DKBLU
                                                        ;WAS LD A,$9b
    DEC         DE
    JP          SUB_ram_c86c
    RET
DRAW_FL1_DOOR:
    CALL        DRAW_L1_WALL
    LD          A,$f0                                  ;DKGRY on BLK
                                                        ;WAS DKCYN on BLK
                                                        ;WAS LD A,$90
    PUSH        AF
    LD          A,$b0                                  ;DKBLU on BLK
    PUSH        AF
    LD          A,0xb                                   ;BLK on DKGRY
                                                        ;WAS BLK on DKBLU
                                                        ;WAS LD A,0xb
    JR          DRAW_L1_DOOR
DRAW_L1:
    CALL        DRAW_L1_WALL
    LD          A,$fd                                  ;DKGRY on DKGRN
                                                        ;WAS DKCYN on DKGRN
                                                        ;WAS LD A,$9d
    PUSH        AF
    LD          A,$2d                                  ;GRN on DKGRN
    PUSH        AF
    LD          A,$db                                  ;DKGRN on DKBLU
DRAW_L1_DOOR:
    LD          HL,COLRAM_L1_DOOR_IDX                   ;= $60    `
    LD          BC,$207                                ;2 x 7 rectangle
    CALL        SUB_ram_cb1c
    LD          HL,CHRRAM_L1_DOOR_IDX                   ;= $20
    LD          A,$c1                                  ;LEFT ANGLE CHR
    LD          (HL),A              ;= $20
    LD          DE,$29
    ADD         HL,DE
    LD          (HL),A                    ;= $20
    RET
SUB_ram_cab0:
    LD          HL,DAT_ram_356c                         ;= $60    `
    LD          BC,$408                                ;4 x 8 rectangle
    LD          A,$4b                                  ;BLU on DKBLU
    CALL        FILL_CHRCOL_RECT
    LD          HL,DAT_ram_316c                         ;= $20
    LD          C,0x8
    LD          A,$20                                  ;Change to SPACE 32 / $20
                                                        ;WAS d134 / $86 crosshatch char
                                                        ;WAS LD A, $86
    JP          DRAW_CHRCOLS
SUB_ram_cac5:
    CALL        SUB_ram_cab0
    XOR         A
    JR          DRAW_L1_DOOR_2
DRAW_L1_DOOR_CLOSED:
    CALL        SUB_ram_cab0
    LD          A,$dd                                  ;DKGRN on DKGRN
DRAW_L1_DOOR_2:
    LD          HL,COLRAM_FL2_WALL_IDX                  ;= $60    `
    LD          BC,$206                                ;2 x 6 rectangle
    JP          DRAW_CHRCOLS
DRAW_WALL_FL2:
    LD          HL,COLRAM_FL2_WALL_IDX                  ;= $60    `
    LD          BC,$204                                ;2 x 4 rectangle
    LD          A,$11                                  ;BLK on DKGRY
    CALL        FILL_CHRCOL_RECT
    LD          C,0x4
    LD          HL,COLRAM_FL2_PLUS_WALL_IDX             ;= $60    `
    LD          A,$22                                  ;BLK on DKGRY
                                                        ;WAS BLK on DKBLU
                                                        ;WAS LD A,0xb
    JP          DRAW_CHRCOLS
DRAW_WALL_FL2_EMPTY:
    LD          HL,COLRAM_FL2_WALL_IDX                  ;= $60    `
    LD          BC,$404                                ;4 x 4 rectangle
    LD          A,0x0                                   ;BLK on BLK
    JP          FILL_CHRCOL_RECT
DRAW_WALL_L2:
    LD          A,$ca                                  ;Right slash char
    PUSH        AF
    LD          A,$20                                  ;GRN on BLK
    PUSH        AF
    LD          HL,CHRRAM_F1_WALL_IDX                   ;= $20
    LD          A,$c1                                  ;Left angle char
    LD          BC,$204                                ;2 x 4 rectangle
    CALL        SUB_ram_cb1c
    LD          A,0xf                                   ;FL2 Bottom Color
                                                        ;BLK on DKGRY
                                                        ;WAS DKCYN on DKBLU
                                                        ;WAS LD A,$9b
    PUSH        AF
    LD          A,0xf                                   ;FL2 Wall Color
                                                        ;BLK on DKGRY
                                                        ;WAS BLK on DKBLU
                                                        ;WAS LD A,0xb
    PUSH        AF
    LD          HL,COLRAM_F0_DOOR_IDX                   ;= $60
    LD          A,$f0                                  ;FL2 Top Color
                                                        ;DKGRY on BLK
                                                        ;WAS DKBLU on CYN
                                                        ;WAS LD A,$b6
    LD          BC,$204                                ;2 x 4 rectangle
    CALL        SUB_ram_cb1c
    RET
SUB_ram_cb1c:
    POP         IX
    LD          (HL),A
    LD          DE,$29                                 ;EDIT MEdb?
    ADD         HL,DE
    LD          (HL),A
    DEC         HL
    DEC         DE
    POP         AF
    LD          (HL),A
    ADD         HL,DE
    CALL        DRAW_CHRCOLS
    ADD         HL,DE
    LD          (HL),A
    ADD         HL,DE
    POP         AF
    LD          (HL),A
    SCF
    CCF
    SBC         HL,DE
    INC         HL
    LD          (HL),A
    JP          (IX)
DRAW_WALL_L2_C:
    LD          HL,COLRAM_L2_LEFT                         ;= $60    `
    LD          BC,$204                                ;2 x 4 rectangle
    LD          A,0xf                                   ;BLK on DKGRY
                                                        ;WAS BLK on DKBLU
                                                        ;WAS LD A,0xb
    JP          FILL_CHRCOL_RECT
DRAW_WALL_L2_C_EMPTY:
    LD          HL,COLRAM_L2_LEFT                         ;= $60    `
    LD          BC,$204                                ;2 x 4 rectangle
    LD          A,0x0                                   ;BLK on BLK
    JP          FILL_CHRCOL_RECT
DRAW_WALL_R0:
    LD          A,$f4                                  ;DKGRY on BLU
                                                        ;WAS DKCYN on BLU
                                                        ;WAS LD A,$94
    PUSH        AF
    LD          BC,$410
    LD          A,0x4                                   ;BLK on BLU
    PUSH        AF
    LD          A,$40                                  ;BLU on BLK
                                                        ;WAS BLU on CYN
                                                        ;WAS LD A, $46
    LD          HL,DAT_ram_34b4                         ;= $60    `
    CALL        SUB_ram_cc4d
    LD          HL,DAT_ram_303f                         ;= $20
    LD          A,$c0                                  ;Right angle char
    LD          DE,$27
    CALL        SUB_ram_c87e
    LD          HL,DAT_ram_335c                         ;= $20
    INC         A
    INC         DE
    INC         DE
    JP          SUB_ram_c87e
DRAW_FRO_DOOR:
    CALL        DRAW_WALL_R0
    LD          A,$f0                                  ;DKGRY on BLK
                                                        ;WAS DKCYN on DKBLU
                                                        ;WAS LD A,$9b
    EX          AF,AF'
    LD          A,0x4                                   ;BLK on BLU
                                                        ;WAS DKBLU on BLU
                                                        ;WAS LDA A,$b4
    JR          LAB_ram_cb86
SUB_ram_cb7e:
    CALL        DRAW_WALL_R0
    LD          A,$f2                                  ;DKGRY on GRN
                                                        ;WAS DKCYN on GRN
                                                        ;WAS LD A,$92
    EX          AF,AF'
    LD          A,$24                                  ;GRN on BLU
LAB_ram_cb86:
    LD          HL,DAT_ram_352d                         ;= $60    `
    DEC         DE
    DEC         DE
    CALL        SUB_ram_c871
    INC         DE
    ADD         HL,DE
    EX          AF,AF'
    CALL        SUB_ram_c893
    ADD         HL,DE
    LD          BC,$30c
    CALL        DRAW_CHRCOLS
    ADD         HL,DE
    CALL        SUB_ram_c8ad
    ADD         HL,DE
    INC         DE
    CALL        SUB_ram_c871
    LD          HL,DAT_ram_30df                         ;= $20
    LD          A,$c0                                  ;Right angle char
    DEC         DE
    DEC         DE
    JP          LAB_ram_c880
SUB_ram_cbae:
    LD          HL,DAT_ram_34dc                         ;= $60    `
    LD          A,0x4                                   ;BLK on BLU
    LD          BC,$410                                ;4 x 10 rectangle
    JP          FILL_CHRCOL_RECT
SUB_ram_cbb9:
    LD          HL,DAT_ram_317c                         ;= $20
    LD          BC,$408
    LD          A,$20                                  ;Change to SPACE 32 / $20
                                                        ;WAS d134 / $86 crosshatch char
                                                        ;WAS LD A, $86
    CALL        FILL_CHRCOL_RECT
    LD          HL,DAT_ram_357c                         ;= $60    `
    LD          C,0x8
    LD          A,$4b                                  ;BLU on DKBLU
    JP          DRAW_CHRCOLS
SUB_ram_cbce:
    CALL        SUB_ram_cbb9
    XOR         A
    JR          LAB_ram_cbd9
SUB_ram_cbd4:
    CALL        SUB_ram_cbb9
    LD          A,$dd                                  ;DKGRN on DKGRNdb?
LAB_ram_cbd9:
    LD          HL,DAT_ram_35cc                         ;= $60    `
    LD          BC,$206                                ;2 x 6 rectangledb?
    JP          DRAW_CHRCOLS
SUB_ram_cbe2:
    LD          HL,DAT_ram_317f                         ;= $20
    LD          A,$c0                                  ;Right angle char
    LD          (HL),A                    ;= $20
    LD          DE,$28
    ADD         HL,DE
    DEC         HL
    LD          (HL),A                    ;= $20
    LD          HL,DAT_ram_326e                         ;= $20
    LD          A,$c1                                  ;Left angle char
    LD          (HL),A                    ;= $20
    ADD         HL,DE
    INC         HL
    LD          (HL),A                    ;= $20
    LD          HL,DAT_ram_357f                         ;= $60
    LD          A,$bf                                  ;DKBLU on DKGRY
                                                        ;WAS DKBLU on DKCYN
                                                        ;WAS LD A,$b9
    LD          (HL),A                    ;= $60
    ADD         HL,DE
    DEC         HL
    LD          (HL),A                    ;= $60
    INC         HL
    LD          A,0xf                                   ;BLK on DKGRY
                                                        ;WAS BLK on DKBLU
                                                        ;WAS LD A,0xb
    LD          (HL),A                    ;= $60
    LD          BC,$204                                ;2 x 4 rectangle
    ADD         HL,DE
    DEC         HL                        ;= $60    `
    CALL        DRAW_CHRCOLS
    ADD         HL,DE
    INC         HL
    LD          (HL),A                    ;= $60
    DEC         HL
    LD          A,0xf                                   ;BLK on DKGRY
                                                        ;WAS DKCYN on DKBLU
                                                        ;WAS LD A,$9b
    LD          (HL),A                    ;= $60
    ADD         HL,DE
    INC         HL
    LD          (HL),A                    ;= $60
    LD          HL,DAT_ram_35cc                         ;= $60    `
    LD          C,0x4
    LD          A,0x0
    JP          DRAW_CHRCOLS
DRAW_WALL_FR222_EMPTY:
    LD          HL,DAT_ram_35cc                         ;= $60    `
    LD          BC,$404                                ;4 x 4 rectangle
    LD          A,0x0                                   ;BLK on BLK
    JP          FILL_CHRCOL_RECT
DRAW_WALL_FR1:
    LD          A,$c1
    PUSH        AF
    LD          BC,$408                                ;4 x 8 rectangle
    LD          A,$20                                  ;Change to SPACE 32 / $20
                                                        ;WAS d134 / $86 crosshatch char
                                                        ;WAS LD A, $86
    PUSH        AF
    LD          A,$c0                                  ;Right angle char
    LD          HL,DAT_ram_3150                         ;= $20
    CALL        SUB_ram_cc4d
    LD          A,$fb                                  ;DKGRY on DKBLU
                                                        ;WAS DKCYN on DKBLU
                                                        ;WAS LD $9b
    PUSH        AF
    LD          C,0x8
    LD          A,$4b                                  ;BLU on DKBLU
    PUSH        AF
    LD          A,$b0                                  ;DKBLU on BLK
                                                        ;WAS DKBLU on CYN
                                                        ;WAS LD A,$b6
    LD          HL,DAT_ram_3550                         ;= $60    `
    CALL        SUB_ram_cc4d
    RET
SUB_ram_cc4d:
    POP         IX
    LD          DE,$27
    CALL        SUB_ram_c86c
    INC         DE
    ADD         HL,DE
    POP         AF
    CALL        SUB_ram_c893
    ADD         HL,DE
    DEC         HL
    CALL        DRAW_CHRCOLS
    ADD         HL,DE
    INC         HL
    CALL        SUB_ram_c8ad
    ADD         HL,DE
    POP         AF
    INC         DE
    CALL        SUB_ram_c86c
    JP          (IX)
SUB_ram_cc6d:
    CALL        DRAW_WALL_FR1
    LD          A,$f0                                  ;DKGRY on BLK
                                                        ;WAS DKCYN on BLK
                                                        ;WAS LD A,$90
    PUSH        AF
    LD          A,$b0                                  ;DKBLU on BLK
    PUSH        AF
    LD          A,0xb                                   ;BLK on DKBLU
    JR          LAB_ram_cc85
SUB_ram_cc7a:
    CALL        DRAW_WALL_FR1
    LD          A,$fd                                  ;DKGRY on DKGRN
                                                        ;WAS DKCYN on DKGRN
                                                        ;WAS LD A,$9d
    PUSH        AF
    LD          A,$2d                                  ;GRN on DKGRN
    PUSH        AF
    LD          A,$db                                  ;DKGRN on DKBLU
LAB_ram_cc85:
    LD          HL,DAT_ram_357a                         ;= $60    `
    LD          BC,$207                                ;2 x 7 rectangle
    CALL        SUB_ram_cd07
    LD          HL,DAT_ram_317a                         ;= $20
    LD          A,$c0                                  ;Right angle char
    LD          (HL),A                    ;= $20
    LD          DE,$27
    ADD         HL,DE
    LD          (HL),A                    ;= $20
    RET
SUB_ram_cc9a:
    LD          HL,DAT_ram_3578                         ;= $60    `
    LD          BC,$408                                ;4 x 8 rectangle
    LD          A,$4b                                  ;BLU on DKBLU
    CALL        FILL_CHRCOL_RECT
    LD          HL,DAT_ram_3178                         ;= $20
    LD          C,0x8
    LD          A,$20                                  ;Change to SPACE 32 / $20
                                                        ;WAS d134 / $86 crosshatch char
                                                        ;WAS LD A, $86
    JP          DRAW_CHRCOLS
SUB_ram_ccaf:
    CALL        SUB_ram_cc9a
    XOR         A
    JR          LAB_ram_ccba
SUB_ram_ccb5:
    CALL        SUB_ram_cc9a
    LD          A,$dd                                  ;DKGRN on DKGRN
LAB_ram_ccba:
    LD          HL,DAT_ram_35ca                         ;= $60    `
    LD          BC,$206                                ;2 x 6 rectangle
    JP          DRAW_CHRCOLS
SUB_ram_ccc3:
    LD          HL,DAT_ram_35ca                         ;= $60    `
    LD          BC,$204                                ;2 x 4 rectangle
    LD          A,0x0                                   ;BLK on BLK
    CALL        FILL_CHRCOL_RECT
    LD          C,0x4
    LD          HL,DAT_ram_35c8                         ;= $60    `
    LD          A,0xf                                   ;BLK on DKGRY
                                                        ;WAS BLK on DKBLU
                                                        ;WAS LD A, 0xb
    JP          DRAW_CHRCOLS
DRAW_WALL_FR2_EMPTY:
    LD          HL,DAT_ram_35c8                         ;= $60    `
    LD          BC,$404                                ;4 x 4 rectangle
    LD          A,0x0                                   ;BLK on BLK
    JP          FILL_CHRCOL_RECT
DRAW_WALL_FR2:
    LD          A,0xf                                   ;FR2 Bottom
                                                        ;BLK on DKGRY
                                                        ;WAS DKCYN on DKBLU
                                                        ;WAS LD A,$9b
    PUSH        AF
    LD          A,0xf                                   ;FR2 Wall
                                                        ;BLK on DKGRY
                                                        ;WAS BLK on DKBLU
                                                        ;WAS LD A,0xb
    PUSH        AF
    LD          A,$f0                                  ;FR2 Top
                                                        ;DKGRY on BLK
                                                        ;WAS DKBLU on CYN
                                                        ;WAS LD A,$b6
    LD          HL,DAT_ram_3577                         ;= $60    `
    LD          BC,$204                                ;2 x 4 rectangle
    CALL        SUB_ram_cd07
    LD          HL,DAT_ram_3266                         ;= $20
    LD          A,$da                                  ;Left slash char
    LD          (HL),A                    ;= $20
    ADD         HL,DE
    LD          (HL),A                    ;= $20
    LD          HL,DAT_ram_3177                         ;= $20
    LD          A,$c0                                  ;Right angle char
    LD          (HL),A                    ;= $20
    DEC         DE
    DEC         DE
    ADD         HL,DE
    LD          (HL),A                    ;= $20
    RET
SUB_ram_cd07:
    POP         IX
    LD          (HL),A
    LD          DE,$27
    ADD         HL,DE
    LD          (HL),A
    INC         HL
    POP         AF
    LD          (HL),A
    ADD         HL,DE
    INC         DE
    CALL        DRAW_CHRCOLS
    INC         DE
    ADD         HL,DE
    LD          (HL),A
    DEC         HL
    POP         AF
    LD          (HL),A
    ADD         HL,DE
    LD          (HL),A
    JP          (IX)
SUB_ram_cd21:
    LD          HL,DAT_ram_35c6                         ;= $60    `
    LD          BC,$204                                ;2 x 4 rectangle
    LD          A,0xf                                   ;BLK on DKGRY
                                                        ;WAS BLK on DKBLU
                                                        ;WAS LD A,0xb
    JP          FILL_CHRCOL_RECT
SUB_ram_cd2c:
    LD          HL,DAT_ram_35c6                         ;= $60    `
    LD          BC,$204                                ;2 x 4 rectangle
    LD          A,0x0                                   ;BLK on BLK
    JP          FILL_CHRCOL_RECT
    LD          A,0x8
    LD          (SOUND_REPEAT_COUNT),A
    LD          B,A
LAB_ram_cd3d:
    PUSH        BC
    CALL        SOUND_04
    CALL        SUB_ram_cde7
    CALL        SOUND_02
    CALL        SOUND_01
    POP         BC
    DJNZ        LAB_ram_cd3d
    RET
    LD          A,0x7
    LD          (SOUND_REPEAT_COUNT),A
    LD          B,A
LAB_ram_cd54:
    PUSH        BC
    CALL        SOUND_02
    CALL        SOUND_03
    POP         BC
    DJNZ        LAB_ram_cd54
    RET
SUB_ram_cd5f:
    LD          A,0xa
    LD          (SOUND_REPEAT_COUNT),A
    LD          B,A
LAB_ram_cd65:
    PUSH        BC
    CALL        SOUND_04
    CALL        SOUND_05
    POP         BC
    DJNZ        LAB_ram_cd65
    JP          SUB_ram_cdbf
POOF_SOUND:
    LD          A,0x7
    LD          (SOUND_REPEAT_COUNT),A
    LD          B,0x1
    JR          DOINK_SOUND
END_OF_GAME_SOUND:
    LD          A,0x4                                   ;Was LD A,0x7
    LD          (SOUND_REPEAT_COUNT),A
    LD          B,A
DOINK_SOUND:
    PUSH        BC
    CALL        SOUND_02
    CALL        SUB_ram_cde7
    CALL        SOUND_03
    POP         BC
    DJNZ        DOINK_SOUND
    RET
    CALL        SUB_ram_cde7
    CALL        SUB_ram_cde7
    CALL        SUB_ram_cde7
    CALL        SUB_ram_cde7
    CALL        SUB_ram_cde7
    CALL        SUB_ram_cde7
    CALL        SUB_ram_cde7
    CALL        SUB_ram_cde7
    CALL        SUB_ram_cde7
    CALL        SUB_ram_cde7
    CALL        SUB_ram_cde7
    CALL        SOUND_05
    CALL        SOUND_05
    CALL        SOUND_05
    CALL        SOUND_05
    JP          SOUND_05
SUB_ram_cdbf:
    LD          A,0x0
    PUSH        AF
    LD          BC,$40
    LD          DE,$15
    LD          HL,$400
    LD          A,0x0
    LD          (PITCH_UP_BOOL),A
    JP          PLAY_PITCH_CHANGE
SUB_ram_cdd3:
    LD          A,0x0
    PUSH        AF
    LD          BC,$a0
    LD          DE,0x8
    LD          HL,$800
    LD          A,0x0
    LD          (PITCH_UP_BOOL),A
    JP          PLAY_PITCH_CHANGE
SUB_ram_cde7:
    LD          A,0x0
    PUSH        AF
    LD          BC,$a0
    LD          DE,0x1
    LD          HL,0x2
    LD          A,0x0
    LD          (PITCH_UP_BOOL),A
    JP          PLAY_PITCH_CHANGE
SETUP_OPEN_DOOR_SOUND:
    LD          DE,0xf
    LD          HL,$580
LO_HI_PITCH_SOUND:
    LD          BC,0x8
    LD          A,0x0
    PUSH        AF
    LD          A,0x1
    LD          (PITCH_UP_BOOL),A
    JP          PLAY_PITCH_CHANGE
SETUP_CLOSE_DOOR_SOUND:
    LD          HL,0x5
    LD          DE,0xc
HI_LO_PITCH_SOUND:
    LD          BC,0xe                                  ;H
    XOR         A
    PUSH        AF
    LD          (PITCH_UP_BOOL),A
    JP          PLAY_PITCH_CHANGE
SOUND_01:
    LD          A,0x0
    PUSH        AF
    LD          BC,$30
    LD          DE,0x2
    LD          HL,$100
    LD          A,0x1
    LD          (PITCH_UP_BOOL),A
    JP          PLAY_PITCH_CHANGE
SOUND_02:
    LD          A,0x0
    PUSH        AF
    LD          BC,$1a
    LD          DE,$10
    LD          HL,$300
    LD          A,0x1
    LD          (PITCH_UP_BOOL),A
    JP          PLAY_PITCH_CHANGE
SOUND_03:
    LD          A,0x0
    PUSH        AF
    LD          BC,$2a
    LD          DE,0xa
    LD          HL,0x4
    LD          A,0x0
    LD          (PITCH_UP_BOOL),A
    JP          PLAY_PITCH_CHANGE
SOUND_04:
    LD          A,0x0
    PUSH        AF
    LD          BC,$20
    LD          DE,0x2
    LD          HL,$55
    LD          A,0x1
    LD          (PITCH_UP_BOOL),A
    JP          PLAY_PITCH_CHANGE
SOUND_05:
    LD          A,0x0
    PUSH        AF
    LD          BC,$30
    LD          DE,0x1
    LD          HL,0x1
    LD          A,0x0
    LD          (PITCH_UP_BOOL),A
    JP          PLAY_PITCH_CHANGE
PLAY_PITCH_CHANGE:
    LD          (SND_CYCLE_HOLDER),HL
PLAY_PITCH_CHANGE_LOOP:
    DEC         HL
    LD          A,H
    OR          L                                       ;Clear flags
    JR          NZ,PLAY_PITCH_CHANGE_LOOP
    POP         AF
    OUT         (SPEAKER),A                             ;= db
    XOR         0x1
    PUSH        AF
    DEC         BC
    LD          A,B
    OR          C
    JR          NZ,INCREASE_PITCH
    POP         AF
    LD          HL,(SND_CYCLE_HOLDER)
    RET
INCREASE_PITCH:
    LD          HL,PITCH_UP_BOOL
    BIT         0x0,(HL)
    JR          Z,DECREASE_PITCH
    LD          HL,(SND_CYCLE_HOLDER)
    SBC         HL,DE
    JR          PLAY_PITCH_CHANGE
DECREASE_PITCH:
    LD          HL,(SND_CYCLE_HOLDER)
    ADD         HL,DE
    JR          PLAY_PITCH_CHANGE
HC_JOY_INPUT_COMPARE:
    LD          A,(RAM_AE)
    CP          $31                                    ;Compare to "1" db?
    JP          NZ,WAIT_FOR_INPUT
    LD          HL,(HC_INPUT_HOLDER)                    ;= $6060
    LD          A,$f3                                  ;Compare to JOY disc UUL
    CP          L
    JP          Z,DO_MOVE_FW_CHK_WALLS
    CP          H
    JP          Z,DO_MOVE_FW_CHK_WALLS
    LD          A,$fb                                  ;Compare to JOY disc UP
    CP          L
    JP          Z,DO_MOVE_FW_CHK_WALLS
    CP          H
    JP          Z,DO_MOVE_FW_CHK_WALLS
    LD          A,$eb                                  ;Compare to JOY disc UUR
    CP          H
    JP          Z,DO_MOVE_FW_CHK_WALLS
    CP          L
    JP          Z,DO_MOVE_FW_CHK_WALLS
    LD          A,$e9                                  ;Compare to JOY disc UR
    CP          L
    JP          Z,DO_TURN_RIGHT
    CP          H
    JP          Z,DO_TURN_RIGHT
    LD          A,$f9                                  ;Compare to JOY disc RUR
    CP          L
    JP          Z,DO_TURN_RIGHT
    CP          H
    JP          Z,DO_TURN_RIGHT
    LD          A,$fd                                  ;Compare to JOY disc RIGHT
    CP          L
    JP          Z,DO_TURN_RIGHT
    CP          H
    JP          Z,DO_TURN_RIGHT
    LD          A,$e7                                  ;Compare to JOY disc LUL
    CP          L
    JP          Z,DO_TURN_LEFT
    CP          H
    JP          Z,DO_TURN_LEFT
    LD          A,$e3                                  ;Compare to JOY disc UL
    CP          L
    JP          Z,DO_TURN_LEFT
    CP          H
    JP          Z,DO_TURN_LEFT
    LD          A,$f7                                  ;Compare to JOY disc LEFT
    CP          L
    JP          Z,DO_TURN_LEFT
    CP          H
    JP          Z,DO_TURN_LEFT
    LD          A,$f6                                  ;Compare to JOY disc LDL
    CP          L
    JP          Z,DO_GLANCE_LEFT
    CP          H
    JP          Z,DO_GLANCE_LEFT
    LD          A,$e6                                  ;Compare to JOY disc DL
    CP          L
    JP          Z,DO_GLANCE_LEFT
    CP          H
    JP          Z,DO_GLANCE_LEFT
    LD          A,$ed                                  ;Compare to JOY disc RDR
    CP          L
    JP          Z,DO_GLANCE_RIGHT
    CP          H
    JP          Z,DO_GLANCE_RIGHT
    LD          A,$ec                                  ;Compare to JOY disc DR
    CP          L
    JP          Z,DO_GLANCE_RIGHT
    CP          H
    JP          Z,DO_GLANCE_RIGHT
    LD          A,$fc                                  ;Compare to JOY disc DDR
    CP          L
    JP          Z,DO_JUMP_BACK
    CP          H
    JP          Z,DO_JUMP_BACK
    LD          A,$fe                                  ;Compare to JOY disc DOWN
    CP          L
    JP          Z,DO_JUMP_BACK
    CP          H
    JP          Z,DO_JUMP_BACK
    LD          A,$ee                                  ;Compare to JOY disc DDL
    CP          L
    JP          Z,DO_JUMP_BACK
    CP          H
    JP          Z,DO_JUMP_BACK
    LD          A,$df                                  ;Compare to JOY K4
    CP          L
    JP          Z,TOGGLE_SHIFT_MODE
    CP          H
    JP          Z,TOGGLE_SHIFT_MODE
    LD          A,(GAME_BOOLEANS)
    BIT         0x1,A
    JP          NZ,DO_HC_SHIFT_ACTIONS
DO_HC_BUTTON_ACTIONS:
    LD          A,$bf                                  ;Compare to JOY K1
    CP          L
    JP          Z,DO_USE_ATTACK
    CP          H
    JP          Z,DO_USE_ATTACK
    LD          A,$7b                                  ;Compare to JOY K2
    CP          L
    JP          Z,DO_OPEN_CLOSE
    CP          H
    JP          Z,DO_OPEN_CLOSE
    LD          A,$5f                                  ;Compare to JOY K3
    CP          L
    JP          Z,DO_PICK_UP
    CP          H
    JP          Z,DO_PICK_UP
    LD          A,$7d                                  ;Compare to JOY K5
    CP          L
    JP          Z,DO_SWAP_PACK
    CP          H
    JP          Z,DO_SWAP_PACK
    LD          A,$7e                                  ;Compare to JOY K6
    CP          L
    JP          Z,DO_ROTATE_PACK
    CP          H
    JP          Z,DO_ROTATE_PACK
    JP          NO_ACTION_TAKEN
DO_HC_SHIFT_ACTIONS:
    LD          A,$bf                                  ;Compare to JOY K1
    CP          L
    JP          Z,DO_USE_LADDER
    CP          H
    JP          Z,DO_USE_LADDER
    LD          A,$7b                                  ;Compare to JOY K2
    CP          L
    JP          Z,DO_COUNT_FOOD
    CP          H
    JP          Z,DO_COUNT_FOOD
    LD          A,$5f                                  ;Compare to JOY K3
    CP          L
    JP          Z,DO_COUNT_ARROWS
    CP          H
    JP          Z,DO_COUNT_ARROWS
    LD          A,$7d                                  ;Compare to JOY K5
    CP          L
    JP          Z,DO_SWAP_HANDS
    CP          H
    JP          Z,DO_SWAP_HANDS
    LD          A,$7e                                  ;Compare to JOY K6
    CP          L
    JP          Z,DO_REST
    CP          H
    JP          Z,DO_REST
    LD          A,$cc                                  ;Compare to K4 + DR chord
    CP          L
    JP          Z,MAX_HEALTH_ARROWS_FOOD
    CP          H
    JP          Z,MAX_HEALTH_ARROWS_FOOD
    LD          A,$c6                                  ;Compare to K4 + DL chord
    CP          L
    JP          Z,DO_TELEPORT
    CP          H
    JP          Z,DO_TELEPORT
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    JP          NO_ACTION_TAKEN
    NOP
    db          $FF
GRYPHON:                                                    
    db          $04,$04,$04,$04                                                                 
    db          $02,$88,$90,$88,$F0,$01                                                         
    db          $02,$02,$BE,$A0,$AC,$A0,$ED,$95,$A0,$85,$A0,$F5,$01                             
    db          $02,$02,$A0,$95,$95,$95,$A0,$B5,$86,$91,$01                                     
    db          $02,$02,$A0,$95,$95,$95,$A0,$C3,$95,$E5,$A0,$C7,$A0,$B0,$01                     
    db          $02,$02,$A0,$95,$95,$A0,$A1,$EF,$F4,$EF,$F5,$A0,",",$A0,$01                     
    db          $02,$02,$12,$B9,$7F,$F5,$7F,$F5,"\r",$C7,$01                                    
    db          $02,$02,$B6,$EA,$F7,$E7,$7F,$EB,$F5,$01                                         
    db          $02,$02,$8B,$C7,$BF,$B6,$EF,$ED,$EB,$E5,$FF                                     
GRYPHON_S:
    db          $04,$04,$04,$B8,$B8,$B0,$01
    db          $A0,$95,$95,$A0,$12,$C9,$01
    db          $E1,$A0,$D9,$D9,$A0,$8D,$01
    db          "(",$E7,$E7,$E5,$FF
STAFF:
    db          $01,$01,$01,$01,$01
    db          $D5,$01
    db          $00,$DA,$01
    db          $00,$00,$DA,$01
    db          $00,$00,$00,$DA,$FF
STAFF_S:
    db          $01,$01
    db          $00,$D3,$01
    db          $00,$00,$DA,$FF
STAFF_T:
    db          $00,"\\",$FF
SCROLL:
    db          $01,$01,$01,$01,$01
    db          "\t",$90,$90,"\t",$01
    db          $12,$8F,$8E,$12,$01
    db          $12,$9E,$9F,$12,$01
    db          "\b",$A0,$80,$80,$A0,"\b",$FF
SCROLL_S:
    db          $01,$01
    db          $00,$CD,$DD,$01
    db          $00,$CD,$DD,$FF
SCROLL_T:
    db          $00,"H",$FF
CROSSBOW:
    db          $01,$01,$01,$01,$01
    db          $00,$00,$90,$F0,$01
    db          $00,"\f",$B7,$A0,$91,$A0,$01
    db          $A0,$91,$A0,$B7,$ED,$A0,$91,$A0,$01
    db          $A0,$99,$A0,$90,$90,$A0,$D7,$A0,$FF
CROSSBOW_S:
    db          $01,$01
    db          $D7,$DC,$01
    db          $CD,"\r",$FF
CROSSBOW_T:
    db          $A0,$91,$A0,$D8,$02,$04,$90,$FF
WARRIOR_POTION:
    db          $01,$01,$01,$01,$01
    db          $00,"+",$D4,$01
    db          $00,$11,$0F,$01
    db          $00,$CD,$DD,$01
    db          $00,$C7,$D9,$FF
MAGE_POTION:
    db          $01,$01,$01,$01,$01
    db          $00,"+",$D5,$01
    db          $00,$11,$0F,$01
    db          $00,$CD,$DD,$01
    db          $00,$C7,$D9,$FF
CHAOS_POTION:
    db          $01,$01,$01,$01,$01
    db          $00,"??",$01
    db          $00,$11,$0F,$01
    db          $00,$CD,$DD,$01
    db          $00,$C7,$D9,$FF
WARRIOR_POTION_S:
    db          $01,$01
    db          $00,$D4,$01
    db          $00,$14,$01
    db          $00,$C2,$FF
MAGE_POTION_S:
    db          $01,$01
    db          $00,$D5,$01
    db          $00,$14,$01
    db          $00,$C2,$FF
CHAOS_POTION_S:
    db          $01,$01
    db          $00,"?",$01
    db          $00,$14,$01
    db          $00,$C2,$FF
POTION_T:
    db          $00,"U",$02,$04,"_",$FF
THE_END_PART_A:
    db          " Asterion, the minotaur ",$FF
THE_END_PART_B:
    db          " is dead. ",$FF
COMPASS:
    db          $D7,"n",$C9,$01
    db          "w\be",$01
    db          $C7,"s",$D9,$FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
DRAW_BKGD:
    LD          A,$20                                  ;Set VIEWPORT fill chars to SPACE
    LD          HL,$3028
    LD          BC,$1818                               ;24 x 24 cells
    CALL        FILL_CHRCOL_RECT
    LD          C,0x8                                   ;8 rows of ceiling
    LD          HL,$3428
    LD          A,$f0                                  ;DKGRY on BLK
    CALL        DRAW_CHRCOLS
    LD          C,0x6                                   ;6 more rows of ceiling
    ADD         HL,DE
    LD          A,0x0                                   ;BLK on BLK
    CALL        DRAW_CHRCOLS
    LD          C,0xa                                   ;10 rows of floor
    ADD         HL,DE
    LD          A,$df                                  ;DKGRN on DKGRY
    CALL        DRAW_CHRCOLS
    LD          A,(CURR_MONSTER_PHYS)
    CP          0x0
    JR          Z,NOT_IN_BATTLE
    LD          A,(CURR_MONSTER_SPRT)
    CP          0x0
    JR          Z,NOT_IN_BATTLE
    CALL        REDRAW_MONSTER_HEALTH
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    RET
NOT_IN_BATTLE:
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    RET
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
WIPE_VARIABLE_SPACE:
    LD          A,0x0
    LD          HL,$3900
    LD          B,$ff
CLEAR_MAP_SPACE:
    LD          (HL),A
    INC         HL
    LD          (HL),A
    INC         HL
    LD          (HL),A
    INC         HL
    DJNZ        CLEAR_MAP_SPACE
    LD          HL,$3a62
    LD          (NEXT_BLINK_CHECK),HL
    RET
    db          $FF
    db          $FF
    db          $FF
DRAW_WHITE_MAP:
    LD          HL,$74
    CALL        MAP_ITEM_MONSTER
UPDATE_ITEM_CELLS:
    JP          Z,DRAW_PURPLE_MAP
    LD          A,(BC)
    INC         C
    INC         C
    EXX
    LD          D,$b6
    CALL        UPDATE_COLRAM_FROM_OFFSET
    EXX
    CALL        FIND_NEXT_ITEM_MONSTER_LOOP
    JR          UPDATE_ITEM_CELLS
    JP          DRAW_PURPLE_MAP
    db          $00
SHOW_MAP:
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $F4
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FA
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
PLAY_POOF_ANIM:
    PUSH        HL                                      ;Save HL register value
    LD          DE,POOF_1                               ;DE = Start of POOF animation graphic
    LD          B,$70                                  ;Set color to WHT on BLK
    EXX                                                 ;Swap BC DE HL with BC' DE' HL'
    CALL        POOF_SOUND
    EXX                                                 ;Swap BC DE HL with BC' DE' HL'
    CALL        GFX_DRAW
    POP         HL                  ;Restore DE register value
    CALL        TOGGLE_ITEM_POOF_AND_WAIT
    PUSH        HL
    CALL        GFX_DRAW
    POP         HL
    PUSH        DE
    LD          DE,$29
    SBC         HL,DE
    POP         DE                              ;= $D7,$C9,$01
    CALL        TOGGLE_ITEM_POOF_AND_WAIT
    PUSH        HL
    CALL        GFX_DRAW
    POP         HL
    PUSH        HL
    LD          B,$80
    CALL        GFX_DRAW
    CALL        TOGGLE_ITEM_POOF_AND_WAIT
    POP         HL
    PUSH        HL
    CALL        GFX_DRAW
    CALL        TOGGLE_ITEM_POOF_AND_WAIT
    LD          B,$d0
    POP         HL
    CALL        GFX_DRAW
    EX          AF,AF'
    RET
TOGGLE_ITEM_POOF_AND_WAIT:
    EXX
    LD          BC,DAT_ram_3200                         ;= $20
    CALL        SLEEP                                   ;byte SLEEP(short cycleCount)
    EXX
    RET
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
    db          $FF
MONSTER_KILLED:
    LD          HL,CHRRAM_MONSTER_POOF_IDX              ;= $20
    CALL        PLAY_POOF_ANIM
    LD          A,(PLAYER_MAP_POS)                      ;A  = Player position in map
    LD          HL,(DIR_FACING_HI)                      ;HL = FW adjustment value
    ADD         A,H                                     ;A  = Player position in map
                                                        ;one step forward
    CALL        ITEM_MAP_CHECK                          ;Upon return,
                                                        ;A  = itemNum one step forward
                                                        ;BC = itemMapRAMLocation
    CP          $9f                                    ;Check to see if it is
                                                        ;the Minotaur ($9f)
    JP          Z,MINOTAUR_DEAD
    LD          A,$fe                                  ;A  = $fe (empty item space)
    LD          (BC),A                                  ;itemMapLocRAM = $fe (empty)
    CALL        CLEAR_MONSTER_STATS
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    POP         HL
    JP          UPDATE_VIEWPORT
TOGGLE_SHIFT_MODE:
    LD          A,(GAME_BOOLEANS)
    BIT         0x1,A                                   ;NZ if SHIFT MODE
    JR          NZ,RESET_SHIFT_MODE
SET_SHIFT_MODE:
    SET         0x1,A                                   ;Set SHIFT MODE boolean
    LD          (GAME_BOOLEANS),A
    LD          A,$d0                                  ;DKGRN on BLK
    LD          (COLRAM_SHIFT_MODE_IDX),A               ;= $60    `
    JP          INPUT_DEBOUNCE
RESET_SHIFT_MODE:
    LD          A,(GAME_BOOLEANS)                       ;Reset SHIFT MODE boolean
    RES         0x1,A
    LD          (GAME_BOOLEANS),A
    LD          A,$f0
    LD          (COLRAM_SHIFT_MODE_IDX),A               ;= $60    `
    JP          INPUT_DEBOUNCE
SHOW_AUTHOR:
    LD          HL,CHRRAM_AUTHORS_IDX                   ;= $20
    LD          DE,AUTHORS                              ;= "   Originally programmed by Tom L...
    LD          B,$20
    CALL        GFX_DRAW
    LD          A,$ff
    JP          WAIT_FOR_INPUT
TIMER_UPDATE:
    LD          HL,(TIMER_A)
    LD          BC,0x1
    ADD         HL,BC
    LD          (TIMER_A),HL
    RET
BLINK_ROUTINE:
    PUSH        AF
    LD          A,(GAME_BOOLEANS)
    BIT         0x0,A
    JR          Z,STILL_ON_TITLE
    JR          BLINK_EXIT_AF
BLINK_EXIT_ALL:
    POP         DE
    POP         HL
BLINK_EXIT_BCAF:
    POP         BC
BLINK_EXIT_AF:
    POP         AF
    RET
STILL_ON_TITLE:
    PUSH        BC
    LD          A,(TIMER_B)
    LD          B,A
    LD          A,(NEXT_BLINK_CHECK)
    CP          B
    JR          NZ,BLINK_EXIT_BCAF
    LD          A,R
    LD          (NEXT_BLINK_CHECK),A
    PUSH        HL
    PUSH        DE
    CALL        DO_CLOSE_EYES
    LD          BC,$8000
    CALL        SLEEP                                   ;byte SLEEP(short cycleCount)
    CALL        DO_OPEN_EYES
    JR          BLINK_EXIT_ALL
DO_OPEN_EYES:
    LD          DE,$32d6
    LD          HL,$dad6                    ; Pinned to TITLE_SCREEN (0xD800) + 726
    LD          BC,$44
    LDIR
    LD          DE,$36d6
    LD          HL,$ded6                    ; Pinned to TITLE_SCREEN (0XD800) + 1750
    LD          BC,$44
    LDIR
    RET
DO_CLOSE_EYES:
    LD          HL,$32d6
    LD          BC,$d1d0                    ; Value, not an address 
    LD          (HL),B
    INC         HL
    LD          (HL),B
    LD          DE,$1a
    ADD         HL,DE
    LD          (HL),B
    DEC         HL
    LD          (HL),B
    LD          HL,$32fe
    LD          (HL),C
    INC         HL
    LD          (HL),B
    ADD         HL,DE
    LD          (HL),B
    DEC         HL
    LD          (HL),C
    LD          HL,$36d6
    LD          BC,$f00f                    ; Value, not an address
    LD          (HL),B
    INC         HL
    LD          (HL),C
    ADD         HL,DE
    LD          (HL),C
    DEC         HL
    LD          (HL),B
    LD          HL,$36fe
    LD          (HL),B
    INC         HL
    LD          (HL),B
    ADD         HL,DE
    LD          (HL),B
    DEC         HL
    LD          (HL),B
    RET
    db          $00
    db          $00
    db          $00
DRAW_ICON_BAR:
    PUSH        AF
    PUSH        HL
    LD          HL,CHRRAM_LEVEL_IND_L                   ;= $20
    LD          (HL),$85           ;Right side halftone CHR
    INC         HL
    INC         HL
    INC         HL
    LD          (HL),$95           ;Left side halftone CHR
    INC         HL
    LD          (HL),0x8         ;Up arrow CHR
    INC         HL
    INC         HL
    LD          (HL),$48            ;Ladder (H) CHR
    INC         HL
    INC         HL
    LD          (HL),$d3              ;Item CHR
    INC         HL
    INC         HL
    LD          (HL),$93           ;Monster CHR
    INC         HL
    INC         HL
    LD          (HL),$85              ;Right side halftone CHR
    NOP
    NOP
    INC         HL
    INC         HL
    INC         HL
    INC         HL                                      ;Map CHR
    LD          (HL),$d1               ;= $20
    INC         HL
    INC         HL                                      ;Armor CHR
    LD          (HL),$9d             ;= $20
    INC         HL
    INC         HL                                      ;Helmet CHR
    LD          (HL),0xe             ;= $20
    INC         HL
    INC         HL                                      ;Ring (o) CHR
    LD          (HL),$6f              ;= $20
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    POP         HL
    POP         AF
    RET
DRAW_COMPASS:
    PUSH        AF                                      ;DKBLU on BLK
    PUSH        BC
    PUSH        HL
    PUSH        DE
    LD          B,$b0
    LD          HL,DAT_ram_31af                         ;= $20
    LD          DE,COMPASS                              ;= $D7,"n",$C9,$01
    CALL        GFX_DRAW
    LD          HL,DAT_ram_35d8                         ;= $60
    LD          (HL),$10                 ;= $60
    POP         DE
    POP         HL
    POP         BC
    POP         AF
    RET
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
WIPE_WALLS:
    PUSH        AF
    PUSH        BC
    PUSH        HL
    LD          HL,$3800
    LD          BC,0x0
    LD          A,0x0
WIPE_WALLS_LOOP:
    LD          (HL),A
    INC         HL
    DJNZ        WIPE_WALLS_LOOP
    POP         HL
    POP         BC
    POP         AF
    CALL        UPDATE_VIEWPORT
    JP          INPUT_DEBOUNCE
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
DRAW_WALL_FL22_EMPTY:
    LD          HL,COLRAM_FL22_WALL_IDX                 ;= $60    `
    LD          BC,$404                                ;4 x 4 rectangle
    LD          A,0x0                                   ;BLK on BLK
    CALL        FILL_CHRCOL_RECT
    LD          HL,DAT_ram_3230                         ;= $20
    LD          BC,$401                                ;4 x 1 rectangle
    LD          A,$20                                  ;SPACE char
    JP          FILL_CHRCOL_RECT
DRAW_WALL_FL2_NEW:
    LD          HL,$3234                               ;Bottom CHARRAM IDX of FL2
    LD          BC,$401                                ;4 x 1 rectangle
    LD          A,$90                                  ;Thin base line char
    CALL        FILL_CHRCOL_RECT
    LD          HL,$35bc
    LD          BC,$204                                ;2 x 4 rectangle
    LD          A,0xf                                   ;BLK on DKGRY
    CALL        FILL_CHRCOL_RECT
    LD          C,0x4
    LD          HL,$35be
    LD          A,0xf
    JP          DRAW_CHRCOLS
FIX_ICON_COLORS:
    LD          HL,COLRAM_LEVEL_IDX_L                   ;= $60
    LD          A,(INPUT_HOLDER)
    ADD         A,A
    SUB         0x1
    LD          (HL),A              ;= $60
    INC         L
    LD          (HL),A             ;= $60
    INC         L
    LD          (HL),A              ;= $60
    INC         L
    LD          (HL),A              ;= $60
    LD          HL,COLRAM_SHIFT_MODE_IDX                ;= $60    `
    LD          BC,$1300
    DEC         HL
ICON_GREY_FILL_LOOP:
    INC         HL
    LD          (HL),$f0
    DJNZ        ICON_GREY_FILL_LOOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    RET

TITLE_SCREEN:
INCBIN "dungeon_title.scr"

SCRAMBLECODE:                                               
    db          ">[^\0\0",$9C,$00,$B0,$00,"l\0d\0",$A8,"^p"                                     
GAMEINIT:
    LD          SP,$3fff                      ;Set SP to top of BANK0 RAM
    CALL        WIPE_VARIABLE_SPACE                     ;Wipe variable space first...
    LD          (HL),0x2              ;($3a62) = 0x2
    INC         L                                       ;HL = $3a63
    LD          A,$32                                  ;A = $32
    LD          (HL),A                          ;($3a63) = $32
    INC         L                                       ;HL = $3a64
    LD          (HL),A                          ;($3a64) = $32
    INC         L                                       ;HL = $3a65
    LD          (HL),A                          ;($3a65) = $32
    INC         L                                       ;HL = $3a66
    DEC         A                                       ;A = $31
    LD          (HL),A                          ;($3a66) = $31
    INC         L                                       ;HL = $3a67
    LD          (HL),A                          ;($3a67) = $31
    INC         L                                       ;HL = $3a68
    LD          B,$12                                  ;B = $12
    XOR         A                                       ;A = 0x0, F = $44 (Z and P set)
LAB_ram_e029:
    LD          (HL),A                   ;($3a68) = $00
    INC         L                                       ;HL = $3a69 to $3a7a,
                                                        ;A = 0x0, F = $28
    DJNZ        LAB_ram_e029                            ;Loop if Not Z (B is decremented)
    LD          A,$18                                  ;A = $18 (HL = $3a7a, B = 0x0)
    LD          (HL),A                         ;($3a7a) = $18
    INC         HL                                      ;HL = $3a7b
    LD          A,$fe                                  ;A = $fe
    LD          B,$10                                  ;B = $10
LAB_ram_e035:
    LD          (HL),A                         ;= $60
    INC         HL
    DJNZ        LAB_ram_e035                            ;Loop if Not Z (B is decremented)
    LD          B,$20                                  ;Set fill CHR to SPACE 32/$20
    LD          HL,CHRRAM                               ;HL = $3000 (Start of CHRRAM)
    CALL        FILL_FULL_1024                          ;byte FILL_FULL_1024(word chrColValue...
    LD          HL,$5e                                 ;HL = $005e
    LD          (TIMER_E),HL                            ;($3a9c) = $0053
    LD          A,R                                     ;Semi-random number into A
    LD          H,A
    LD          (RNDHOLD_AA),HL
    LD          BC,$7f
    LD          A,0x7
    OUT         (C),A                          ;= db
    DEC         C
    LD          A,$3f
    OUT         (C),A                          ;= db
    LD          B,0x6                                   ;BLK on CYN
    LD          HL,COLRAM                               ;= $60
    CALL        FILL_FULL_1024                          ;byte FILL_FULL_1024(word chrColValue...
    CALL        CHK_ITEM
    CALL        DRAW_TITLE
    JP          INPUT_DEBOUNCE
    NOP
DRAW_TITLE:
    LD          DE,CHRRAM                               ;= $20
    LD          HL,$D800                    ; Pinned to TITLE_SCREEN (0xD800)
    LD          BC,$3e8
    LDIR                                                ;= $20
    LD          DE,COLRAM                               ;= $60
    LD          HL,$DC00                    ; Pinned to TITLE_SCREEN (0xD800) + 1000
    LD          BC,$3e8
    LDIR                                                ;= $60
                                                        ;= $70
    RET
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
BLANK_SCRN:
    LD          HL,CHRRAM                               ;= $20
    LD          B,$20                                  ;SPACE char
    CALL        FILL_FULL_1024                          ;byte FILL_FULL_1024(word chrColValue...
    LD          HL,COLRAM                               ;= $60
    LD          B,$d0                                  ;DKGRN on BLK
    CALL        FILL_FULL_1024                          ;byte FILL_FULL_1024(word chrColValue...
    LD          DE,STATS_TXT                            ;DE = STATS_TXT
    LD          HL,CHRRAM_STATS_TOP                     ;HL = CHRRAM_STATS_TOP
    LD          B,$d0                                  ;DKGRN on BLK
    CALL        GFX_DRAW
    LD          HL,IDX_HEALTH_SPACER                    ;= $20
    CALL        GFX_DRAW
    LD          HL,$30                                 ;Set starting PHYS HEALTH = 30
    LD          E,$15                                  ;Set starting SPRT HEALTH = 15
    LD          (PLAYER_PHYS_HEALTH),HL
    LD          (PLAYER_PHYS_HEALTH_MAX),HL
    LD          A,E
    LD          (PLAYER_SPRT_HEALTH),A
    LD          (PLAYER_SPRT_HEALTH_MAX),A
    CALL        REDRAW_STATS
    LD          HL,$20
    LD          (BYTE_ram_3aa9),HL
    LD          A,$14
    LD          (FOOD_INV),A                            ;Set starting FOOD_INV  = 14
    LD          (ARROW_INV),A                           ;Set starting ARROW INV = 14
    LD          B,$10                                  ;RED on BLK
    LD          HL,CHRRAM_LEFT_HAND_ITEM_IDX            ;= $20
    LD          DE,BOW                                  ;= $01,$01,$01,$01,$01
    CALL        GFX_DRAW
    CALL        FIX_ICON_COLORS
    CALL        DRAW_COMPASS
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    NOP
    DEC         A
    LD          B,A
    LD          A,0x3
    SUB         B
    LD          (RIGHT_HAND_ITEM),A
    RRCA
    JR          C,LAB_ram_e103
    LD          B,$10                                  ;Right hand RED SHIELD_L
    JR          ADJUST_SHIELD_LEVEL
LAB_ram_e103:
    LD          B,$30
ADJUST_SHIELD_LEVEL:
    RRCA
    JR          NC,LAB_ram_e10c
    LD          A,$40
    ADD         A,B
    LD          B,A
LAB_ram_e10c:
    LD          A,$18                                  ;Left hand RED BOW
    LD          (LEFT_HAND_ITEM),A
    LD          HL,CHRRAM_RIGHT_HAND_ITEM_IDX           ;= $20
    LD          DE,BUCKLER                              ;= $01,$01,$01,$01,$01
    CALL        GFX_DRAW
    CALL        BUILD_MAP
    CALL        SUB_ram_cdbf
    CALL        SUB_ram_f2c4
    CALL        REDRAW_START
    CALL        REDRAW_VIEWPORT
    JP          DO_SWAP_HANDS
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
DO_MOVE_FW_CHK_WALLS:
    LD          A,(WALL_F0_STATE)                       ;= $20
    CP          0x0                                     ;Check for no wall in F0
    JP          Z,FW_WALLS_CLEAR_CHK_MONSTER
    BIT         0x2,A                                   ;Check for closed door
    JP          Z,NO_ACTION_TAKEN
FW_WALLS_CLEAR_CHK_MONSTER:
    LD          A,(ITEM_F1)                             ;= $60
    INC         A
    INC         A
    CP          $7a                                    ;Check for monster in F1
    JP          NC,NO_ACTION_TAKEN                      ;Monster in your way!
                                                        ;Do nothing.
    LD          BC,(DIR_FACING_HI)                      ;Way is clear!
                                                        ;Move forward.
    LD          (BYTE_ram_3a9e),BC
    LD          A,(DIR_FACING_SHORT)
    LD          (BYTE_ram_3aa0),A
    LD          A,(PLAYER_MAP_POS)
    LD          (PLAYER_PREV_MAP_LOC),A
    ADD         A,B
    LD          (PLAYER_MAP_POS),A
    JP          UPDATE_VIEWPORT
DO_JUMP_BACK:
    LD          HL,PLAYER_MAP_POS
    LD          A,(PLAYER_PREV_MAP_LOC)
    CP          (HL)
    JP          Z,LAB_ram_e201
    EX          AF,AF'
    LD          HL,(BYTE_ram_3a9e)
    LD          A,(DIR_FACING_LO)
    NEG                                                 ;Negate A
    CP          H
    JP          Z,NO_ACTION_TAKEN
    EX          AF,AF'
    LD          (PLAYER_MAP_POS),A
    LD          (DIR_FACING_HI),HL
    LD          A,(BYTE_ram_3aa0)
    LD          (DIR_FACING_SHORT),A
    LD          A,(LAST_ITEM_HELD)
    AND         A
    JP          Z,UPDATE_VIEWPORT
    CALL        CLEAR_MONSTER_STATS
    JP          INIT_MELEE_ANIM
LAB_ram_e201:
    LD          BC,$500
    LD          DE,$20
    CALL        PLAY_SOUND_LOOP
    LD          A,(LAST_ITEM_HELD)
    AND         A
    JP          Z,WAIT_FOR_INPUT
    JP          INIT_MELEE_ANIM
DO_COUNT_FOOD:
    LD          A,(FOOD_INV)
COUNT_INV:
    LD          D,A
    INC         D
    XOR         A
PLAY_INV_COUNT_BLIPS:
    DEC         D
    JP          Z,INPUT_DEBOUNCE
    EX          AF,AF'
    LD          BC,BYTE_ram_2400                        ;= $FF
    CALL        SLEEP                                   ;byte SLEEP(short cycleCount)
    EX          AF,AF'
    OUT         (SPEAKER),A                             ;= db
    DEC         A
    JR          PLAY_INV_COUNT_BLIPS
DO_COUNT_ARROWS:
    LD          A,(ARROW_INV)
    JR          COUNT_INV
NO_ACTION_TAKEN:
    LD          BC,$500
    LD          DE,$20
    CALL        PLAY_SOUND_LOOP
    JP          WAIT_FOR_INPUT
PLAY_SOUND_LOOP:
    DEC         DE
    LD          A,E
    OR          D
    RET         Z
    OUT         (SPEAKER),A                             ;Send sound to speaker
    LD          H,B
    LD          L,C
LAB_ram_e244:
    DEC         HL
    LD          A,L
    OR          H
    JP          NZ,LAB_ram_e244
    JP          PLAY_SOUND_LOOP
USE_MAP:
    LD          A,(GAME_BOOLEANS)
    BIT         0x2,A                                   ;See if HAVE MAP bit is set
    JP          Z,NO_ACTION_TAKEN
    LD          A,(MAP_INV_SLOT)
    AND         A
    JP          Z,INIT_MELEE_ANIM
    EXX                                                 ;Swap BC  DE  HL
                                                        ;with BC' DE' HL'
    LD          BC,$1818                               ;24 x 24
    LD          HL,IDX_VIEWPORT_CHRRAM                  ;= $20
    LD          A,$20                                  ;SPACE character fill
    CALL        FILL_CHRCOL_RECT                        ;Fill map CHARs with SPACES
    CALL        SOUND_03
    LD          BC,$1818                               ;24 x 24
    LD          HL,COLRAM_VIEWPORT_IDX                  ;= $60    `
    LD          A,$b0                                  ;DKBLU on BLK
                                                        ;Was DKGN on BLK
    CALL        FILL_CHRCOL_RECT                        ;Fill map colors
    EXX                                                 ;Swap BC  DE  HL
                                                        ;with BC' DE' HL'
    PUSH        AF
    LD          A,(MAP_INV_SLOT)
    LD          B,A
    POP         AF
    NOP                                                 ;Reset N flag
    DEC         B
    JP          Z,DRAW_RED_MAP                          ;Walls and player
    DEC         B
    JP          Z,DRAW_YELLOW_MAP                       ;Walls, player, and ladder
    DEC         B
    JP          Z,DRAW_PURPLE_MAP                       ;Walls, player, ladder,
                                                        ;and monsters
    JP          DRAW_WHITE_MAP                          ;Walls, player, ladder,
                                                        ;monsters, and items
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
DRAW_PURPLE_MAP:
    LD          HL,$78a8                               ;Item range for monsters:
                                                        ;78 - skeleton
                                                        ;a8 - db?
    CALL        MAP_ITEM_MONSTER
UPDATE_MONSTER_CELLS:
    JR          Z,DRAW_YELLOW_MAP
    LD          A,(BC)
    INC         C
    INC         C
    EXX                                                 ;Swap BC  DE  HL
                                                        ;with BC' DE' HL'
    LD          D,$b1                                  ;Set current map position color
                                                        ;to $b1 DKBLU on RED
                                                        ;was DKGRN on YEL
    CALL        UPDATE_COLRAM_FROM_OFFSET
    EXX                                                 ;Swap BC  DE  HL
                                                        ;with BC' DE' HL'
    CALL        FIND_NEXT_ITEM_MONSTER_LOOP
    JR          UPDATE_MONSTER_CELLS
DRAW_YELLOW_MAP:
    LD          D,$b5                                  ;Set current map position color
                                                        ;to $b5, DKBLU on PUR
                                                        ;was DKGRN on PUR
    LD          A,(ITEM_HOLDER)
    CALL        UPDATE_COLRAM_FROM_OFFSET
DRAW_RED_MAP:
    LD          BC,$1018                               ;16 x 20
    LD          DE,HC_LAST_INPUT
    LD          HL,CHRRAM_WALL_F0_IDX                   ;= $20
CALC_MINIMAP_WALL:
    INC         DE
    LD          A,D
    CP          $39
    JR          Z,SET_MINIMAP_PLAYER_LOC
    LD          A,(DE)
    OR          A
    JR          Z,SET_MINIMAP_NO_WALLS
    AND         0xf
    JR          NZ,LAB_ram_e2d6
SET_MINIMAP_N_WALL:
    LD          A,$a3                                  ;A = $a3, map CHAR N wall
    JR          DRAW_MINIMAP_WALL
SET_MINIMAP_NO_WALLS:
    LD          A,$a0                                  ;A = $a0, map CHAR no walls
    JR          DRAW_MINIMAP_WALL
SET_MINIMAP_NW_WALLS:
    LD          A,$b7                                  ;A = $b7, map CHAR N and W walls
    JR          DRAW_MINIMAP_WALL
LAB_ram_e2d6:
    LD          A,(DE)
    AND         $f0
    JR          NZ,SET_MINIMAP_NW_WALLS
SET_MINIMAP_W_WALL:
    LD          A,$b5                                  ;A = $b5, map CHAR W wall
DRAW_MINIMAP_WALL:
    LD          (HL),A              ;= $20
    INC         HL
    DJNZ        CALC_MINIMAP_WALL
    ADD         HL,BC
    LD          B,$10
    JR          CALC_MINIMAP_WALL
SET_MINIMAP_PLAYER_LOC:
    LD          A,(PLAYER_MAP_POS)
    LD          D,$b7                                  ;Set player position color
                                                        ;to $b7 DKBLU on WHT
                                                        ;was DKGRN on WHT
    CALL        UPDATE_COLRAM_FROM_OFFSET
    CALL        WAIT_A_TICK
READ_KEY:
    LD          BC,$ff
    IN          A,(C)
    INC         A
    JR          NZ,READ_KEY
ENABLE_HC:
    LD          C,$f7
    LD          A,0xf
    OUT         (C),A                              ;= db
    DEC         C
READ_HC:
    IN          A,(C)                     ;= db
    INC         A
    JP          NZ,READ_KEY
    INC         C
    LD          A,0xe
DISABLE_HC:
    OUT         (C),A                              ;= db
    DEC         C
    IN          A,(C)                     ;= db
    INC         A
    JP          NZ,READ_KEY
    JP          UPDATE_VIEWPORT
MAP_ITEM_MONSTER:
    LD          BC,MAP_LADDER_OFFSET
FIND_NEXT_ITEM_MONSTER_LOOP:
    LD          A,(BC)
    INC         BC
    INC         A
    RET         Z
    LD          A,(BC)
    CP          H                                       ;CP A to H (low end of itemRange)
    INC         BC
    JR          C,FIND_NEXT_ITEM_MONSTER_LOOP
    CP          L                                       ;CP A to L (high end of itemRange)
    JR          NC,FIND_NEXT_ITEM_MONSTER_LOOP
    DEC         C
    DEC         BC
    RET
UPDATE_COLRAM_FROM_OFFSET:
    PUSH        AF
    AND         0xf
    LD          HL,COLRAM_F0_WALL_MAP_IDX               ;= $60    `
    LD          C,A
    LD          B,0x0
    ADD         HL,BC
    POP         AF
    AND         $f0
    RRA
    LD          C,A
    ADD         HL,BC
    RLA
    RLA
    RL          B
    LD          C,A
    ADD         HL,BC
    LD          (HL),D                                  ;LD (HL),D
    RET
CHK_ITEM_BREAK:
    LD          A,B                                     ;A  = itemLevel (0-3)
    RLCA                                                ;A  = A * 2
    RLCA                                                ;A  = A * 2
    RLCA                                                ;A  = A * 2
    LD          C,A                                     ;B  = A
    CALL        MAKE_RANDOM_BYTE                        ;A  = Random Byte
    ADD         A,C                                     ;A  = A + B (orig A * 8)
    JR          C,ITEM_POOFS_RH                         ;If A > 255, item breaks
    ADD         A,0x5                                   ;A  = A + 5
    RET         NC                                      ;If A < 255, item doesn't break
    db          $00
    db          $00
    db          $00
ITEM_POOFS_RH:
    SCF                                                 ;Set C
    EX          AF,AF'
    LD          HL,CHRRAM_RH_POOF_IDX                   ;= $20
    CALL        PLAY_POOF_ANIM
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
FIX_RH_COLORS:
    PUSH        AF
    PUSH        BC
    PUSH        HL
    LD          A,$f0                                  ;DKGRN on BLK
    LD          BC,$404                                ; 4 x 4 rectangle
    LD          HL,COLRAM_RH_ITEM_IDX                   ;= $60    `
    CALL        FILL_CHRCOL_RECT
    POP         HL
    POP         BC
    POP         AF
    SCF
    RET
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
SUB_ram_e39a:
    CALL        SOUND_05
    LD          A,(BYTE_ram_3a87)
    LD          HL,(BYTE_ram_3a85)
    DEC         A
    JP          NZ,LAB_ram_e3cd
    DEC         L
    JP          NZ,LAB_ram_e3b6
    DEC         H
    JP          Z,LAB_ram_e45a
    LD          A,$31
    LD          (RAM_AC),A
    LD          L,0x4
LAB_ram_e3b6:
    LD          A,0x4
    LD          (BYTE_ram_3a87),A
    LD          (BYTE_ram_3a85),HL
    LD          HL,(BYTE_ram_3a83)
    LD          BC,$29
    XOR         A
    SBC         HL,BC
    LD          (BYTE_ram_3a83),HL
    JP          LAB_ram_e3d7
LAB_ram_e3cd:
    LD          (BYTE_ram_3a87),A
    LD          HL,(BYTE_ram_3a83)
    DEC         HL
    LD          (BYTE_ram_3a83),HL
LAB_ram_e3d7:
    LD          BC,$c8
    XOR         A
    SBC         HL,BC
    PUSH        HL
    ADD         HL,BC
    LD          DE,ITEM_MOVE_CHR_BUFFER
    CALL        UPDATE_MELEE_OBJECTSdb
    POP         HL
    LD          C,L
    LD          A,(RAM_AC)
    LD          (MON_FS),A
    LD          A,(BYTE_ram_3a82)
    CALL        CHK_ITEM
    LD          A,$32
    LD          (MON_FS),A
    LD          A,(TIMER_A)
    ADD         A,$ff
    LD          (BYTE_ram_3a89),A
    RET
SUB_ram_e401:
    LD          A,L
    AND         0xf
    LD          B,A
    INC         B
    CALL        SUB_ram_e41d
    LD          C,A
    LD          A,L
    AND         $f0
    RLCA
    RLCA
    RLCA
    RLCA
    LD          B,A
    INC         B
    CALL        SUB_ram_e41d
    RLCA
    RLCA
    RLCA
    RLCA
    ADD         A,C
    LD          L,A
    RET
SUB_ram_e41d:
    CALL        UPDATE_SCR_SAVER_TIMER
    AND         0xf
LAB_ram_e422:
    SUB         B
    JR          NC,LAB_ram_e422
    ADD         A,B
    RET
SUB_ram_e427:
    LD          A,L
    ADD         A,E
    DAA
    LD          L,A
    LD          A,D
    ADC         A,H
    DAA
    LD          H,A
    RET
RECALC_PHYS_HEALTH:
    LD          A,L
    SUB         E
    DAA                                                 ;Normalize BCD
    LD          L,A
    LD          A,H
    SBC         A,D
    DAA                                                 ;Normalize BCD
    LD          H,A
    RET
SUB_ram_e439:
    XOR         A
    RR          H
    JR          NC,LAB_ram_e446
    RR          L
    LD          A,L
    SUB         $30
    LD          L,A
    JR          LAB_ram_e448
LAB_ram_e446:
    RR          L
LAB_ram_e448:
    BIT         0x3,L
    RET         Z
    LD          A,L
    SUB         0x3
    LD          L,A
    RET
SUB_ram_e450:
    LD          DE,(BYTE_ram_3a83)
    LD          HL,ITEM_MOVE_CHR_BUFFER
    JP          SUB_ram_e97d
LAB_ram_e45a:
    CALL        SUB_ram_e450
    LD          A,$32
    LD          (RAM_AC),A
    LD          (RAM_AD),A
    LD          A,(WEAPON_SPRT)
    LD          E,A
    LD          D,0x0
    CP          0x0
    JP          NZ,LAB_ram_e50f
    LD          DE,(WEAPON_PHYS)
    EXX
    CALL        NEW_RIGHT_HAND_ITEM
    EXX
    LD          HL,(PLAYER_PHYS_HEALTH_MAX)
    CALL        SUB_ram_e439
    CALL        RECALC_PHYS_HEALTH
    JR          NC,LAB_ram_e487
    LD          HL,0x0
LAB_ram_e487:
    CALL        SUB_ram_e401
    LD          L,H
    LD          H,A
    CALL        SUB_ram_e401
    LD          L,H
    LD          H,A
    EX          DE,HL
    CALL        SUB_ram_e439
    EX          DE,HL
    CALL        SUB_ram_e427
    EX          DE,HL
    CALL        SUB_ram_e401
    CALL        SUB_ram_e427
    LD          DE,(NEW_DAMAGE)
    CALL        RECALC_PHYS_HEALTH
    JR          C,LAB_ram_e4bb
LAB_ram_e4a9:
    EX          DE,HL
    LD          HL,(CURR_MONSTER_PHYS)
    CALL        RECALC_PHYS_HEALTH
    JR          C,LAB_ram_e4c3
    OR          L
    JR          Z,LAB_ram_e4c3
    LD          (CURR_MONSTER_PHYS),HL
    JP          REDRAW_MONSTER_HEALTH
LAB_ram_e4bb:
    LD          HL,0x6
    CALL        SUB_ram_e401
    JR          LAB_ram_e4a9
LAB_ram_e4c3:
    EXX
    LD          HL,0x0
    LD          (CURR_MONSTER_PHYS),HL
    CALL        REDRAW_MONSTER_HEALTH
    EXX
    INC         L
    LD          A,$99
    CP          H
    JP          NZ,MONSTER_KILLED
    LD          A,$61
    CP          L
    JP          NC,MONSTER_KILLED
    LD          A,(COLRAM_PHYS_STATS_1000)              ;= $60
    CALL        SUB_ram_e5ba
    LD          HL,(PLAYER_PHYS_HEALTH_MAX)
    CALL        SUB_ram_e439
    LD          A,L
    CP          B
    JP          NC,MONSTER_KILLED
LAB_ram_e4ec:
    CALL        UPDATE_SCR_SAVER_TIMER
    SUB         $40
    JR          C,INCREASE_MAX_PHYS_HEALTH
    CP          C
    JP          NC,MONSTER_KILLED
INCREASE_MAX_PHYS_HEALTH:
    LD          HL,(PLAYER_PHYS_HEALTH_MAX)
    LD          A,L
    ADD         A,0x1
    DAA                                                 ;Correct for BCD
    LD          L,A
    LD          A,H
    ADC         A,0x0
    LD          H,A
    LD          (PLAYER_PHYS_HEALTH_MAX),HL
    LD          A,C
    SUB         $10
    JP          C,MONSTER_KILLED
    LD          C,A
    JR          LAB_ram_e4ec
LAB_ram_e50f:
    LD          A,(PLAYER_SPRT_HEALTH_MAX)
    LD          H,0x0
    LD          L,A
    EXX
    CALL        NEW_RIGHT_HAND_ITEM
    EXX
    CALL        SUB_ram_e439
    LD          A,L
    SUB         E
    DAA
    LD          L,A
    JR          NC,LAB_ram_e525
    LD          L,0x0
LAB_ram_e525:
    CALL        SUB_ram_e401
    EX          DE,HL
    CALL        SUB_ram_e439
    LD          A,L
    ADD         A,E
    DAA
    LD          E,A
    CALL        SUB_ram_e401
    ADD         A,E
    DAA
    LD          L,A
    LD          A,(BYTE_ram_3aa5)
    LD          E,A
    LD          A,L
    SUB         E
    DAA
    JR          C,LAB_ram_e54f
    LD          L,A
MONSTER_TAKES_SPRT_DAMAGE:
    LD          A,(CURR_MONSTER_SPRT)
    SUB         L
    DAA
    JR          C,LAB_ram_e557
    JR          Z,LAB_ram_e557
    LD          (CURR_MONSTER_SPRT),A
    JP          REDRAW_MONSTER_HEALTH
LAB_ram_e54f:
    LD          HL,0x3
    CALL        SUB_ram_e401
    JR          MONSTER_TAKES_SPRT_DAMAGE
LAB_ram_e557:
    PUSH        AF
    XOR         A
    LD          (CURR_MONSTER_SPRT),A
    CALL        REDRAW_MONSTER_HEALTH
    POP         AF
    DEC         A
    CP          $86
    JR          C,ITEM_USED_UP
    LD          A,(COLRAM_SPRT_STATS_10)                ;= $60
    CALL        SUB_ram_e5ba
    LD          A,(PLAYER_SPRT_HEALTH_MAX)
    CP          B
    JR          NC,ITEM_USED_UP
REDUCE_ITEM_BY_30:
    CALL        UPDATE_SCR_SAVER_TIMER
    SUB         $30
    JR          C,INCREASE_MAX_SPRT_HEALTH
    CP          C
    JR          NC,ITEM_USED_UP
INCREASE_MAX_SPRT_HEALTH:
    LD          A,(PLAYER_SPRT_HEALTH_MAX)
    ADD         A,0x1
    DAA                                                 ;Correct for BCD
    LD          (PLAYER_SPRT_HEALTH_MAX),A
    LD          A,C
    SUB         $10
    JR          C,ITEM_USED_UP
    LD          C,A
    JR          REDUCE_ITEM_BY_30
ITEM_USED_UP:
    JP          MONSTER_KILLED
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
CLEAR_MONSTER_STATS:
    XOR         A                                       ;A  = $fe on entry (usually)
                                                        ;A  = $00 after
                                                        ;Reset C & N, Set Z
                                                        ;
    LD          (LAST_ITEM_HELD),A                   ;ItemHolder = $00
    LD          BC,$403
    LD          HL,CHRRAM_LEVEL_IDX                     ;= $20
    LD          A,$20
    JP          FILL_CHRCOL_RECT
SUB_ram_e5ba:
    AND         0xf
    INC         A
    INC         A
    LD          B,A
    RLCA
    RLCA
    RLCA
    RLCA
    LD          C,A
    LD          A,B
    ADD         A,A
    DAA
    ADD         A,A
    DAA
    ADD         A,A
    DAA
    ADD         A,A
    DAA
    LD          B,A
    RET
MELEE_ANIM_LOOP:
    CALL        SOUND_05
    LD          A,(MELEE_ANIM_STATE)
    LD          HL,(MONSTER_ATT_POS_COUNT)
    DEC         A
    JP          NZ,LAB_ram_e600
    DEC         L
    JP          NZ,LAB_ram_e5eb
    DEC         H
    JP          Z,LAB_ram_e63f
    LD          A,$32
    LD          (RAM_AF),A
    LD          L,0x2
LAB_ram_e5eb:
    LD          A,0x3
    LD          (MELEE_ANIM_STATE),A
    LD          (MONSTER_ATT_POS_COUNT),HL
    LD          HL,(MONSTER_ATT_POS_OFFSET)
    LD          BC,$29
    ADD         HL,BC
    LD          (MONSTER_ATT_POS_OFFSET),HL
    JP          ANIMATE_MELEE_ROUND
LAB_ram_e600:
    LD          (MELEE_ANIM_STATE),A
    LD          HL,(MONSTER_ATT_POS_OFFSET)
    INC         HL
    LD          (MONSTER_ATT_POS_OFFSET),HL
ANIMATE_MELEE_ROUND:
    LD          BC,$c8
    XOR         A
    SBC         HL,BC
    PUSH        HL
    ADD         HL,BC
    LD          DE,BYTE_ram_3a20
    CALL        UPDATE_MELEE_OBJECTSdb
    POP         BC
    LD          B,0x0
    LD          A,(RAM_AF)
    LD          (MON_FS),A
    LD          A,(BYTE_ram_3a8a)
    CALL        CHK_ITEM
    LD          A,$32
    LD          (MON_FS),A
    LD          A,(TIMER_A)
    ADD         A,$ff
    LD          (BYTE_ram_3a8c),A
    RET
SUB_ram_e635:
    LD          DE,(MONSTER_ATT_POS_OFFSET)
    LD          HL,BYTE_ram_3a20
    JP          SUB_ram_e97d
LAB_ram_e63f:
    CALL        SUB_ram_e635
    LD          A,$31
    LD          (RAM_AF),A
    LD          (RAM_AE),A
    LD          A,(INPUT_HOLDER)
    LD          B,A
    LD          H,0x0
    LD          A,(WEAPON_VALUE_HOLDER)
    LD          L,A
    JR          LAB_ram_e658
LAB_ram_e656:
    ADD         A,L
    DAA
LAB_ram_e658:
    DJNZ        LAB_ram_e656
    LD          L,A
    LD          A,(BYTE_ram_3a8a)
    AND         $fc
    CP          $24
    JR          NZ,LAB_ram_e693
    LD          A,(SHIELD_SPRT)
    LD          E,A
    CALL        SUB_ram_e439
    LD          D,L
    CALL        SUB_ram_e401
    LD          A,L
    ADD         A,D
    DAA
    SUB         E
    DAA
    JR          C,LAB_ram_e68a
    LD          E,A
LAB_ram_e677:
    LD          A,(PLAYER_SPRT_HEALTH)
    SUB         E
    DAA
    JP          C,PLAYER_DIES
    JP          Z,PLAYER_DIES
    LD          (PLAYER_SPRT_HEALTH),A
    CALL        REDRAW_STATS
    JR          LAB_ram_e6be
LAB_ram_e68a:
    LD          HL,0x2
    CALL        SUB_ram_e401
    LD          E,L
    JR          LAB_ram_e677
LAB_ram_e693:
    CALL        SUB_ram_e401
    LD          A,(WEAPON_VALUE_HOLDER)
    ADD         A,L
    DAA
    LD          L,A
    LD          A,H
    ADC         A,0x0
    DAA
    LD          H,A
    LD          DE,(SHIELD_PHYS)
    CALL        RECALC_PHYS_HEALTH
    JR          C,LAB_ram_e6c4
LAB_ram_e6aa:
    EX          DE,HL
    LD          HL,(PLAYER_PHYS_HEALTH)
    CALL        RECALC_PHYS_HEALTH
    JP          C,PLAYER_DIES
    OR          L
    JP          Z,PLAYER_DIES
    LD          (PLAYER_PHYS_HEALTH),HL
    CALL        REDRAW_STATS
LAB_ram_e6be:
    CALL        REDRAW_START
    JP          REDRAW_VIEWPORT
LAB_ram_e6c4:
    LD          HL,0x3
    CALL        SUB_ram_e401
    JR          LAB_ram_e6aa
DO_SWAP_HANDS:
    LD          HL,RIGHT_HAND_ITEM
    LD          BC,LEFT_HAND_ITEM
    CALL        SUB_ram_ea62
    LD          HL,CHRRAM_RIGHT_HD_GFX_IDX              ;= $20
    LD          DE,ITEM_MOVE_CHR_BUFFER
    CALL        UPDATE_MELEE_OBJECTSdb
    LD          HL,CHRRAM_LEFT_HD_GFX_IDX               ;= $20
    LD          DE,CHRRAM_RIGHT_HD_GFX_IDX              ;= $20
    CALL        SUB_ram_e99e
    LD          HL,ITEM_MOVE_CHR_BUFFER
    LD          DE,CHRRAM_LEFT_HD_GFX_IDX               ;= $20
    CALL        SUB_ram_e97d
    CALL        NEW_RIGHT_HAND_ITEM
    LD          BC,0x0
    LD          HL,RIGHT_HAND_ITEM
    CALL        SUB_ram_e720
    LD          A,(SHIELD_SPRT)
    SUB         C
    DAA
    LD          (SHIELD_SPRT),A
    LD          A,(SHIELD_PHYS)
    SUB         B
    DAA
    LD          (SHIELD_PHYS),A
    LD          A,(SHIELD_PHYS+1)
    SBC         A,0x0
    LD          (SHIELD_PHYS+1),A
    LD          BC,0x0
    LD          HL,LEFT_HAND_ITEM
    CALL        SUB_ram_e720
    JP          LAB_ram_e812
SUB_ram_e720:
    LD          A,(HL)
    CP          $14
    RET         NC
    CP          $10
    JR          NC,LAB_ram_e72b
    CP          0x4
    RET         NC
LAB_ram_e72b:
    AND         0x3
    INC         A
    CALL        SUB_ram_e9c1
    LD          A,(HL)
    AND         $fc
    RET         NZ
    LD          H,0x0
    LD          L,B
    CALL        SUB_ram_e439
    LD          B,L
    LD          L,C
    CALL        SUB_ram_e439
    LD          C,L
    RET
NEW_RIGHT_HAND_ITEM:
    LD          A,(RIGHT_HAND_ITEM)
    CP          $18                                    ;Less than RED Bow
    JR          C,LAB_ram_e7c0
    CP          $34                                    ;Greater than WHITE Crossbow
    JR          NC,LAB_ram_e7c0
    LD          BC,0x0                                  ;C = 0
    LD          E,0x0                                   ;E = 0
    SRL         A                                       ;Div A by 2
    RR          B
    RRA
    RL          B
    RL          B
    SUB         0x6
    JR          NZ,LAB_ram_e763
    LD          D,0x6
    JR          LAB_ram_e78b
LAB_ram_e763:
    DEC         A
    JR          NZ,LAB_ram_e76a
    LD          D,0x6
    JR          LAB_ram_e79e
LAB_ram_e76a:
    DEC         A
    JR          NZ,LAB_ram_e771
    LD          D,$16
    JR          LAB_ram_e78b
LAB_ram_e771:
    DEC         A
    JR          NZ,LAB_ram_e778
    LD          D,$20
    JR          LAB_ram_e79e
LAB_ram_e778:
    DEC         A
    JR          NZ,LAB_ram_e77f
    LD          D,$24
    JR          LAB_ram_e78b
LAB_ram_e77f:
    DEC         A
    JR          NZ,LAB_ram_e786
    LD          D,$15
    JR          LAB_ram_e79e
LAB_ram_e786:
    DEC         A
    LD          D,$18
    NOP
    NOP
LAB_ram_e78b:
    CALL        CALC_WEAPON_VALUE
    ADD         A,A
    DAA                                                 ;BCD Correction
    LD          L,A
    LD          A,0x0
    RLA
    LD          H,A
    LD          (WEAPON_PHYS),HL
    XOR         A
    LD          (WEAPON_SPRT),A
    JR          LAB_ram_e7aa
LAB_ram_e79e:
    CALL        CALC_WEAPON_VALUE
    LD          (WEAPON_SPRT),A
    LD          HL,0x0
    LD          (WEAPON_PHYS),HL
LAB_ram_e7aa:
    LD          DE,CHRRAM_PHYS_WEAPON_IDX               ;= $20
    LD          HL,WEAPON_PHYS
    LD          B,0x2
    CALL        RECALC_AND_REDRAW_BCD
    LD          DE,CHRRAM_SPRT_WEAPON_IDX               ;= $20
    LD          HL,WEAPON_SPRT
    LD          B,0x1
    JP          RECALC_AND_REDRAW_BCD
LAB_ram_e7c0:
    LD          HL,0x0                                  ;HL = 0
    XOR         A                                       ;A  = 0
    LD          (WEAPON_PHYS),HL
    LD          (WEAPON_SPRT),A
    JR          LAB_ram_e7aa
DO_PICK_UP:
    LD          A,(ITEM_HOLDER)
    LD          B,A
    LD          A,(PLAYER_MAP_POS)
    CP          B                                       ;Check difference between
                                                        ;item and item location
    JP          Z,NO_ACTION_TAKEN
    INC         A
    JP          Z,NO_ACTION_TAKEN
    DEC         A
    CALL        ITEM_MAP_CHECK
    JR          Z,LAB_ram_e844
    CP          0x4                                     ;Compare to RING (0x4)
    JR          C,CHECK_FOOD_ARROWS                     ;Jump if less than RING (C)
    CP          $10                                    ;Compare to PAVISE ($10)
    JR          NC,CHECK_FOOD_ARROWS                    ;Jump if PAVISE or greater (NC)
PROCESS_RHA:
    CALL        PICK_UP_F0_ITEM
    LD          HL,ARMOR_INV_SLOT                       ;Start with ARMOR slot
    DEC         A                                       ;Subtract 1 from A:
                                                        ;- Armor
    JR          NZ,NOT_ARMOR                            ;Treat as NOT ARMOR
    INC         HL                                      ;HL = HELMET_INV_SLOT
    INC         HL                                      ;HL = RING_INV_SLOT
NOT_ARMOR:
    DEC         A
    JR          NZ,NOT_HELMET
    INC         HL
NOT_HELMET:
    LD          A,(HL)
    INC         D
    CP          D
    JP          NC,INPUT_DEBOUNCE
    EX          AF,AF'
    LD          A,D
    LD          (HL),A
    CALL        SUB_ram_e9c1
    LD          E,C
    LD          D,B
    EX          AF,AF'
    CALL        SUB_ram_e9c1
    LD          A,E
    SUB         C
    DAA                                                 ;BCD Correction
    LD          C,A
    LD          A,D
    SUB         B
    DAA                                                 ;BCD Correction
    LD          B,A
LAB_ram_e812:
    LD          A,(SHIELD_SPRT)
    ADD         A,C
    DAA                                                 ;BCD Correction
    LD          (SHIELD_SPRT),A
    LD          A,(SHIELD_PHYS)
    ADD         A,B
    DAA                                                 ;BCD Correction
    LD          (SHIELD_PHYS),A
    LD          A,(SHIELD_PHYS+1)
    ADC         A,0x0
    DAA                                                 ;BCD Correction
    LD          (SHIELD_PHYS+1),A
    LD          HL,SHIELD_PHYS
    LD          DE,CHRRAM_PHYS_SHIELD_IDX               ;= $20
    LD          B,0x2
    CALL        RECALC_AND_REDRAW_BCD
    LD          HL,SHIELD_SPRT
    LD          DE,CHRRAM_SPRT_SHIELD_IDX               ;= $20
    LD          B,0x1
    CALL        RECALC_AND_REDRAW_BCD
    JP          RHA_REDRAW                              ;Was JP AWAITING_INPUT
                                                        ;(c3 9c ea)
LAB_ram_e844:
    CALL        Z,SUB_ram_e9e1
CHECK_FOOD_ARROWS:
    CP          $48
    JR          C,CHECK_MAP_NECKLACE_CHARMS             ;CHEST or lower
    CP          $50
    JR          NC,CHECK_MAP_NECKLACE_CHARMS            ;LOCKED CHEST or higher
    CALL        PICK_UP_F0_ITEM
    INC         D
    RL          D
    INC         D
    CP          $12
    JR          NZ,PICK_UP_ARROWS
    PUSH        DE
    CALL        PICK_UP_FOOD
    POP         DE
    CALL        PICK_UP_FOOD
    JP          INPUT_DEBOUNCE
PICK_UP_FOOD:
    LD          A,(FOOD_INV)
    ADD         A,D
    JR          NC,LAB_ram_e872
    INC         A
    LD          C,A
    LD          A,D
    SUB         C
    LD          D,A
    JR          PICK_UP_FOOD
LAB_ram_e872:
    LD          (FOOD_INV),A
    LD          HL,(BYTE_ram_3aa9)
    LD          A,D
    ADD         A,L
    DAA                                                 ;BCD correct
    LD          L,A
    LD          A,H
    ADC         A,0x0
    DAA                                                 ;BCD correct
    LD          H,A
    LD          (BYTE_ram_3aa9),HL
    RET
PICK_UP_ARROWS:
    LD          A,(ARROW_INV)
    ADD         A,D
    CP          $33
    JR          C,ADD_ARROWS_TO_INV
    LD          A,$32
ADD_ARROWS_TO_INV:
    LD          (ARROW_INV),A
    JP          INPUT_DEBOUNCE
CHECK_MAP_NECKLACE_CHARMS:
    CP          $6c                                    ;Red MAP
    JR          Z,PROCESS_MAP
    CP          $6d                                    ;Yellow MAP
    JR          Z,PROCESS_MAP
    CP          $de                                    ;Purple MAP
    JR          Z,PROCESS_MAP
    CP          $df                                    ;White MAP
    JR          Z,PROCESS_MAP
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    CP          $5c                                    ;WHITE KEY or lower
    JR          C,PICK_UP_NON_TREASURE
    CP          $64
    JR          NC,PICK_UP_NON_TREASURE                 ;WARRIOR POTION or higher
    CALL        PICK_UP_F0_ITEM
    JP          INPUT_DEBOUNCE
PROCESS_MAP:
    PUSH        AF
    LD          A,(GAME_BOOLEANS)
    SET         0x2,A
    LD          (GAME_BOOLEANS),A
    POP         AF
    CALL        PICK_UP_F0_ITEM
    LD          (MAP_INV_SLOT),DE
    PUSH        AF
    LD          A,(MAP_INV_SLOT)
    CALL        LEVEL_TO_COLRAM_FIX
    LD          (COLRAM_MAP_IDX),A                      ;= $60    `
    POP         AF
    JP          INPUT_DEBOUNCE
PICK_UP_NON_TREASURE:
    LD          HL,RIGHT_HAND_ITEM
    LD          A,(HL)
    LD          (ITEM_F0),A                             ;= $60
    CALL        SUB_ram_ea62
    LD          HL,CHRRAM_RIGHT_HD_GFX_IDX              ;= $20
    LD          DE,ITEM_MOVE_CHR_BUFFER
    CALL        UPDATE_MELEE_OBJECTSdb
    LD          HL,CHRRAM_FO_ITEM_IDX                   ;= $20
    LD          DE,CHRRAM_RIGHT_HD_GFX_IDX              ;= $20
    CALL        SUB_ram_e99e
    LD          HL,ITEM_MOVE_CHR_BUFFER
    LD          DE,CHRRAM_FO_ITEM_IDX                   ;= $20
    CALL        SUB_ram_e97d
    LD          HL,COLRAM_FO_ITEM_IDX                   ;= $60    `
    LD          DE,$f00                                ;BLK on DKGY /
                                                        ;BLK on BLK
                                                        ;WAS BLK on DKCYN /
                                                        ;    BLK on BLK
                                                        ;WAS LD DE,$0900
    LD          C,$f0                                  ;Floor color (for compare)
                                                        ;DKGRY on BLK
                                                        ;WAS DKCYN on BLK
    CALL        RECOLOR_ITEM
    LD          HL,COLRAM_RH_ITEM_IDX                   ;= $60    `
    LD          DE,$f0                                 ;Floor color (for fill)
                                                        ;DKGRY on BLK
                                                        ;WAS DKCYN on BLK
    LD          C,0x0
    CALL        RECOLOR_ITEM
    CALL        NEW_RIGHT_HAND_ITEM
    JP          INPUT_DEBOUNCE
RECOLOR_ITEM:
    LD          A,0x4
LAB_ram_e91c:
    EX          AF,AF'
    LD          B,0x4
LAB_ram_e91f:
    LD          A,(HL)
    AND         $f0
    CP          E
    JR          Z,LAB_ram_e935
    OR          D
LAB_ram_e926:
    LD          (HL),A
    INC         HL
    DJNZ        LAB_ram_e91f
    PUSH        DE
    LD          DE,$24                                 ;Jump ahead 36 cells
                                                        ;(40 - 4)
    ADD         HL,DE
    POP         DE
    EX          AF,AF'
    DEC         A
    JR          NZ,LAB_ram_e91c
    RET
LAB_ram_e935:
    LD          A,(HL)
    AND         0xf
    OR          C
    JR          LAB_ram_e926
WAIT_A_TICK:
    LD          BC,$8600                               ;Sleep for 134 "cycles"
    JP          SLEEP                                   ;byte SLEEP(short cycleCount)
PICK_UP_F0_ITEM:
    AND         A                                       ;Reset flags
    EX          AF,AF'                                  ;Save item
    LD          A,$fe                                  ;Empty item
    LD          (BC),A
    LD          HL,CHRRAM_FO_ITEM_IDX                   ;= $20
    LD          A,$20                                  ;SPACE char
    CALL        UPDATE_FO_ITEM
    LD          HL,COLRAM_FO_ITEM_IDX                   ;= $60    `
    LD          A,$df                                  ;DKGRN on DKGRY
    CALL        UPDATE_FO_ITEM
    EX          AF,AF'                                  ;Restore item
    RRA                                                 ;Rotate A right, A:0 to carry
    RR          D                                       ;Rotate D right
                                                        ;Carry (from A:0) to D:7
    RRA                                                 ;Rotate A right, A:0 (was A:1) to carry
    RL          D                                       ;Rotate D left, carry to D:0
                                                        ;D:7 to carry
    RL          D                                       ;Rotate D left, carry to D;0
                                                        ;D:7 to carry
                                                        ;D  = item level
    RET
UPDATE_MELEE_OBJECTSdb:
    LD          A,0x4
LAB_ram_e962:
    LD          BC,0x4
    LDIR                                                ;= "OM"
    DEC         A
    JP          Z,LAB_ram_e972
    LD          BC,$24
    ADD         HL,BC
    JP          LAB_ram_e962
LAB_ram_e972:
    LD          A,H
    CP          $34
    RET         NC
    LD          BC,$384
    ADD         HL,BC
    JP          UPDATE_MELEE_OBJECTSdb
SUB_ram_e97d:
    LD          A,0x4
LAB_ram_e97f:
    LD          BC,0x4
    LDIR                                                ;= "OM"
    DEC         A
    JP          Z,LAB_ram_e991
    EX          DE,HL
    LD          BC,$24
    ADD         HL,BC
    EX          DE,HL
    JP          LAB_ram_e97f
LAB_ram_e991:
    LD          A,D
    CP          $34
    RET         NC
    LD          BC,$384
    EX          DE,HL
    ADD         HL,BC
    EX          DE,HL
    JP          SUB_ram_e97d
SUB_ram_e99e:
    LD          A,0x4
LAB_ram_e9a0:
    LD          BC,0x4
    LDIR                                                ;= "OM"
    DEC         A
    JP          Z,LAB_ram_e9b3
    LD          BC,$24
    ADD         HL,BC
    EX          DE,HL
    ADD         HL,BC
    EX          DE,HL
    JP          LAB_ram_e9a0
LAB_ram_e9b3:
    LD          A,H
    CP          $34
    RET         NC
    LD          BC,$384
    ADD         HL,BC
    EX          DE,HL
    ADD         HL,BC
    EX          DE,HL
    JP          SUB_ram_e99e
SUB_ram_e9c1:
    DEC         A
    JR          NZ,LAB_ram_e9c8
    LD          BC,$501                                ;PHYS = 5
                                                        ;SPRT = 1
    RET
LAB_ram_e9c8:
    DEC         A
    JR          NZ,LAB_ram_e9cf
    LD          BC,$804
    RET
LAB_ram_e9cf:
    DEC         A
    JR          NZ,LAB_ram_e9d6
    LD          BC,LAB_ram_1208
    RET
LAB_ram_e9d6:
    DEC         A
    JR          NZ,LAB_ram_e9dd
    LD          BC,BYTE_ram_2613                        ;= $FF
    RET
LAB_ram_e9dd:
    LD          BC,0x0
    RET
SUB_ram_e9e1:
    LD          A,(RIGHT_HAND_ITEM)
    CP          $fe
    JR          NZ,LAB_ram_e9ec
    POP         HL
    JP          NO_ACTION_TAKEN
LAB_ram_e9ec:
    LD          A,$ff
    LD          (BC),A
    DEC         C
    DEC         C
    LD          A,H
    LD          (BC),A
    INC         C
    LD          A,$fe
    LD          (BC),A
    RET
DO_ROTATE_PACK:
    LD          HL,INV_ITEM_SLOT_1
    LD          BC,ITEM_MOVE_COL_BUFFER
    XOR         A
    LD          (BC),A
    CALL        SUB_ram_ea62
    INC         HL
    LD          BC,INV_ITEM_SLOT_1
    CALL        SUB_ram_ea62
    LD          E,0x4
LAB_ram_ea0c:
    INC         HL
    INC         BC
    CALL        SUB_ram_ea62
    DEC         E
    JP          NZ,LAB_ram_ea0c
    LD          HL,ITEM_MOVE_COL_BUFFER
    INC         BC
    CALL        SUB_ram_ea62
    LD          HL,DAT_ram_31b4                         ;= $20
    LD          DE,ITEM_MOVE_CHR_BUFFER
    CALL        UPDATE_MELEE_OBJECTSdb
    LD          HL,DAT_ram_3111                         ;= $20
    LD          DE,DAT_ram_31b4                         ;= $20
    CALL        SUB_ram_e99e
    LD          HL,DAT_ram_310c                         ;= $20
    LD          DE,DAT_ram_3111                         ;= $20
    CALL        SUB_ram_e99e
    LD          HL,CHHRAM_INV_4_IDX                     ;= $20
    LD          DE,DAT_ram_310c                         ;= $20
    CALL        SUB_ram_e99e
    LD          HL,DAT_ram_324c                         ;= $20
    LD          DE,CHHRAM_INV_4_IDX                     ;= $20
    CALL        SUB_ram_e99e
    LD          HL,CHHRAM_INV_6_IDX                     ;= $20
    LD          DE,DAT_ram_324c                         ;= $20
    CALL        SUB_ram_e99e
    LD          HL,WAIT_FOR_INPUT                    ; WAIT FOR INPUT label --- UNDO???
    PUSH        HL
    LD          HL,ITEM_MOVE_CHR_BUFFER
    LD          DE,CHHRAM_INV_6_IDX                     ;= $20
    CALL        SUB_ram_e97d
    JP          WAIT_A_TICK
SUB_ram_ea62:
    LD          D,(HL)
    LD          A,(BC)
    LD          (HL),A
    LD          A,D
    LD          (BC),A
    RET
DO_SWAP_PACK:
    LD          HL,INV_ITEM_SLOT_1
    LD          BC,RIGHT_HAND_ITEM
    CALL        SUB_ram_ea62
    LD          HL,CHRRAM_RIGHT_HD_GFX_IDX              ;= $20
    LD          DE,ITEM_MOVE_CHR_BUFFER
    CALL        UPDATE_MELEE_OBJECTSdb
    LD          HL,DAT_ram_31b4                         ;= $20
    LD          DE,CHRRAM_RIGHT_HD_GFX_IDX              ;= $20
    CALL        SUB_ram_e99e
    LD          HL,WAIT_FOR_INPUT                    ; WAIT FOR INPUT label --- UNDO???
    PUSH        HL
    LD          HL,ITEM_MOVE_CHR_BUFFER
    LD          DE,DAT_ram_31b4                         ;= $20
    CALL        SUB_ram_e97d
    CALL        NEW_RIGHT_HAND_ITEM
    JP          WAIT_A_TICK
UPDATE_VIEWPORT:
    CALL        REDRAW_START
    CALL        REDRAW_VIEWPORT
INPUT_DEBOUNCE:
    CALL        WAIT_A_TICK
WAIT_FOR_INPUT:
    CALL        TIMER_UPDATE
    CALL        BLINK_ROUTINE
    NOP
    NOP
    NOP
    NOP
    JR          NC,TIMER_UPDATED_CHECK_INPUT
    LD          HL,TIMER_C
    INC         (HL)
    LD          A,(HL)
    CP          $15
    JP          C,TIMER_UPDATED_CHECK_INPUT
    XOR         A
    LD          (HL),A
SCREEN_SAVER_FULL_SCREEN:
    LD          HL,$800
SCREEN_SAVER_REDRAW_LOOP:
    LD          DE,COLRAM                               ;= $60
RECALC_SCREEN_SAVER_COLORS:
    LD          A,(DE)                          ;= $60
    RRCA
    LD          (DE),A                          ;= $60
    INC         DE
    LD          A,$38
    CP          D
    JR          NZ,RECALC_SCREEN_SAVER_COLORS
    DEC         H
    JR          NZ,CHECK_INPUT_DURING_SCREEN_SAVER
    LD          H,0x8
CHECK_INPUT_DURING_SCREEN_SAVER:
    DEC         L
    JR          Z,SCREEN_SAVER_REDRAW_LOOP
    LD          BC,$140
    CALL        SLEEP                                   ;byte SLEEP(short cycleCount)
    LD          BC,$ff
    IN          A,(C)
    INC         A
    JR          NZ,LAB_ram_eaf5
    LD          C,$f7
    LD          A,0xf
    OUT         (C),A                              ;= db
    DEC         C
    IN          A,(C)                     ;= db
    INC         A
    JP          NZ,LAB_ram_eaf5
    INC         C
    LD          A,0xe
    OUT         (C),A                              ;= db
    DEC         C
    IN          A,(C)                     ;= db
    INC         A
    JP          Z,CHECK_INPUT_DURING_SCREEN_SAVER
LAB_ram_eaf5:
    LD          DE,COLRAM                               ;= $60
LAB_ram_eaf8:
    LD          B,H
    LD          A,(DE)                          ;= $60
LAB_ram_eafa:
    RRCA
    DJNZ        LAB_ram_eafa
    LD          (DE),A                          ;= $60
    INC         DE                  ;= $60
    LD          A,$38
    CP          D
    JR          NZ,LAB_ram_eaf8
    JR          INPUT_DEBOUNCE
TIMER_UPDATED_CHECK_INPUT:
    LD          A,(RAM_AD)
    CP          $32
    JR          Z,LAB_ram_eb53
    LD          A,(RAM_AE)
    CP          $31
    JR          NZ,LAB_ram_eb27
    LD          HL,TIMER_A
    LD          A,(BYTE_ram_3a89)
    CP          (HL)
    JP          NZ,WAIT_FOR_INPUT
    CALL        SUB_ram_e450
    CALL        SUB_ram_e39a
    JP          WAIT_FOR_INPUT
LAB_ram_eb27:
    LD          HL,TIMER_A
    LD          A,(BYTE_ram_3a8c)
    CP          (HL)
    JP          NZ,WAIT_FOR_INPUT
    CALL        SUB_ram_e635
    CALL        SUB_ram_e450
    CALL        SUB_ram_e39a
    CALL        MELEE_ANIM_LOOP
    JP          WAIT_FOR_INPUT
LAB_ram_eb40:
    LD          HL,TIMER_A
    LD          A,(BYTE_ram_3a8c)
    CP          (HL)
    JP          NZ,WAIT_FOR_INPUT
    CALL        SUB_ram_e635
    CALL        MELEE_ANIM_LOOP
    JP          WAIT_FOR_INPUT
LAB_ram_eb53:
    LD          A,(RAM_AE)
    CP          $31
    JR          NZ,LAB_ram_eb40
    CALL        UPDATE_SCR_SAVER_TIMER
    LD          A,(LAST_ITEM_HELD)
    AND         A
    JP          NZ,LAB_ram_ebd6
    LD          B,0x4
    LD          HL,ITEM_F1                              ;= $60
    LD          A,(HL)                         ;= $60
    INC         A
    INC         A
    LD          HL,ITEM_FR1                             ;= $60
LAB_ram_eb6f:
    CP          $7a
    JR          NC,LAB_ram_eb7b
    INC         HL
    LD          A,(HL)                         ;= $60
    INC         A
    INC         A
    DJNZ        LAB_ram_eb6f
    JR          LAB_ram_ebd6
LAB_ram_eb7b:
    LD          A,(TIMER_D)
    CP          0x5
    JR          NC,LAB_ram_ebd6
    CALL        MAKE_RANDOM_BYTE
    ADD         A,0x8
    JR          NC,LAB_ram_ebd6
    DEC         B
    JR          NZ,LAB_ram_eb9e
    LD          A,(WALL_B0_STATE)                        ;= $20
    BIT         0x2,A
    JR          NZ,LAB_ram_eb96
    AND         A
    JR          NZ,LAB_ram_ebd6
LAB_ram_eb96:
    CALL        SUB_ram_ee23
    CALL        SUB_ram_ee23
    JR          LAB_ram_ebc0
LAB_ram_eb9e:
    DEC         B
    JR          NZ,LAB_ram_ebb0
    LD          A,(WALL_L0_STATE)                        ;= $20
    BIT         0x2,A
    JR          NZ,LAB_ram_ebab
    AND         A
    JR          NZ,LAB_ram_ebd6
LAB_ram_ebab:
    CALL        SUB_ram_ee0b
    JR          LAB_ram_ebc0
LAB_ram_ebb0:
    DEC         B
    JR          NZ,LAB_ram_ebcc
    LD          A,(WALL_R0_STATE)                        ;= $20
    BIT         0x2,A
    JR          NZ,LAB_ram_ebbd
    AND         A
    JR          NZ,LAB_ram_ebd6
LAB_ram_ebbd:
    CALL        SUB_ram_ee23
LAB_ram_ebc0:
    CALL        REDRAW_START
    CALL        REDRAW_VIEWPORT
LAB_ram_ebc6:
    CALL        SUB_ram_cd5f
    JP          SUB_ram_f130
LAB_ram_ebcc:
    LD          A,(WALL_F0_STATE)                       ;= $20
    BIT         0x2,A
    JR          NZ,LAB_ram_ebc6
    AND         A
    JR          Z,LAB_ram_ebc6
LAB_ram_ebd6:
    LD          BC,$ff
    IN          A,(C)
    INC         A
    JP          NZ,LAB_ram_ec52
    LD          C,$f7
    LD          A,0xf
    OUT         (C),A                              ;= db
    DEC         C
    IN          A,(C)                     ;= db
    INC         A
    JR          NZ,LAB_ram_ebf7
    INC         C
    LD          A,0xe
    OUT         (C),A                              ;= db
    DEC         C
    IN          A,(C)                     ;= db
    INC         A
    JP          Z,WAIT_FOR_INPUT
LAB_ram_ebf7:
    CALL        PLAY_DESCENDING_SOUND
    LD          HL,HC_INPUT_HOLDER                      ;= $6060
DISABLE_JOY_04:
    LD          C,$f7
    LD          A,0xf
    OUT         (C),A                              ;= db
    DEC         C
    IN          A,(C)                     ;= db
    LD          (HL),A                 ;= $6060
    INC         HL
    INC         C
ENABLE_JOY_04:
    LD          A,0xe
    OUT         (C),A                              ;= db
    DEC         C
    IN          A,(C)                     ;= db
    LD          (HL),A
    LD          A,(INPUT_HOLDER)
    AND         A
    JP          NZ,HC_JOY_INPUT_COMPARE
    LD          A,(DUNGEON_LEVEL)
    AND         A
    JP          NZ,GAMEINIT
    LD          A,(HL)
    INC         A
    JR          Z,TITLE_CHK_FOR_HC_INPUT
HC_LEVEL_SELECT_LOOP:
    CP          $60                                    ;K3 pressed on title screen
    JR          Z,SET_DIFFICULTY_1
    CP          $7c
    JR          Z,SET_DIFFICULTY_2
    CP          $c0
    JR          Z,SET_DIFFICULTY_3
    JR          SET_DIFFICULTY_4
TITLE_CHK_FOR_HC_INPUT:
    DEC         HL
    LD          A,(HL)                 ;= $6060
    INC         A
    JR          HC_LEVEL_SELECT_LOOP
PLAY_DESCENDING_SOUND:
    XOR         A
    LD          (TIMER_A),A
    LD          (TIMER_B),A
    LD          (TIMER_C),A
    OUT         (SPEAKER),A                             ;= db
    LD          BC,$f0
    CALL        SLEEP                                   ;byte SLEEP(short cycleCount)
    INC         A
    OUT         (SPEAKER),A                             ;= db
    LD          BC,$4c0
    CALL        SLEEP                                   ;byte SLEEP(short cycleCount)
    RET
LAB_ram_ec52:
    CALL        PLAY_DESCENDING_SOUND
    LD          HL,KEY_INPUT_COL0                       ;= $60
    LD          BC,GFX_POINTERS
    LD          D,0x8
SELECT_DIFFICULTY_LOOP:
    IN          A,(C)
    LD          (HL),A                  ;= $20
                                                        ;= $60
    INC         L
    RLC         B
    DEC         D
    JR          NZ,SELECT_DIFFICULTY_LOOP
    LD          A,(INPUT_HOLDER)
    AND         A
    JP          NZ,KEY_COMPARE                          ;OLD = e12c ; NEW = fbe0
    LD          A,(DUNGEON_LEVEL)
    AND         A
    JP          NZ,GAMEINIT
    LD          A,(KEY_INPUT_COL6)                      ;= $60
    CP          $fe
    JR          Z,SET_DIFFICULTY_1                      ;Key 3 pressed on Title Screen
    CP          $df
    JP          Z,SHOW_AUTHOR                           ;Key A pressed (and held)
                                                        ;on title screen
    LD          A,(KEY_INPUT_COL7)                      ;= $60
    CP          $fe
    JR          Z,SET_DIFFICULTY_2                      ;Key 2 pressed on Title Screen
    CP          $fb
    JR          Z,SET_DIFFICULTY_3                      ;Key 1 pressed on Title Screen
SET_DIFFICULTY_4:
    LD          A,0x0                                   ;Some other key pressed on Title Screen
GOTO_GAME_START:
    LD          (INPUT_HOLDER),A
    LD          A,(GAME_BOOLEANS)
    SET         0x0,A
    LD          (GAME_BOOLEANS),A
    JP          BLANK_SCRN
SET_DIFFICULTY_1:
    LD          A,0x1
    JR          GOTO_GAME_START
SET_DIFFICULTY_2:
    LD          A,0x2
    JR          GOTO_GAME_START
SET_DIFFICULTY_3:
    LD          A,0x3
    JR          GOTO_GAME_START
    NOP
    NOP
    NOP
    NOP
    NOP
CHK_ITEM:
    CP          $fe
    RET         Z
    SRL         A
    LD          E,A
    JP          C,LAB_ram_ecba
    LD          D,$10
    JP          LAB_ram_ecbc
LAB_ram_ecba:
    LD          D,$30
LAB_ram_ecbc:
    SRL         A
    JP          NC,LAB_ram_ecc5
    LD          A,$40
    ADD         A,D
    LD          D,A
LAB_ram_ecc5:
    RES         0x0,E
    LD          A,E
    SLA         A
    ADD         A,E
    ADD         A,B
    LD          B,D
    LD          L,A
    LD          H,$ff
    LD          E,(HL)
    INC         HL
    LD          D,(HL)
    LD          A,(MON_FS)
    LD          H,A
    LD          L,C
    JP          GFX_DRAW
DO_OPEN_CLOSE:
    LD          A,(ITEM_F0)                             ;= $60
    LD          C,0x0                                   ;C  = 0
    SRL         A                                       ;Move item LEVEL
                                                        ;into C
    RR          C
    SRL         A
    RL          C
    RL          C
    CP          $11                                    ;Compare to BOX
                                                        ;44,45,46,47 2 @ SRL = 11
    JR          NZ,LAB_ram_ed1b
    LD          A,C                                     ;A = C (item level)
    AND         A
    JR          Z,DO_OPEN_BOX
    CALL        UPDATE_SCR_SAVER_TIMER
    INC         C
LAB_ram_ecf6:
    SUB         C
    JR          NC,LAB_ram_ecf6
    ADD         A,C
    LD          C,A
DO_OPEN_BOX:
    LD          A,R                                     ;Semi-random number into A
    AND         0x7
PICK_RANDOM_ITEM:
    SUB         0x7
    JR          NC,PICK_RANDOM_ITEM
    ADD         A,$1d                                  ;$1d is +1 above range
    RR          C
    RR          B
    RR          C                                       ;C = C/8
    RLA
    RL          B
    RLA
    EX          AF,AF'
    LD          A,(PLAYER_MAP_POS)
    CALL        ITEM_MAP_CHECK
    EX          AF,AF'
    LD          (BC),A
    JP          UPDATE_VIEWPORT
LAB_ram_ed1b:
    LD          A,(PLAYER_MAP_POS)
    LD          H,$38
    LD          L,A
    LD          A,(DIR_FACING_SHORT)
    DEC         A
    JR          Z,NORTH_OPEN_CLOSE_DOOR                 ;Is facing NORTH
    DEC         A
    JR          Z,SHIFT_EAST_OPEN_CLOSE_DOOR            ;Is facing EAST
    DEC         A
    JR          NZ,LAB_ram_ed4b                         ;Is facing WEST
    LD          A,L                                     ;Is facing SOUTH
    ADD         A,$10
    LD          L,A                                     ;Shift SOUTH and process as NORTH
NORTH_OPEN_CLOSE_DOOR:
    BIT         0x6,(HL)                                ;N WALL check
    JP          Z,NO_ACTION_TAKEN                       ;...if no N WALL
    BIT         0x5,(HL)                                ;N hidden DOOR check
    JR          Z,SET_N_DOOR_MASK                       ;...if no N hidden DOOR
    LD          A,$44                                  ;WALL mask
    JR          OPEN_N_CHECK
SET_N_DOOR_MASK:
    LD          A,$22                                  ;DOOR mask
OPEN_N_CHECK:
    BIT         0x7,(HL)                                ;N DOOR-OPEN check
    JP          NZ,CLOSE_N_DOOR                         ;...if N DOOR not OPEN
    SET         0x7,(HL)                                ;Set N door closed on wall map
    JP          SET_F0_DOOR_OPEN
SHIFT_EAST_OPEN_CLOSE_DOOR:
    INC         L                                       ;Shift EAST and process as WEST
LAB_ram_ed4b:
    BIT         0x1,(HL)                                ;W WALL check
    JP          Z,NO_ACTION_TAKEN                       ;...if no W WALL
    BIT         0x0,(HL)                                ;W DOOR check
    JP          Z,SET_W_DOOR_MASK                       ;...if no W DOOR
    LD          A,$44                                  ;WALL mask
    JP          LAB_ram_ed5c
SET_W_DOOR_MASK:
    LD          A,$22
LAB_ram_ed5c:
    BIT         0x2,(HL)                                ;DOOR-OPEN check
    JP          NZ,CLOSE_W_DOOR                         ;...if DOOR-OPEN
    SET         0x2,(HL)                                ;Set W door closed on wall map
SET_F0_DOOR_OPEN:
    LD          HL,WALL_F0_STATE                        ;= $20
    SET         0x2,(HL)                 ;= $20
    EX          AF,AF'                                  ;Save MASK state from A
WAIT_TO_REDRAW_F0_DOOR:
    IN          A,(VSYNC)                               ;= db
    INC         A
    JR          Z,WAIT_TO_REDRAW_F0_DOOR
    LD          A,0x0                                   ;BLK on BLK
                                                        ;WAS BLU on BLU
                                                        ;WAS LD A,$bb
    CALL        DRAW_DOOR_F0
    LD          A,(ITEM_F1)                             ;= $60
    LD          BC,$28a
    CALL        CHK_ITEM
    LD          HL,COLRAM_F0_DOOR_IDX                   ;= $60
    LD          DE,ITEM_MOVE_CHR_BUFFER
    CALL        SUB_ram_edaf
    CALL        SETUP_OPEN_DOOR_SOUND
    EXX
    LD          HL,BYTE_ram_3a58
    LD          DE,DAT_ram_3728                         ;= $60
    LD          A,0xc
LAB_ram_ed91:
    EX          AF,AF'
    EXX
    CALL        LO_HI_PITCH_SOUND
    EXX
    LD          BC,0x8
    LDIR                                                ;= $60
    LD          BC,$10
    SBC         HL,BC
    EX          DE,HL
    LD          BC,$30
    SBC         HL,BC
    EX          DE,HL
    EX          AF,AF'
    DEC         A
    JP          Z,WAIT_FOR_INPUT
    JR          LAB_ram_ed91
SUB_ram_edaf:
    LD          A,0xc
LAB_ram_edb1:
    LD          BC,0x8
    LDIR
    LD          BC,$20
    ADD         HL,BC
    DEC         A
    JR          NZ,LAB_ram_edb1
    EX          AF,AF'
    JP          DRAW_DOOR_F0
CLOSE_N_DOOR:
    RES         0x7,(HL)                                ;Set N Door map flag to closed
    JP          START_DOOR_CLOSE_ANIM
CLOSE_W_DOOR:
    RES         0x2,(HL)                                ;Set W Door map flag to closed
START_DOOR_CLOSE_ANIM:
    LD          HL,WALL_F0_STATE                        ;= $20
    RES         0x2,(HL)                 ;= $20
    EX          AF,AF'
    LD          A,(PLAYER_MAP_POS)
    LD          (PLAYER_PREV_MAP_LOC),A
    CALL        SETUP_CLOSE_DOOR_SOUND
    EXX
    EX          AF,AF'
    LD          HL,COLRAM_F0_DOOR_IDX                   ;= $60
    LD          DE,$20
    LD          BC,$c08
DOOR_CLOSE_ANIM_LOOP:
    LD          (HL),A              ;= $60
    INC         L
    DEC         C
    JP          NZ,DOOR_CLOSE_ANIM_LOOP
    EXX
    EX          AF,AF'
    CALL        HI_LO_PITCH_SOUND
    EX          AF,AF'
    EXX
    LD          C,0x8
    ADD         HL,DE
    DJNZ        DOOR_CLOSE_ANIM_LOOP
    CALL        CLEAR_MONSTER_STATS
    JP          WAIT_FOR_INPUT
    LD          BC,$1600
    JP          SLEEP                                   ;byte SLEEP(short cycleCount)
DO_TURN_LEFT:
    LD          A,(LAST_ITEM_HELD)
    AND         A
    JP          NZ,NO_ACTION_TAKEN
    LD          HL,UPDATE_VIEWPORT
    PUSH        HL
SUB_ram_ee0b:
    LD          A,(DIR_FACING_SHORT)
    DEC         A
    JP          NZ,LAB_ram_ee14
    LD          A,0x4
LAB_ram_ee14:
    LD          (DIR_FACING_SHORT),A
    RET
DO_TURN_RIGHT:
    LD          A,(LAST_ITEM_HELD)
    AND         A
    JP          NZ,NO_ACTION_TAKEN
    LD          HL,UPDATE_VIEWPORT
    PUSH        HL
SUB_ram_ee23:
    LD          A,(DIR_FACING_SHORT)
    INC         A
    CP          0x5
    JP          NZ,LAB_ram_ee2e
    LD          A,0x1
LAB_ram_ee2e:
    LD          (DIR_FACING_SHORT),A
    RET
DO_GLANCE_RIGHT:
    LD          A,(LAST_ITEM_HELD)
    AND         A
    JP          NZ,NO_ACTION_TAKEN
    CALL        SUB_ram_ee23
    CALL        REDRAW_START
    CALL        REDRAW_VIEWPORT
    CALL        SLEEP_ZERO                              ;byte SLEEP_ZERO(void)
    JP          DO_TURN_LEFT
DO_GLANCE_LEFT:
    LD          A,(LAST_ITEM_HELD)
    AND         A
    JP          NZ,NO_ACTION_TAKEN
    CALL        SUB_ram_ee0b
    CALL        REDRAW_START
    CALL        REDRAW_VIEWPORT
    CALL        SLEEP_ZERO                              ;byte SLEEP_ZERO(void)
    JP          DO_TURN_RIGHT
DO_USE_ATTACK:
    LD          A,(RIGHT_HAND_ITEM)
    LD          B,0x0
    SRL         A                                       ;Remove "color/level" in bit 0
                                                        ;to compare item type, below.
    RR          B                                       ;Push bit 0 from A
                                                        ;(via Carry Flag) to B
    SRL         A                                       ;Remove second "color/level" in bit 1
                                                        ;to compare item type, below
    RL          B                                       ;Move bits 0 & 1
                                                        ;from A to B...
    RL          B                                       ;B now has the LEVEL value (0-3)
    NOP                                                 ;Was USE_MAP
    NOP
    NOP
    NOP
    NOP
    CP          $16                                    ;Compare to KEY
                                                        ;58,59,5A,5B 2 @ SRL = 16
    JP          Z,DO_USE_KEY
    CP          $19                                    ;Compare to PHYS POTION
                                                        ;64,65,66,67 2 @ SRL = 19
    JP          Z,DO_USE_PHYS_POTION
    CP          $1a                                    ;Compare to SPRT POTION
                                                        ;68,69,6A,6B 2 @ SRL = 1A
    JP          Z,DO_USE_SPRT_POTION
    CP          $1c                                    ;Compare to CHAOS POTION
                                                        ;70,71,72,73 2 @ SRL = 1c
    JP          NZ,USE_SOMETHING_ELSE
DO_USE_CHAOS_POTION:
    CALL        PLAY_USE_PHYS_POTION_SOUND
    INC         B
    DEC         B
    JR          NZ,CHECK_YELLOW_L_POTION                ;If NZ, handle other colors
                                                        ;of LARGE POTION
    CALL        TOTAL_HEAL                              ;LARGE Potion is RED
                                                        ;so do TOTAL HEAL
PROCESS_POTION_UPDATES:
    CALL        REDRAW_STATS
    LD          A,(LAST_ITEM_HELD)
    AND         A
    JP          NZ,INIT_MELEE_ANIM
    JP          INPUT_DEBOUNCE
PLAY_USE_PHYS_POTION_SOUND:
    EXX
    CALL        SOUND_03
    CALL        SOUND_03
    CALL        SOUND_03
    JR          CLEAR_RIGHT_HAND
SUB_ram_eea9:
    EXX
CLEAR_RIGHT_HAND:
    LD          A,$fe
    LD          (RIGHT_HAND_ITEM),A
    LD          DE,POOF_6                               ;= "    ",$01
    LD          HL,CHRRAM_RIGHT_HD_GFX_IDX              ;= $20
    LD          B,$d0
    CALL        GFX_DRAW
    EXX
    RET
TOTAL_HEAL:
    LD          HL,(PLAYER_PHYS_HEALTH_MAX)
    LD          (PLAYER_PHYS_HEALTH),HL
    LD          A,(PLAYER_SPRT_HEALTH_MAX)
    LD          (PLAYER_SPRT_HEALTH),A
    RET
REDRAW_STATS_OLD:
    LD          HL,PLAYER_PHYS_HEALTH
    LD          DE,CHRRAM_PHYS_HEALTH_1000              ;= $20
    LD          B,0x2
    CALL        RECALC_AND_REDRAW_BCD
    LD          HL,PLAYER_SPRT_HEALTH
    LD          DE,CHRRAM_SPRT_HEALTH_10                ;= $20
    LD          B,0x1
    JP          RECALC_AND_REDRAW_BCD                   ;Waz JP FUN_ram_f2fd
                                                        ;(c3 fd f2)
CHECK_YELLOW_L_POTION:
    DEC         B
    JR          NZ,CHECK_PURPLE_L_POTION
    LD          BC,$10                                 ;Set PHYS increase to 10
    LD          E,0x0                                   ;Set SPRT increase to 0
PROCESS_LARGE_POTION:
    CALL        CALC_CURR_PHYS_HEALTH
    CALL        CALC_MAX_PHYS_HEALTH
    JR          PROCESS_POTION_UPDATES
CHECK_PURPLE_L_POTION:
    DEC         B
    JR          NZ,CHECK_WHITE_L_POTION
    LD          BC,0x0                                  ;Set PHYS increase to 0
    LD          E,0x6                    ;Set SPRT increase to 6
    JR          PROCESS_LARGE_POTION
CHECK_WHITE_L_POTION:
    CALL        MAKE_RANDOM_BYTE                        ;Get RANDOM BYTE
                                                        ;and put into A
    AND         0x3                                     ;Range it to 0-3
    DEC         A
    JR          NZ,LAB_ram_ef08                         ;If NZ, check for case 1
    LD          E,0x0                    ;Case 0: set SPRT increase to 0
    LD          BC,$20                                 ;Set PHYS increase to 20
    JR          PROCESS_LARGE_POTION                    ;...and reprocess
LAB_ram_ef08:
    DEC         A
    JR          NZ,LAB_ram_ef12
    LD          BC,0x0                                  ;Set PHYS increase to 0
    LD          E,$12                ;Set SPRT increase to 12
    JR          PROCESS_LARGE_POTION
LAB_ram_ef12:
    DEC         A
    JR          NZ,CHECK_CASE_3_WL_POTION
    CALL        TOTAL_HEAL                              ;Fill up PHYS and SPRT
    LD          BC,$10                                 ;Set PHYS increase to 10
    LD          E,0x6                    ;Set SPRT increase to 6
    JR          PROCESS_LARGE_POTION
CHECK_CASE_3_WL_POTION:
    LD          BC,$30                                 ;Set PHYS decrease to 30
    LD          E,$15                                  ;Set SPRT decrease to 15
    CALL        REDUCE_HEALTH_BIG
    LD          BC,$15
    LD          E,0x7
    CALL        REDUCE_HEALTH_SMALL
    JP          PROCESS_POTION_UPDATES
CALC_CURR_PHYS_HEALTH:
    LD          HL,(PLAYER_PHYS_HEALTH)                 ;Load current PHYS Health
                                                        ;into HL
    LD          A,L
    ADD         A,C
    DAA                                                 ;Correct 1000s & 100s
                                                        ;for BCD
    LD          L,A
    LD          A,H
    ADC         A,B
    DAA                                                 ;Correct 10s & 1s
                                                        ;for BCD
    CP          0x2
    LD          H,A
    JR          NZ,UPDATE_HEALTH_VALUES
    LD          H,0x1
    LD          L,$99                                  ;Max PHYS Health of 199
UPDATE_HEALTH_VALUES:
    LD          (PLAYER_PHYS_HEALTH),HL
    LD          A,(PLAYER_SPRT_HEALTH)
    ADD         A,E
    DAA                                                 ;Correct for BCD
    LD          (PLAYER_SPRT_HEALTH),A
    RET         NC
    LD          A,$99                                  ;Max SPRT Health of 99
    LD          (PLAYER_SPRT_HEALTH),A
    RET
CALC_MAX_PHYS_HEALTH:
    LD          HL,(PLAYER_PHYS_HEALTH)
    LD          BC,(PLAYER_PHYS_HEALTH_MAX)
    LD          A,H
    CP          B
    JR          C,CALC_MAX_SPRT_HEALTH
    LD          A,L
    CP          C
    JR          C,CALC_MAX_SPRT_HEALTH
    LD          (PLAYER_PHYS_HEALTH_MAX),HL
CALC_MAX_SPRT_HEALTH:
    LD          HL,PLAYER_SPRT_HEALTH_MAX
    LD          A,(PLAYER_SPRT_HEALTH)
    CP          (HL)
    RET         C
    LD          (HL),A
    RET
REDUCE_HEALTH_BIG:
    LD          HL,(PLAYER_PHYS_HEALTH)
    LD          A,L
    SUB         C
    DAA
    LD          L,A
    LD          A,H
    SBC         A,B
    DAA
    LD          H,A
    JR          C,PLAYER_DIES
    LD          (PLAYER_PHYS_HEALTH),HL
    LD          A,(PLAYER_SPRT_HEALTH)
    SUB         E
    DAA
    JR          C,PLAYER_DIES
    LD          (PLAYER_SPRT_HEALTH),A
    RET
REDUCE_HEALTH_SMALL:
    LD          HL,(PLAYER_PHYS_HEALTH_MAX)
    LD          A,L
    SUB         C
    DAA
    LD          L,A
    LD          A,H
    SBC         A,B
    DAA
    LD          H,A
    JR          C,PLAYER_DIES
    LD          (PLAYER_PHYS_HEALTH_MAX),HL
    LD          A,(PLAYER_SPRT_HEALTH_MAX)
    SUB         E
    DAA
    JR          C,PLAYER_DIES
    LD          (PLAYER_SPRT_HEALTH_MAX),A
    RET
PLAYER_DIES:
    LD          HL,COLRAM_VIEWPORT_IDX                  ;= $60    `
    LD          BC,$1818                               ;18 x 18 rectangle
    XOR         A
    CALL        FILL_CHRCOL_RECT
    LD          HL,CHRRAM_YOU_DIED_IDX                  ;= $20
    LD          DE,YOU_DIED_TXT
    LD          A,(INPUT_HOLDER)
    LD          (LAST_ITEM_HELD),A
    RLCA
    RLCA
    RLCA
    RLCA
    LD          B,A
    CALL        GFX_DRAW
    LD          HL,0x0
    LD          (PLAYER_PHYS_HEALTH),HL
    XOR         A
    LD          (PLAYER_SPRT_HEALTH),A
    LD          (INPUT_HOLDER),A
    CALL        REDRAW_STATS
    LD          A,$32
    LD          (RAM_AD),A
    CALL        SUB_ram_cdd3
    CALL        SLEEP_ZERO                              ;byte SLEEP_ZERO(void)
    JP          SCREEN_SAVER_FULL_SCREEN
YOU_DIED_TXT:
    DB         $7F,$A0,"You died ",$FF

DO_USE_PHYS_POTION:
    CALL        PLAY_USE_PHYS_POTION_SOUND
    INC         B                                       ;Change from LEVEL to
                                                        ;COLOR value (Level + 1)
    LD          H,B
    LD          L,B
    LD          (COLRAM_PHYS_STATS_1000),HL             ;Update PHYS color (1000s & 100s)
                                                        ;to potion level on BLK
    LD          (COLRAM_PHYS_STATS_10),HL               ;Update PHYS color (10s & 1s)
                                                        ;to potion level on BLK
    LD          H,$d0                                  ;DKGRN on BLK
    LD          L,H
    LD          (COLRAM_SPRT_STATS_10),HL               ;Update SPRT color (10s)
                                                        ;to DKGRN on BLACK
    LD          (COLRAM_SPRT_STATS_1),HL                ;Update SPRT color (1s)
                                                        ;to DKGRN on BLACK
    JP          PROCESS_POTION_UPDATES
DO_USE_SPRT_POTION:
    CALL        PLAY_USE_PHYS_POTION_SOUND
    INC         B                                       ;Change from LEVEL to
                                                        ;COLOR value (Level + 1)
    LD          H,B
    LD          L,B
    LD          (COLRAM_SPRT_STATS_10),HL               ;Update SPRT color (10s)
                                                        ;to potion level on BLK
    LD          (COLRAM_SPRT_STATS_1),HL                ;Update SPRT color (1s)
                                                        ;to potion level on BLK
    LD          H,$d0                                  ;DKGRN on BLK
    LD          L,H
    LD          (COLRAM_PHYS_STATS_1000),HL             ;Update PHYS color (1000s & 100s)
                                                        ;to DKGRN on BLK
    LD          (COLRAM_PHYS_STATS_10),HL               ;Update PHYS color (10s & 1s)
                                                        ;to DKGRN on BLK
    JP          PROCESS_POTION_UPDATES
DO_USE_KEY:
    LD          A,(ITEM_F0)                             ;= $60
    LD          C,0x0
    SRL         A
    RR          C
    SRL         A
    RL          C
    RL          C
    CP          $14
    JP          NZ,NO_ACTION_TAKEN
    LD          A,B
    CP          C
    JP          C,NO_ACTION_TAKEN
    LD          A,C
    LD          B,A
    AND         A
    JR          Z,LAB_ram_f048
    CALL        UPDATE_SCR_SAVER_TIMER
    INC         C
LAB_ram_f043:
    SUB         C
    JR          NC,LAB_ram_f043
    ADD         A,C
    LD          B,A
LAB_ram_f048:
    LD          A,R                                     ;Semi-random number into A
    AND         0x7
LAB_ram_f04c:
    JR          Z,LAB_ram_f071
    SUB         0x7
LAB_ram_f050:
    JR          NC,LAB_ram_f04c
    ADD         A,$1d
LAB_ram_f054:
    RR          B
    RR          C
    RR          B
    RLA
    RL          C
    RLA
    EX          AF,AF'
    LD          A,(PLAYER_MAP_POS)
    CALL        ITEM_MAP_CHECK
    EX          AF,AF'
    LD          (BC),A
    LD          A,(LAST_ITEM_HELD)
    AND         A
    JP          NZ,INIT_MELEE_ANIM
    JP          UPDATE_VIEWPORT
LAB_ram_f071:
    LD          A,C
    CP          0x4
    JP          Z,LAB_ram_f07c
    LD          B,A
    LD          A,$16
    JR          LAB_ram_f054
LAB_ram_f07c:
    LD          B,0x3
    LD          A,$1c
    JR          LAB_ram_f054
USE_SOMETHING_ELSE:
    EX          AF,AF'
    LD          A,(WALL_F0_STATE)                       ;= $20
    AND         A
    JR          Z,CHECK_FOR_NON_ITEMS
    BIT         0x2,A
    JR          Z,CHECK_FOR_END_ITEM
CHECK_FOR_NON_ITEMS:
    LD          A,(ITEM_F1)                             ;= $60
    CP          $fe                                    ;Compare to EMPTY
    JR          Z,CHECK_FOR_END_ITEM
    CP          $78                                    ;Compare to MONSTERS
    JR          NC,CHECK_IF_BOW_XBOW
CHECK_FOR_END_ITEM:
    EX          AF,AF'
    CP          $ff                                    ;Compare to EMPTY-END
    JP          NZ,NO_ACTION_TAKEN
    EX          AF,AF'
CHECK_IF_BOW_XBOW:
    EX          AF,AF'
    CP          0x6                                     ;Compare to BOW
    JR          NZ,CHECK_IF_SCROLL_STAFF
USE_BOW_XBOW:
    PUSH        BC                                      ;Save BC
    LD          A,(ARROW_INV)                           ;Get Arrow Inventory
    SUB         0x1                                     ;Decrease by 1
    JP          C,NO_ACTION_TAKEN                       ;If Arrow Inv <1, end
    LD          (ARROW_INV),A
    CALL        CHK_ITEM_BREAK
    POP         BC
    JR          NC,BOW_XBOW_NO_BREAK
    LD          A,$fe                                  ;$fe = EMPTY ITEM
    LD          (RIGHT_HAND_ITEM),A                     ;Put EMPTY ITEM into Right Hand
BOW_XBOW_NO_BREAK:
    LD          D,0x5
    JR          LAB_ram_f0e9
CHECK_IF_SCROLL_STAFF:
    CP          0x7                                     ;Compare to SCROLL
    JR          NZ,CHECK_OTHERS
USE_SCROLL_STAFF:
    PUSH        BC
    CALL        CHK_ITEM_BREAK
    POP         BC
    JR          NC,SCROLL_STAFF_NO_BREAK
    LD          A,$fe
    LD          (RIGHT_HAND_ITEM),A
SCROLL_STAFF_NO_BREAK:
    LD          D,0x9                                   ;Use FIREBALL ammo
    JR          LAB_ram_f0e9
CHECK_OTHERS:
    CP          0xb                                     ;Compare to STAFF
    JR          Z,USE_SCROLL_STAFF
    CP          0xc                                     ;Compare to XBOW
    JR          Z,USE_BOW_XBOW
    CP          0x6                                     ;Compare to BOW
    JP          C,NO_ACTION_TAKEN
    CP          $10                                    ;Compare to LADDER
    JP          NC,LAB_ram_f113
    LD          D,A
    CALL        SUB_ram_eea9
LAB_ram_f0e9:
    CALL        SUB_ram_f0f2
    JP          SUB_ram_f130
SUB_ram_f0ef:
    CALL        SUB_ram_eea9
SUB_ram_f0f2:
    LD          A,0x3
    LD          (BYTE_ram_3a87),A
    LD          A,D
    SLA         A
    SLA         A
    OR          B
    LD          (BYTE_ram_3a82),A
    LD          HL,$203
    LD          (BYTE_ram_3a85),HL
    LD          HL,CHRRAM_RIGHT_HD_GFX_IDX              ;= $20
    LD          (BYTE_ram_3a83),HL
    LD          A,L
    LD          (RAM_AD),A
    JP          LAB_ram_e3d7
LAB_ram_f113:
    CP          $11
    JR          NZ,LAB_ram_f119
    JR          LAB_ram_f11e
LAB_ram_f119:
    CP          $14
    JP          NZ,NO_ACTION_TAKEN
LAB_ram_f11e:
    LD          D,A
    LD          A,(LAST_ITEM_HELD)
    AND         A
    JP          Z,NO_ACTION_TAKEN
    XOR         A                                       ;A  = $00
                                                        ;Reset C & N, Set Z
    LD          (LAST_ITEM_HELD),A
    CALL        SUB_ram_f0ef
    JP          WAIT_FOR_INPUT
SUB_ram_f130:
    LD          A,(LAST_ITEM_HELD)
    AND         A
    JP          NZ,INIT_MELEE_ANIM
    INC         A
    LD          (LAST_ITEM_HELD),A
    LD          A,(ITEM_F1)                             ;= $60
    LD          B,0x0
    SRL         A
    RR          B
    RRA
    RL          B
    RL          B
    EX          AF,AF'
    XOR         A
    LD          HL,DUNGEON_LEVEL
    RLD
    LD          D,A
    SRL         A
    JR          NC,LAB_ram_f157
    ADD         A,$50
LAB_ram_f157:
    RLCA
    RLCA
    RLCA
    RLCA
    LD          E,A
    LD          A,D
    RLD
    LD          D,A
    SRL         A
    ADD         A,E
    ADD         A,0x3
    DAA
    LD          C,A
    LD          A,D
    RLD
    EX          AF,AF'
    SUB         $1e
    JR          NZ,LAB_ram_f17d
    LD          D,0x7
    LD          HL,$304
    LD          A,$3c
    ADD         A,B
    LD          (BYTE_ram_3a8a),A
    JP          LAB_ram_f22b
LAB_ram_f17d:
    DEC         A
    JR          NZ,LAB_ram_f18e
    LD          D,0x3
    LD          HL,$101
    LD          A,$3c
    ADD         A,B
    LD          (BYTE_ram_3a8a),A
    JP          LAB_ram_f22b
LAB_ram_f18e:
    DEC         A
    JR          NZ,LAB_ram_f19f
    LD          D,0x4
    LD          HL,0x2
    LD          A,$24
    ADD         A,B
    LD          (BYTE_ram_3a8a),A
    JP          LAB_ram_f22b
LAB_ram_f19f:
    DEC         A
    JR          NZ,LAB_ram_f1af
    LD          D,0x5
    LD          HL,$203
    LD          A,$3c
    ADD         A,B
    LD          (BYTE_ram_3a8a),A
    JR          LAB_ram_f22b
LAB_ram_f1af:
    DEC         A
    JR          NZ,LAB_ram_f1bf
    LD          D,0x3
    LD          HL,$302
    LD          A,$24
    ADD         A,B
    LD          (BYTE_ram_3a8a),A
    JR          LAB_ram_f22b
LAB_ram_f1bf:
    DEC         A
    JR          NZ,LAB_ram_f1cf
    LD          D,0x8
    LD          HL,$405
    LD          A,$24
    ADD         A,B
    LD          (BYTE_ram_3a8a),A
    JR          LAB_ram_f22b
LAB_ram_f1cf:
    DEC         A
    JP          NZ,LAB_ram_f1e0
    LD          D,0x6
    LD          HL,$204
    LD          A,$3c
    ADD         A,B
    LD          (BYTE_ram_3a8a),A
    JR          LAB_ram_f22b
LAB_ram_f1e0:
    DEC         A
    JR          NZ,LAB_ram_f1f0
    LD          D,$13
    LD          HL,$505
    LD          A,$24
    ADD         A,B
    LD          (BYTE_ram_3a8a),A
    JR          LAB_ram_f22b
LAB_ram_f1f0:
    DEC         A
    JR          NZ,LAB_ram_f200
    LD          D,0x4
    LD          HL,$405
    LD          A,$3c
    ADD         A,B
    LD          (BYTE_ram_3a8a),A
    JR          LAB_ram_f22b
LAB_ram_f200:
    DEC         A
    JR          NZ,LAB_ram_f228
    LD          D,$11
    LD          HL,$405
    EXX
    LD          HL,(PLAYER_PHYS_HEALTH)
    CALL        SUB_ram_e439
    EX          DE,HL
    LD          A,(PLAYER_SPRT_HEALTH)
    LD          L,A
    LD          H,0x0
    CALL        RECALC_PHYS_HEALTH
    EXX
    JR          NC,LAB_ram_f224
    LD          A,$24
LAB_ram_f21e:
    ADD         A,B
    LD          (BYTE_ram_3a8a),A
    JR          LAB_ram_f22b
LAB_ram_f224:
    LD          A,$3c
    JR          LAB_ram_f21e
LAB_ram_f228:
    JP          NO_ACTION_TAKEN
LAB_ram_f22b:
    CALL        SUB_ram_f27f
    PUSH        HL
    LD          HL,CURR_MONSTER_SPRT
    CALL        SUB_ram_f298
    POP         HL
    LD          D,H
    CALL        SUB_ram_f27f
    PUSH        HL
    LD          HL,BYTE_ram_3aa5
    CALL        SUB_ram_f298
    POP         HL
    LD          D,L
    LD          E,0x0
    CALL        CALC_WEAPON_VALUE
    LD          (WEAPON_VALUE_HOLDER),A
    CALL        REDRAW_MONSTER_HEALTH
INIT_MELEE_ANIM:
    LD          A,0x3                                   ;A  = $03
    LD          (MELEE_ANIM_STATE),A
    LD          HL,$206                                ;HL = $ce
    LD          (MONSTER_ATT_POS_COUNT),HL
    LD          HL,$31ea                               ;HL = $0020 db?
                                                        ;Always $20 (SPACE char)?
    LD          (MONSTER_ATT_POS_OFFSET),HL
    LD          A,L
    LD          (RAM_AE),A
    CALL        ANIMATE_MELEE_ROUND
    JP          WAIT_FOR_INPUT
REDRAW_MONSTER_HEALTH:
    LD          DE,CHRRAM_MONSTER_PHYS                  ;WAS LD DE,$333d
    LD          HL,CURR_MONSTER_PHYS
    LD          B,0x2
    CALL        RECALC_AND_REDRAW_BCD
    LD          DE,CHRRAM_MONSTER_SPRT                  ;WAS LD DE,$338f
    LD          HL,CURR_MONSTER_SPRT
    LD          B,0x1
    JP          RECALC_AND_REDRAW_BCD
SUB_ram_f27f:
    CALL        UPDATE_SCR_SAVER_TIMER
    AND         0x7
    LD          E,A
CALC_WEAPON_VALUE:
    PUSH        BC                                      ;Save original weaponLevel
    INC         B                                       ;B = B + 1
    LD          A,D                                     ;A = D
    JR          LAB_ram_f28c
LAB_ram_f28a:
    ADD         A,D                                     ;A = A + D
    DAA                                                 ;Normalize for BCD
LAB_ram_f28c:
    DJNZ        LAB_ram_f28a                            ;B = B - 1
    SUB         E                                       ;A = A - E
    DAA                                                 ;Normalize for BCD
    JR          NC,LAB_ram_f294
    ADC         A,E                                     ;A = A + E (and CARRY)
    DAA                                                 ;Normalize for BCD
LAB_ram_f294:
    ADD         A,C                                     ;A = A + C
    DAA                                                 ;Normalize for BCD
    POP         BC                                      ;BC = Original weaponLevel
    RET                                                 ;A = new weaponValue
SUB_ram_f298:
    LD          (HL),A
    INC         HL
    ADD         A,A
    DAA
    LD          (HL),A
    INC         HL
    LD          A,0x0
    RLA
    LD          (HL),A
    RET
DO_USE_LADDER:
    LD          A,(LAST_ITEM_HELD)
    AND         A
    JP          NZ,NO_ACTION_TAKEN
    LD          A,(ITEM_F0)                             ;= $60
    CP          $42
    JP          NZ,NO_ACTION_TAKEN
    LD          A,(PLAYER_MAP_POS)
    LD          (PLAYER_PREV_MAP_LOC),A
    CALL        BUILD_MAP
    CALL        SUB_ram_cdbf
    CALL        SUB_ram_f2c4
    JP          RESET_SHIFT_MODE
SUB_ram_f2c4:
    LD          DE,$3002                               ;WAS $33df
    LD          HL,DUNGEON_LEVEL
    LD          A,0x1
    ADD         A,(HL)
    DAA
    JR          C,LAB_ram_f2dc
LAB_ram_f2d0:
    LD          (HL),A
    LD          B,0x1
    CALL        RECALC_AND_REDRAW_BCD
    CALL        REDRAW_START
    JP          REDRAW_VIEWPORT
LAB_ram_f2dc:
    CALL        DRAW_BKGD
    LD          HL,DAT_ram_3051                         ;= $20
    LD          DE,LEVEL_99_LOOP                        ;= "Looks like this dungeon",$01
    LD          B,$f0
    CALL        GFX_DRAW
    LD          B,$1e
LAB_ram_f2ec:
    EXX
    CALL        SLEEP_ZERO                              ;byte SLEEP_ZERO(void)
    EXX
    DJNZ        LAB_ram_f2ec
    LD          A,$90
    LD          HL,DUNGEON_LEVEL
    LD          DE,CHHRAM_LVL_IDX                       ;= $20
    JR          LAB_ram_f2d0
RECALC_AND_REDRAW_BCD:
    PUSH        DE
    LD          DE,$3a50
    LD          A,B
    SLA         A
    DEC         A
    EX          AF,AF'
LAB_ram_f306:
    LD          A,(HL)
    AND         0xf                                     ;Wipe upper nybble
    ADD         A,$30                                  ;Numeric char offset
    LD          (DE),A
    LD          A,(HL)
    AND         $f0                                    ;Wipe lower nybble
    RRCA                                                ;Move upper
    RRCA                                                ;nybble to
    RRCA                                                ;lower
    RRCA                                                ;nybble
    ADD         A,$30                                  ;Numeric char offset
    INC         DE
    LD          (DE),A
    INC         DE
    INC         HL
    DJNZ        LAB_ram_f306
    DEC         DE
    POP         HL
    EX          AF,AF'
    LD          B,A
LAB_ram_f31f:
    LD          A,(DE)
    CP          $30                                    ;Numeric char offset
    JR          NZ,LAB_ram_f32d
    LD          (HL),$20                               ;SPACE char for ZERO
    INC         HL                                      ;Move forward one cell
    DEC         DE                                      ;Move backwards one byte
                                                        ;(big endian)
    DJNZ        LAB_ram_f31f
    LD          A,(DE)
    JR          LAB_ram_f333
LAB_ram_f32d:
    LD          (HL),A
    INC         HL                                      ;Move forward one cell
    DEC         DE                                      ;Move backwards one byte
                                                        ;(big endian)
    LD          A,(DE)
    DJNZ        LAB_ram_f32d
LAB_ram_f333:
    LD          (HL),A
    RET
GFX_DRAW:
    PUSH        HL
    LD          C,$28                                  ;$28 = +40, down one row
LAB_ram_f338:
    LD          A,(DE)                       ;= "\b",$FF
                                                        ;= $FF
    INC         DE
    INC         A
    JR          NZ,LAB_ram_f33f                         ;Check for $ff end of graphic char
    POP         HL
    RET
LAB_ram_f33f:
    DEC         A                                       ;$00 = no char, move right one column...
    JR          NZ,LAB_ram_f345
    INC         HL
    JR          LAB_ram_f338
LAB_ram_f345:
    CP          0x1                                     ;$01 = down one row, back to index
    JR          NZ,LAB_ram_f352
    LD          A,B
    LD          B,0x0
    POP         HL
    ADD         HL,BC
    PUSH        HL
    LD          B,A
    JR          LAB_ram_f338
LAB_ram_f352:
    CP          0x2                                     ;$02 = back up one column
    JR          NZ,LAB_ram_f359
    DEC         HL
    JR          LAB_ram_f338
LAB_ram_f359:
    CP          0x3                                     ;$03 = down one row, same column
    JR          NZ,LAB_ram_f367
    LD          A,B
    LD          B,0x0
    ADD         HL,BC
    EX          (SP),HL
    ADD         HL,BC
    EX          (SP),HL
    LD          B,A
    JR          LAB_ram_f338
LAB_ram_f367:
    CP          0x4                                     ;$04 = up one row, same column
    JR          NZ,LAB_ram_f377
    LD          A,B
    LD          B,0x0
    SBC         HL,BC
    EX          (SP),HL
    SBC         HL,BC
    EX          (SP),HL
    LD          B,A
    JR          LAB_ram_f338
LAB_ram_f377:
    CP          $a0                                    ;$a0 = reverse FG & BG colors
    JR          NZ,LAB_ram_f385
    RRC         B                                       ;Swap hi and lo nybbles (FG & BG colo...
    RRC         B
    RRC         B
    RRC         B
    JR          LAB_ram_f338
LAB_ram_f385:
    LD          (HL),A              ;= $20
    INC         H
    INC         H
    INC         H
    INC         H
    LD          A,0xf
    CP          B
    LD          A,(HL)                    ;= $60
    JR          C,LAB_ram_f398
    RLCA
    RLCA
    RLCA
    RLCA
    AND         $f0
    JR          LAB_ram_f39a
LAB_ram_f398:
    AND         0xf
LAB_ram_f39a:
    OR          B
    LD          (HL),A                    ;= $60
    DEC         H
    DEC         H
    DEC         H
    DEC         H
    INC         HL
    JR          LAB_ram_f338
BUILD_MAP:
    LD          HL,MAPSPACE_WALLS
    LD          B,0x0
GENERATE_MAPWALLS_LOOP:
    CALL        MAKE_RANDOM_BYTE
    LD          E,A
    CALL        MAKE_RANDOM_BYTE
    AND         E
    AND         $63
    LD          (HL),A
    INC         L
    DJNZ        GENERATE_MAPWALLS_LOOP
    LD          A,(PLAYER_MAP_POS)
    LD          L,A
    LD          (HL),$42
GEN_MAP_NW_WALL_LOOP:
    CALL        UPDATE_SCR_SAVER_TIMER
    INC         A
    JR          Z,GEN_MAP_NW_WALL_LOOP
    DEC         A
    LD          (ITEM_HOLDER),A
    LD          L,A
    LD          (HL),$63
    LD          HL,MAP_LADDER_OFFSET
    LD          (HL),A
    INC         L
    LD          (HL),$42                   ;Put ladder object into map
                                                        ;(always 1st item after offset)
    INC         L
    LD          A,(INPUT_HOLDER)
    LD          B,A
    LD          A,0x2
    JR          LAB_ram_f3db
LAB_ram_f3d9:
    ADD         A,A
    DAA
LAB_ram_f3db:
    DJNZ        LAB_ram_f3d9
    LD          C,A
    LD          A,(DUNGEON_LEVEL)
    CP          C
    JR          C,LAB_ram_f3fd
GEN_ITEM_MAP:
    CALL        UPDATE_SCR_SAVER_TIMER
    INC         A
    JR          Z,GEN_ITEM_MAP
    DEC         A
    LD          C,A
    LD          A,(ITEM_HOLDER)
    CP          C
    JR          Z,GEN_ITEM_MAP
    LD          A,(PLAYER_MAP_POS)
    CP          C
    JR          Z,GEN_ITEM_MAP
    LD          (HL),C
    INC         HL
    LD          (HL),$9f                ;Full ITEM_monster range $009f
    INC         HL
LAB_ram_f3fd:
    LD          B,$50                                  ;Max 50 items+monstersdb?
GEN_RND_ITEM:
    CALL        MAKE_RANDOM_BYTE
    INC         A
    JR          Z,GEN_RND_ITEM
    DEC         A
    EX          AF,AF'
    LD          A,(DUNGEON_LEVEL)
    AND         A
    JR          NZ,LAB_ram_f417
    EX          AF,AF'
    CP          0x1
    JR          Z,GEN_RND_ITEM
    CP          $10
    JR          Z,GEN_RND_ITEM
    EX          AF,AF'
LAB_ram_f417:
    EX          AF,AF'
    LD          E,A
    LD          A,(PLAYER_MAP_POS)
    CP          E
    JR          Z,GEN_RND_ITEM
    LD          A,(ITEM_HOLDER)
    CP          E
    JR          Z,GEN_RND_ITEM
    LD          (HL),E
    INC         L
    CALL        UPDATE_SCR_SAVER_TIMER
    AND         $c0
    RLCA
    RLCA
    DEC         A
    JR          NZ,LAB_ram_f437
    LD          C,0x5
    LD          D,0x0
    JR          LAB_ram_f465
LAB_ram_f437:
    DEC         A
    JR          NZ,LAB_ram_f449
    LD          C,0x5
    LD          D,0x6
    LD          A,(DUNGEON_LEVEL)
    CP          0x6
    JR          C,LAB_ram_f465
    LD          C,0x7
    JR          LAB_ram_f465
LAB_ram_f449:
    DEC         A
    JR          NZ,LAB_ram_f452
    LD          C,0x4
    LD          D,$11
    JR          LAB_ram_f465
LAB_ram_f452:
    LD          D,$1e
    LD          C,0x5
    LD          A,(DUNGEON_LEVEL)
    CP          0x6
    JR          C,LAB_ram_f465
    LD          C,0x7
    CP          $16
    JR          C,LAB_ram_f465
    LD          C,0x9
LAB_ram_f465:
    CALL        MAKE_RANDOM_BYTE
    AND         0xf
LAB_ram_f46a:
    SUB         C
    JR          NC,LAB_ram_f46a
    ADD         A,C
    ADD         A,D
    LD          C,A
    LD          A,(DUNGEON_LEVEL)
    INC         A
    INC         A
    SRL         A
    LD          D,A
    CALL        UPDATE_SCR_SAVER_TIMER
    LD          E,A
    CALL        MAKE_RANDOM_BYTE
    AND         E
    AND         0x3
LAB_ram_f482:
    SUB         D
    JR          NC,LAB_ram_f482
    ADD         A,D
    RRA
    RRA
    RL          C
    RLA
    RL          C
    LD          (HL),C
    INC         L
    DEC         B
    JP          NZ,GEN_RND_ITEM
    LD          (HL),$ff
    LD          DE,TEMP_MAP
    LD          HL,MAP_LADDER_OFFSET
    LD          B,0x0
LAB_ram_f49d:
    LD          A,(HL)
    CP          $ff
    JR          Z,SETUP_MAP_COPY
    INC         B
    CALL        SUB_ram_f4d4
    EXX
    JR          Z,LAB_ram_f4b7
    LD          (DE),A
    INC         DE
    INC         HL
    LD          A,(HL)
    CP          $fe
    JR          Z,LAB_ram_f4bc
    INC         B
    LD          (DE),A
    INC         DE
    INC         HL
    JR          LAB_ram_f49d
LAB_ram_f4b7:
    INC         HL
    INC         HL
    DEC         B
    JR          LAB_ram_f49d
LAB_ram_f4bc:
    INC         HL
    DEC         DE
    DEC         B
    JR          LAB_ram_f49d
SETUP_MAP_COPY:
    LD          DE,TEMP_MAP                             ;DE = Temp Map
    LD          HL,MAP_LADDER_OFFSET                    ;HL = Real Map
    INC         B
    DEC         B
    JR          Z,MAP_DONE
COPY_TEMP_MAP_TO_REAL_MAP:
    LD          A,(DE)
    LD          (HL),A
    INC         HL
    INC         DE
    DJNZ        COPY_TEMP_MAP_TO_REAL_MAP               ;Loop while B is not zero
MAP_DONE:
    LD          (HL),$ff
    RET
SUB_ram_f4d4:
    PUSH        BC
    EXX
    POP         BC
    DEC         B
    JR          Z,LAB_ram_f4e4
    LD          HL,TEMP_MAP
LAB_ram_f4dd:
    CP          (HL)
    RET         Z
    DEC         B
    INC         HL
    INC         HL
    DJNZ        LAB_ram_f4dd
LAB_ram_f4e4:
    DEC         B
    RET
REDRAW_START:
    LD          HL,GET_WEST_WALL_2                            ; GET_WEST_WALL (0xF79B) + 7... UNDO? was 0xF7A1
    PUSH        HL
    LD          HL,PLAYER_MAP_POS
    LD          E,(HL)
    LD          D,$38                                  ;DE = Player map position in RAM
    LD          HL,WALL_F0_STATE                        ;= $20
    LD          C,0x5
    LD          A,(DIR_FACING_SHORT)
    DEC         A
    JP          Z,FACING_NORTH
    DEC         A
    JP          Z,FACING_EAST
    DEC         A
    JP          Z,FACING_SOUTH
    LD          A,(DE)
    AND         0x7                                     ;Keep low 3 bits, reset top 5 bits
    LD          (HL),A                   ;= $20
    DEC         E
    CALL        GET_WEST_WALL
    DEC         E
    CALL        GET_WEST_WALL
    LD          A,E
    ADD         A,$10
    LD          E,A
    CALL        GET_NORTH_WALL
    INC         L
    LD          (HL),A                   ;= $20
    LD          A,(DE)
    AND         0x7
    CALL        CALC_HALF_WALLS
    LD          A,E
    SUB         $10
    LD          E,A
    CALL        GET_NORTH_WALL
    LD          (HL),A                   ;= $20
    LD          A,E
    SUB         $10
    LD          E,A
    LD          A,(DE)
    AND         0x7
    CALL        CALC_HALF_WALLS
    LD          A,E
    ADD         A,$21
    LD          E,A
    CALL        GET_NORTH_WALL
    LD          (HL),A                   ;= $20
    LD          A,(DE)
    AND         0x7
    CALL        CALC_HALF_WALLS
    LD          A,E
    SUB         $10
    LD          E,A
    CALL        GET_NORTH_WALL
    INC         L
    LD          (HL),A                   ;= $20
    LD          A,E
    SUB         $10
    LD          E,A
    LD          A,(DE)
    AND         0x7
    CALL        CALC_HALF_WALLS
    LD          A,E
    ADD         A,$21
    LD          E,A
    CALL        GET_NORTH_WALL
    INC         L
    LD          (HL),A                   ;= $20
    CALL        GET_WEST_WALL
    LD          A,E
    ADD         A,0xe
    LD          E,A
    CALL        GET_NORTH_WALL
    INC         L
    INC         L
    LD          (HL),A                    ;= $20
    LD          A,E
    SUB         $1e
    LD          E,A
    CALL        GET_NORTH_WALL
    INC         L
    LD          (HL),A                    ;= $20
    LD          A,E
    SUB         $10
    LD          E,A
    CALL        GET_WEST_WALL
    DEC         E
    DEC         E
    CALL        GET_NORTH_WALL
    INC         L
    INC         L
    LD          (HL),A                    ;= $20
    LD          A,E
    ADD         A,$13
    LD          E,A
    CALL        GET_WEST_WALL
    LD          D,$ff
    LD          E,$f0
    LD          (DIR_FACING_HI),DE                      ;DE = 0xFFF0 (WEST)
    LD          B,$10                                  ;RED on BLK
    LD          HL,CHRRAM_POINTER_IDX                   ;WAS $31d6
    LD          DE,WEST_TXT                             ;= "\a",$FF
    JP          GFX_DRAW
WEST_TXT:
    db          "\a",$FF
    db          $00
    db          $00
    db          $00
    db          $00
GET_NORTH_WALL:
    LD          A,(DE)
    AND         $e0
    RLCA
    RLCA
    RLCA
    RET
CALC_HALF_WALLS:
    INC         L
    LD          (HL),A
    LD          B,A
    LD          A,L
    ADD         A,C
    LD          L,A
    LD          (HL),B
    LD          A,L
    SUB         C
    LD          L,A
    INC         L
    INC         C
    RET
FACING_NORTH:
    CALL        GET_NORTH_WALL
    LD          (HL),A
    LD          A,E
    SUB         $10
    LD          E,A
    CALL        GET_NORTH_WALL
    INC         L
    LD          (HL),A
    LD          A,E
    SUB         $10
    LD          E,A
    CALL        GET_NORTH_WALL
    INC         L
    LD          (HL),A
    CALL        GET_WEST_WALL
    DEC         E
    CALL        GET_NORTH_WALL
    CALL        CALC_HALF_WALLS
    INC         E
    INC         E
    LD          A,(DE)
    AND         0x7
    LD          (HL),A
    CALL        GET_NORTH_WALL
    CALL        CALC_HALF_WALLS
    LD          A,E
    ADD         A,0xf
    LD          E,A
    LD          A,(DE)
    AND         0x7
    LD          (HL),A
    DEC         E
    CALL        GET_NORTH_WALL
    CALL        CALC_HALF_WALLS
    INC         E
    INC         E
    CALL        GET_WEST_WALL
    CALL        GET_NORTH_WALL
    CALL        CALC_HALF_WALLS
    LD          A,E
    ADD         A,0xf
    LD          E,A
    CALL        GET_WEST_WALL
    DEC         E
    CALL        GET_NORTH_WALL
    INC         L
    LD          (HL),A
    LD          A,E
    SUB         $20
    LD          E,A
    LD          A,(DE)
    AND         0x7
    INC         L
    INC         L
    LD          (HL),A
    LD          A,E
    ADD         A,$22
    LD          E,A
    CALL        GET_WEST_WALL
    CALL        GET_NORTH_WALL
    INC         L
    LD          (HL),A
    LD          A,E
    SUB         $1f
    LD          E,A
    LD          A,(DE)
    AND         0x7
    INC         L
    INC         L
    LD          (HL),A
    LD          A,E
    ADD         A,$2e
    LD          E,A
    CALL        GET_NORTH_WALL
    INC         L
    LD          (HL),A
    LD          D,$f0
    LD          E,0x1
    LD          (DIR_FACING_HI),DE
    LD          B,$10                                  ;RED on BLK
    LD          HL,CHRRAM_POINTER_IDX                   ;WAS $31d6
    LD          DE,NORTH_TXT                            ;= "\b",$FF
    JP          GFX_DRAW
NORTH_TXT:
    db          "\b",$FF
    db          $00
    db          $00
    db          $00
    db          $00
FACING_SOUTH:
    LD          A,E
    ADD         A,$10
    LD          E,A
    CALL        GET_NORTH_WALL
    LD          (HL),A                   ;= $20
    LD          A,E
    ADD         A,$10
    LD          E,A
    CALL        GET_NORTH_WALL
    INC         L
    LD          (HL),A                   ;= $20
    LD          A,E
    ADD         A,$10
    LD          E,A
    CALL        GET_NORTH_WALL
    INC         L
    LD          (HL),A                   ;= $20
    LD          A,E
    SUB         0xf
    LD          E,A
    CALL        GET_WEST_WALL
    LD          A,E
    ADD         A,$10
    LD          E,A
    CALL        GET_NORTH_WALL
    CALL        CALC_HALF_WALLS
    LD          A,E
    SUB         $11
    LD          E,A
    LD          A,(DE)
    AND         0x7
    LD          (HL),A                   ;= $20
    LD          A,E
    ADD         A,0xf
    LD          E,A
    CALL        GET_NORTH_WALL
    CALL        CALC_HALF_WALLS
    LD          A,E
    SUB         $1e
    LD          E,A
    LD          A,(DE)
    AND         0x7
    LD          (HL),A                   ;= $20
    LD          A,E
    ADD         A,$10
    LD          E,A
    CALL        GET_NORTH_WALL
    CALL        CALC_HALF_WALLS
    LD          A,E
    SUB         $11
    LD          E,A
    CALL        GET_WEST_WALL
    LD          A,E
    ADD         A,0xf
    LD          E,A
    CALL        GET_NORTH_WALL
    CALL        CALC_HALF_WALLS
    LD          A,E
    SUB         $1e
    LD          E,A
    CALL        GET_WEST_WALL
    LD          A,E
    ADD         A,$10
    LD          E,A
    CALL        GET_NORTH_WALL
    INC         L
    LD          (HL),A                   ;= $20
    LD          A,E
    ADD         A,$11
    LD          E,A
    LD          A,(DE)
    AND         0x7
    INC         L
    INC         L
    LD          (HL),A                    ;= $20
    LD          A,E
    SUB         $22
    LD          E,A
    CALL        GET_WEST_WALL
    LD          A,E
    ADD         A,0xf
    LD          E,A
    CALL        GET_NORTH_WALL
    INC         L
    LD          (HL),A                    ;= $20
    LD          A,E
    ADD         A,$10
    LD          E,A
    LD          A,(DE)
    AND         0x7
    INC         L
    INC         L
    LD          (HL),A                    ;= $20
    LD          A,E
    SUB         $1f
    LD          E,A
    CALL        GET_NORTH_WALL
    INC         L
    LD          (HL),A                    ;= $20
    LD          D,$10
    LD          E,$ff
    LD          (DIR_FACING_HI),DE
    LD          B,$10                                  ;RED on BLK
    LD          HL,CHRRAM_POINTER_IDX                   ;WAS $31d6
    LD          DE,SOUTH_TXT                            ;= "\t",$FF
    JP          GFX_DRAW
SOUTH_TXT:
    db          "\t",$FF
    db          $00
    db          $00
    db          $00
    db          $00
FACING_EAST:
    INC         E
    LD          A,(DE)
    AND         0x7
    LD          (HL),A                   ;= $20
    INC         E
    CALL        GET_WEST_WALL
    INC         E
    CALL        GET_WEST_WALL
    DEC         E
    CALL        GET_NORTH_WALL
    INC         L
    LD          (HL),A                   ;= $20
    LD          A,E
    SUB         0xf
    LD          E,A
    LD          A,(DE)
    AND         0x7
    CALL        CALC_HALF_WALLS
    LD          A,E
    ADD         A,$1f
    LD          E,A
    CALL        GET_NORTH_WALL
    LD          (HL),A                   ;= $20
    INC         E
    LD          A,(DE)
    AND         0x7
    CALL        CALC_HALF_WALLS
    LD          A,E
    SUB         $12
    LD          E,A
    CALL        GET_NORTH_WALL
    LD          (HL),A                   ;= $20
    LD          A,E
    SUB         0xf
    LD          E,A
    LD          A,(DE)
    AND         0x7
    CALL        CALC_HALF_WALLS
    LD          A,E
    ADD         A,$1f
    LD          E,A
    CALL        GET_NORTH_WALL
    INC         L
    LD          (HL),A                   ;= $20
    INC         E
    LD          A,(DE)
    AND         0x7
    CALL        CALC_HALF_WALLS
    LD          A,E
    SUB         $12
    LD          E,A
    CALL        GET_NORTH_WALL
    INC         L
    LD          (HL),A                   ;= $20
    LD          A,E
    SUB         0xf
    LD          E,A
    CALL        GET_WEST_WALL
    INC         E
    CALL        GET_NORTH_WALL
    INC         L
    INC         L
    LD          (HL),A                    ;= $20
    LD          A,E
    ADD         A,$1e
    LD          E,A
    CALL        GET_NORTH_WALL
    INC         L
    LD          (HL),A                    ;= $20
    INC         E
    CALL        GET_WEST_WALL
    LD          A,E
    ADD         A,$11
    LD          E,A
    CALL        GET_NORTH_WALL
    INC         L
    INC         L
    LD          (HL),A                    ;= $20
    LD          A,E
    SUB         $22
    LD          E,A
    CALL        GET_WEST_WALL
    LD          D,0x1
    LD          E,$10
    LD          (DIR_FACING_HI),DE
    LD          B,$10                                  ;RED on BLK
    LD          HL,CHRRAM_POINTER_IDX                   ;WAS $31d6
    LD          DE,EAST_TXT                             ;= $06,$FF
    JP          GFX_DRAW
EAST_TXT:
    db          $06,$FF
    db          $00
    db          $00
    db          $00
    db          $00
GET_WEST_WALL:
    LD          A,(DE)
    AND         0x7
    INC         L
    LD          (HL),A
    RET
GET_WEST_WALL_2:
    LD          IX,ITEM_F2                              ;= $60
    LD          DE,(DIR_FACING_HI)
    LD          A,(PLAYER_MAP_POS)
    ADD         A,D
    ADD         A,D
    CALL        ITEM_MAP_CHECK
    LD          (IX+0),A                     ;= $60
    LD          A,H
    SUB         D
    CALL        ITEM_MAP_CHECK
    LD          (IX+1),A                     ;= $60
    LD          A,H
    SUB         D
    CALL        ITEM_MAP_CHECK
    LD          (IX+2),A                     ;= $60
    LD          A,H
    ADD         A,D
    SUB         E
    CALL        ITEM_MAP_CHECK
    LD          (IX+3),A                    ;= $60
    LD          A,H
    ADD         A,E
    ADD         A,E
    CALL        ITEM_MAP_CHECK
    LD          (IX+4),A                    ;= $60
    LD          A,H
    SUB         D
    CALL        ITEM_MAP_CHECK
    LD          (IX+5),A                     ;= $60
    LD          A,H
    SUB         E
    SUB         E
    CALL        ITEM_MAP_CHECK
    LD          (IX+6),A                     ;= $60
    LD          A,H
    SUB         D
    ADD         A,E
    CALL        ITEM_MAP_CHECK
    LD          (IX+7),A                     ;= $60
LAB_ram_f7f0:
    LD          A,$fe
    RET
ITEM_MAP_CHECK:
    LD          H,A
    LD          BC,MAP_LADDER_OFFSET
LAB_ram_f7f7:
    LD          A,(BC)
    INC         BC
    INC         BC
    INC         A
    JR          Z,LAB_ram_f7f0
    DEC         A
    CP          H
    JR          NZ,LAB_ram_f7f7
    DEC         C
    LD          A,(BC)
    RET
REDRAW_VIEWPORT:
    CALL        DRAW_BKGD
    LD          BC,ITEM_F2                              ;BC = ITEM_F2
    LD          DE,WALL_F0_STATE                        ;DE = wallAheadTemp
    LD          A,(DE)                   ;A = (wallAheadTemp)
    RRCA
    JP          NC,F0_NO_HD                             ;Jump if no hidden door
    EX          AF,AF'
    CALL        DRAW_F0_WALL
    EX          AF,AF'
    RRCA
    JP          NC,F0_HD_NO_WALL                        ;Jump if no wall
    RRCA
    JP          NC,F0_HD_NO_WALL                        ;Jump if door closed
F0_NO_HD_WALL_OPEN:
    CALL        DRAW_WALL_F0_AND_OPEN_DOOR
    JP          LAB_ram_f986
F0_NO_HD:
    RRCA
    JP          NC,F0_NO_HD_NO_WALL                     ;Jump if no wall
    RRCA
    JP          C,F0_NO_HD_WALL_OPEN                    ;Jump if door open
    CALL        DRAW_F0_WALL_AND_CLOSED_DOOR
    JP          F0_HD_NO_WALL
F0_NO_HD_NO_WALL:
    INC         DE
    LD          A,(DE)                   ;= $20
    RRCA
    JP          NC,F1_NO_HD                             ;Jump if no hidden door
    EX          AF,AF'
    CALL        DRAW_WALL_F1
    EX          AF,AF'
    RRCA
    JP          NC,F1_HD_NO_WALL                        ;Jump if no wall
    RRCA
    JP          NC,F1_HD_NO_WALL                        ;Jump if door closed
F1_NO_HD_WALL_OPEN:
    CALL        DRAW_WALL_F1_AND_OPEN_DOOR
    JP          LAB_ram_f8b7
F1_NO_HD:
    RRCA
    JP          NC,LAB_ram_f85a
    RRCA
    JP          C,F1_NO_HD_WALL_OPEN
    CALL        DRAW_WALL_F1_AND_CLOSED_DOOR
    JP          F1_HD_NO_WALL
LAB_ram_f85a:
    INC         DE
    LD          A,(DE)                   ;= $20
    RRCA
    JP          NC,CHECK_WALL_F2
F2_WALL:
    CALL        DRAW_WALL_F2
    JP          LAB_ram_f86d
CHECK_WALL_F2:
    RRCA
    JP          C,F2_WALL
    CALL        DRAW_DOOR_F2_OPEN
LAB_ram_f86d:
    LD          DE,WALL_F3_STATE                        ;= $20
    LD          A,(DE)                   ;= $20
    RRCA
    JP          NC,LAB_ram_f87b
LAB_ram_f875:
    CALL        DRAW_WALL_FL2_EMPTY
    JP          LAB_ram_f892
LAB_ram_f87b:
    RRCA
    JP          C,LAB_ram_f875
    INC         DE
    LD          A,(DE)                    ;= $20
    RRCA
    JP          NC,LAB_ram_f88b
LAB_ram_f885:
    CALL        DRAW_WALL_L2_C
    JP          LAB_ram_f892
LAB_ram_f88b:
    RRCA
    JP          C,LAB_ram_f885
    CALL        DRAW_WALL_L2_C_EMPTY
LAB_ram_f892:
    LD          DE,WALL_R2_STATE                         ;= $20
    LD          A,(DE)                    ;= $20
    RRCA
    JP          NC,LAB_ram_f8a0
LAB_ram_f89a:
    CALL        DRAW_WALL_FR2
    JP          LAB_ram_f8b7
LAB_ram_f8a0:
    RRCA
    JP          C,LAB_ram_f89a
    INC         DE
    LD          A,(DE)                    ;= $20
    RRCA
    JP          NC,LAB_ram_f8b0
LAB_ram_f8aa:
    CALL        SUB_ram_cd21
    JP          LAB_ram_f8b7
LAB_ram_f8b0:
    RRCA
    JP          C,LAB_ram_f8aa
    CALL        SUB_ram_cd2c
LAB_ram_f8b7:
    LD          A,(ITEM_F2)                             ;= $60
    LD          BC,$48a
    CALL        CHK_ITEM
F1_HD_NO_WALL:
    LD          DE,WALL_L1_STATE                         ;= $20
    LD          A,(DE)                    ;= $20
    RRCA
    JP          NC,LAB_ram_f8db
    EX          AF,AF'
    CALL        DRAW_L1_WALL
    EX          AF,AF'
    RRCA
    JP          NC,LAB_ram_f923
    RRCA
    JP          NC,LAB_ram_f923
LAB_ram_f8d5:
    CALL        DRAW_FL1_DOOR
    JP          LAB_ram_f923
LAB_ram_f8db:
    RRCA
    JP          NC,LAB_ram_f8e9
    RRCA
    JP          C,LAB_ram_f8d5
    CALL        DRAW_L1
    JP          LAB_ram_f923
LAB_ram_f8e9:
    INC         E
    LD          A,(DE)                    ;= $20
    RRCA
    JP          NC,LAB_ram_f902
    EX          AF,AF'
    CALL        SUB_ram_cab0
    EX          AF,AF'
    RRCA
    JP          NC,LAB_ram_f923
    RRCA
    JP          NC,LAB_ram_f923
LAB_ram_f8fc:
    CALL        SUB_ram_cac5
    JP          LAB_ram_f923
LAB_ram_f902:
    RRCA
    JP          NC,LAB_ram_f910
    RRCA
    JP          C,LAB_ram_f8fc
    CALL        DRAW_L1_DOOR_CLOSED
    JP          LAB_ram_f923
LAB_ram_f910:
    INC         E
    LD          A,(DE)                    ;= $20
    RRCA
    JP          NC,LAB_ram_f91c
LAB_ram_f916:
    CALL        DRAW_WALL_FL2_NEW
    JP          LAB_ram_f923
LAB_ram_f91c:
    RRCA
    JP          C,LAB_ram_f916
    CALL        DRAW_WALL_FL2_EMPTY
LAB_ram_f923:
    LD          DE,WALL_R1_STATE                         ;= $20
    LD          A,(DE)                    ;= $20
    RRCA
    JP          NC,LAB_ram_f93e
    EX          AF,AF'
    CALL        DRAW_WALL_FR1
    EX          AF,AF'
    RRCA
    JP          NC,LAB_ram_f986
    RRCA
    JP          NC,LAB_ram_f986
LAB_ram_f938:
    CALL        SUB_ram_cc6d
    JP          LAB_ram_f986
LAB_ram_f93e:
    RRCA
    JP          NC,LAB_ram_f94c
    RRCA
    JP          C,LAB_ram_f938
    CALL        SUB_ram_cc7a
    JP          LAB_ram_f986
LAB_ram_f94c:
    INC         E
    LD          A,(DE)                    ;= $20
    RRCA
    JP          NC,LAB_ram_f965
    EX          AF,AF'
    CALL        SUB_ram_cc9a
    EX          AF,AF'
    RRCA
    JP          NC,LAB_ram_f986
    RRCA
    JP          NC,LAB_ram_f986
LAB_ram_f95f:
    CALL        SUB_ram_ccaf
    JP          LAB_ram_f986
LAB_ram_f965:
    RRCA
    JP          NC,LAB_ram_f973
    RRCA
    JP          C,LAB_ram_f95f
    CALL        SUB_ram_ccb5
    JP          LAB_ram_f986
LAB_ram_f973:
    INC         E
    LD          A,(DE)                    ;= $20
    RRCA
    JP          NC,LAB_ram_f97f
LAB_ram_f979:
    CALL        SUB_ram_ccc3
    JP          LAB_ram_f986
LAB_ram_f97f:
    RRCA
    JP          C,LAB_ram_f979
    CALL        DRAW_WALL_FR2_EMPTY
LAB_ram_f986:
    LD          A,(ITEM_F1)                             ;= $60
    LD          BC,$28a
    CALL        CHK_ITEM
F0_HD_NO_WALL:
    LD          DE,WALL_L0_STATE                         ;= $20
    LD          A,(DE)                    ;= $20
    RRCA
    JP          NC,LAB_ram_f9aa
    EX          AF,AF'
    CALL        DRAW_WALL_L0
    EX          AF,AF'
    RRCA
    JP          NC,LAB_ram_fa19
    RRCA
    JP          NC,LAB_ram_fa19
LAB_ram_f9a4:
    CALL        DRAW_DOOR_FL0_HIDDEN
    JP          LAB_ram_fa19
LAB_ram_f9aa:
    RRCA
    JP          NC,LAB_ram_f9b8
    RRCA
    JP          C,LAB_ram_f9a4
    CALL        SUB_ram_c996
    JP          LAB_ram_fa19
LAB_ram_f9b8:
    INC         E
    LD          A,(DE)                    ;= $20
    RRCA
    JP          NC,LAB_ram_f9c4
LAB_ram_f9be:
    CALL        SUB_ram_c9c5
    JP          LAB_ram_fa19
LAB_ram_f9c4:
    RRCA
    JP          C,LAB_ram_f9be
    INC         E
    LD          A,(DE)                    ;= $20
    RRCA
    JP          NC,LAB_ram_f9f0
    EX          AF,AF'
    CALL        SUB_ram_c9d0
    CALL        SUB_ram_f9e7
    EX          AF,AF'
    RRCA
    JP          NC,LAB_ram_fa19
    RRCA
    JP          NC,LAB_ram_fa19
LAB_ram_f9de:
    CALL        SUB_ram_c9f3
    CALL        SUB_ram_f9e7
    JP          LAB_ram_fa19
SUB_ram_f9e7:
    LD          A,(ITEM_FL1)                            ;= $60
    LD          BC,$4d0
    JP          CHK_ITEM
LAB_ram_f9f0:
    RRCA
    JP          NC,LAB_ram_fa01
    RRCA
    JP          C,LAB_ram_f9de
    CALL        SUB_ram_c9e5
    CALL        SUB_ram_f9e7
    JP          LAB_ram_fa19
LAB_ram_fa01:
    INC         E
    RRCA
    JP          NC,LAB_ram_fa0f
LAB_ram_fa06:
    CALL        SUB_ram_c9f9
    CALL        SUB_ram_f9e7
    JP          LAB_ram_fa19
LAB_ram_fa0f:
    RRCA
    JP          C,LAB_ram_fa06
    CALL        DRAW_WALL_FL22_EMPTY
    CALL        SUB_ram_f9e7
LAB_ram_fa19:
    LD          DE,WALL_R0_STATE                         ;= $20
    LD          A,(DE)                    ;= $20
    RRCA
    JP          NC,LAB_ram_fa34
    EX          AF,AF'
    CALL        DRAW_WALL_R0
    EX          AF,AF'
    RRCA
    JP          NC,LAB_ram_faa3
    RRCA
    JP          NC,LAB_ram_faa3
LAB_ram_fa2e:
    CALL        DRAW_FRO_DOOR
    JP          LAB_ram_faa3
LAB_ram_fa34:
    RRCA
    JP          NC,LAB_ram_fa42
    RRCA
    JP          C,LAB_ram_fa2e
    CALL        SUB_ram_cb7e
    JP          LAB_ram_faa3
LAB_ram_fa42:
    INC         E
    LD          A,(DE)                    ;= $20
    RRCA
    JP          NC,LAB_ram_fa57
LAB_ram_fa48:
    CALL        SUB_ram_cbae
    JP          LAB_ram_faa3
SUB_ram_fa4e:
    LD          A,(ITEM_FR1)                            ;= $60
    LD          BC,$4e4
    JP          CHK_ITEM
LAB_ram_fa57:
    RRCA
    JP          C,LAB_ram_fa48
    INC         E
    LD          A,(DE)                    ;= $20
    RRCA
    JP          NC,LAB_ram_fa7a
    EX          AF,AF'
    CALL        SUB_ram_cbb9
    CALL        SUB_ram_fa4e
    EX          AF,AF'
    RRCA
    JP          NC,LAB_ram_faa3
    RRCA
    JP          NC,LAB_ram_faa3
LAB_ram_fa71:
    CALL        SUB_ram_cbce
    CALL        SUB_ram_fa4e
    JP          LAB_ram_faa3
LAB_ram_fa7a:
    RRCA
    JP          NC,LAB_ram_fa8b
    RRCA
    JP          C,LAB_ram_fa71
    CALL        SUB_ram_cbd4
    CALL        SUB_ram_fa4e
    JP          LAB_ram_faa3
LAB_ram_fa8b:
    INC         E
    RRCA
    JP          NC,LAB_ram_fa99
LAB_ram_fa90:
    CALL        SUB_ram_cbe2
    CALL        SUB_ram_fa4e
    JP          LAB_ram_faa3
LAB_ram_fa99:
    RRCA
    JP          C,LAB_ram_fa90
    CALL        DRAW_WALL_FR222_EMPTY
    CALL        SUB_ram_fa4e
LAB_ram_faa3:
    LD          A,(ITEM_F0)                             ;= $60
    LD          BC,$8a
    JP          CHK_ITEM
MAKE_RANDOM_BYTE:
    PUSH        BC
    PUSH        HL
    LD          B,0x5                                   ;Run data randomizer 5x
    LD          HL,(RNDHOLD_AA)
RANDOM_BYTE_LOOP:
    SLA         L                                       ;L x 2
    RL          H
    JR          C,FINISH_BYTE_LOOP
    LD          A,$87
    XOR         L
    LD          L,A
    LD          A,$1d
    XOR         H
    LD          H,A
FINISH_BYTE_LOOP:
    DJNZ        RANDOM_BYTE_LOOP
    LD          (RNDHOLD_AA),HL
    LD          A,H
    POP         HL
    POP         BC
    RET
UPDATE_SCR_SAVER_TIMER:
    PUSH        BC
    PUSH        HL
    LD          HL,(TIMER_E)
    LD          B,H
    LD          C,L
    SLA         C
    RL          B
    SLA         C
    RL          B
    ADD         HL,BC
    LD          A,H
    XOR         L
    LD          (TIMER_D),A
    LD          B,H
    LD          C,L
    SLA         C
    RL          B
    SLA         C
    RL          B
    ADD         HL,BC
    LD          BC,$13
    ADD         HL,BC
    LD          (TIMER_E),HL
    POP         HL
    POP         BC
    RET
MINOTAUR_DEAD:
    CALL        DRAW_BKGD
    LD          HL,DAT_ram_3050                         ;= $20
    LD          DE,THE_END_PART_A                       ;WAS LD DE, 0xC25D
    LD          B,$10                                  ;RED on BLK
    CALL        GFX_DRAW
    LD          HL,DAT_ram_30a0                         ;= $20
    CALL        GFX_DRAW
    CALL        MAKE_RANDOM_BYTE
    AND         0x3
    ADD         A,0xa
    LD          B,A
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    LD          A,(INPUT_HOLDER)
    RLCA
    RLCA
    RLCA
    RLCA
    LD          B,A
    XOR         A
    LD          (INPUT_HOLDER),A
    LD          DE,MINOTAUR                             ;= $04,$04,$04,$04
    LD          HL,DAT_ram_32da                         ;= $20
    CALL        GFX_DRAW
    CALL        TOTAL_HEAL
    CALL        REDRAW_STATS
    LD          B,0x2                                   ;Was LD B,0x6
MINOTAUR_DEAD_SOUND_LOOP:
    EXX
    CALL        SUB_ram_cd5f
    CALL        END_OF_GAME_SOUND
    EXX
    DJNZ        MINOTAUR_DEAD_SOUND_LOOP
    JP          SCREEN_SAVER_FULL_SCREEN
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
DO_REST:
    LD          A,(LAST_ITEM_HELD)                   ;Load food inventory into A
    AND         A
    JP          NZ,NO_ACTION_TAKEN                      ;If food is empty, do nothing
CHK_NEEDS_HEALING:
    LD          HL,(PLAYER_PHYS_HEALTH_MAX)             ;HL = max PHYS health
    LD          DE,(PLAYER_PHYS_HEALTH)                 ;DE = current PHYS health
    CALL        RECALC_PHYS_HEALTH
    OR          L
    JR          NZ,HEAL_PLAYER_PHYS_HEALTH
    LD          A,(PLAYER_SPRT_HEALTH_MAX)
    LD          C,A
    LD          A,(PLAYER_SPRT_HEALTH)
    CP          C
    JP          Z,INPUT_DEBOUNCE
    JR          HEAL_PLAYER_SPRT_HEALTH
HEAL_PLAYER_PHYS_HEALTH:
    LD          HL,(BYTE_ram_3aa9)
    LD          DE,0x1
    CALL        RECALC_PHYS_HEALTH
    JP          C,INPUT_DEBOUNCE
    LD          (BYTE_ram_3aa9),HL
    LD          HL,FOOD_INV
    DEC         (HL)
    LD          HL,(PLAYER_PHYS_HEALTH)
    CALL        SUB_ram_e427
    LD          (PLAYER_PHYS_HEALTH),HL
    CALL        REDRAW_STATS
    LD          A,(PLAYER_SPRT_HEALTH_MAX)
    LD          C,A
    LD          A,(PLAYER_SPRT_HEALTH)
    CP          C
    JP          Z,CHK_NEEDS_HEALING
HEAL_PLAYER_SPRT_HEALTH:
    LD          HL,(BYTE_ram_3aa9)
    LD          DE,0x1
    CALL        RECALC_PHYS_HEALTH
    JP          C,INPUT_DEBOUNCE
    LD          (BYTE_ram_3aa9),HL
    LD          HL,FOOD_INV
    DEC         (HL)
    LD          A,(PLAYER_SPRT_HEALTH)
    ADD         A,0x1
    DAA
    LD          (PLAYER_SPRT_HEALTH),A
    CALL        REDRAW_STATS
    JR          CHK_NEEDS_HEALING
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
KEY_COMPARE:
    LD          A,(RAM_AE)
    CP          $31                                    ;Compare to "1" db?
    JP          NZ,WAIT_FOR_INPUT
KEY_COL_0:
    LD          HL,KEY_INPUT_COL0                       ;= $60
    LD          A,(HL)                  ;A = Key Column 0
    CP          $fe                                    ;If Key Row = 0 "="
    JP          Z,NO_ACTION_TAKEN
    CP          $fd                                    ;If Key Row = 1 "BKSP"
    JP          Z,NO_ACTION_TAKEN
    CP          $fb                                    ;If Key Row = 2 ":"
    JP          Z,NO_ACTION_TAKEN
    CP          $f7                                    ;If Key Row = 3 "RET"
    JP          Z,NO_ACTION_TAKEN
    CP          $ef                                    ;If Key Row = 4 ";"
    JP          Z,DO_GLANCE_RIGHT
    CP          $df                                    ;If Key Row = 5 "."
    JP          Z,DO_TURN_RIGHT
KEY_COL_1:
    INC         L
    LD          A,(HL)                  ;A = Key Column 1
    CP          $fe                                    ;If Key Row = 0 "-"
    JP          Z,NO_ACTION_TAKEN
    CP          $fd                                    ;If Key Row = 1 "/"
    JP          Z,NO_ACTION_TAKEN
    CP          $fb                                    ;If Key Row = 2 "0"
    JP          Z,NO_ACTION_TAKEN
    CP          $f7                                    ;If Key Row = 3 "P"
    JP          Z,NO_ACTION_TAKEN
    CP          $ef                                    ;If Key Row = 4 "L"
    JP          Z,DO_MOVE_FW_CHK_WALLS
    CP          $df                                    ;If Key Row = 5 ","
    JP          Z,DO_JUMP_BACK
KEY_COL_2:
    INC         L
    LD          A,(HL)                  ;A = Key Column 2
    CP          $fe                                    ;If Key Row = 0 "9"
    JP          Z,NO_ACTION_TAKEN
    CP          $fd                                    ;If Key Row = 1 "O"
    JP          Z,NO_ACTION_TAKEN
    CP          $fb                                    ;If Key Row = 2 "K"
    JP          Z,DO_MOVE_FW_CHK_WALLS
    CP          $f7                                    ;If Key Row = 3 "M"
    JP          Z,DO_TURN_LEFT
    CP          $ef                                    ;If Key Row = 4 "N"
    JP          Z,DO_USE_ATTACK
    CP          $df                                    ;If Key Row = 5 "J"
    JP          Z,DO_GLANCE_LEFT
KEY_COL_3:
    INC         L
    LD          A,(HL)                  ;A = Key Column 3
    CP          $fe                                    ;If Key Row = 0 "8"
    JP          Z,NO_ACTION_TAKEN
    CP          $fd                                    ;If Key Row = 1 "I"
    JP          Z,NO_ACTION_TAKEN
    CP          $fb                                    ;If Key Row = 2 "7"
    JP          Z,NO_ACTION_TAKEN
    CP          $f7                                    ;If Key Row = 3 "U"
    JP          Z,NO_ACTION_TAKEN
    CP          $ef                                    ;If Key Row = 4 "H"
    JP          Z,DO_OPEN_CLOSE
    CP          $df                                    ;If Key Row = 5 "B"
    JP          Z,NO_ACTION_TAKEN
KEY_COL_4:
    INC         L
    LD          A,(HL)                  ;A = Key Column 4
    CP          $fe                                    ;If Key Row = 0 "6"
    JP          Z,NO_ACTION_TAKEN
    CP          $fd                                    ;If Key Row = 1 "Y"
    JP          Z,USE_MAP
    CP          $fb                                    ;If Key Row = 2 "G"
    JP          Z,NO_ACTION_TAKEN
    CP          $f7                                    ;If Key Row = 3 "V"
    JP          Z,NO_ACTION_TAKEN
    CP          $ef                                    ;If Key Row = 4 "C"
    JP          Z,DO_COUNT_ARROWS
    CP          $df                                    ;If Key Row = 5 "F"
    JP          Z,DO_REST
KEY_COL_5:
    INC         L
    LD          A,(HL)                  ;A = Key Column 5
    CP          $fe                                    ;If Key Row = 0 "5"
    JP          Z,NO_ACTION_TAKEN
    CP          $fd                                    ;If Key Row = 1 "T"
    JP          Z,DO_TELEPORT
    CP          $fb                                    ;If Key Row = 2 "4"
    JP          Z,NO_ACTION_TAKEN
    CP          $f7                                    ;If Key Row = 3 "R"
    JP          Z,DO_SWAP_PACK
    CP          $ef                                    ;If Key Row = 4 "D"
    JP          Z,DO_USE_LADDER
    CP          $df                                    ;If Key Row = 5 "X"
    JP          Z,DO_COUNT_FOOD
KEY_COL_6:
    INC         L
    LD          A,(HL)                  ;A = Key Column 6
    CP          $fe                                    ;If Key Row = 0 "3"
    JP          Z,NO_ACTION_TAKEN
    CP          $fd                                    ;If Key Row = 1 "E"
    JP          Z,DO_SWAP_HANDS
    CP          $fb                                    ;If Key Row = 2 "S"
    JP          Z,DO_ROTATE_PACK
    CP          $f7                                    ;If Key Row = 3 "Z"
    JP          Z,WIPE_WALLS
    CP          $ef                                    ;If Key Row = 4 "SPC"
    JP          Z,NO_ACTION_TAKEN
    CP          $df                                    ;If Key Row = 5 "A"
    JP          Z,NO_ACTION_TAKEN
KEY_COL_7:
    INC         L
    LD          A,(HL)                  ;A = Key Column 7
    CP          $fe                                    ;If Key Row = 0 "2"
    JP          Z,NO_ACTION_TAKEN
    CP          $fd                                    ;If Key Row = 1 "W"
    JP          Z,DO_PICK_UP
    CP          $fb                                    ;If Key Row = 2 "1"
    JP          Z,NO_ACTION_TAKEN
    CP          $f7                                    ;If Key Row = 3 "Q"
    JP          Z,MAX_HEALTH_ARROWS_FOOD
    CP          $ef                                    ;If Key Row = 4 "SHFT"
    JP          Z,NO_ACTION_TAKEN
    CP          $df                                    ;If Key Row = 5 "CTRL"
    JP          Z,NO_ACTION_TAKEN
    JP          NO_ACTION_TAKEN
    NOP
MAX_HEALTH_ARROWS_FOOD:
    LD          HL,PLAYER_PHYS_HEALTH
    LD          A,$99
    LD          (HL),A
    INC         HL
    LD          (HL),A
    INC         HL
    LD          (HL),A
    INC         HL
    LD          (HL),A
    INC         HL
    LD          (HL),A
    INC         HL
    LD          (HL),A
    LD          HL,FOOD_INV
    LD          (HL),A
    INC         HL
    LD          (HL),A
    CALL        PLAY_POWER_UP_SOUND
    CALL        REDRAW_STATS
    JP          INPUT_DEBOUNCE
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
DO_TELEPORT:
    LD          A,(MAP_LADDER_OFFSET)
    LD          (PLAYER_MAP_POS),A
    CALL        PLAY_TELEPORT_SOUND
    JP          UPDATE_VIEWPORT
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
REDRAW_STATS:
    CALL        DRAW_ICON_BAR
    LD          HL,PLAYER_PHYS_HEALTH
    LD          DE,CHRRAM_PHYS_HEALTH_1000              ;= $20
    LD          B,0x2
    CALL        RECALC_AND_REDRAW_BCD
    LD          HL,PLAYER_SPRT_HEALTH
    LD          DE,CHRRAM_SPRT_HEALTH_10                ;= $20
    LD          B,0x1
    JP          RECALC_AND_REDRAW_BCD
CHECK_RING:
    PUSH        AF
    LD          A,(RING_INV_SLOT)
    CALL        LEVEL_TO_COLRAM_FIX
    LD          (COLRAM_RING_IDX),A                     ;= $60    `
    POP         AF
    RET
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
CHECK_HELMET:
    PUSH        AF
    LD          A,(HELMET_INV_SLOT)
    CALL        LEVEL_TO_COLRAM_FIX
    LD          (COLRAM_HELMET_IDX),A                   ;= $60    `
    POP         AF
    RET
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
CHECK_ARMOR:
    PUSH        AF
    LD          A,(ARMOR_INV_SLOT)
    CALL        LEVEL_TO_COLRAM_FIX
    LD          (COLRAM_ARMOR_IDX),A                    ;= $60    `
    POP         AF
    RET
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
LEVEL_TO_COLRAM_FIX:
    ADD         A,A
    SUB         0x1
    SLA         A
    SLA         A
    SLA         A
    SLA         A
    RET
RHA_REDRAW:
    CALL        CHECK_RING
    CALL        CHECK_HELMET
    CALL        CHECK_ARMOR
    JP          INPUT_DEBOUNCE
PLAY_TELEPORT_SOUND:
    LD          BC,$220
    LD          DE,$18
    CALL        PLAY_SOUND_LOOP
    LD          BC,$110
    LD          DE,$18
    CALL        PLAY_SOUND_LOOP
    LD          BC,$88
    LD          DE,$18
    CALL        PLAY_SOUND_LOOP
    LD          BC,$44
    LD          DE,$18
    CALL        PLAY_SOUND_LOOP
    RET
PLAY_POWER_UP_SOUND:
    LD          BC,$220
    LD          DE,$18
    CALL        PLAY_SOUND_LOOP
    LD          BC,$200
    LD          DE,$18
    CALL        PLAY_SOUND_LOOP
    LD          BC,$1e0
    LD          DE,$18
    CALL        PLAY_SOUND_LOOP
    LD          BC,$1c0
    LD          DE,$60
    CALL        PLAY_SOUND_LOOP
    RET
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
    db          $00
GFX_POINTERS:
    db          0h
GFX_PTR_BUCKLER:
    dw        BUCKLER                                 ;= $01,$01,$01,$01,$01
GFX_PTR_BUCKLER_S:
    dw        BUCKLER_S                               ;= $01,$01
GFX_PTR_BUCKLER_T:
    dw        BUCKLER_T                               ;= $00,$87,$FF
GFX_PTR_RING:
    dw        RING                                    ;= $01,$01,$01,$01,$01,$01,$01
GFX_PTR_RING_S:
    dw        RING_S                                  ;= $01,$01,$01
GFX_PTR_RING_T:
    dw        RING_T                                  ;= $00,".",$FF
GFX_PTR_HELMET:
    dw        HELMET                                  ;= $01,$01,$01,$01,$01,$01
GFX_PTR_HELMET_S:
    dw        HELMET_S                                ;= $01,$01,$01
GFX_PTR_HELMET_T:
    dw        HELMET_T                                ;= $00,"^",$FF
GFX_PTR_ARMOR:
    dw        ARMOR                                   ;= $01,$01,$01,$01,$01
GFX_PTR_ARMOR_S:
    dw        ARMOR_S                                 ;= $01,$01
GFX_PTR_ARMOR_T:
    dw        ARMOR_T                                 ;= $00,$A0,$C7,$D9,$01
GFX_PTR_PAVISE:
    dw        PAVISE                                  ;= $01,$01,$01,$01,$01
GFX_PTR_PAVISE_S:
    dw        PAVISE_S                                ;= $01,$01
GFX_PTR_PAVISE_T:
    dw        PAVISE_T                                ;= $00,$7F,$01
GFX_PTR_ARROW_L:
    dw        ARROW_FLYING_LEFT                       ;= $01,$01,$01,$01,$01,$01
GFX_PTR_ARROW_R:
    dw        ARROW_FLYING_RIGHT                      ;= $01,$01,$01,$01,$01,$01
GFX_PTR_ARROW_L_2:
    dw        ARROW_FLYING_LEFT                       ;= $01,$01,$01,$01,$01,$01
GFX_PTR_BOW:
    dw        BOW                                     ;= $01,$01,$01,$01,$01
GFX_PTR_BOW_S:
    dw        BOW_S                                   ;= $01,$01
GFX_PTR_BOW_T:
    dw        BOW_T                                   ;= $00,"{",$FF
GFX_PTR_SCROLL:
    dw        SCROLL                                  ;= $01,$01,$01,$01,$01
GFX_PTR_SCROLL_S:
    dw        SCROLL_S                                ;= $01,$01
GFX_PTR_SCROLL_NEW_T:
    dw        SCROLL_T                                ;= $00,"H",$FF
GFX_PTR_AXE:
    dw        AXE                                     ;= $01,$01,$01,$01,$01
GFX_PTR_AXE_S:
    dw        AXE_S                                   ;= $01,$01
GFX_PTR_AXE_T:
    dw        AXE_T                                   ;= $00,$11,$FF
GFX_PTR_FIREBALL:
    dw        FIREBALL                                ;= $01,$01,$01,$01,$01
GFX_PTR_FIREBALL_S:
    dw        FIREBALL_S                              ;= $01,$01
GFX_PTR_FIREBALL_T:
    dw        FIREBALL_T                              ;= $00,$D3,$FF
GFX_PTR_MACE:
    dw        MACE                                    ;= $01,$01,$01,$01,$01
GFX_PTR_MACE_S:
    dw        MACE_S                                  ;= $01,$01
GFX_PTR_MACE_T:
    dw        MACE_T                                  ;= $00,"T",$FF
GFX_PTR_STAFF:
    dw        STAFF                                   ;= $01,$01,$01,$01,$01
GFX_PTR_STAFF_S:
    dw        STAFF_S                                 ;= $01,$01
GFX_PTR_STAFF_T:
    dw        STAFF_T                                 ;= $00,"\\",$FF
GFX_PTR_CROSSBOW:
    dw        CROSSBOW                                ;= $01,$01,$01,$01,$01
GFX_PTR_CROSSBOW_S:
    dw        CROSSBOW_S                              ;= $01,$01
GFX_PTR_CROSSBOW_T:
    dw        CROSSBOW_T                              ;= $A0,$91,$A0,$D8,$02,$04,$90,$FF
    dw        EXCL_MARK_GFX
    dw        EXCL_MARK_GFX
    dw        EXCL_MARK_GFX
    dw        EXCL_MARK_GFX
    dw        EXCL_MARK_GFX
    dw        EXCL_MARK_GFX
GFX_PTR_ARROW_R_2:
    dw        ARROW_FLYING_RIGHT                      ;= $01,$01,$01,$01,$01,$01
    dw        EXCL_MARK_GFX
    dw        EXCL_MARK_GFX
GFX_PTR_LADDER:
    dw        LADDER                                  ;= $01,$01,$01,$01,$01
GFX_PTR_LADDER_S:
    dw        LADDER_S                                ;= $01,$01
GFX_PTR_LADDER_T:
    dw        LADDER_T                                ;= $00,$CD,$97,$FF
GFX_PTR_CHEST:
    dw        CHEST                                   ;= $01,$01,$01,$01,$01
GFX_PTR_CHEST_S:
    dw        CHEST_S                                 ;= $01,$E0,$1F,$1F,$B0,$01
GFX_PTR_CHEST_T:
    dw        CHEST_T                                 ;= $00,$FC,$FF
GFX_PTR_FOOD:
    dw        FOOD                                    ;= $01,$01,$01,$01,$01
GFX_PTR_FOOD_S:
    dw        FOOD_S                                  ;= $01,$01
GFX_PTR_FOOD_T:
    dw        FOOD_T                                  ;= $00,"#",$FF
GFX_PTR_QUIVER:
    dw        QUIVER                                  ;= $01,$01,$01,$01,$01,$01
GFX_PTR_QUIVER_S:
    dw        QUIVER_S                                ;= $01,$01
GFX_PTR_QUIVER_T:
    dw        QUIVER_T                                ;= $00,$F0,$FF
GFX_PTR_LOCK_CHEST:
    dw        LOCKED_CHEST                            ;= $01,$01,$01,$01,$01
GFX_PTR_LOCK_CHEST_S:
    dw        CHEST_S                                 ;= $01,$E0,$1F,$1F,$B0,$01
GFX_PTR_LOCK_CHEST_T:
    dw        CHEST_T                                 ;= $00,$FC,$FF
    dw        EXCL_MARK_GFX
    dw        EXCL_MARK_GFX
    dw        EXCL_MARK_GFX
GFX_PTR_KEY:
    dw        KEY                                     ;= $01,$01,$01,$01,$01,$01
GFX_PTR_KEY_S:
    dw        KEY_S                                   ;= $01,$01,$01
GFX_PTR_KEY_T:
    dw        KEY_T                                   ;= $FF,"-",$FF
GFX_PTR_AMULET:
    dw        AMULET                                  ;= $01,$01,$01,$01,$01
GFX_PTR_AMULET_S:
    dw        AMULET_S                                ;= $01,$01
GFX_PTR_AMULET_T:
    dw        AMULET_T                                ;= $00,"&",$FF
GFX_PTR_CHALICE:
    dw        CHALICE                                 ;= $01,$01,$01,$01,$01,$01
GFX_PTR_CHALICE_S:
    dw        CHALICE_S                               ;= $01,$01
GFX_PTR_CHALICE_T:
    dw        CHALICE_T                               ;= $00,"Y",$FF
GFX_PTR_WARRIOR_POTION:
    dw        WARRIOR_POTION                          ;= $01,$01,$01,$01,$01
GFX_PTR_WARRIOR_POTION_S:
    dw        WARRIOR_POTION_S                        ;= $01,$01
GFX_PTR_WARRIOR_POTION_T:
    dw        POTION_T                                ;= $00,"U",$02,$04,"_",$FF
GFX_PTR_MAGE_POTION:
    dw        MAGE_POTION                             ;= $01,$01,$01,$01,$01
GFX_PTR_MAGE_POTION_S:
    dw        MAGE_POTION_S                           ;= $01,$01
GFX_PTR_MAGE_POTION_T:
    dw        POTION_T                                ;= $00,"U",$02,$04,"_",$FF
GFX_PTR_MAP:
    dw        MAP                                     ;= $01,$01,$01,$01,$01
GFX_PTR_MAP_S:
    dw        MAP_S                                   ;= $01,$01
GFX_PTR_MAP_T:
    dw        MAP_T                                   ;= $00,$D5,$FF
GFX_PTR_CHAOS_POTION:
    dw        CHAOS_POTION                            ;= $01,$01,$01,$01,$01
GFX_PTR_CHAOS_POTION_S:
    dw        CHAOS_POTION_S                          ;= $01,$01
GFX_PTR_CHAOS_POTION_T:
    dw        POTION_T                                ;= $00,"U",$02,$04,"_",$FF
    dw        EXCL_MARK_GFX
    dw        EXCL_MARK_GFX
    dw        EXCL_MARK_GFX
GFX_END_PT1:
    dw        NO_GFX                                  ;= $FF
GFX_PTR_SKELETON:
    dw        SKELETON                                ;= $04,$04,$04,$04
GFX_PTR_SKELETON_S:
    dw        SKELETON_S                              ;= $04,$04,$04
    dw        NO_GFX                                  ;= $FF
GFX_PTR_SNAKE:
    dw        SNAKE                                   ;= $04,$04,$04
GFX_PTR_SNAKE_S:
    dw        SNAKE_S                                 ;= $04,$04,$04
    dw        NO_GFX                                  ;= $FF
GFX_PTR_SPIDER:
    dw        SPIDER                                  ;= $04,$04
GFX_PTR_SPIDER_S:
    dw        SPIDER_S                                ;= $04,$04,$04,$04
    dw        NO_GFX                                  ;= $FF
GFX_PTR_MIMIC:
    dw        MIMIC                                   ;= $04,$02,$D7,$96,$00,$00,$96,$C9,$01
GFX_PTR_MIMIC_S:
    dw        MIMIC_S                                 ;= $01,$E0,$1F,$1F,$B0,$01
    dw        NO_GFX                                  ;= $FF
GFX_PTR_MALOCCHIO:
    dw        MALOCCHIO                               ;= $04,$04,$04,$04
GFX_PTR_MALOCCHIO_S:
    dw        MALOCCHIO_S                             ;= $04,$04,$04,$04
    dw        NO_GFX                                  ;= $FF
GFX_PTR_DRAGON:
    dw        DRAGON                                  ;= $04,$04,$04,$04
GFX_PTR_DRAGON_S:
    dw        DRAGON_S                                ;= $04,$04,$04,$C9,$C9,$C0,$C0,$01
GFX_PTR_END_A:
    dw        NO_GFX                                  ;= $FF
GFX_PTR_MUMMY:
    dw        MUMMY                                   ;= $04,$04,$04,$04
GFX_PTR_MUMMY_S:
    dw        MUMMY_S                                 ;= $04,$04,$04
GFX_PTR_END_B:
    dw        NO_GFX                                  ;= $FF
GFX_PTR_NECRO:
    dw        NECROMANCER                             ;= $04,$04,$04,$04
GFX_PTR_NECRO_S:
    dw        NECROMANCER_S                           ;= $04,$04,$04
GFX_PTR_END_C:
    dw        NO_GFX                                  ;= $FF
GFX_PTR_GRYPHON:
    dw        GRYPHON                                 ;= $04,$04,$04,$04
GFX_PTR_GRYPHON_S:
    dw        GRYPHON_S                               ;= $04,$04,$04,$B8,$B8,$B0,$01
GFX_PTR_END_D:
    dw        NO_GFX                                  ;= $FF
GFX_PTR_MINOTAUR:
    dw        MINOTAUR                                ;= $04,$04,$04,$04
GFX_PTR_MINOTAUR_S:
    dw        MINOTAUR_S                              ;= $04,$04,$04,$04

    ds 16, $00
