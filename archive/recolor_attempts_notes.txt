RECOLOR_ITEM REVERSED CHARACTER HANDLING - ATTEMPT LOG
========================================================

PREVIOUS COMMIT: "RH to F0 swap colors fixed (reverse CHRs still an issue)"
- Working: RH→F0 drop leaves F0 with DKGRY background, RH clears to $D0
- Issue: F0→RH pickup loses item color in reversed characters ($F1 → $F0 instead of $01)

CHANGES MADE SINCE LAST COMMIT:
================================

1. RECOLOR_ITEM Function Enhancement (lines ~1265-1310)
   - Renamed CHANGE_REVERSED_COLORS → CHANGE_FG_COLOR
   - Added CHECK_BG_COLOR section with RRCA rotation logic
   - Added new CHANGE_BG_COLOR routine
   - Logic: 
     * First check: FG matches E → CHANGE_FG_COLOR (AND $0F, OR C)
     * Second check: FG matches E's BG (rotated) → CHANGE_BG_COLOR (AND $F0, OR C)
     * Fallthrough: OR D

2. New Helper Function: CLEAR_BG_TO_BLK (after CHANGE_BG_COLOR)
   - Unconditionally ANDs $F0 across 4x4 block at HL
   - Zeros BG nibble for all cells
   - Uses same row/column loop structure as RECOLOR_ITEM
   - Labels: CLR_ROW_LOOP, CLR_COL_LOOP, CLR_DONE

3. PICK_UP_NON_TREASURE Modifications (F0→RH pickup)
   - Changed F0 recolor:
     * DE: TWOCOLOR(NOCLR,DKGRY,DKGRN,NOCLR) - D=$0F for floor BG
     * C: COLOR(BLK,DKGRY) - preserves DKGRY in BG for matches
   - Changed RH recolor:
     * DE: TWOCOLOR(NOCLR,DKGRY,DKGRN,NOCLR) - attempted to use BG nibble for reversed check
     * C: COLOR(BLK,NOCLR) - FG to BLK for reversed cells
   - Added CLEAR_BG_TO_BLK call after RH recolor

4. DROP_NON_TREASURE Parameters (RH→F0 drop - unchanged from working commit)
   - F0 recolor: DE with D=$0F, C=COLOR(BLK,DKGRY)
   - RH recolor: DE=TWOCOLOR(NOCLR,BLK,DKGRN,NOCLR), C=COLOR(DKGRY,NOCLR)

PROBLEM WITH CURRENT APPROACH:
===============================
- CHECK_BG_COLOR logic rotates E's lower nibble to check against FG
- E=$D0 has lower nibble=$0, which rotates to $00, doesn't match reversed cell's FG=$F0
- Reversed cells ($F1) not getting converted to $01
- Need E's lower nibble to be DKGRY ($0F) for rotation to match $F0

CONSIDERED ALTERNATIVES:
========================
1. Two RECOLOR_ITEM calls - rejected as too slow
2. Direct E=$F0 match - would need separate handling for normal vs reversed
3. Nibble swap routine - complexity vs speed tradeoff

KEY INSIGHT:
============
The shared RECOLOR_ITEM function is trying to serve both DROP and PICKUP with 
incompatible requirements via the new CHECK_BG_COLOR path. DROP needs it disabled,
PICKUP needs it enabled but with correct E lower nibble value.

NEXT APPROACH TO TRY:
=====================
[To be filled in after revert and new strategy discussion]
