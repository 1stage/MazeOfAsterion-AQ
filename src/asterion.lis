src/asterion.asm:
     1                          INCLUDE "aquarius.inc"
src/aquarius.inc:
     1                          ; Aquarius SYSROM Routines
     2                          SLEEP_ZERO EQU $1d48
     3                          SLEEP EQU $1d4b
     4                          FILL_FULL_1024 EQU $1e59
     5                          
     6                          ; CHRRAM - Character RAM
     7                          CHRRAM EQU $3000
     8                          
     9                          ; COLRAM: Color RAM
    10                          COLRAM EQU $3400
    11                          
    12                          ; Aquarius IO ports
    13                          MODEM_A EQU $7E
    14                          MODEM_B EQU $7F
    15                          CONTROL_PADS EQU $F6
    16                          PSG EQU $F7
    17                          SPEAKER EQU $FC
    18                          VSYNC EQU $FD
    19                          PRINTER EQU $FE
    20                          KEYBOARD EQU $FF
    21                          
src/asterion.asm:
     2                          INCLUDE "asterion.inc"
src/asterion.inc:
     1                          ; CHRRAM - Character RAM
     2                          CHRRAM_LEVEL_IND_L EQU $3001
     3                          CHRRAM_LEVEL_IND_R EQU $3004
     4                          CHRRAM_SHIFT_MODE_IDX EQU $3005
     5                          CHRRAM_LADDER_IDX EQU $3007
     6                          CHRRAM_ITEM_IDX EQU $3009
     7                          CHRRAM_MONSTER_IDX EQU $300b
     8                          CHRRAM_DOOR_IDX EQU $300d
     9                          CHRRAM_MAP_IDX EQU $3011
    10                          CHRRAM_ARMOR_IDX EQU $3013
    11                          CHRRAM_HELMET_IDX EQU $3015
    12                          CHRRAM_RING_IDX EQU $3017
    13                          IDX_VIEWPORT_CHRRAM EQU $3028
    14                          DAT_ram_3050 EQU $3050
    15                          CHRRAM_WALL_F0_IDX EQU $30cc
    16                          DAT_ram_3168 EQU $3168
    17                          CHRRAM_L1_DOOR_IDX EQU $316d
    18                          DAT_ram_3177 EQU $3177
    19                          DAT_ram_317a EQU $317a
    20                          DAT_ram_317f EQU $317f
    21                          DAT_ram_3191 EQU $3191
    22                          DAT_ram_3196 EQU $3196
    23                          DAT_ram_31a1 EQU $31a1
    24                          DAT_ram_31a6 EQU $31a6
    25                          CHRRAM_POINTER_IDX EQU $31d8
    26                          DAT_ram_3259 EQU $3259
    27                          DAT_ram_3266 EQU $3266
    28                          DAT_ram_326e EQU $326e
    29                          DAT_ram_3280 EQU $3280
    30                          DAT_ram_3297 EQU $3297
    31                          
    32                          ; CHRRAM Spare 24
    33                          WALL_F0_STATE EQU $33e8
    34                          WALL_F1_STATE EQU $33e9
    35                          WALL_F2_STATE EQU $33ea
    36                          WALL_F3_STATE EQU $33eb
    37                          DAT_ram_33ec EQU $33ec
    38                          DAT_ram_33ed EQU $33ed
    39                          DAT_ram_33ee EQU $33ee
    40                          DAT_ram_33ef EQU $33ef
    41                          DAT_ram_33f0 EQU $33f0
    42                          DAT_ram_33f1 EQU $33f1
    43                          DAT_ram_33f2 EQU $33f2
    44                          DAT_ram_33f3 EQU $33f3
    45                          DAT_ram_33f4 EQU $33f4
    46                          DAT_ram_33f5 EQU $33f5
    47                          DAT_ram_33f6 EQU $33f6
    48                          DAT_ram_33f7 EQU $33f7
    49                          DAT_ram_33f9 EQU $33f9
    50                          DAT_ram_33fa EQU $33fa
    51                          DAT_ram_33fb EQU $33fb
    52                          DAT_ram_33fd EQU $33fd
    53                          
    54                          ; COLRAM: Color RAM
    55                          COLRAM_LEVEL_IDX_L EQU $3401
    56                          COLRAM_FLOOR_IDX_10 EQU $3402
    57                          COLRAM_FLOOR_IDX_1 EQU $3403
    58                          COLRAM_LEVEL_IDX_R EQU $3404
    59                          COLRAM_ARMOR_IDX EQU $3413
    60                          COLRAM_HELMET_IDX EQU $3415
    61                          COLRAM_RING_IDX EQU $3417
    62                          COLRAM_PHYS_STATS_1000 EQU $3441
    63                          COLRAM_SPRT_STATS_10 EQU $3446
    64                          DAT_ram_3568 EQU $3568
    65                          COLRAM_F0_DOOR_IDX EQU $3570
    66                          DAT_ram_357f EQU $357f
    67                          DAT_ram_3590 EQU $3590
    68                          DAT_ram_3591 EQU $3591
    69                          DAT_ram_35a6 EQU $35a6
    70                          DAT_ram_35a7 EQU $35a7
    71                          DAT_ram_35d8 EQU $35d8
    72                          DAT_ram_35e0 EQU $35e0
    73                          DAT_ram_35e1 EQU $35e1
    74                          DAT_ram_35f6 EQU $35f6
    75                          DAT_ram_35f7 EQU $35f7
    76                          DAT_ram_3608 EQU $3608
    77                          DAT_ram_361f EQU $361f
    78                          DAT_ram_3728 EQU $3728
    79                          
    80                          ; COLRAM Spare 24
    81                          ITEM_F2 EQU $37e8
    82                          ITEM_F1 EQU $37e9
    83                          ITEM_F0 EQU $37ea
    84                          ITEM_FL1 EQU $37eb
    85                          ITEM_FR1 EQU $37ec
    86                          ITEM_R1 EQU $37ed
    87                          ITEM_L1 EQU $37ee
    88                          ITEM_B1 EQU $37ef
    89                          KEY_INPUT_COL0 EQU $37f6
    90                          KEY_INPUT_COL1 EQU $37f7
    91                          KEY_INPUT_COL2 EQU $37f8
    92                          KEY_INPUT_COL3 EQU $37f9
    93                          KEY_INPUT_COL4 EQU $37fa
    94                          KEY_INPUT_COL5 EQU $37fb
    95                          KEY_INPUT_COL6 EQU $37fc
    96                          KEY_INPUT_COL7 EQU $37fd
    97                          HC_INPUT_HOLDER EQU $37fe
    98                          
    99                          ; Aquarius Built-In 2k RAM Space
   100                          MAPSPACE_WALLS EQU $3800
   101                          MAP_LADDER_OFFSET EQU $3900
   102                          LADDER_POS EQU $3901
   103                          MAP_ITEM_SPACE EQU $3902
   104                          BYTE_ram_3903 EQU $3903
   105                          BYTE_ram_3904 EQU $3904
   106                          BYTE_ram_3905 EQU $3905
   107                          BYTE_ram_3906 EQU $3906
   108                          ITEM_MOVE_CHR_BUFFER EQU $3a00
   109                          ITEM_MOVE_COL_BUFFER EQU $3a10
   110                          BYTE_ram_3a20 EQU $3a20
   111                          BYTE_ram_3a58 EQU $3a58
   112                          DIR_FACING_FW EQU $3a60
   113                          DIR_FACING_BW EQU $3a61
   114                          DIR_FACING_SHORT EQU $3a62
   115                          MON_FS EQU $3a63
   116                          RAM_AC EQU $3a64
   117                          RAM_AD EQU $3a65
   118                          RAM_AE EQU $3a66
   119                          RAM_AF EQU $3a67
   120                          DUNGEON_LEVEL EQU $3a68
   121                          TIMER_A EQU $3a69
   122                          TIMER_B EQU $3a6a
   123                          TIMER_C EQU $3a6b
   124                          TIMER_D EQU $3a88
   125                          TIMER_E EQU $3a9c
   126                          
   127                          INPUT_HOLDER EQU $3a6c
   128                          SHIELD_PHYS EQU $3a71
   129                          SHIELD_SPRT EQU $3a73
   130                          ARMOR_INV_SLOT EQU $3a74
   131                          HELMET_INV_SLOT EQU $3a75
   132                          RING_INV_SLOT EQU $3a76
   133                          PLAYER_PREV_MAP_LOC EQU $3a77
   134                          LAST_ITEM_HELD EQU $3a78
   135                          PLAYER_MAP_POS EQU $3a79
   136                          RIGHT_HAND_ITEM EQU $3a7a
   137                          LEFT_HAND_ITEM EQU $3a7b
   138                          INV_ITEM_SLOT_1 EQU $3a7c
   139                          INV_ITEM_SLOT_2 EQU $3a7d
   140                          INV_ITEM_SLOT_3 EQU $3a7e
   141                          BYTE_ram_3a82 EQU $3a82
   142                          BYTE_ram_3a83 EQU $3a83
   143                          BYTE_ram_3a85 EQU $3a85
   144                          BYTE_ram_3a87 EQU $3a87
   145                          
   146                          BYTE_ram_3a89 EQU $3a89
   147                          BYTE_ram_3a8a EQU $3a8a
   148                          MELEE_ANIM_STATE EQU $3a8b
   149                          BYTE_ram_3a8c EQU $3a8c
   150                          MONSTER_ATT_POS_COUNT EQU $3a8d
   151                          MONSTER_ATT_POS_OFFSET EQU $3a8f
   152                          RNDHOLD_AA EQU $3a91
   153                          PLAYER_PHYS_HEALTH EQU $3a93
   154                          PLAYER_PHYS_HEALTH_MAX EQU $3a95
   155                          PLAYER_SPRT_HEALTH EQU $3a97
   156                          PLAYER_SPRT_HEALTH_MAX EQU $3a98
   157                          WEAPON_PHYS EQU $3a99
   158                          WEAPON_SPRT EQU $3a9b
   159                          BYTE_ram_3a9e EQU $3a9e
   160                          BYTE_ram_3aa0 EQU $3aa0
   161                          ITEM_HOLDER EQU $3aa1
   162                          CURR_MONSTER_SPRT EQU $3aa2
   163                          CURR_MONSTER_PHYS EQU $3aa3
   164                          BYTE_ram_3aa5 EQU $3aa5
   165                          NEW_DAMAGE EQU $3aa6
   166                          WEAPON_VALUE_HOLDER EQU $3aa8
   167                          BYTE_ram_3aa9 EQU $3aa9
   168                          FOOD_INV EQU $3aab
   169                          ARROW_INV EQU $3aac
   170                          MAP_INV_SLOT EQU $3aad
   171                          SND_CYCLE_HOLDER EQU $3ab3
   172                          PITCH_UP_BOOL EQU $3ab5
   173                          SOUND_REPEAT_COUNT EQU $3ab8
   174                          GAME_BOOLEANS EQU $3ab9
   175                          NEXT_BLINK_CHECK EQU $3aba
   176                          TEMP_MAP EQU $3b00
   177                          BYTE_ram_3ffd EQU $3ffd
   178                          
   179                          ; Missing items
   180                          BYTE_ram_2400 EQU $2400
   181                          BYTE_ram_2613 EQU $2613
   182                          DAT_ram_303f EQU $303f
   183                          DAT_ram_3051 EQU $3051
   184                          DAT_ram_30a0 EQU $30a0
   185                          DAT_ram_30c8 EQU $30c8
   186                          DAT_ram_30df EQU $30df
   187                          DAT_ram_310c EQU $310c
   188                          DAT_ram_3111 EQU $3111
   189                          DAT_ram_3150 EQU $3150
   190                          DAT_ram_316c EQU $316c
   191                          DAT_ram_3178 EQU $3178
   192                          DAT_ram_317c EQU $317c
   193                          DAT_ram_31af EQU $31af
   194                          DAT_ram_31b4 EQU $31b4
   195                          DAT_ram_3200 EQU $3200
   196                          DAT_ram_3230 EQU $3230
   197                          DAT_ram_324c EQU $324c
   198                          DAT_ram_32da EQU $32da
   199                          DAT_ram_335c EQU $335c
   200                          DAT_ram_33c0 EQU $33c0
   201                          DAT_ram_34b4 EQU $34b4
   202                          DAT_ram_34c8 EQU $34c8
   203                          DAT_ram_34dc EQU $34dc
   204                          DAT_ram_351a EQU $351a
   205                          DAT_ram_352d EQU $352d
   206                          DAT_ram_3547 EQU $3547
   207                          DAT_ram_3550 EQU $3550
   208                          DAT_ram_356c EQU $356c
   209                          DAT_ram_3577 EQU $3577
   210                          DAT_ram_3578 EQU $3578
   211                          DAT_ram_357a EQU $357a
   212                          DAT_ram_357c EQU $357c
   213                          DAT_ram_35ba EQU $35ba
   214                          DAT_ram_35c0 EQU $35c0
   215                          DAT_ram_35c6 EQU $35c6
   216                          DAT_ram_35c8 EQU $35c8
   217                          DAT_ram_35ca EQU $35ca
   218                          DAT_ram_35cc EQU $35cc
   219                          LAB_ram_1208 EQU $1208
   220                          LAB_ram_efef EQU $efef
   221                          CHHRAM_INV_4_IDX EQU $31a9
   222                          CHHRAM_INV_6_IDX EQU $3251
   223                          CHHRAM_LVL_IDX EQU $33df
   224                          CHRRAM_AUTHORS_IDX EQU $3348
   225                          CHRRAM_F1_WALL_IDX EQU $3170
   226                          CHRRAM_FL1_WALL_IDX EQU $3147
   227                          CHRRAM_FO_ITEM_IDX EQU $3352
   228                          CHRRAM_LEFT_HAND_ITEM_IDX EQU $3271
   229                          CHRRAM_LEFT_HD_GFX_IDX EQU $3339
   230                          CHRRAM_LEVEL_IDX EQU $333d
   231                          CHRRAM_MONSTER_PHYS EQU $3089
   232                          CHRRAM_MONSTER_POOF_IDX EQU $323b
   233                          CHRRAM_MONSTER_SPRT EQU $3063
   234                          CHRRAM_PHYS_HEALTH_1000 EQU $3041
   235                          CHRRAM_PHYS_SHIELD_IDX EQU $3069
   236                          CHRRAM_PHYS_WEAPON_IDX EQU $3091
   237                          CHRRAM_RH_POOF_IDX EQU $336c
   238                          CHRRAM_RIGHT_HAND_ITEM_IDX EQU $327b
   239                          CHRRAM_RIGHT_HD_GFX_IDX EQU $3343
   240                          CHRRAM_SPRT_HEALTH_10 EQU $3047
   241                          CHRRAM_SPRT_SHIELD_IDX EQU $306f
   242                          CHRRAM_SPRT_WEAPON_IDX EQU $3097
   243                          CHRRAM_STATS_TOP EQU $3019
   244                          CHRRAM_YOU_DIED_IDX EQU $31e7
   245                          COLRAM_F0_WALL_MAP_IDX EQU $34cc
   246                          COLRAM_F1_DOOR_IDX EQU $35c2
   247                          COLRAM_FL00_WALL_IDX EQU $34a3
   248                          COLRAM_FL2_PLUS_WALL_IDX EQU $35be
   249                          COLRAM_FL2_WALL_IDX EQU $35bc
   250                          COLRAM_FL22_WALL_IDX EQU $35b8
   251                          COLRAM_FO_ITEM_IDX EQU $3752
   252                          COLRAM_L1_DOOR_IDX EQU $356d
   253                          COLRAM_MAP_IDX EQU $3411
   254                          COLRAM_PHYS_STATS_10 EQU $3443
   255                          COLRAM_RH_ITEM_IDX EQU $3743
   256                          COLRAM_SHIFT_MODE_IDX EQU $3405
   257                          COLRAM_SPRT_STATS_1 EQU $3447
   258                          COLRAM_VIEWPORT_IDX EQU $3428
   259                          HC_LAST_INPUT EQU $37ff
   260                          IDX_HEALTH_SPACER EQU $3045
   261                          
src/asterion.asm:
     3                          
     4                          org $c000
     5                          
     6                          include "asterion_gfx.asm"
src/asterion_gfx.asm:
     1                          ; ASTERION_GFX.ASM
     2                          ; Updated 22 SEP 2025 by Sean P. Harrington
     3                          ;
     4                          
     5                          ; Maze of Asterion Grpahics Draw Routine -
     6                          ;   The routine that draws character-based graphics in Maze of Asterion is labelled GFX_DRAW .
     7                          ;   -   Register B expects the FG/BG color value
     8                          ;   -   Register HL expects the CHRRAM screen address to start drawing
     9                          ;       - Indexed starting points for ITEMS and MONSTERS within the VIEWPORT
    10                          ;       - Indexed starting points for LEFT and RIGHT hands and inventory items
    11                          ;       - Any other indexed locations (always starting in CHRRAM!!!)
    12                          ;   -   Register DE expects the GFX start address (typically through the GFX_POINTERS table)
    13                          ;   A graphic in Maze of Asterion is a block of AQUASCII characters, $FF terminated, with six defined “control” characters:
    14                          ;   -   $00 = empty character (move right one column, NOT a space character!)
    15                          ;   -   $01 = return character (move down and back to index)
    16                          ;   -   $02 = backspace character (move left one column)
    17                          ;   -   $03 = linefeed (move down one row)
    18                          ;   -   $04 = previous line (move up one row)
    19                          ;   -   $A0 = reverse colors (swap FG/BG)
    20                          
    21                          
    22                          
    23                          ; NO_GFX is a label used for an "empty" graphic, since it's only character is the end of graphic code, $FF
    24                          NO_GFX:
    25  0000  ff                    db          $FF
    26                          
    27                          ; ITEMS:
    28                          ;   - Items range from OBJECT INDEX $00 to $77, and OBJECT TYPE $00 to $1D
    29                          ;   - OBJECT TYPE is the OBJECT INDEX bit-shifted RIGHT two times to remove the 2 bits of object level
    30                          ;   - Items (if visible in the maze) have three sizes, depending on how far away they are from the PLAYER's position:
    31                          ;       - Tiny (i.e. MAP_T): These items are either two spaces forward, or one space diagonal right or left forward from the player. These graphics are usually only a single character wide.
    32                          ;       - Small (i.e. MAP_S): These items are one space forward from the player. These graphics are usually 2x2 characters in size.
    33                          ;       - Regular (i.e. MAP): These items are in the same space as the player. These graphics are usually 4x4 characters in size, and this is the size used for items in the player's inventory pack.
    34                          ;
    35                          
    36                          ; =================================
    37                          ; BUCKLER -
    38                          ;   OBJECT TYPE:  $00
    39                          ;   OBJECT INDEX:
    40                          ;       $00 - RED BUCKLER (Starting item, HARDEST level)
    41                          ;       $01 - YELLOW BUCKLER (Starting item, HARD level)
    42                          ;       $02 - MAGENTA BUCKLER (Starting item, MEDIUM level)
    43                          ;       $03 - WHITE BUCKLER (Starting item, EASIEST level)
    44                          ; The BUCKLER is a small shield item that can be picked up and swapped to the LEFT HAND for protection.
    45                          ;
    46                          BUCKLER:
    47  0001  0101010101            db          $01,$01,$01,$01,$01
    48  0006  d7fcc901              db          $D7,$FC,$C9,$01
    49  000a  a098a07f9901          db          $A0,$98,$A0,$7F,$99,$01
    50  0010  c7afd9ff              db          $C7,$AF,$D9,$FF
    51                          BUCKLER_S:
    52  0014  0101                  db          $01,$01
    53  0016  0096ff                db          $00,$96,$FF
    54                          BUCKLER_T:
    55  0019  0087ff                db          $00,$87,$FF
    56                          
    57                          ; =================================
    58                          ; RING -
    59                          ;   OBJECT TYPE:  $01
    60                          ;   OBJECT INDEX:
    61                          ;       $04 - RED RING
    62                          ;       $05 - YELLOW RING
    63                          ;       $06 - MAGENTA RING
    64                          ;       $07 - WHITE RING
    65                          ; The RING is an enchantment item that increases protection. Once picked up they are worn immediately and cannot be removed. They are not kept in inventory. If another RING of greater level it is picked up and worn, and the old RING disappears.
    66                          ;
    67                          RING:
    68  001c  01010101010101        db          $01,$01,$01,$01,$01,$01,$01
    69  0023  006fff                db          $00,"o",$FF
    70                          RING_S:
    71  0026  010101                db          $01,$01,$01
    72  0029  00c6ff                db          $00,$C6,$FF
    73                          RING_T:
    74  002c  002eff                db          $00,".",$FF
    75                          
    76                          ; =================================
    77                          ; HELMET -
    78                          ;   OBJECT TYPE:  $02
    79                          ;   OBJECT INDEX:
    80                          ;       $08 - RED HELMET
    81                          ;       $09 - YELLOW HELMET
    82                          ;       $0A - MAGENTA HELMET
    83                          ;       $0B - WHITE HELMET
    84                          ; The HELMET is an enchantment item that increases protection. Once picked up they are worn immediately and cannot be removed. They are not kept in inventory. If another HELMET of greater level it is picked up and worn, and the old HELMET disappears.
    85                          ;
    86                          HELMET:
    87  002f  010101010101          db          $01,$01,$01,$01,$01,$01
    88  0035  00c0c101              db          $00,$C0,$C1,$01
    89  0039  00bfefff              db          $00,$BF,$EF,$FF
    90                          HELMET_S:
    91  003d  010101                db          $01,$01,$01
    92  0040  0400d201              db          $04,$00,$D2,$01
    93  0044  00a3ff                db          $00,$A3,$FF
    94                          HELMET_T:
    95  0047  005eff                db          $00,"^",$FF
    96                          
    97                          ; =================================
    98                          ; ARMOR -
    99                          ;   OBJECT TYPE:  $03
   100                          ;   OBJECT INDEX:
   101                          ;       $0C - RED ARMOR
   102                          ;       $0D - YELLOW ARMOR
   103                          ;       $0E - MAGENTA ARMOR
   104                          ;       $0F - WHITE ARMOR
   105                          ; The ARMOR is an enchantment item that increases protection. Once picked up they are worn immediately and cannot be removed. They are not kept in inventory. If another ARMOR of greater level it is picked up and worn, and the old ARMOR disappears.
   106                          ;
   107                          ARMOR:
   108  004a  0101010101            db          $01,$01,$01,$01,$01
   109  004f  a0c9c7d9d7a001        db          $A0,$C9,$C7,$D9,$D7,$A0,$01
   110  0056  ea7f7fb501            db          $EA,$7F,$7F,$B5,$01
   111  005b  a0c38888a097ff        db          $A0,$C3,$88,$88,$A0,$97,$FF
   112                          ARMOR_S:
   113  0062  0101                  db          $01,$01
   114  0064  c7a0c7d9a0d901        db          $C7,$A0,$C7,$D9,$A0,$D9,$01
   115  006b  007f7f01              db          $00,$7F,$7F,$01
   116  006f  00d9c7ff              db          $00,$D9,$C7,$FF
   117                          ARMOR_T:
   118  0073  00a0c7d901            db          $00,$A0,$C7,$D9,$01
   119  0078  0097a0c3ff            db          $00,$97,$A0,$C3,$FF
   120                          
   121                          ; =================================
   122                          ; PAVICE -
   123                          ;   OBJECT TYPE:  $04
   124                          ;   OBJECT INDEX:
   125                          ;       $00 - RED PAVICE
   126                          ;       $01 - YELLOW PAVICE
   127                          ;       $02 - MAGENTA PAVICE
   128                          ;       $03 - WHITE PAVICE
   129                          ; The PAVICE is a large shield item that can be picked up and swapped to the LEFT HAND for protection.
   130                          ;
   131                          PAVICE:
   132  007d  0101010101            db          $01,$01,$01,$01,$01
   133  0082  e8f0f0b401            db          $E8,$F0,$F0,$B4,$01
   134  0087  ea7f7fb501            db          $EA,$7F,$7F,$B5,$01
   135  008c  ea7f7fb501            db          $EA,$7F,$7F,$B5,$01
   136  0091  00efbfff              db          $00,$EF,$BF,$FF
   137                          PAVICE_S:
   138  0095  0101                  db          $01,$01
   139  0097  00f4f801              db          $00,$F4,$F8,$01
   140  009b  007f7f01              db          $00,$7F,$7F,$01
   141  009f  00aba7ff              db          $00,$AB,$A7,$FF
   142                          PAVICE_T:
   143  00a3  007f01                db          $00,$7F,$01
   144  00a6  00c2ff                db          $00,$C2,$FF
   145                          
   146                          ; =================================
   147                          ; ARROW_FLYING_RIGHT -
   148                          ;   OBJECT TYPE:  $05
   149                          ;   OBJECT INDEX: $14
   150                          ; The ARROW_FLYING_RIGHT is the object used in animation when a MONSTER performs a PHYSICAL attack on the PLAYER. Note that this item/object does not appear in the maze and cannot be picked up.
   151                          ;
   152                          ARROW_FLYING_RIGHT:
   153  00a9  010101010101          db          $01,$01,$01,$01,$01,$01
   154  00af  ac9aff                db          $AC,$9A,$FF
   155                          
   156                          ; =================================
   157                          ; BOW -
   158                          ;   OBJECT TYPE:  $06
   159                          ;   OBJECT INDEX:
   160                          ;       $18 - RED BOW (Starting item, all levels)
   161                          ;       $19 - YELLOW BOW
   162                          ;       $1A - MAGENTA BOW
   163                          ;       $1B - WHITE BOW
   164                          ; The BOW is a basic WEAPON that can be used with ARROWS by the PLAYER to make a PHYSICAL attack on a MONSTER.
   165                          ;
   166                          BOW:
   167  00b2  0101010101            db          $01,$01,$01,$01,$01
   168  00b7  d7aca38e01            db          $D7,$AC,$A3,$8E,$01
   169  00bc  d600ca01              db          $D6,$00,$CA,$01
   170  00c0  b5ca01                db          $B5,$CA,$01
   171  00c3  9f00ff                db          $9F,$00,$FF
   172                          BOW_S:
   173  00c6  0101                  db          $01,$01
   174  00c8  d7acc901              db          $D7,$AC,$C9,$01
   175  00cc  d6ca01                db          $D6,$CA,$01
   176  00cf  c7ff                  db          $C7,$FF
   177                          BOW_T:
   178  00d1  007bff                db          $00,"{",$FF
   179                          
   180                          ; =================================
   181                          ; SCROLL -
   182                          ;   OBJECT TYPE:  $07
   183                          ;   OBJECT INDEX:
   184                          ;       $1C - RED SCROLL
   185                          ;       $1D - YELLOW SCROLL
   186                          ;       $1E - MAGENTA SCROLL
   187                          ;       $1F - WHITE SCROLL
   188                          ; The SCROLL is a WEAPON that can be used by the PLAYER to make a MAGICAL attack on a MONSTER.
   189                          ;
   190                          SCROLL:
   191  00d4  0101010101            db          $01,$01,$01,$01,$01
   192  00d9  0990900901            db          "\t",$90,$90,"\t",$01
   193  00de  128f8e1201            db          $12,$8F,$8E,$12,$01
   194  00e3  129e9f1201            db          $12,$9E,$9F,$12,$01
   195  00e8  08a08080a008ff        db          "\b",$A0,$80,$80,$A0,"\b",$FF
   196                          SCROLL_S:
   197  00ef  0101                  db          $01,$01
   198  00f1  00cddd01              db          $00,$CD,$DD,$01
   199  00f5  00cdddff              db          $00,$CD,$DD,$FF
   200                          SCROLL_T:
   201  00f9  0048ff                db          $00,"H",$FF
   202                          
   203                          ; =================================
   204                          ; AXE -
   205                          ;   OBJECT TYPE:  $08
   206                          ;   OBJECT INDEX:
   207                          ;       $20 - RED AXE
   208                          ;       $21 - YELLOW AXE
   209                          ;       $22 - MAGENTA AXE
   210                          ;       $23 - WHITE AXE
   211                          ; The AXE is a WEAPON that can be thrown by the PLAYER to make a PHYSICAL attack on a MONSTER. Once used, it (usually) relocates to another part of the maze.
   212                          ;
   213                          AXE:
   214  00fc  0101010101            db          $01,$01,$01,$01,$01
   215  0101  007fb701              db          $00,$7F,$B7,$01
   216  0105  00d99801              db          $00,$D9,$98,$01
   217  0109  0000b501              db          $00,$00,$B5,$01
   218  010d  000099ff              db          $00,$00,$99,$FF
   219                          AXE_S:
   220  0111  0101                  db          $01,$01
   221  0113  00a0d7a0b701          db          $00,$A0,$D7,$A0,$B7,$01
   222  0119  00009801              db          $00,$00,$98,$01
   223  011d  0000b5ff              db          $00,$00,$B5,$FF
   224                          AXE_T:
   225  0121  0011ff                db          $00,$11,$FF
   226                          
   227                          ; =================================
   228                          ; FIREBALL -
   229                          ;   OBJECT TYPE:  $09
   230                          ;   OBJECT INDEX:
   231                          ;       $24 - RED FIREBALL
   232                          ;       $25 - YELLOW FIREBALL
   233                          ;       $26 - MAGENTA FIREBALL
   234                          ;       $27 - WHITE FIREBALL
   235                          ; The FIREBALL is a WEAPON that can be thrown by the PLAYER to make a MAGICAL attack on a MONSTER. Once used, it disappears.
   236                          ;
   237                          FIREBALL:
   238  0124  0101010101            db          $01,$01,$01,$01,$01
   239  0129  bab9e101              db          $BA,$B9,$E1,$01
   240  012d  b8beb901              db          $B8,$BE,$B9,$01
   241  0131  a8e1b6ff              db          $A8,$E1,$B6,$FF
   242                          FIREBALL_S:
   243  0135  0101                  db          $01,$01
   244  0137  00d1ff                db          $00,$D1,$FF
   245                          FIREBALL_T:
   246  013a  00d3ff                db          $00,$D3,$FF
   247                          
   248                          ; =================================
   249                          ; MACE -
   250                          ;   OBJECT TYPE:  $0A
   251                          ;   OBJECT INDEX:
   252                          ;       $28 - RED MACE
   253                          ;       $29 - YELLOW MACE
   254                          ;       $2A - MAGENTA MACE
   255                          ;       $2B - WHITE MACE
   256                          ; The MACE is a WEAPON that can be thrown by the PLAYER to make a PHYSICAL attack on a MONSTER. Once used, it (usually) relocates to another part of the maze.
   257                          ;
   258                          MACE:
   259  013d  0101010101            db          $01,$01,$01,$01,$01
   260  0142  009e8e01              db          $00,$9E,$8E,$01
   261  0146  00a0c3a09701          db          $00,$A0,$C3,$A0,$97,$01
   262  014c  00a0c3a09701          db          $00,$A0,$C3,$A0,$97,$01
   263  0152  00a099a098ff          db          $00,$A0,$99,$A0,$98,$FF
   264                          MACE_S:
   265  0158  0101                  db          $01,$01
   266  015a  00e0b001              db          $00,$E0,$B0,$01
   267  015e  00a091a08101          db          $00,$A0,$91,$A0,$81,$01
   268  0164  00a0c3a097ff          db          $00,$A0,$C3,$A0,$97,$FF
   269                          MACE_T:
   270  016a  0054ff                db          $00,"T",$FF
   271                          
   272                          ; =================================
   273                          ; STAFF -
   274                          ;   OBJECT TYPE:  $0B
   275                          ;   OBJECT INDEX:
   276                          ;       $2C - RED STAFF
   277                          ;       $2D - YELLOW STAFF
   278                          ;       $2E - MAGENTA STAFF
   279                          ;       $2F - WHITE STAFF
   280                          ; The STAFF is an advanced WEAPON that can be used by the PLAYER to make a MAGICAL attack on a MONSTER.
   281                          ;
   282                          STAFF:
   283  016d  0101010101            db          $01,$01,$01,$01,$01
   284  0172  d501                  db          $D5,$01
   285  0174  00da01                db          $00,$DA,$01
   286  0177  0000da01              db          $00,$00,$DA,$01
   287  017b  000000daff            db          $00,$00,$00,$DA,$FF
   288                          STAFF_S:
   289  0180  0101                  db          $01,$01
   290  0182  00d301                db          $00,$D3,$01
   291  0185  0000daff              db          $00,$00,$DA,$FF
   292                          STAFF_T:
   293  0189  005cff                db          $00,"\\",$FF
   294                          
   295                          ; =================================
   296                          ; CROSSBOW -
   297                          ;   OBJECT TYPE:  $0C
   298                          ;   OBJECT INDEX:
   299                          ;       $30 - RED CROSSBOW
   300                          ;       $31 - YELLOW CROSSBOW
   301                          ;       $32 - MAGENTA CROSSBOW
   302                          ;       $33 - WHITE CROSSBOW
   303                          ; The CROSSBOW is an advanced WEAPON that can be used with ARROWS by the PLAYER to make a PHYSICAL attack on a MONSTER.
   304                          ;
   305                          CROSSBOW:
   306  018c  0101010101            db          $01,$01,$01,$01,$01
   307  0191  000090f001            db          $00,$00,$90,$F0,$01
   308  0196  000cb7a091a001        db          $00,"\f",$B7,$A0,$91,$A0,$01
   309  019d  a091a0b7eda091a0      db          $A0,$91,$A0,$B7,$ED,$A0,$91,$A0,$01
              01                
   310  01a6  a099a09090a0d7a0      db          $A0,$99,$A0,$90,$90,$A0,$D7,$A0,$FF
              ff                
   311                          CROSSBOW_S:
   312  01af  0101                  db          $01,$01
   313  01b1  d7dc01                db          $D7,$DC,$01
   314  01b4  cd0dff                db          $CD,"\r",$FF
   315                          CROSSBOW_T:
   316  01b7  a091a0d8020490ff      db          $A0,$91,$A0,$D8,$02,$04,$90,$FF
   317                          
   318                          ; =================================
   319                          ; UNKNOWN ITEM -
   320                          ;   OBJECT TYPE:  $0D
   321                          ;   OBJECT INDEX: $34
   322                          ; The purpose of this item is unknown, but maybe used for the flying animation for AXE or MACE. Note that this item/object does not appear in the maze and cannot be picked up.
   323                          
   324                          ; =================================
   325                          ; UNKNOWN ITEM -
   326                          ;   OBJECT TYPE:  $0E
   327                          ;   OBJECT INDEX: $38
   328                          ; The purpose of this item is unknown, but maybe used for the flying animation for AXE or MACE. Note that this item/object does not appear in the maze and cannot be picked up.
   329                          
   330                          ; =================================
   331                          ; ARROW_FLYING_LEFT -
   332                          ;   OBJECT TYPE:  $0F
   333                          ;   OBJECT INDEX: $3C
   334                          ; The ARROW_FLYING_LEFTT is the object used in animation when the PLAYER performs a PHYSICAL attack on a MONSTER. Note that this item/object does not appear in the maze and cannot be picked up.
   335                          ;
   336                          ARROW_FLYING_LEFT:
   337  01bf  010101010101          db          $01,$01,$01,$01,$01,$01
   338  01c5  9bacff                db          $9B,$AC,$FF
   339                          
   340                          ; =================================
   341                          ; LADDDER -
   342                          ;   OBJECT TYPE:  $10
   343                          ;   OBJECT INDEX: $42 (MAGENTA LADDER)
   344                          ; The LADDER is the object that allows progressing to the next lower level of the maze. Note that this item/object cannot be picked up and only shows up in the MAGENTA form.
   345                          ;
   346                          LADDER:
   347  01c8  0101010101            db          $01,$01,$01,$01,$01
   348  01cd  ea0000b501            db          $EA,$00,$00,$B5,$01
   349  01d2  eaafafb501            db          $EA,$AF,$AF,$B5,$01
   350  01d7  fafcfcf501            db          $FA,$FC,$FC,$F5,$01
   351  01dc  abf0f0a7ff            db          $AB,$F0,$F0,$A7,$FF
   352                          LADDER_S:
   353  01e1  0101                  db          $01,$01
   354  01e3  00b4e801              db          $00,$B4,$E8,$01
   355  01e7  d7b7ebc901            db          $D7,$B7,$EB,$C9,$01
   356  01ec  c7afafd9ff            db          $C7,$AF,$AF,$D9,$FF
   357                          LADDER_T:
   358  01f1  00cd97ff              db          $00,$CD,$97,$FF
   359                          
   360                          ; =================================
   361                          ; CHEST -
   362                          ;   OBJECT TYPE:  $11
   363                          ;   OBJECT INDEX:
   364                          ;       $44 - RED CHEST
   365                          ;       $45 - YELLOW CHEST
   366                          ;       $46 - MAGENTA CHEST
   367                          ;       $47 - WHITE CHEST
   368                          ; The CHEST is an ITEM that can be picked up or opened when on the ground in front of the PLAYER. When opened, it disappears and becomes a TREASURE item, a POTION, a KEY, or a MAP. Note that the CHEST can also be thrown as a WEAPON for a PHYSICAL attack, but does not inflict much damage.
   369                          ;
   370                          CHEST:
   371  01f5  0101010101            db          $01,$01,$01,$01,$01
   372  01fa  9088889001            db          $90,$88,$88,$90,$01
   373  01ff  a090888890a001        db          $A0,$90,$88,$88,$90,$A0,$01
   374  0206  a0819090a09101        db          $A0,$81,$90,$90,$A0,$91,$01
   375  020d  a0d7fcfcc9a0ff        db          $A0,$D7,$FC,$FC,$C9,$A0,$FF
   376                          CHEST_S:
   377  0214  01e01f1fb001          db          $01,$E0,$1F,$1F,$B0,$01
   378  021a  a099a080809801        db          $A0,$99,$A0,$80,$80,$98,$01
   379  0221  a20000a1ff            db          $A2,$00,$00,$A1,$FF
   380                          CHEST_T:
   381  0226  00fcff                db          $00,$FC,$FF
   382                          
   383                          ; =================================
   384                          ; FOOD -
   385                          ;   OBJECT TYPE:  $12
   386                          ;   OBJECT INDEX:
   387                          ;       $48 - RED FOOD
   388                          ;       $49 - YELLOW FOOD
   389                          ;       $4A - MAGENTA FOOD
   390                          ;       $4B - WHITE FOOD
   391                          ; The FOOD is an ITEM that can be picked up and added to the PLAYER's rations, a separate inventory. Picking FOOD up causes it to disappear.
   392                          ;
   393                          FOOD:
   394  0229  0101010101            db          $01,$01,$01,$01,$01
   395  022e  e41ff601              db          $E4,$1F,$F6,$01
   396  0232  a0c3cbdba09701        db          $A0,$C3,$CB,$DB,$A0,$97,$01
   397  0239  00bba01fa0a9ff        db          $00,$BB,$A0,$1F,$A0,$A9,$FF
   398                          FOOD_S:
   399  0240  0101                  db          $01,$01
   400  0242  e0beb001              db          $E0,$BE,$B0,$01
   401  0246  00e9a7ff              db          $00,$E9,$A7,$FF
   402                          FOOD_T:
   403  024a  0023ff                db          $00,"#",$FF
   404                          
   405                          ; =================================
   406                          ; QUIVER -
   407                          ;   OBJECT TYPE:  $13
   408                          ;   OBJECT INDEX:
   409                          ;       $4C - RED QUIVER
   410                          ;       $4D - YELLOW QUIVER
   411                          ;       $4E - MAGENTA QUIVER
   412                          ;       $4F - WHITE QUIVER
   413                          ; The QUIVER is an ITEM that can be picked up and added to the PLAYER's arrows, a separate inventory. Picking QUIVER up causes it to disappear.
   414                          ;
   415                          QUIVER:
   416  024d  010101010101          db          $01,$01,$01,$01,$01,$01
   417  0253  7f7fa0d7a00601        db          $7F,$7F,$A0,$D7,$A0,$06,$01
   418  025a  a2acb2e901            db          $A2,$AC,$B2,$E9,$01
   419  025f  0000a2a1ff            db          $00,$00,$A2,$A1,$FF
   420                          QUIVER_S:
   421  0264  0101                  db          $01,$01
   422  0266  00afbdb001            db          $00,$AF,$BD,$B0,$01
   423  026b  0000a2ff              db          $00,$00,$A2,$FF
   424                          QUIVER_T:
   425  026f  00f0ff                db          $00,$F0,$FF
   426                          
   427                          ; =================================
   428                          ; LOCKED_CHEST -
   429                          ;   OBJECT TYPE:  $14
   430                          ;   OBJECT INDEX:
   431                          ;       $50 - RED LOCKED_CHEST
   432                          ;       $51 - YELLOW LOCKED_CHEST
   433                          ;       $52 - MAGENTA LOCKED_CHEST
   434                          ;       $53 - WHITE LOCKED_CHEST
   435                          ; The LOCKED_CHEST is an ITEM that can be picked up or unlocked/opened with a KEY of similar or greater level when on the ground in front of the PLAYER. When unlocked/opened, it disappears and becomes a TREASURE item, a POTION, a KEY, or a MAP. Note that the LOCKED_CHEST can also be thrown as a WEAPON for a PHYSICAL attack, but does not inflict much damage.
   436                          ; A tiny or small LOCKED_CHEST looks like a regular CHEST from afar, so it uses those graphics.
   437                          ;
   438                          LOCKED_CHEST:
   439  0272  0101010101            db          $01,$01,$01,$01,$01
   440  0277  9088889001            db          $90,$88,$88,$90,$01
   441  027c  a090888890a001        db          $A0,$90,$88,$88,$90,$A0,$01
   442  0283  a081cbdba09101        db          $A0,$81,$CB,$DB,$A0,$91,$01
   443  028a  a0d7fcfcc9a0ff        db          $A0,$D7,$FC,$FC,$C9,$A0,$FF
   444                          
   445                          ; =================================
   446                          ; UNKNOWN ITEM -
   447                          ;   OBJECT TYPE:  $15
   448                          ;   OBJECT INDEX: $54
   449                          ; The purpose of this item is unknown, but maybe used for the flying animation for FIREBALL. Note that this item/object does not appear in the maze and cannot be picked up.
   450                          
   451                          ; =================================
   452                          ; KEY -
   453                          ;   OBJECT TYPE:  $16
   454                          ;   OBJECT INDEX:
   455                          ;       $58 - RED KEY
   456                          ;       $59 - YELLOW KEY
   457                          ;       $5A - MAGENTA KEY
   458                          ;       $5B - WHITE KEY
   459                          ; The KEY is an ITEM that can be picked up or used to unlock/open a LOCKED_CHEST of similar or lesser level when the LOCKED_CHEST is on the ground in front of the PLAYER. When used it disappears.
   460                          ;
   461                          KEY:
   462  0291  010101010101          db          $01,$01,$01,$01,$01,$01
   463  0297  9090b8c901            db          $90,$90,$B8,$C9,$01
   464  029c  10a080a0a9d9ff        db          $10,$A0,$80,$A0,$A9,$D9,$FF
   465                          KEY_S:
   466  02a3  010101                db          $01,$01,$01
   467  02a6  bcc5ff                db          $BC,$C5,$FF
   468                          KEY_T:
   469  02a9  ff2dff                db          $FF,"-",$FF
   470                          
   471                          ; =================================
   472                          ; AMULET -
   473                          ;   OBJECT TYPE:  $17
   474                          ;   OBJECT INDEX:
   475                          ;       $5C - RED AMULET
   476                          ;       $5D - YELLOW AMULET
   477                          ;       $5E - MAGENTA AMULET
   478                          ;       $5F - WHITE AMULET
   479                          ; The AMULET is a TREASURE item that increases the PLAYER's score. When picked up it disappears. Note in future versions of this game, the score will be removed, and picking up an AMULET will perform other functions.
   480                          ;
   481                          AMULET:
   482  02ac  0101010101            db          $01,$01,$01,$01,$01
   483  02b1  d7acc901              db          $D7,$AC,$C9,$01
   484  02b5  c7acc8c901            db          $C7,$AC,$C8,$C9,$01
   485  02ba  d7acd9d601            db          $D7,$AC,$D9,$D6,$01
   486  02bf  c7ac05d9ff            db          $C7,$AC,$05,$D9,$FF
   487                          AMULET_S:
   488  02c4  0101                  db          $01,$01
   489  02c6  00d7c901              db          $00,$D7,$C9,$01
   490  02ca  00c7c8c901            db          $00,$C7,$C8,$C9,$01
   491  02cf  00cbf1a5ff            db          $00,$CB,$F1,$A5,$FF
   492                          AMULET_T:
   493  02d4  0026ff                db          $00,"&",$FF
   494                          
   495                          ; =================================
   496                          ; CHALICE -
   497                          ;   OBJECT TYPE:  $18
   498                          ;   OBJECT INDEX:
   499                          ;       $60 - RED CHALICE
   500                          ;       $61 - YELLOW CHALICE
   501                          ;       $62 - MAGENTA CHALICE
   502                          ;       $63 - WHITE CHALICE
   503                          ; The CHALICE is a TREASURE item that increases the PLAYER's score. When picked up it disappears. Note in future versions of this game, the score will be removed, and picking up an CHALICE will perform other functions.
   504                          ;
   505                          CHALICE:
   506  02d7  010101010101          db          $01,$01,$01,$01,$01,$01
   507  02dd  a0c3a0899701          db          $A0,$C3,$A0,$89,$97,$01
   508  02e3  009f01                db          $00,$9F,$01
   509  02e6  e00eb0ff              db          $E0,$0E,$B0,$FF
   510                          CHALICE_S:
   511  02ea  0101                  db          $01,$01
   512  02ec  009f01                db          $00,$9F,$01
   513  02ef  00ccff                db          $00,$CC,$FF
   514                          CHALICE_T:
   515  02f2  0059ff                db          $00,"Y",$FF
   516                          
   517                          ; =================================
   518                          ; WARRIOR_POTION -
   519                          ;   OBJECT TYPE:  $19
   520                          ;   OBJECT INDEX:
   521                          ;       $64 - RED WARRIOR_POTION
   522                          ;       $65 - YELLOW WARRIOR_POTION
   523                          ;       $66 - MAGENTA WARRIOR_POTION
   524                          ;       $67 - WHITE WARRIOR_POTION
   525                          ; The WARRIOR_POTION is a potion that can be picked up or used. When used, it disappears and usually affects the PLAYER's PHYSICAL traits. It removes any other currently active POTION effect. Note all potions use the POTION_T for their tiny view.
   526                          ;
   527                          WARRIOR_POTION:
   528  02f5  0101010101            db          $01,$01,$01,$01,$01
   529  02fa  002bd401              db          $00,"+",$D4,$01
   530  02fe  00110f01              db          $00,$11,$0F,$01
   531  0302  00cddd01              db          $00,$CD,$DD,$01
   532  0306  00c7d9ff              db          $00,$C7,$D9,$FF
   533                          WARRIOR_POTION_S:
   534  030a  0101                  db          $01,$01
   535  030c  00d401                db          $00,$D4,$01
   536  030f  001401                db          $00,$14,$01
   537  0312  00c2ff                db          $00,$C2,$FF
   538                          POTION_T:
   539  0315  005502045fff          db          $00,"U",$02,$04,"_",$FF
   540                          
   541                          ; =================================
   542                          ; MAGE_POTION -
   543                          ;   OBJECT TYPE:  $1A
   544                          ;   OBJECT INDEX:
   545                          ;       $68 - RED MAGE_POTION
   546                          ;       $69 - YELLOW MAGE_POTION
   547                          ;       $6A - MAGENTA MAGE_POTION
   548                          ;       $6B - WHITE MAGE_POTION
   549                          ; The MAGE_POTION is a potion that can be picked up or used. When used, it disappears and usually affects the PLAYER's SPIRITUAL traits. It removes any other currently active POTION effect. Note all potions use the POTION_T for their tiny view.
   550                          ;
   551                          MAGE_POTION:
   552  031b  0101010101            db          $01,$01,$01,$01,$01
   553  0320  002bd501              db          $00,"+",$D5,$01
   554  0324  00110f01              db          $00,$11,$0F,$01
   555  0328  00cddd01              db          $00,$CD,$DD,$01
   556  032c  00c7d9ff              db          $00,$C7,$D9,$FF
   557                          MAGE_POTION_S:
   558  0330  0101                  db          $01,$01
   559  0332  00d501                db          $00,$D5,$01
   560  0335  001401                db          $00,$14,$01
   561  0338  00c2ff                db          $00,$C2,$FF
   562                          
   563                          ; =================================
   564                          ; MAP -
   565                          ;   OBJECT TYPE:  $1B
   566                          ;   OBJECT INDEX:
   567                          ;       $6C - RED MAP
   568                          ;       $6D - YELLOW MAP
   569                          ;       $6E - MAGENTA MAP
   570                          ;       $6F - WHITE MAP
   571                          ; The MAP is an ITEM that can be picked up or used to view the floorplan of the current maze level.
   572                          ;
   573                          MAP:
   574  033b  0101010101            db          $01,$01,$01,$01,$01
   575  0340  f01fc89801            db          $F0,$1F,$C8,$98,$01
   576  0345  12c8ccb501            db          $12,$C8,$CC,$B5,$01
   577  034a  a0b5a0cdcc1201        db          $A0,$B5,$A0,$CD,$CC,$12,$01
   578  0351  a099a0cca01ffca0      db          $A0,$99,$A0,$CC,$A0,$1F,$FC,$A0,$FF
              ff                
   579                          MAP_S:
   580  035a  0101                  db          $01,$01
   581  035c  00d701                db          $00,$D7,$01
   582  035f  c7a0d5a0c901          db          $C7,$A0,$D5,$A0,$C9,$01
   583  0365  00d9ff                db          $00,$D9,$FF
   584                          MAP_T:
   585  0368  00d5ff                db          $00,$D5,$FF
   586                          
   587                          ; =================================
   588                          ; CHAOS_POTION -
   589                          ;   OBJECT TYPE:  $1C
   590                          ;   OBJECT INDEX:
   591                          ;       $70 - RED CHAOS_POTION
   592                          ;       $71 - YELLOW CHAOS_POTION
   593                          ;       $72 - MAGENTA CHAOS_POTION
   594                          ;       $73 - WHITE CHAOS_POTION
   595                          ; The CHAOS_POTION is a potion that can be picked up or used. When used, it disappears and can randomly affects the PLAYER's SPIRITUAL, HEALTH, or PHYSICAL traits. It removes any other currently active POTION effect. Note all potions use the POTION_T for their tiny view.
   596                          ;
   597                          CHAOS_POTION:
   598  036b  0101010101            db          $01,$01,$01,$01,$01
   599  0370  003f3f01              db          $00,"??",$01
   600  0374  00110f01              db          $00,$11,$0F,$01
   601  0378  00cddd01              db          $00,$CD,$DD,$01
   602  037c  00c7d9ff              db          $00,$C7,$D9,$FF
   603                          CHAOS_POTION_S:
   604  0380  0101                  db          $01,$01
   605  0382  003f01                db          $00,"?",$01
   606  0385  001401                db          $00,$14,$01
   607  0388  00c2ff                db          $00,$C2,$FF
   608                          
   609                          ; =================================
   610                          ; UNKNOWN ITEM -
   611                          ;   OBJECT TYPE:  $1D
   612                          ;   OBJECT INDEX: $74
   613                          ; The purpose of this item is unknown, but maybe used for the text for the PLAYER's death sequence.
   614                          ;
   615                          EXCL_MARK_GFX:
   616  038b  21ff                  db          "!",$FF
   617                          
   618                          
   619                          ; MONSTERS
   620                          ;   - Monsters range from OBJECT INDEX $78 to $9F, and OBJECT TYPE $1E to $27
   621                          ;   - OBJECT TYPE is the OBJECT INDEX bit-shifted RIGHT two times to remove the 2 bits of object level
   622                          ;   - Monsters have two sizes, depending on how far away they are from the PLAYER's position:
   623                          ;       - Small (i.e. SKELETON_S): These monsters are two spaces forward, or one space diagonal left or right forward from the player. These graphics are usually 4x4 characters in size.
   624                          ;       - Regular (i.e. SKELETON): These items are one space forward from the player. These graphics are usually 8x8 characters in size.
   625                          ;
   626                          
   627                          ; =================================
   628                          ; SKELETON -
   629                          ;   OBJECT TYPE:  $1E
   630                          ;   OBJECT INDEX:
   631                          ;       $78 - RED SKELETON
   632                          ;       $79 - YELLOW SKELETON
   633                          ;       $7A - MAGENTA SKELETON
   634                          ;       $7B - WHITE SKELETON
   635                          ; The SKELETON is a basic monster.
   636                          ;
   637                          SKELETON:
   638  038d  04040404              db          $04,$04,$04,$04
   639  0391  028a00eeed01          db          $02,$8A,$00,$EE,$ED,$01
   640  0397  02d600a017a0a701      db          $02,$D6,$00,$A0,$17,$A0,$A7,$01
   641  039f  02d6e0acb9e401        db          $02,$D6,$E0,$AC,$B9,$E4,$01
   642  03a6  0223a6e2e6a2b401      db          $02,"#",$A6,$E2,$E6,$A2,$B4,$01
   643  03ae  02d600f8edb02301      db          $02,$D6,$00,$F8,$ED,$B0,"#",$01
   644  03b6  02d6e8a100e501        db          $02,$D6,$E8,$A1,$00,$E5,$01
   645  03bd  02d6a2e400ba01        db          $02,$D6,$A2,$E4,$00,$BA,$01
   646  03c4  02d600a6a8f1ff        db          $02,$D6,$00,$A6,$A8,$F1,$FF
   647                          SKELETON_S:
   648  03cb  040404                db          $04,$04,$04
   649  03ce  08e2a501              db          "\b",$E2,$A5,$01
   650  03d2  cdb8b7b401            db          $CD,$B8,$B7,$B4,$01
   651  03d7  d6b8a9b001            db          $D6,$B8,$A9,$B0,$01
   652  03dc  d6a2e8b1ff            db          $D6,$A2,$E8,$B1,$FF
   653                          
   654                          ; =================================
   655                          ; SNAKE -
   656                          ;   OBJECT TYPE:  $1F
   657                          ;   OBJECT INDEX:
   658                          ;       $7C - RED SNAKE
   659                          ;       $7D - YELLOW SNAKE
   660                          ;       $7E - MAGENTA SNAKE
   661                          ;       $7F - WHITE SNAKE
   662                          ; The SNAKE is a basic monster.
   663                          ;
   664                          SNAKE:
   665  03e1  040404                db          $04,$04,$04
   666  03e4  02b8bef7bdb001        db          $02,$B8,$BE,$F7,$BD,$B0,$01
   667  03eb  021111e2e9ea01        db          $02,$11,$11,$E2,$E9,$EA,$01
   668  03f2  02d7ade1b7b601        db          $02,$D7,$AD,$E1,$B7,$B6,$01
   669  03f9  028d00b6fae0f001      db          $02,$8D,$00,$B6,$FA,$E0,$F0,$01
   670  0401  0202b8a6fbb2faf1      db          $02,$02,$B8,$A6,$FB,$B2,$FA,$F1,$A4,$E9,$01
              a4e901            
   671  040c  0202b5a2eab2b2b4      db          $02,$02,$B5,$A2,$EA,$B2,$B2,$B4,$E0,$E6,$01
              e0e601            
   672  0417  0202a2aca3e6f2ae      db          $02,$02,$A2,$AC,$A3,$E6,$F2,$AE,$E1,$BB,$FF
              e1bbff            
   673                          SNAKE_S:
   674  0422  040404                db          $04,$04,$04
   675  0425  00fef901              db          $00,$FE,$F9,$01
   676  0429  0022a085a09701        db          $00,"\"",$A0,$85,$A0,$97,$01
   677  0430  b8b6f6e401            db          $B8,$B6,$F6,$E4,$01
   678  0435  e5e7f9e6ff            db          $E5,$E7,$F9,$E6,$FF
   679                          
   680                          ; =================================
   681                          ; SPIDER -
   682                          ;   OBJECT TYPE:  $20
   683                          ;   OBJECT INDEX:
   684                          ;       $80 - RED SPIDER
   685                          ;       $81 - YELLOW SPIDER
   686                          ;       $82 - MAGENTA SPIDER
   687                          ;       $83 - WHITE SPIDER
   688                          ; The SPIDER is a basic monster.
   689                          ;
   690                          SPIDER:
   691  043a  0404                  db          $04,$04
   692  043c  00befd01              db          $00,$BE,$FD,$01
   693  0440  a099a0f7ee9801        db          $A0,$99,$A0,$F7,$EE,$98,$01
   694  0447  02b6b9fbf7e6e901      db          $02,$B6,$B9,$FB,$F7,$E6,$E9,$01
   695  044f  02f7e6eebdb9fb01      db          $02,$F7,$E6,$EE,$BD,$B9,$FB,$01
   696  0457  0212d6a0178ca0d6      db          $02,$12,$D6,$A0,$17,$8C,$A0,$D6,$12,$01
              1201              
   697  0461  02a099a0c76027d9      db          $02,$A0,$99,$A0,$C7,"`'",$D9,$98,$FF
              98ff              
   698                          SPIDER_S:
   699  046b  04040404              db          $04,$04,$04,$04
   700  046f  00d7c901              db          $00,$D7,$C9,$01
   701  0473  d79585c901            db          $D7,$95,$85,$C9,$01
   702  0478  4da0178ca04d01        db          "M",$A0,$17,$8C,$A0,"M",$01
   703  047f  58602758ff            db          "X`'X",$FF
   704                          
   705                          ; =================================
   706                          ; MIMIC -
   707                          ;   OBJECT TYPE:  $21
   708                          ;   OBJECT INDEX:
   709                          ;       $84 - RED MIMIC
   710                          ;       $85 - YELLOW MIMIC
   711                          ;       $86 - MAGENTA MIMIC
   712                          ;       $87 - WHITE MIMIC
   713                          ; The MIMIC is a basic monster.
   714                          ;
   715                          MIMIC:
   716  0484  0402d796000096c9      db          $04,$02,$D7,$96,$00,$00,$96,$C9,$01
              01                
   717  048d  0212f01f1ff01201      db          $02,$12,$F0,$1F,$1F,$F0,$12,$01
   718  0495  02d611a0178ca00f      db          $02,$D6,$11,$A0,$17,$8C,$A0,$0F,$D6,$01
              d601              
   719  049f  02c7a0188d188da0      db          $02,$C7,$A0,$18,$8D,$18,$8D,$A0,$D9,$01
              d901              
   720  04a9  a0819090a09101        db          $A0,$81,$90,$90,$A0,$91,$01
   721  04b0  a0d7fcfcc9a0ff        db          $A0,$D7,$FC,$FC,$C9,$A0,$FF
   722                          MIMIC_S:
   723  04b7  01e01f1fb001          db          $01,$E0,$1F,$1F,$B0,$01
   724  04bd  a099a080809801        db          $A0,$99,$A0,$80,$80,$98,$01
   725  04c4  a20000a1ff            db          $A2,$00,$00,$A1,$FF
   726                          
   727                          ; =================================
   728                          ; MALOCCHIO -
   729                          ;   OBJECT TYPE:  $22
   730                          ;   OBJECT INDEX:
   731                          ;       $88 - RED MIMIC
   732                          ;       $89 - YELLOW MIMIC
   733                          ;       $8A - MAGENTA MIMIC
   734                          ;       $8B - WHITE MIMIC
   735                          ; The MALOCCHIO is a basic monster.
   736                          ;
   737                          MALOCCHIO:
   738  04c9  04040404              db          $04,$04,$04,$04
   739  04cd  02a8b0b600b6b001      db          $02,$A8,$B0,$B6,$00,$B6,$B0,$01
   740  04d5  02b4e5beeeb8e101      db          $02,$B4,$E5,$BE,$EE,$B8,$E1,$01
   741  04dd  02e27ff6f87fb101      db          $02,$E2,$7F,$F6,$F8,$7F,$B1,$01
   742  04e5  02a5a014141414a0      db          $02,$A5,$A0,$14,$14,$14,$14,$A0,$EA,$01
              ea01              
   743  04ef  02e8ab7f7fa7b401      db          $02,$E8,$AB,$7F,$7F,$A7,$B4,$01
   744  04f7  02c7a40000a8d9ff      db          $02,$C7,$A4,$00,$00,$A8,$D9,$FF
   745                          MALOCCHIO_S:
   746  04ff  04040404              db          $04,$04,$04,$04
   747  0503  00b6b8e001            db          $00,$B6,$B8,$E0,$01
   748  0508  e3bee9f101            db          $E3,$BE,$E9,$F1,$01
   749  050d  b9a08484a0e401        db          $B9,$A0,$84,$84,$A0,$E4,$01
   750  0514  a2a6a1a5ff            db          $A2,$A6,$A1,$A5,$FF
   751                          
   752                          ; =================================
   753                          ; DRAGON -
   754                          ;   OBJECT TYPE:  $23
   755                          ;   OBJECT INDEX:
   756                          ;       $8C - RED DRAGON
   757                          ;       $8D - YELLOW DRAGON
   758                          ;       $8E - MAGENTA DRAGON
   759                          ;       $8F - WHITE DRAGON
   760                          ; The DRAGON is an advanced monster.
   761                          ;
   762                          DRAGON:
   763  0519  04040404              db          $04,$04,$04,$04
   764  051d  02b0e000c0a0c2a0      db          $02,$B0,$E0,$00,$C0,$A0,$C2,$A0,$C1,$01
              c101              
   765  0527  0202a099a0c9d798      db          $02,$02,$A0,$99,$A0,$C9,$D7,$98,$A0,$95,$95,$85,$A0,$81,$01
              a0959585a08101    
   766  0536  0202a0c3a4a81285      db          $02,$02,$A0,$C3,$A4,$A8,$12,$85,$86,$85,$A0,$97,$01
              8685a09701        
   767  0543  02a0178ca52094a0      db          $02,$A0,$17,$8C,$A5," ",$94,$A0,$94,$A5,$01
              94a501            
   768  054e  0202d7f6f97f7f7f      db          $02,$02,$D7,$F6,$F9,$7F,$7F,$7F,$7F,$B4,$01
              7fb401            
   769  0559  0202a0b595862084      db          $02,$02,$A0,$B5,$95,$86," ",$84," ",$B0,$A0,$99,$01
              20b0a09901        
   770  0566  0202a0c3d7a094a0      db          $02,$02,$A0,$C3,$D7,$A0,$94,$A0,$C9,$A0,$DB,$18,$A2,$C3,$01
              c9a0db18a2c301    
   771  0575  0218008d0000e899      db          $02,$18,$00,$8D,$00,$00,$E8,$99,$01
              01                
   772  057e  009eec1fbfa1ff        db          $00,$9E,$EC,$1F,$BF,$A1,$FF
   773                          DRAGON_S:
   774  0585  040404c9c9c0c001      db          $04,$04,$04,$C9,$C9,$C0,$C0,$01
   775  058d  eda5a09595a001        db          $ED,$A5,$A0,$95,$95,$A0,$01
   776  0594  a092a0f9a0caa0a7      db          $A0,$92,$A0,$F9,$A0,$CA,$A0,$A7,$01
              01                
   777  059d  babfefe901            db          $BA,$BF,$EF,$E9,$01
   778  05a2  d9d907abff            db          $D9,$D9,"\a",$AB,$FF
   779                          
   780                          ; =================================
   781                          ; MUMMY -
   782                          ;   OBJECT TYPE:  $24
   783                          ;   OBJECT INDEX:
   784                          ;       $90 - RED MUMMY
   785                          ;       $91 - YELLOW MUMMY
   786                          ;       $92 - MAGENTA MUMMY
   787                          ;       $93 - WHITE MUMMY
   788                          ; The MUMMY is an advanced monster.
   789                          ;
   790                          MUMMY:
   791  05a7  04040404              db          $04,$04,$04,$04
   792  05ab  d7fcc901              db          $D7,$FC,$C9,$01
   793  05af  0202d7c995a093a0      db          $02,$02,$D7,$C9,$95,$A0,$93,$A0,$B4,$00,$D7,$C9,$01
              b400d7c901        
   794  05bc  0202a097a084a094      db          $02,$02,$A0,$97,$A0,$84,$A0,$94,$84,$94,$A0,$84,$A0,$D9,$A0,$97,$01
              8494a084a0d9a097  
              01                
   795  05cd  0202a0b5f8c98494      db          $02,$02,$A0,$B5,$F8,$C9,$84,$94,$D2,$D6,$A0,$01
              d2d6a001          
   796  05d9  0202a0c3a00095a0      db          $02,$02,$A0,$C3,$A0,$00,$95,$A0,$84,$94,$7F,$12,$A0,$01
              84947f12a001      
   797  05e7  0202a091bf94e094      db          $02,$02,$A0,$91,$BF,$94,$E0,$94,$AA,$91,$A0,$01
              aa91a001          
   798  05f3  0295a095a00011a0      db          $02,$95,$A0,$95,$A0,$00,$11,$A0,$95,$A0,$01
              95a001            
   799  05fe  02a0d9a0850027a0      db          $02,$A0,$D9,$A0,$85,$00,"'",$A0,$85,$A0,$C9,$FF
              85a0c9ff          
   800                          MUMMY_S:
   801  060a  040404                db          $04,$04,$04
   802  060d  1ceab11a01            db          $1C,$EA,$B1,$1A,$01
   803  0612  11efbf0f01            db          $11,$EF,$BF,$0F,$01
   804  0617  d6a0d9c7a06001        db          $D6,$A0,$D9,$C7,$A0,"`",$01
   805  061e  e0b5eab0ff            db          $E0,$B5,$EA,$B0,$FF
   806                          
   807                          ; =================================
   808                          ; NECROMANCER -
   809                          ;   OBJECT TYPE:  $25
   810                          ;   OBJECT INDEX:
   811                          ;       $94 - RED NECROMANCER
   812                          ;       $95 - YELLOW NECROMANCER
   813                          ;       $96 - MAGENTA NECROMANCER
   814                          ;       $97 - WHITE NECROMANCER
   815                          ; The NECROMANCER is an advanced monster.
   816                          ;
   817                          NECROMANCER:
   818  0623  04040404              db          $04,$04,$04,$04
   819  0627  02d7d0a0110fa0d0      db          $02,$D7,$D0,$A0,$11,$0F,$A0,$D0,$C9,$01
              c901              
   820  0631  0202d78dd1a4a4d1      db          $02,$02,$D7,$8D,$D1,$A4,$A4,$D1,$18,$C9,$01
              18c901            
   821  063c  0202d6e9a0d9a09c      db          $02,$02,$D6,$E9,$A0,$D9,$A0,$9C,$D7,$A0,$C7,$A0,$B6,$D6,$01
              d7a0c7a0b6d601    
   822  064b  020212faefa0c2a0      db          $02,$02,$12,$FA,$EF,$A0,$C2,$A0,$7F,$BF,$F5,$12,$01
              7fbff51201        
   823  0658  0202c7a7e2afedb1      db          $02,$02,$C7,$A7,$E2,$AF,$ED,$B1,$AB,$D9,$01
              abd901            
   824  0663  7fa0d6a07ffd01        db          $7F,$A0,$D6,$A0,$7F,$FD,$01
   825  066a  02a09920192020a0      db          $02,$A0,$99," ",$19,"  ",$A0,$98,$01,$02,$C7,$A0,$88," ",$90,$F0,$A0,$D9,$FF
              980102c7a0882090  
              f0a0d9ff          
   826                          NECROMANCER_S:
   827  067e  040404                db          $04,$04,$04
   828  0681  0be2db0c01            db          "\v",$E2,$DB,"\f",$01
   829  0686  9fa0c9d7a09f01        db          $9F,$A0,$C9,$D7,$A0,$9F,$01
   830  068d  00129901              db          $00,$12,$99,$01
   831  0691  00fd91ff              db          $00,$FD,$91,$FF
   832                          
   833                          ; =================================
   834                          ; GRYPHON -
   835                          ;   OBJECT TYPE:  $26
   836                          ;   OBJECT INDEX:
   837                          ;       $98 - RED GRYPHON
   838                          ;       $99 - YELLOW GRYPHON
   839                          ;       $9A - MAGENTA GRYPHON
   840                          ;       $9B - WHITE GRYPHON
   841                          ; The GRYPHON is an advanced monster.
   842                          ;
   843                          GRYPHON:
   844  0695  04040404              db          $04,$04,$04,$04
   845  0699  02889088f001          db          $02,$88,$90,$88,$F0,$01
   846  069f  0202bea0aca0ed95      db          $02,$02,$BE,$A0,$AC,$A0,$ED,$95,$A0,$85,$A0,$F5,$01
              a085a0f501        
   847  06ac  0202a0959595a0b5      db          $02,$02,$A0,$95,$95,$95,$A0,$B5,$86,$91,$01
              869101            
   848  06b7  0202a0959595a0c3      db          $02,$02,$A0,$95,$95,$95,$A0,$C3,$95,$E5,$A0,$C7,$A0,$B0,$01
              95e5a0c7a0b001    
   849  06c6  0202a09595a0a1ef      db          $02,$02,$A0,$95,$95,$A0,$A1,$EF,$F4,$EF,$F5,$A0,",",$A0,$01
              f4eff5a02ca001    
   850  06d5  020212b97ff57ff5      db          $02,$02,$12,$B9,$7F,$F5,$7F,$F5,"\r",$C7,$01
              0dc701            
   851  06e0  0202b6eaf7e77feb      db          $02,$02,$B6,$EA,$F7,$E7,$7F,$EB,$F5,$01
              f501              
   852  06ea  02028bc7bfb6efed      db          $02,$02,$8B,$C7,$BF,$B6,$EF,$ED,$EB,$E5,$FF
              ebe5ff            
   853                          GRYPHON_S:
   854  06f5  040404b8b8b001        db          $04,$04,$04,$B8,$B8,$B0,$01
   855  06fc  a09595a012c901        db          $A0,$95,$95,$A0,$12,$C9,$01
   856  0703  e1a0d9d9a08d01        db          $E1,$A0,$D9,$D9,$A0,$8D,$01
   857  070a  28e7e7e5ff            db          "(",$E7,$E7,$E5,$FF
   858                          
   859                          ; =================================
   860                          ; MINOTAUR -
   861                          ;   OBJECT TYPE:  $27
   862                          ;   OBJECT INDEX:
   863                          ;       $9C - RED MINOTAUR
   864                          ;       $9D - YELLOW MINOTAUR
   865                          ;       $9E - MAGENTA MINOTAUR
   866                          ;       $9F - WHITE MINOTAUR
   867                          ; The MINOTAUR is an boss level monster. Killing a MINOTAUR completes the game.
   868                          ;
   869                          MINOTAUR:
   870  070f  04040404              db          $04,$04,$04,$04
   871  0713  e8a1e901              db          $E8,$A1,$E9,$01
   872  0717  ebefefa101            db          $EB,$EF,$EF,$A1,$01
   873  071c  0202e0b8b4fbb1e4      db          $02,$02,$E0,$B8,$B4,$FB,$B1,$E4,$F0,$01
              f001              
   874  0726  0202f6e6fef4e8ed      db          $02,$02,$F6,$E6,$FE,$F4,$E8,$ED,$FD,$ED,$01
              fded01            
   875  0731  0202e9b5bfe1eafb      db          $02,$02,$E9,$B5,$BF,$E1,$EA,$FB,$FE,$FB,$01
              fefb01            
   876  073c  0202a1e0fe7ffdb9      db          $02,$02,$A1,$E0,$FE,$7F,$FD,$B9,$AD,$A1,$01
              ada101            
   877  0747  02a27fb4feb70102      db          $02,$A2,$7F,$B4,$FE,$B7,$01,$02,$BE,$B6,$00,$A2,$BE,$B4,$FF
              beb600a2beb4ff    
   878                          MINOTAUR_S:
   879  0756  04040404              db          $04,$04,$04,$04
   880  075a  00edbe01              db          $00,$ED,$BE,$01
   881  075e  d7e6b9d201            db          $D7,$E6,$B9,$D2,$01
   882  0763  0a8eedc201            db          "\n",$8E,$ED,$C2,$01
   883  0768  001683ff              db          $00,$16,$83,$FF
   884                          
   885                          
   886                          ; OTHER GRAPHICS
   887                          
   888                          ; STATS
   889                          ;   Stats labels are shown in the right side of the screen to identify a player's health and other statistics in real-time.
   890                          ;
   891                          STATS_TXT:
   892  076c  50485953d6535052      db          "PHYS",$D6,"SPRT",$FF
              54ff              
   893  0776  d600000000486561      db          $D6,$00,$00,$00,$00,"Health",$01
              6c746801          
   894  0782  d600000000536869      db          $D6,$00,$00,$00,$00,"Shield",$01
              656c6401          
   895  078e  d600000000576561      db          $D6,$00,$00,$00,$00,"Weapon",$FF
              706f6eff          
   896                          
   897                          ; COMPASS
   898                          ;   The compass is the right side of the screen, and points in the direction that the PLAYER is currently facing.
   899                          ;
   900                          COMPASS:
   901  079a  d76ec901              db          $D7,"n",$C9,$01
   902  079e  77086501              db          "w\be",$01
   903  07a2  c773d9ff              db          $C7,"s",$D9,$FF
   904                          
   905                          ; POOF Animation
   906                          ;   The POOF animation is played when a MONSTER or ITEM disappears.
   907                          ;       - For MONSTERS, it is when they are killed by the player. Their graphic is replaced with the POOF Animation, and then the empty maze space is rerendered as blank.
   908                          ;       = For ITEMS, they can disappear if they break or are used up (like a POTION). This occurs in the PLAYER's RIGHT HAND.
   909                          ;
   910                          POOF_1:
   911  07a6  d7c901                db          $D7,$C9,$01
   912  07a9  c7d9ff                db          $C7,$D9,$FF
   913                          POOF_2:
   914  07ac  d1d101                db          $D1,$D1,$01
   915  07af  d1d1ff                db          $D1,$D1,$FF
   916                          POOF_3:
   917  07b2  d1d1d1d101            db          $D1,$D1,$D1,$D1,$01
   918  07b7  d1d0d0d101            db          $D1,$D0,$D0,$D1,$01
   919  07bc  d1d0d0d101            db          $D1,$D0,$D0,$D1,$01
   920  07c1  d1d1d1d1ff            db          $D1,$D1,$D1,$D1,$FF
   921                          POOF_4:
   922  07c6  0100d0d001            db          $01,$00,$D0,$D0,$01
   923  07cb  00d0d0ff              db          $00,$D0,$D0,$FF
   924                          POOF_5:
   925  07cf  d0d0d0d001            db          $D0,$D0,$D0,$D0,$01
   926  07d4  d00000d001            db          $D0,$00,$00,$D0,$01
   927  07d9  d00000d001            db          $D0,$00,$00,$D0,$01
   928  07de  d0d0d0d0ff            db          $D0,$D0,$D0,$D0,$FF
   929                          POOF_6:
   930  07e3  2020202001            db          "    ",$01
   931  07e8  2020202001            db          "    ",$01
   932  07ed  2020202001            db          "    ",$01
   933  07f2  20202020ff            db          "    ",$FF
   934                          
   935                          ; AUTHORS
   936                          ;   The Author's credits can be viewed on the TITLE SCREEN when the A (About) key is pressed on the keyboard.
   937                          ;
   938                          AUTHORS:
   939  07f7  2020204f72696769      db          "   Originally programmed by Tom Loughry ",$01
              6e616c6c79207072  
              6f6772616d6d6564  
              20627920546f6d20  
              4c6f756768727920  
              01                
   940  0820  20204e6577204746      db          "  New GFX & routines by Sean Harrington ",$FF
              58202620726f7574  
              696e657320627920  
              5365616e20486172  
              72696e67746f6e20  
              ff                
   941                          
   942                          ; LEVEL_99_LOOP
   943                          ;   The level 99 overflow text is shown when the player completes maze level 99 without killing the MINOTAUR. Their level is set back to 90, and they continue playing.
   944                          ;
   945                          LEVEL_99_LOOP:
   946  0849  4c6f6f6b73206c69      db          "Looks like this dungeon",$01
              6b65207468697320  
              64756e67656f6e01  
   947  0861  697320746f6f2073      db          "is too small for you",$01
              6d616c6c20666f72  
              20796f7501        
   948  0876  736f207765207769      db          "so we will put you back",$01
              6c6c207075742079  
              6f75206261636b01  
   949  088e  696e746f2061206e      db          "into a new floor #90.",$FF
              657720666c6f6f72  
              202339302eff      
   950                          
   951                          ; THE END
   952                          ;   The end of game text is displayed when you defeat the MINOTAUR.
   953                          ;
   954                          THE_END_PART_A:
   955  08a4  204173746572696f      db          " Asterion, the minotaur ",$FF
              6e2c20746865206d  
              696e6f7461757220  
              ff                
   956                          THE_END_PART_B:
   957  08bd  2069732064656164      db          " is dead. ",$FF
              2e20ff            
   958                          
   959                          ; YOU_DIED
   960                          ;   The end of game text is displayed when the PLAYER dies.
   961                          ;
   962                          YOU_DIED_TXT:
   963  08c8  7fa0596f75206469      DB         $7F,$A0,"You died ",$FF
              656420ff          
   964                          
src/asterion.asm:
     7                          include "asterion_func_low.asm"
src/asterion_func_low.asm:
     1                          SUB_ram_c869:
     2  08d4  112900                LD          DE,$29                                 ;GRN on DKCYN
     3                                                                                  ;(bottom of closed door)
     4                          SUB_ram_c86c:
     5  08d7  77                    LD          (HL),A
     6  08d8  37                    SCF
     7  08d9  3f                    CCF
     8  08da  ed52                  SBC         HL,DE
     9                          SUB_ram_c871:
    10  08dc  77                    LD          (HL),A
    11  08dd  37                    SCF
    12  08de  3f                    CCF
    13  08df  ed52                  SBC         HL,DE
    14  08e1  77                    LD          (HL),A
    15  08e2  ed52                  SBC         HL,DE
    16  08e4  77                    LD          (HL),A
    17  08e5  c9                    RET
    18  08e6  112900                LD          DE,$29                                 ;GRN on DKCYN
    19                                                                                  ;(bottom of closed door)
    20                          SUB_ram_c87e:
    21  08e9  77                    LD          (HL),A
    22  08ea  19                    ADD         HL,DE
    23                          LAB_ram_c880:
    24  08eb  77                    LD          (HL),A
    25  08ec  19                    ADD         HL,DE
    26  08ed  77                    LD          (HL),A
    27  08ee  19                    ADD         HL,DE
    28  08ef  77                    LD          (HL),A
    29  08f0  c9                    RET
    30                          SUB_ram_c886:
    31  08f1  77                    LD          (HL),A
    32  08f2  19                    ADD         HL,DE
    33  08f3  77                    LD          (HL),A
    34  08f4  23                    INC         HL
    35  08f5  77                    LD          (HL),A
    36  08f6  19                    ADD         HL,DE
    37  08f7  23                    INC         HL
    38  08f8  77                    LD          (HL),A
    39  08f9  2b                    DEC         HL
    40  08fa  77                    LD          (HL),A
    41  08fb  2b                    DEC         HL
    42  08fc  77                    LD          (HL),A
    43  08fd  c9                    RET
    44                          SUB_ram_c893:
    45  08fe  77                    LD          (HL),A
    46  08ff  19                    ADD         HL,DE
    47  0900  77                    LD          (HL),A
    48  0901  2b                    DEC         HL
    49  0902  77                    LD          (HL),A
    50  0903  19                    ADD         HL,DE
    51  0904  23                    INC         HL
    52  0905  77                    LD          (HL),A
    53  0906  2b                    DEC         HL
    54  0907  77                    LD          (HL),A
    55  0908  2b                    DEC         HL
    56  0909  77                    LD          (HL),A
    57  090a  c9                    RET
    58                          SUB_ram_c8a0:
    59  090b  77                    LD          (HL),A
    60  090c  23                    INC         HL
    61  090d  77                    LD          (HL),A
    62  090e  23                    INC         HL
    63  090f  77                    LD          (HL),A
    64  0910  19                    ADD         HL,DE
    65  0911  2b                    DEC         HL
    66  0912  77                    LD          (HL),A
    67  0913  2b                    DEC         HL
    68  0914  77                    LD          (HL),A
    69  0915  19                    ADD         HL,DE
    70  0916  77                    LD          (HL),A
    71  0917  c9                    RET
    72                          SUB_ram_c8ad:
    73  0918  77                    LD          (HL),A
    74  0919  23                    INC         HL
    75  091a  77                    LD          (HL),A
    76  091b  23                    INC         HL
    77  091c  77                    LD          (HL),A
    78  091d  19                    ADD         HL,DE
    79  091e  2b                    DEC         HL
    80  091f  77                    LD          (HL),A
    81  0920  23                    INC         HL
    82  0921  77                    LD          (HL),A
    83  0922  19                    ADD         HL,DE
    84  0923  77                    LD          (HL),A
    85  0924  c9                    RET
    86                          DRAW_ROW:
    87  0925  77                    LD          (HL),A
    88  0926  05                    DEC         B
    89  0927  c8                    RET         Z
    90  0928  23                    INC         HL
    91  0929  c32509                JP          DRAW_ROW
    92  092c  112800                LD          DE,$28                                 ;DE = 40 (next line) / $28
    93                          DRAW_CELL:
    94  092f  77                    LD          (HL),A
    95  0930  0d                    DEC         C
    96  0931  c8                    RET         Z
    97  0932  19                    ADD         HL,DE                                   ;Goto next row
    98  0933  c32f09                JP          DRAW_CELL
    99                          FILL_CHRCOL_RECT:
   100  0936  112800                LD          DE,$28                                 ;DE = 40 / $28 (next row)
   101                          DRAW_CHRCOLS:
   102  0939  e5                    PUSH        HL
   103  093a  c5                    PUSH        BC
   104  093b  cd2509                CALL        DRAW_ROW
   105  093e  c1                    POP         BC
   106  093f  e1                    POP         HL
   107  0940  0d                    DEC         C
   108  0941  c8                    RET         Z
   109  0942  19                    ADD         HL,DE
   110  0943  c33909                JP          DRAW_CHRCOLS
   111                          DRAW_F0_WALL:
   112  0946  21cc34                LD          HL,COLRAM_F0_WALL_MAP_IDX               ;= $60    `
   113  0949  011010                LD          BC,$1010                               ;16 x 16 rectangle
   114  094c  3e44                  LD          A,$44                                  ;BLU on BLU
   115  094e  c33609                JP          FILL_CHRCOL_RECT
   116                          DRAW_F0_WALL_AND_CLOSED_DOOR:
   117  0951  cd4609                CALL        DRAW_F0_WALL
   118  0954  3e22                  LD          A,$22                                  ;GRN on GRN
   119                          DRAW_DOOR_F0:
   120  0956  217035                LD          HL,COLRAM_F0_DOOR_IDX                   ;= $60
   121  0959  010c08                LD          BC,$80c                                ;8 x 12 rectangle
   122  095c  c33609                JP          FILL_CHRCOL_RECT
   123                          DRAW_WALL_F0_AND_OPEN_DOOR:
   124  095f  cd4609                CALL        DRAW_F0_WALL
   125  0962  3ef0                  LD          A,$f0                                  ;DKGRY on BLK
   126                                                                                  ;WAS BLK on DKBLU
   127                                                                                  ;WAS LD A,0xb
   128  0964  c35609                JP          DRAW_DOOR_F0
   129                          DRAW_WALL_F1:
   130  0967  217031                LD          HL,CHRRAM_F1_WALL_IDX                   ;= $20
   131  096a  010808                LD          BC,$808                                ;8 x 8 rectangle
   132  096d  3e20                  LD          A,$20                                  ;Change to SPACE 32 / $20
   133                                                                                  ;WAS d134 / $86 crosshatch char
   134                                                                                  ;WAS LD A, $86
   135  096f  cd3609                CALL        FILL_CHRCOL_RECT
   136  0972  0e08                  LD          C,0x8
   137  0974  217035                LD          HL,COLRAM_F0_DOOR_IDX                   ;= $60
   138  0977  3e4b                  LD          A,$4b                                  ;BLU on DKBLU
   139  0979  c33909                JP          DRAW_CHRCOLS
   140                          DRAW_WALL_F1_AND_CLOSED_DOOR:
   141  097c  cd6709                CALL        DRAW_WALL_F1
   142  097f  3e2d                  LD          A,$2d                                  ;GRN on DKGRN
   143                          DRAW_DOOR_F1_OPEN:
   144  0981  21c235                LD          HL,COLRAM_F1_DOOR_IDX                   ;= $60    `
   145  0984  010604                LD          BC,$406                                ;4 x 6 rectangle
   146  0987  c33609                JP          FILL_CHRCOL_RECT
   147                          DRAW_WALL_F1_AND_OPEN_DOOR:
   148  098a  cd6709                CALL        DRAW_WALL_F1
   149  098d  3e00                  LD          A,0x0                                   ;BLK on BLK
   150  098f  c38109                JP          DRAW_DOOR_F1_OPEN
   151                          DRAW_WALL_F2:
   152  0992  010404                LD          BC,$404                                ;4 x 4 rectangle
   153  0995  21c235                LD          HL,COLRAM_F1_DOOR_IDX                   ;= $60    `
   154  0998  3eff                  LD          A,$ff                                  ;DKGRY on DKGRY
   155                                                                                  ;WAS BLK on DKBLU
   156                                                                                  ;WAS LD A,0xb
   157  099a  c33609                JP          FILL_CHRCOL_RECT
   158                          DRAW_DOOR_F2_OPEN:
   159  099d  21c235                LD          HL,COLRAM_F1_DOOR_IDX                   ;= $60    `
   160  09a0  3e00                  LD          A,0x0                                   ;BLK on BLK
   161                          UPDATE_FO_ITEM:
   162  09a2  010404                LD          BC,$404                                ;4 x 4 rectangle
   163  09a5  c33609                JP          FILL_CHRCOL_RECT
   164                          DRAW_WALL_FL0:
   165  09a8  21a334                LD          HL,COLRAM_FL00_WALL_IDX                 ;= $60    `
   166  09ab  3e40                  LD          A,$40                                  ;BLU on BLK
   167                                                                                  ;WAS BLU on CYN
   168                                                                                  ;WAS LD A,$46
   169  09ad  cdd408                CALL        SUB_ram_c869
   170  09b0  1b                    DEC         DE
   171  09b1  19                    ADD         HL,DE
   172  09b2  3e04                  LD          A,0x4                                   ;BLK on BLU
   173  09b4  cdf108                CALL        SUB_ram_c886
   174  09b7  19                    ADD         HL,DE
   175  09b8  011004                LD          BC,$410                                ;Jump into COLRAM and down one row
   176  09bb  cd3909                CALL        DRAW_CHRCOLS
   177  09be  19                    ADD         HL,DE
   178  09bf  cd0b09                CALL        SUB_ram_c8a0
   179  09c2  19                    ADD         HL,DE
   180  09c3  3ef4                  LD          A,$f4                                  ;DKGRY on BLU
   181                                                                                  ;WAS DKCYN on BLU
   182                                                                                  ;WAS LD A,$94
   183  09c5  1b                    DEC         DE
   184  09c6  cdd708                CALL        SUB_ram_c86c
   185  09c9  3ec0                  LD          A,$c0
   186  09cb  21c033                LD          HL,DAT_ram_33c0                         ;= $20
   187  09ce  cdd708                CALL        SUB_ram_c86c
   188  09d1  212830                LD          HL,IDX_VIEWPORT_CHRRAM                  ;= $20
   189  09d4  3ec1                  LD          A,$c1
   190  09d6  13                    INC         DE
   191  09d7  13                    INC         DE
   192  09d8  c3e908                JP          SUB_ram_c87e
   193  09db  c9                    RET
   194                          DRAW_DOOR_FLO:
   195  09dc  cda809                CALL        DRAW_WALL_FL0
   196  09df  3ef0                  LD          A,$f0                                  ;DKGRY on BLK
   197                                                                                  ;WAS DKCYN on DKBLU
   198                                                                                  ;WAS LD A,$9b
   199  09e1  08                    EX          AF,AF'
   200  09e2  3e04                  LD          A,0x4                                   ;BLK on BLU
   201                                                                                  ;WAS DKBLU on BLU
   202                                                                                  ;LD A,$b4
   203  09e4  c3ef09                JP          LAB_ram_c99e
   204                          SUB_ram_c996:
   205  09e7  cda809                CALL        DRAW_WALL_FL0
   206  09ea  3ef2                  LD          A,$f2                                  ;DKGRY on GRN
   207                                                                                  ;WAS DKCYN on GRN
   208                                                                                  ;WAS LD A,$92
   209  09ec  08                    EX          AF,AF'
   210  09ed  3e24                  LD          A,$24                                  ;GRN on BLU
   211                          LAB_ram_c99e:
   212  09ef  211a35                LD          HL,DAT_ram_351a                         ;= $60    `
   213  09f2  cddc08                CALL        SUB_ram_c871
   214  09f5  1b                    DEC         DE
   215  09f6  19                    ADD         HL,DE
   216  09f7  08                    EX          AF,AF'
   217  09f8  cdf108                CALL        SUB_ram_c886
   218  09fb  19                    ADD         HL,DE
   219  09fc  010c03                LD          BC,$30c
   220  09ff  cd3909                CALL        DRAW_CHRCOLS
   221  0a02  19                    ADD         HL,DE
   222  0a03  cd0b09                CALL        SUB_ram_c8a0
   223  0a06  19                    ADD         HL,DE
   224  0a07  1b                    DEC         DE
   225  0a08  cddc08                CALL        SUB_ram_c871
   226  0a0b  21c830                LD          HL,DAT_ram_30c8                         ;= $20
   227  0a0e  3ec1                  LD          A,$c1
   228  0a10  13                    INC         DE
   229  0a11  13                    INC         DE
   230  0a12  c3eb08                JP          LAB_ram_c880
   231  0a15  c9                    RET
   232                          SUB_ram_c9c5:
   233  0a16  21c834                LD          HL,DAT_ram_34c8                         ;= $60    `
   234  0a19  3e04                  LD          A,0x4                                   ;BLK on BLU
   235  0a1b  011004                LD          BC,$410                                ;4 x 10 rectangle
   236  0a1e  c33609                JP          FILL_CHRCOL_RECT
   237                          SUB_ram_c9d0:
   238  0a21  216831                LD          HL,DAT_ram_3168                         ;= $20
   239  0a24  010804                LD          BC,$408                                ;4 x 8 rectangle
   240  0a27  3e20                  LD          A,$20                                  ;Change to SPACE 32 / $20
   241                                                                                  ;WAS d134 / $86 crosshatch char
   242                                                                                  ;WAS LD A, $86
   243  0a29  cd3609                CALL        FILL_CHRCOL_RECT
   244  0a2c  216835                LD          HL,DAT_ram_3568                         ;= $60
   245  0a2f  0e08                  LD          C,0x8
   246  0a31  3e4b                  LD          A,$4b                                  ;BLU on DKBLU
   247  0a33  c33909                JP          DRAW_CHRCOLS
   248                          SUB_ram_c9e5:
   249  0a36  cd210a                CALL        SUB_ram_c9d0
   250  0a39  3edd                  LD          A,$dd                                  ;DKGRN on DKGRN
   251                          LAB_ram_c9ea:
   252  0a3b  21ba35                LD          HL,DAT_ram_35ba                         ;= $60    `
   253  0a3e  010602                LD          BC,$206                                ;2 x 6 rectangle
   254  0a41  c33909                JP          DRAW_CHRCOLS
   255                          SUB_ram_c9f3:
   256  0a44  cd210a                CALL        SUB_ram_c9d0
   257  0a47  af                    XOR         A
   258  0a48  c33b0a                JP          LAB_ram_c9ea
   259                          SUB_ram_c9f9:
   260  0a4b  216831                LD          HL,DAT_ram_3168                         ;= $20
   261  0a4e  3ec1                  LD          A,$c1
   262  0a50  77                    LD          (HL),A                    ;= $20
   263  0a51  112800                LD          DE,$28
   264  0a54  19                    ADD         HL,DE
   265  0a55  23                    INC         HL
   266  0a56  77                    LD          (HL),A                    ;= $20
   267  0a57  215932                LD          HL,DAT_ram_3259                         ;= $20
   268  0a5a  3ec0                  LD          A,$c0
   269  0a5c  77                    LD          (HL),A                    ;= $20
   270  0a5d  19                    ADD         HL,DE
   271  0a5e  2b                    DEC         HL
   272  0a5f  77                    LD          (HL),A                    ;= $20
   273  0a60  216835                LD          HL,DAT_ram_3568                         ;= $60
   274  0a63  3ebf                  LD          A,$bf                                  ;DKBLU on DKGRY
   275                                                                                  ;WAS DKBLU on DKCYN
   276                                                                                  ;WAS LD A,$b9
   277  0a65  77                    LD          (HL),A                    ;= $60
   278  0a66  19                    ADD         HL,DE
   279  0a67  23                    INC         HL
   280  0a68  77                    LD          (HL),A                    ;= $60
   281  0a69  2b                    DEC         HL
   282  0a6a  3e0f                  LD          A,0xf                                   ;BLK on DKGRY
   283                                                                                  ;WAS BLK on DKBLU
   284                                                                                  ;WAS LD A,0xb
   285  0a6c  77                    LD          (HL),A                    ;= $60
   286  0a6d  010402                LD          BC,$204                                ;2 x 4 rectangle
   287  0a70  19                    ADD         HL,DE             ;= $60    `
   288  0a71  cd3909                CALL        DRAW_CHRCOLS
   289  0a74  19                    ADD         HL,DE
   290  0a75  77                    LD          (HL),A                    ;= $60
   291  0a76  23                    INC         HL
   292  0a77  3e0f                  LD          A,0xf                                   ;BLK on DKGRY
   293                                                                                  ;WAS DKCYN on DKBLU
   294                                                                                  ;WAS LD A,$9b
   295  0a79  77                    LD          (HL),A                    ;= $60
   296  0a7a  19                    ADD         HL,DE
   297  0a7b  2b                    DEC         HL
   298  0a7c  77                    LD          (HL),A                    ;= $60
   299  0a7d  21ba35                LD          HL,DAT_ram_35ba                         ;= $60    `
   300  0a80  0e04                  LD          C,0x4
   301  0a82  3e00                  LD          A,0x0
   302  0a84  c33909                JP          DRAW_CHRCOLS
   303                          DRAW_WALL_FL22:
   304  0a87  21b835                LD          HL,COLRAM_FL22_WALL_IDX                 ;= $60    `
   305  0a8a  010404                LD          BC,$404                                ;4 x 4 rectangle
   306  0a8d  3eff                  LD          A,$ff                                  ;DKGRY on DKGRY
   307  0a8f  c33609                JP          FILL_CHRCOL_RECT
   308                          DRAW_L1_WALL:
   309  0a92  214731                LD          HL,CHRRAM_FL1_WALL_IDX                  ;= $20
   310  0a95  3ec1                  LD          A,$c1                                  ;LEFT angle CHR
   311  0a97  cdd408                CALL        SUB_ram_c869
   312  0a9a  1b                    DEC         DE
   313  0a9b  19                    ADD         HL,DE
   314  0a9c  3e20                  LD          A,$20                                  ;Change to SPACE 32 / $20
   315                                                                                  ;WAS d134 / $86 crosshatch char
   316                                                                                  ;WAS LD A, $86
   317  0a9e  cdf108                CALL        SUB_ram_c886
   318  0aa1  19                    ADD         HL,DE
   319  0aa2  010804                LD          BC,$408                                ;4 x 8 rectangle
   320  0aa5  cd3909                CALL        DRAW_CHRCOLS
   321  0aa8  19                    ADD         HL,DE
   322  0aa9  cd0b09                CALL        SUB_ram_c8a0
   323  0aac  19                    ADD         HL,DE
   324  0aad  3ec0                  LD          A,$c0                                  ;RIGHT angle CHR
   325  0aaf  1b                    DEC         DE
   326  0ab0  cdd708                CALL        SUB_ram_c86c
   327  0ab3  214735                LD          HL,DAT_ram_3547                         ;= $60    `
   328  0ab6  3eb0                  LD          A,$b0                                  ;DKBLU on BLK
   329                                                                                  ;WAS DKBLU on CYN
   330                                                                                  ;WAS LD A,$b6
   331  0ab8  cdd408                CALL        SUB_ram_c869
   332  0abb  1b                    DEC         DE
   333  0abc  19                    ADD         HL,DE
   334  0abd  3e4b                  LD          A,$4b                                  ;BLU on DKBLU
   335  0abf  cdf108                CALL        SUB_ram_c886
   336  0ac2  19                    ADD         HL,DE
   337  0ac3  010804                LD          BC,$408                                ;Jump to COLRAM + 32 cells
   338  0ac6  cd3909                CALL        DRAW_CHRCOLS
   339  0ac9  19                    ADD         HL,DE
   340  0aca  cd0b09                CALL        SUB_ram_c8a0
   341  0acd  19                    ADD         HL,DE
   342  0ace  3efb                  LD          A,$fb                                  ;DKGRY on DKBLU
   343                                                                                  ;WAS DKCYN on DKBLU
   344                                                                                  ;WAS LD A,$9b
   345  0ad0  1b                    DEC         DE
   346  0ad1  c3d708                JP          SUB_ram_c86c
   347  0ad4  c9                    RET
   348                          DRAW_FL1_DOOR:
   349  0ad5  cd920a                CALL        DRAW_L1_WALL
   350  0ad8  3ef0                  LD          A,$f0                                  ;DKGRY on BLK
   351                                                                                  ;WAS DKCYN on BLK
   352                                                                                  ;WAS LD A,$90
   353  0ada  f5                    PUSH        AF
   354  0adb  3eb0                  LD          A,$b0                                  ;DKBLU on BLK
   355  0add  f5                    PUSH        AF
   356  0ade  3e0b                  LD          A,0xb                                   ;BLK on DKGRY
   357                                                                                  ;WAS BLK on DKBLU
   358                                                                                  ;WAS LD A,0xb
   359  0ae0  c3ee0a                JP          DRAW_L1_DOOR
   360                          DRAW_L1:
   361  0ae3  cd920a                CALL        DRAW_L1_WALL
   362  0ae6  3efd                  LD          A,$fd                                  ;DKGRY on DKGRN
   363                                                                                  ;WAS DKCYN on DKGRN
   364                                                                                  ;WAS LD A,$9d
   365  0ae8  f5                    PUSH        AF
   366  0ae9  3e2d                  LD          A,$2d                                  ;GRN on DKGRN
   367  0aeb  f5                    PUSH        AF
   368  0aec  3edb                  LD          A,$db                                  ;DKGRN on DKBLU
   369                          DRAW_L1_DOOR:
   370  0aee  216d35                LD          HL,COLRAM_L1_DOOR_IDX                   ;= $60    `
   371  0af1  010702                LD          BC,$207                                ;2 x 7 rectangle
   372  0af4  cd700b                CALL        SUB_ram_cb1c
   373  0af7  216d31                LD          HL,CHRRAM_L1_DOOR_IDX                   ;= $20
   374  0afa  3ec1                  LD          A,$c1                                  ;LEFT ANGLE CHR
   375  0afc  77                    LD          (HL),A              ;= $20
   376  0afd  112900                LD          DE,$29
   377  0b00  19                    ADD         HL,DE
   378  0b01  77                    LD          (HL),A                    ;= $20
   379  0b02  c9                    RET
   380                          SUB_ram_cab0:
   381  0b03  216c35                LD          HL,DAT_ram_356c                         ;= $60    `
   382  0b06  010804                LD          BC,$408                                ;4 x 8 rectangle
   383  0b09  3e4b                  LD          A,$4b                                  ;BLU on DKBLU
   384  0b0b  cd3609                CALL        FILL_CHRCOL_RECT
   385  0b0e  216c31                LD          HL,DAT_ram_316c                         ;= $20
   386  0b11  0e08                  LD          C,0x8
   387  0b13  3e20                  LD          A,$20                                  ;Change to SPACE 32 / $20
   388                                                                                  ;WAS d134 / $86 crosshatch char
   389                                                                                  ;WAS LD A, $86
   390  0b15  c33909                JP          DRAW_CHRCOLS
   391                          SUB_ram_cac5:
   392  0b18  cd030b                CALL        SUB_ram_cab0
   393  0b1b  af                    XOR         A
   394  0b1c  c3240b                JP          DRAW_L1_DOOR_2
   395                          DRAW_L1_DOOR_CLOSED:
   396  0b1f  cd030b                CALL        SUB_ram_cab0
   397  0b22  3edd                  LD          A,$dd                                  ;DKGRN on DKGRN
   398                          DRAW_L1_DOOR_2:
   399  0b24  21bc35                LD          HL,COLRAM_FL2_WALL_IDX                  ;= $60    `
   400  0b27  010602                LD          BC,$206                                ;2 x 6 rectangle
   401  0b2a  c33909                JP          DRAW_CHRCOLS
   402                          DRAW_WALL_FL2:
   403  0b2d  21bc35                LD          HL,COLRAM_FL2_WALL_IDX                  ;= $60    `
   404  0b30  010402                LD          BC,$204                                ;2 x 4 rectangle
   405  0b33  3e11                  LD          A,$11                                  ;BLK on DKGRY
   406  0b35  cd3609                CALL        FILL_CHRCOL_RECT
   407  0b38  0e04                  LD          C,0x4
   408  0b3a  21be35                LD          HL,COLRAM_FL2_PLUS_WALL_IDX             ;= $60    `
   409  0b3d  3e22                  LD          A,$22                                  ;BLK on DKGRY
   410                                                                                  ;WAS BLK on DKBLU
   411                                                                                  ;WAS LD A,0xb
   412  0b3f  c33909                JP          DRAW_CHRCOLS
   413                          DRAW_WALL_FL2_EMPTY:
   414  0b42  21bc35                LD          HL,COLRAM_FL2_WALL_IDX                  ;= $60    `
   415  0b45  010404                LD          BC,$404                                ;4 x 4 rectangle
   416  0b48  3e00                  LD          A,0x0                                   ;BLK on BLK
   417  0b4a  c33609                JP          FILL_CHRCOL_RECT
   418                          DRAW_WALL_L2:
   419  0b4d  3eca                  LD          A,$ca                                  ;Right slash char
   420  0b4f  f5                    PUSH        AF
   421  0b50  3e20                  LD          A,$20                                  ;GRN on BLK
   422  0b52  f5                    PUSH        AF
   423  0b53  217031                LD          HL,CHRRAM_F1_WALL_IDX                   ;= $20
   424  0b56  3ec1                  LD          A,$c1                                  ;Left angle char
   425  0b58  010402                LD          BC,$204                                ;2 x 4 rectangle
   426  0b5b  cd700b                CALL        SUB_ram_cb1c
   427  0b5e  3e0f                  LD          A,0xf                                   ;FL2 Bottom Color
   428                                                                                  ;BLK on DKGRY
   429                                                                                  ;WAS DKCYN on DKBLU
   430                                                                                  ;WAS LD A,$9b
   431  0b60  f5                    PUSH        AF
   432  0b61  3e0f                  LD          A,0xf                                   ;FL2 Wall Color
   433                                                                                  ;BLK on DKGRY
   434                                                                                  ;WAS BLK on DKBLU
   435                                                                                  ;WAS LD A,0xb
   436  0b63  f5                    PUSH        AF
   437  0b64  217035                LD          HL,COLRAM_F0_DOOR_IDX                   ;= $60
   438  0b67  3ef0                  LD          A,$f0                                  ;FL2 Top Color
   439                                                                                  ;DKGRY on BLK
   440                                                                                  ;WAS DKBLU on CYN
   441                                                                                  ;WAS LD A,$b6
   442  0b69  010402                LD          BC,$204                                ;2 x 4 rectangle
   443  0b6c  cd700b                CALL        SUB_ram_cb1c
   444  0b6f  c9                    RET
   445                          SUB_ram_cb1c:
   446  0b70  dde1                  POP         IX
   447  0b72  77                    LD          (HL),A
   448  0b73  112900                LD          DE,$29                                 ;EDIT MEdb?
   449  0b76  19                    ADD         HL,DE
   450  0b77  77                    LD          (HL),A
   451  0b78  2b                    DEC         HL
   452  0b79  1b                    DEC         DE
   453  0b7a  f1                    POP         AF
   454  0b7b  77                    LD          (HL),A
   455  0b7c  19                    ADD         HL,DE
   456  0b7d  cd3909                CALL        DRAW_CHRCOLS
   457  0b80  19                    ADD         HL,DE
   458  0b81  77                    LD          (HL),A
   459  0b82  19                    ADD         HL,DE
   460  0b83  f1                    POP         AF
   461  0b84  77                    LD          (HL),A
   462  0b85  37                    SCF
   463  0b86  3f                    CCF
   464  0b87  ed52                  SBC         HL,DE
   465  0b89  23                    INC         HL
   466  0b8a  77                    LD          (HL),A
   467  0b8b  dde9                  JP          (IX)
   468                          DRAW_WALL_L2_C:
   469  0b8d  21c035                LD          HL,DAT_ram_35c0                         ;= $60    `
   470  0b90  010402                LD          BC,$204                                ;2 x 4 rectangle
   471  0b93  3e0f                  LD          A,0xf                                   ;BLK on DKGRY
   472                                                                                  ;WAS BLK on DKBLU
   473                                                                                  ;WAS LD A,0xb
   474  0b95  c33609                JP          FILL_CHRCOL_RECT
   475                          DRAW_WALL_L2_C_EMPTY:
   476  0b98  21c035                LD          HL,DAT_ram_35c0                         ;= $60    `
   477  0b9b  010402                LD          BC,$204                                ;2 x 4 rectangle
   478  0b9e  3e00                  LD          A,0x0                                   ;BLK on BLK
   479  0ba0  c33609                JP          FILL_CHRCOL_RECT
   480                          SUB_ram_cb4f:
   481  0ba3  3ef4                  LD          A,$f4                                  ;DKGRY on BLU
   482                                                                                  ;WAS DKCYN on BLU
   483                                                                                  ;WAS LD A,$94
   484  0ba5  f5                    PUSH        AF
   485  0ba6  011004                LD          BC,$410
   486  0ba9  3e04                  LD          A,0x4                                   ;BLK on BLU
   487  0bab  f5                    PUSH        AF
   488  0bac  3e40                  LD          A,$40                                  ;BLU on BLK
   489                                                                                  ;WAS BLU on CYN
   490                                                                                  ;WAS LD A, $46
   491  0bae  21b434                LD          HL,DAT_ram_34b4                         ;= $60    `
   492  0bb1  cda30c                CALL        SUB_ram_cc4d
   493  0bb4  213f30                LD          HL,DAT_ram_303f                         ;= $20
   494  0bb7  3ec0                  LD          A,$c0                                  ;Right angle char
   495  0bb9  112700                LD          DE,$27
   496  0bbc  cde908                CALL        SUB_ram_c87e
   497  0bbf  215c33                LD          HL,DAT_ram_335c                         ;= $20
   498  0bc2  3c                    INC         A
   499  0bc3  13                    INC         DE
   500  0bc4  13                    INC         DE
   501  0bc5  c3e908                JP          SUB_ram_c87e
   502                          DRAW_FRO_DOOR:
   503  0bc8  cda30b                CALL        SUB_ram_cb4f
   504  0bcb  3ef0                  LD          A,$f0                                  ;DKGRY on BLK
   505                                                                                  ;WAS DKCYN on DKBLU
   506                                                                                  ;WAS LD A,$9b
   507  0bcd  08                    EX          AF,AF'
   508  0bce  3e04                  LD          A,0x4                                   ;BLK on BLU
   509                                                                                  ;WAS DKBLU on BLU
   510                                                                                  ;WAS LDA A,$b4
   511  0bd0  c3db0b                JP          LAB_ram_cb86
   512                          SUB_ram_cb7e:
   513  0bd3  cda30b                CALL        SUB_ram_cb4f
   514  0bd6  3ef2                  LD          A,$f2                                  ;DKGRY on GRN
   515                                                                                  ;WAS DKCYN on GRN
   516                                                                                  ;WAS LD A,$92
   517  0bd8  08                    EX          AF,AF'
   518  0bd9  3e24                  LD          A,$24                                  ;GRN on BLU
   519                          LAB_ram_cb86:
   520  0bdb  212d35                LD          HL,DAT_ram_352d                         ;= $60    `
   521  0bde  1b                    DEC         DE
   522  0bdf  1b                    DEC         DE
   523  0be0  cddc08                CALL        SUB_ram_c871
   524  0be3  13                    INC         DE
   525  0be4  19                    ADD         HL,DE
   526  0be5  08                    EX          AF,AF'
   527  0be6  cdfe08                CALL        SUB_ram_c893
   528  0be9  19                    ADD         HL,DE
   529  0bea  010c03                LD          BC,$30c
   530  0bed  cd3909                CALL        DRAW_CHRCOLS
   531  0bf0  19                    ADD         HL,DE
   532  0bf1  cd1809                CALL        SUB_ram_c8ad
   533  0bf4  19                    ADD         HL,DE
   534  0bf5  13                    INC         DE
   535  0bf6  cddc08                CALL        SUB_ram_c871
   536  0bf9  21df30                LD          HL,DAT_ram_30df                         ;= $20
   537  0bfc  3ec0                  LD          A,$c0                                  ;Right angle char
   538  0bfe  1b                    DEC         DE
   539  0bff  1b                    DEC         DE
   540  0c00  c3eb08                JP          LAB_ram_c880
   541                          SUB_ram_cbae:
   542  0c03  21dc34                LD          HL,DAT_ram_34dc                         ;= $60    `
   543  0c06  3e04                  LD          A,0x4                                   ;BLK on BLU
   544  0c08  011004                LD          BC,$410                                ;4 x 10 rectangle
   545  0c0b  c33609                JP          FILL_CHRCOL_RECT
   546                          SUB_ram_cbb9:
   547  0c0e  217c31                LD          HL,DAT_ram_317c                         ;= $20
   548  0c11  010804                LD          BC,$408
   549  0c14  3e20                  LD          A,$20                                  ;Change to SPACE 32 / $20
   550                                                                                  ;WAS d134 / $86 crosshatch char
   551                                                                                  ;WAS LD A, $86
   552  0c16  cd3609                CALL        FILL_CHRCOL_RECT
   553  0c19  217c35                LD          HL,DAT_ram_357c                         ;= $60    `
   554  0c1c  0e08                  LD          C,0x8
   555  0c1e  3e4b                  LD          A,$4b                                  ;BLU on DKBLU
   556  0c20  c33909                JP          DRAW_CHRCOLS
   557                          SUB_ram_cbce:
   558  0c23  cd0e0c                CALL        SUB_ram_cbb9
   559  0c26  af                    XOR         A
   560  0c27  c32f0c                JP          LAB_ram_cbd9
   561                          SUB_ram_cbd4:
   562  0c2a  cd0e0c                CALL        SUB_ram_cbb9
   563  0c2d  3edd                  LD          A,$dd                                  ;DKGRN on DKGRNdb?
   564                          LAB_ram_cbd9:
   565  0c2f  21cc35                LD          HL,DAT_ram_35cc                         ;= $60    `
   566  0c32  010602                LD          BC,$206                                ;2 x 6 rectangledb?
   567  0c35  c33909                JP          DRAW_CHRCOLS
   568                          SUB_ram_cbe2:
   569  0c38  217f31                LD          HL,DAT_ram_317f                         ;= $20
   570  0c3b  3ec0                  LD          A,$c0                                  ;Right angle char
   571  0c3d  77                    LD          (HL),A                    ;= $20
   572  0c3e  112800                LD          DE,$28
   573  0c41  19                    ADD         HL,DE
   574  0c42  2b                    DEC         HL
   575  0c43  77                    LD          (HL),A                    ;= $20
   576  0c44  216e32                LD          HL,DAT_ram_326e                         ;= $20
   577  0c47  3ec1                  LD          A,$c1                                  ;Left angle char
   578  0c49  77                    LD          (HL),A                    ;= $20
   579  0c4a  19                    ADD         HL,DE
   580  0c4b  23                    INC         HL
   581  0c4c  77                    LD          (HL),A                    ;= $20
   582  0c4d  217f35                LD          HL,DAT_ram_357f                         ;= $60
   583  0c50  3ebf                  LD          A,$bf                                  ;DKBLU on DKGRY
   584                                                                                  ;WAS DKBLU on DKCYN
   585                                                                                  ;WAS LD A,$b9
   586  0c52  77                    LD          (HL),A                    ;= $60
   587  0c53  19                    ADD         HL,DE
   588  0c54  2b                    DEC         HL
   589  0c55  77                    LD          (HL),A                    ;= $60
   590  0c56  23                    INC         HL
   591  0c57  3e0f                  LD          A,0xf                                   ;BLK on DKGRY
   592                                                                                  ;WAS BLK on DKBLU
   593                                                                                  ;WAS LD A,0xb
   594  0c59  77                    LD          (HL),A                    ;= $60
   595  0c5a  010402                LD          BC,$204                                ;2 x 4 rectangle
   596  0c5d  19                    ADD         HL,DE
   597  0c5e  2b                    DEC         HL                        ;= $60    `
   598  0c5f  cd3909                CALL        DRAW_CHRCOLS
   599  0c62  19                    ADD         HL,DE
   600  0c63  23                    INC         HL
   601  0c64  77                    LD          (HL),A                    ;= $60
   602  0c65  2b                    DEC         HL
   603  0c66  3e0f                  LD          A,0xf                                   ;BLK on DKGRY
   604                                                                                  ;WAS DKCYN on DKBLU
   605                                                                                  ;WAS LD A,$9b
   606  0c68  77                    LD          (HL),A                    ;= $60
   607  0c69  19                    ADD         HL,DE
   608  0c6a  23                    INC         HL
   609  0c6b  77                    LD          (HL),A                    ;= $60
   610  0c6c  21cc35                LD          HL,DAT_ram_35cc                         ;= $60    `
   611  0c6f  0e04                  LD          C,0x4
   612  0c71  3e00                  LD          A,0x0
   613  0c73  c33909                JP          DRAW_CHRCOLS
   614                          DRAW_WALL_FR222_EMPTY:
   615  0c76  21cc35                LD          HL,DAT_ram_35cc                         ;= $60    `
   616  0c79  010404                LD          BC,$404                                ;4 x 4 rectangle
   617  0c7c  3e00                  LD          A,0x0                                   ;BLK on BLK
   618  0c7e  c33609                JP          FILL_CHRCOL_RECT
   619                          DRAW_WALL_FR1:
   620  0c81  3ec1                  LD          A,$c1
   621  0c83  f5                    PUSH        AF
   622  0c84  010804                LD          BC,$408                                ;4 x 8 rectangle
   623  0c87  3e20                  LD          A,$20                                  ;Change to SPACE 32 / $20
   624                                                                                  ;WAS d134 / $86 crosshatch char
   625                                                                                  ;WAS LD A, $86
   626  0c89  f5                    PUSH        AF
   627  0c8a  3ec0                  LD          A,$c0                                  ;Right angle char
   628  0c8c  215031                LD          HL,DAT_ram_3150                         ;= $20
   629  0c8f  cda30c                CALL        SUB_ram_cc4d
   630  0c92  3efb                  LD          A,$fb                                  ;DKGRY on DKBLU
   631                                                                                  ;WAS DKCYN on DKBLU
   632                                                                                  ;WAS LD $9b
   633  0c94  f5                    PUSH        AF
   634  0c95  0e08                  LD          C,0x8
   635  0c97  3e4b                  LD          A,$4b                                  ;BLU on DKBLU
   636  0c99  f5                    PUSH        AF
   637  0c9a  3eb0                  LD          A,$b0                                  ;DKBLU on BLK
   638                                                                                  ;WAS DKBLU on CYN
   639                                                                                  ;WAS LD A,$b6
   640  0c9c  215035                LD          HL,DAT_ram_3550                         ;= $60    `
   641  0c9f  cda30c                CALL        SUB_ram_cc4d
   642  0ca2  c9                    RET
   643                          SUB_ram_cc4d:
   644  0ca3  dde1                  POP         IX
   645  0ca5  112700                LD          DE,$27
   646  0ca8  cdd708                CALL        SUB_ram_c86c
   647  0cab  13                    INC         DE
   648  0cac  19                    ADD         HL,DE
   649  0cad  f1                    POP         AF
   650  0cae  cdfe08                CALL        SUB_ram_c893
   651  0cb1  19                    ADD         HL,DE
   652  0cb2  2b                    DEC         HL
   653  0cb3  cd3909                CALL        DRAW_CHRCOLS
   654  0cb6  19                    ADD         HL,DE
   655  0cb7  23                    INC         HL
   656  0cb8  cd1809                CALL        SUB_ram_c8ad
   657  0cbb  19                    ADD         HL,DE
   658  0cbc  f1                    POP         AF
   659  0cbd  13                    INC         DE
   660  0cbe  cdd708                CALL        SUB_ram_c86c
   661  0cc1  dde9                  JP          (IX)
   662                          SUB_ram_cc6d:
   663  0cc3  cd810c                CALL        DRAW_WALL_FR1
   664  0cc6  3ef0                  LD          A,$f0                                  ;DKGRY on BLK
   665                                                                                  ;WAS DKCYN on BLK
   666                                                                                  ;WAS LD A,$90
   667  0cc8  f5                    PUSH        AF
   668  0cc9  3eb0                  LD          A,$b0                                  ;DKBLU on BLK
   669  0ccb  f5                    PUSH        AF
   670  0ccc  3e0b                  LD          A,0xb                                   ;BLK on DKBLU
   671  0cce  c3dc0c                JP          LAB_ram_cc85
   672                          SUB_ram_cc7a:
   673  0cd1  cd810c                CALL        DRAW_WALL_FR1
   674  0cd4  3efd                  LD          A,$fd                                  ;DKGRY on DKGRN
   675                                                                                  ;WAS DKCYN on DKGRN
   676                                                                                  ;WAS LD A,$9d
   677  0cd6  f5                    PUSH        AF
   678  0cd7  3e2d                  LD          A,$2d                                  ;GRN on DKGRN
   679  0cd9  f5                    PUSH        AF
   680  0cda  3edb                  LD          A,$db                                  ;DKGRN on DKBLU
   681                          LAB_ram_cc85:
   682  0cdc  217a35                LD          HL,DAT_ram_357a                         ;= $60    `
   683  0cdf  010702                LD          BC,$207                                ;2 x 7 rectangle
   684  0ce2  cd5f0d                CALL        SUB_ram_cd07
   685  0ce5  217a31                LD          HL,DAT_ram_317a                         ;= $20
   686  0ce8  3ec0                  LD          A,$c0                                  ;Right angle char
   687  0cea  77                    LD          (HL),A                    ;= $20
   688  0ceb  112700                LD          DE,$27
   689  0cee  19                    ADD         HL,DE
   690  0cef  77                    LD          (HL),A                    ;= $20
   691  0cf0  c9                    RET
   692                          SUB_ram_cc9a:
   693  0cf1  217835                LD          HL,DAT_ram_3578                         ;= $60    `
   694  0cf4  010804                LD          BC,$408                                ;4 x 8 rectangle
   695  0cf7  3e4b                  LD          A,$4b                                  ;BLU on DKBLU
   696  0cf9  cd3609                CALL        FILL_CHRCOL_RECT
   697  0cfc  217831                LD          HL,DAT_ram_3178                         ;= $20
   698  0cff  0e08                  LD          C,0x8
   699  0d01  3e20                  LD          A,$20                                  ;Change to SPACE 32 / $20
   700                                                                                  ;WAS d134 / $86 crosshatch char
   701                                                                                  ;WAS LD A, $86
   702  0d03  c33909                JP          DRAW_CHRCOLS
   703                          SUB_ram_ccaf:
   704  0d06  cdf10c                CALL        SUB_ram_cc9a
   705  0d09  af                    XOR         A
   706  0d0a  c3120d                JP          LAB_ram_ccba
   707                          SUB_ram_ccb5:
   708  0d0d  cdf10c                CALL        SUB_ram_cc9a
   709  0d10  3edd                  LD          A,$dd                                  ;DKGRN on DKGRN
   710                          LAB_ram_ccba:
   711  0d12  21ca35                LD          HL,DAT_ram_35ca                         ;= $60    `
   712  0d15  010602                LD          BC,$206                                ;2 x 6 rectangle
   713  0d18  c33909                JP          DRAW_CHRCOLS
   714                          SUB_ram_ccc3:
   715  0d1b  21ca35                LD          HL,DAT_ram_35ca                         ;= $60    `
   716  0d1e  010402                LD          BC,$204                                ;2 x 4 rectangle
   717  0d21  3e00                  LD          A,0x0                                   ;BLK on BLK
   718  0d23  cd3609                CALL        FILL_CHRCOL_RECT
   719  0d26  0e04                  LD          C,0x4
   720  0d28  21c835                LD          HL,DAT_ram_35c8                         ;= $60    `
   721  0d2b  3e0f                  LD          A,0xf                                   ;BLK on DKGRY
   722                                                                                  ;WAS BLK on DKBLU
   723                                                                                  ;WAS LD A, 0xb
   724  0d2d  c33909                JP          DRAW_CHRCOLS
   725                          DRAW_WALL_FR2_EMPTY:
   726  0d30  21c835                LD          HL,DAT_ram_35c8                         ;= $60    `
   727  0d33  010404                LD          BC,$404                                ;4 x 4 rectangle
   728  0d36  3e00                  LD          A,0x0                                   ;BLK on BLK
   729  0d38  c33609                JP          FILL_CHRCOL_RECT
   730                          DRAW_WALL_FR2:
   731  0d3b  3e0f                  LD          A,0xf                                   ;FR2 Bottom
   732                                                                                  ;BLK on DKGRY
   733                                                                                  ;WAS DKCYN on DKBLU
   734                                                                                  ;WAS LD A,$9b
   735  0d3d  f5                    PUSH        AF
   736  0d3e  3e0f                  LD          A,0xf                                   ;FR2 Wall
   737                                                                                  ;BLK on DKGRY
   738                                                                                  ;WAS BLK on DKBLU
   739                                                                                  ;WAS LD A,0xb
   740  0d40  f5                    PUSH        AF
   741  0d41  3ef0                  LD          A,$f0                                  ;FR2 Top
   742                                                                                  ;DKGRY on BLK
   743                                                                                  ;WAS DKBLU on CYN
   744                                                                                  ;WAS LD A,$b6
   745  0d43  217735                LD          HL,DAT_ram_3577                         ;= $60    `
   746  0d46  010402                LD          BC,$204                                ;2 x 4 rectangle
   747  0d49  cd5f0d                CALL        SUB_ram_cd07
   748  0d4c  216632                LD          HL,DAT_ram_3266                         ;= $20
   749  0d4f  3eda                  LD          A,$da                                  ;Left slash char
   750  0d51  77                    LD          (HL),A                    ;= $20
   751  0d52  19                    ADD         HL,DE
   752  0d53  77                    LD          (HL),A                    ;= $20
   753  0d54  217731                LD          HL,DAT_ram_3177                         ;= $20
   754  0d57  3ec0                  LD          A,$c0                                  ;Right angle char
   755  0d59  77                    LD          (HL),A                    ;= $20
   756  0d5a  1b                    DEC         DE
   757  0d5b  1b                    DEC         DE
   758  0d5c  19                    ADD         HL,DE
   759  0d5d  77                    LD          (HL),A                    ;= $20
   760  0d5e  c9                    RET
   761                          SUB_ram_cd07:
   762  0d5f  dde1                  POP         IX
   763  0d61  77                    LD          (HL),A
   764  0d62  112700                LD          DE,$27
   765  0d65  19                    ADD         HL,DE
   766  0d66  77                    LD          (HL),A
   767  0d67  23                    INC         HL
   768  0d68  f1                    POP         AF
   769  0d69  77                    LD          (HL),A
   770  0d6a  19                    ADD         HL,DE
   771  0d6b  13                    INC         DE
   772  0d6c  cd3909                CALL        DRAW_CHRCOLS
   773  0d6f  13                    INC         DE
   774  0d70  19                    ADD         HL,DE
   775  0d71  77                    LD          (HL),A
   776  0d72  2b                    DEC         HL
   777  0d73  f1                    POP         AF
   778  0d74  77                    LD          (HL),A
   779  0d75  19                    ADD         HL,DE
   780  0d76  77                    LD          (HL),A
   781  0d77  dde9                  JP          (IX)
   782                          SUB_ram_cd21:
   783  0d79  21c635                LD          HL,DAT_ram_35c6                         ;= $60    `
   784  0d7c  010402                LD          BC,$204                                ;2 x 4 rectangle
   785  0d7f  3e0f                  LD          A,0xf                                   ;BLK on DKGRY
   786                                                                                  ;WAS BLK on DKBLU
   787                                                                                  ;WAS LD A,0xb
   788  0d81  c33609                JP          FILL_CHRCOL_RECT
   789                          SUB_ram_cd2c:
   790  0d84  21c635                LD          HL,DAT_ram_35c6                         ;= $60    `
   791  0d87  010402                LD          BC,$204                                ;2 x 4 rectangle
   792  0d8a  3e00                  LD          A,0x0                                   ;BLK on BLK
   793  0d8c  c33609                JP          FILL_CHRCOL_RECT
   794  0d8f  3e08                  LD          A,0x8
   795  0d91  32b83a                LD          (SOUND_REPEAT_COUNT),A
   796  0d94  47                    LD          B,A
   797                          LAB_ram_cd3d:
   798  0d95  c5                    PUSH        BC
   799  0d96  cdb50e                CALL        SOUND_04
   800  0d99  cd400e                CALL        SUB_ram_cde7
   801  0d9c  cd8d0e                CALL        SOUND_02
   802  0d9f  cd790e                CALL        SOUND_01
   803  0da2  c1                    POP         BC
   804  0da3  10f0                  DJNZ        LAB_ram_cd3d
   805  0da5  c9                    RET
   806  0da6  3e07                  LD          A,0x7
   807  0da8  32b83a                LD          (SOUND_REPEAT_COUNT),A
   808  0dab  47                    LD          B,A
   809                          LAB_ram_cd54:
   810  0dac  c5                    PUSH        BC
   811  0dad  cd8d0e                CALL        SOUND_02
   812  0db0  cda10e                CALL        SOUND_03
   813  0db3  c1                    POP         BC
   814  0db4  10f6                  DJNZ        LAB_ram_cd54
   815  0db6  c9                    RET
   816                          SUB_ram_cd5f:
   817  0db7  3e0a                  LD          A,0xa
   818  0db9  32b83a                LD          (SOUND_REPEAT_COUNT),A
   819  0dbc  47                    LD          B,A
   820                          LAB_ram_cd65:
   821  0dbd  c5                    PUSH        BC
   822  0dbe  cdb50e                CALL        SOUND_04
   823  0dc1  cdc90e                CALL        SOUND_05
   824  0dc4  c1                    POP         BC
   825  0dc5  10f6                  DJNZ        LAB_ram_cd65
   826  0dc7  c3180e                JP          SUB_ram_cdbf
   827                          POOF_SOUND:
   828  0dca  3e07                  LD          A,0x7
   829  0dcc  32b83a                LD          (SOUND_REPEAT_COUNT),A
   830  0dcf  0601                  LD          B,0x1
   831  0dd1  c3da0d                JP          DOINK_SOUND
   832                          END_OF_GAME_SOUND:
   833  0dd4  3e04                  LD          A,0x4                                   ;Was LD A,0x7
   834  0dd6  32b83a                LD          (SOUND_REPEAT_COUNT),A
   835  0dd9  47                    LD          B,A
   836                          DOINK_SOUND:
   837  0dda  c5                    PUSH        BC
   838  0ddb  cd8d0e                CALL        SOUND_02
   839  0dde  cd400e                CALL        SUB_ram_cde7
   840  0de1  cda10e                CALL        SOUND_03
   841  0de4  c1                    POP         BC
   842  0de5  10f3                  DJNZ        DOINK_SOUND
   843  0de7  c9                    RET
   844  0de8  cd400e                CALL        SUB_ram_cde7
   845  0deb  cd400e                CALL        SUB_ram_cde7
   846  0dee  cd400e                CALL        SUB_ram_cde7
   847  0df1  cd400e                CALL        SUB_ram_cde7
   848  0df4  cd400e                CALL        SUB_ram_cde7
   849  0df7  cd400e                CALL        SUB_ram_cde7
   850  0dfa  cd400e                CALL        SUB_ram_cde7
   851  0dfd  cd400e                CALL        SUB_ram_cde7
   852  0e00  cd400e                CALL        SUB_ram_cde7
   853  0e03  cd400e                CALL        SUB_ram_cde7
   854  0e06  cd400e                CALL        SUB_ram_cde7
   855  0e09  cdc90e                CALL        SOUND_05
   856  0e0c  cdc90e                CALL        SOUND_05
   857  0e0f  cdc90e                CALL        SOUND_05
   858  0e12  cdc90e                CALL        SOUND_05
   859  0e15  c3c90e                JP          SOUND_05
   860                          SUB_ram_cdbf:
   861  0e18  3e00                  LD          A,0x0
   862  0e1a  f5                    PUSH        AF
   863  0e1b  014000                LD          BC,$40
   864  0e1e  111500                LD          DE,$15
   865  0e21  210004                LD          HL,$400
   866  0e24  3e00                  LD          A,0x0
   867  0e26  32b53a                LD          (PITCH_UP_BOOL),A
   868  0e29  c3dd0e                JP          PLAY_PITCH_CHANGE
   869                          SUB_ram_cdd3:
   870  0e2c  3e00                  LD          A,0x0
   871  0e2e  f5                    PUSH        AF
   872  0e2f  01a000                LD          BC,$a0
   873  0e32  110800                LD          DE,0x8
   874  0e35  210008                LD          HL,$800
   875  0e38  3e00                  LD          A,0x0
   876  0e3a  32b53a                LD          (PITCH_UP_BOOL),A
   877  0e3d  c3dd0e                JP          PLAY_PITCH_CHANGE
   878                          SUB_ram_cde7:
   879  0e40  3e00                  LD          A,0x0
   880  0e42  f5                    PUSH        AF
   881  0e43  01a000                LD          BC,$a0
   882  0e46  110100                LD          DE,0x1
   883  0e49  210200                LD          HL,0x2
   884  0e4c  3e00                  LD          A,0x0
   885  0e4e  32b53a                LD          (PITCH_UP_BOOL),A
   886  0e51  c3dd0e                JP          PLAY_PITCH_CHANGE
   887                          SETUP_OPEN_DOOR_SOUND:
   888  0e54  110f00                LD          DE,0xf
   889  0e57  218005                LD          HL,$580
   890                          LO_HI_PITCH_SOUND:
   891  0e5a  010800                LD          BC,0x8
   892  0e5d  3e00                  LD          A,0x0
   893  0e5f  f5                    PUSH        AF
   894  0e60  3e01                  LD          A,0x1
   895  0e62  32b53a                LD          (PITCH_UP_BOOL),A
   896  0e65  c3dd0e                JP          PLAY_PITCH_CHANGE
   897                          SETUP_CLOSE_DOOR_SOUND:
   898  0e68  210500                LD          HL,0x5
   899  0e6b  110c00                LD          DE,0xc
   900                          HI_LO_PITCH_SOUND:
   901  0e6e  010e00                LD          BC,0xe                                  ;H
   902  0e71  af                    XOR         A
   903  0e72  f5                    PUSH        AF
   904  0e73  32b53a                LD          (PITCH_UP_BOOL),A
   905  0e76  c3dd0e                JP          PLAY_PITCH_CHANGE
   906                          SOUND_01:
   907  0e79  3e00                  LD          A,0x0
   908  0e7b  f5                    PUSH        AF
   909  0e7c  013000                LD          BC,$30
   910  0e7f  110200                LD          DE,0x2
   911  0e82  210001                LD          HL,$100
   912  0e85  3e01                  LD          A,0x1
   913  0e87  32b53a                LD          (PITCH_UP_BOOL),A
   914  0e8a  c3dd0e                JP          PLAY_PITCH_CHANGE
   915                          SOUND_02:
   916  0e8d  3e00                  LD          A,0x0
   917  0e8f  f5                    PUSH        AF
   918  0e90  011a00                LD          BC,$1a
   919  0e93  111000                LD          DE,$10
   920  0e96  210003                LD          HL,$300
   921  0e99  3e01                  LD          A,0x1
   922  0e9b  32b53a                LD          (PITCH_UP_BOOL),A
   923  0e9e  c3dd0e                JP          PLAY_PITCH_CHANGE
   924                          SOUND_03:
   925  0ea1  3e00                  LD          A,0x0
   926  0ea3  f5                    PUSH        AF
   927  0ea4  012a00                LD          BC,$2a
   928  0ea7  110a00                LD          DE,0xa
   929  0eaa  210400                LD          HL,0x4
   930  0ead  3e00                  LD          A,0x0
   931  0eaf  32b53a                LD          (PITCH_UP_BOOL),A
   932  0eb2  c3dd0e                JP          PLAY_PITCH_CHANGE
   933                          SOUND_04:
   934  0eb5  3e00                  LD          A,0x0
   935  0eb7  f5                    PUSH        AF
   936  0eb8  012000                LD          BC,$20
   937  0ebb  110200                LD          DE,0x2
   938  0ebe  215500                LD          HL,$55
   939  0ec1  3e01                  LD          A,0x1
   940  0ec3  32b53a                LD          (PITCH_UP_BOOL),A
   941  0ec6  c3dd0e                JP          PLAY_PITCH_CHANGE
   942                          SOUND_05:
   943  0ec9  3e00                  LD          A,0x0
   944  0ecb  f5                    PUSH        AF
   945  0ecc  013000                LD          BC,$30
   946  0ecf  110100                LD          DE,0x1
   947  0ed2  210100                LD          HL,0x1
   948  0ed5  3e00                  LD          A,0x0
   949  0ed7  32b53a                LD          (PITCH_UP_BOOL),A
   950  0eda  c3dd0e                JP          PLAY_PITCH_CHANGE
   951                          PLAY_PITCH_CHANGE:
   952  0edd  22b33a                LD          (SND_CYCLE_HOLDER),HL
   953                          PLAY_PITCH_CHANGE_LOOP:
   954  0ee0  2b                    DEC         HL
   955  0ee1  7c                    LD          A,H
   956  0ee2  b5                    OR          L                                       ;Clear flags
   957  0ee3  c2e00e                JP          NZ,PLAY_PITCH_CHANGE_LOOP
   958  0ee6  f1                    POP         AF
   959  0ee7  d3fc                  OUT         (SPEAKER),A                             ;= db
   960  0ee9  ee01                  XOR         0x1
   961  0eeb  f5                    PUSH        AF
   962  0eec  0b                    DEC         BC
   963  0eed  78                    LD          A,B
   964  0eee  b1                    OR          C
   965  0eef  c2f70e                JP          NZ,INCREASE_PITCH
   966  0ef2  f1                    POP         AF
   967  0ef3  2ab33a                LD          HL,(SND_CYCLE_HOLDER)
   968  0ef6  c9                    RET
   969                          INCREASE_PITCH:
   970  0ef7  21b53a                LD          HL,PITCH_UP_BOOL
   971  0efa  cb46                  BIT         0x0,(HL)
   972  0efc  ca070f                JP          Z,DECREASE_PITCH
   973  0eff  2ab33a                LD          HL,(SND_CYCLE_HOLDER)
   974  0f02  ed52                  SBC         HL,DE
   975  0f04  c3dd0e                JP          PLAY_PITCH_CHANGE
   976                          DECREASE_PITCH:
   977  0f07  2ab33a                LD          HL,(SND_CYCLE_HOLDER)
   978  0f0a  19                    ADD         HL,DE
   979  0f0b  c3dd0e                JP          PLAY_PITCH_CHANGE
   980                          HC_JOY_INPUT_COMPARE:
   981  0f0e  3a663a                LD          A,(RAM_AE)
   982  0f11  fe31                  CP          $31                                    ;Compare to "1" db?
   983  0f13  c29f2a                JP          NZ,WAIT_FOR_INPUT
   984  0f16  2afe37                LD          HL,(HC_INPUT_HOLDER)                    ;= $6060
   985  0f19  3ef3                  LD          A,$f3                                  ;Compare to JOY disc UUL
   986  0f1b  bd                    CP          L
   987  0f1c  ca9e21                JP          Z,DO_MOVE_FW_CHK_WALLS
   988  0f1f  bc                    CP          H
   989  0f20  ca9e21                JP          Z,DO_MOVE_FW_CHK_WALLS
   990  0f23  3efb                  LD          A,$fb                                  ;Compare to JOY disc UP
   991  0f25  bd                    CP          L
   992  0f26  ca9e21                JP          Z,DO_MOVE_FW_CHK_WALLS
   993  0f29  bc                    CP          H
   994  0f2a  ca9e21                JP          Z,DO_MOVE_FW_CHK_WALLS
   995  0f2d  3eeb                  LD          A,$eb                                  ;Compare to JOY disc UUR
   996  0f2f  bc                    CP          H
   997  0f30  ca9e21                JP          Z,DO_MOVE_FW_CHK_WALLS
   998  0f33  bd                    CP          L
   999  0f34  ca9e21                JP          Z,DO_MOVE_FW_CHK_WALLS
  1000  0f37  3ee9                  LD          A,$e9                                  ;Compare to JOY disc UR
  1001  0f39  bd                    CP          L
  1002  0f3a  ca182e                JP          Z,DO_TURN_RIGHT
  1003  0f3d  bc                    CP          H
  1004  0f3e  ca182e                JP          Z,DO_TURN_RIGHT
  1005  0f41  3ef9                  LD          A,$f9                                  ;Compare to JOY disc RUR
  1006  0f43  bd                    CP          L
  1007  0f44  ca182e                JP          Z,DO_TURN_RIGHT
  1008  0f47  bc                    CP          H
  1009  0f48  ca182e                JP          Z,DO_TURN_RIGHT
  1010  0f4b  3efd                  LD          A,$fd                                  ;Compare to JOY disc RIGHT
  1011  0f4d  bd                    CP          L
  1012  0f4e  ca182e                JP          Z,DO_TURN_RIGHT
  1013  0f51  bc                    CP          H
  1014  0f52  ca182e                JP          Z,DO_TURN_RIGHT
  1015  0f55  3ee7                  LD          A,$e7                                  ;Compare to JOY disc LUL
  1016  0f57  bd                    CP          L
  1017  0f58  ca002e                JP          Z,DO_TURN_LEFT
  1018  0f5b  bc                    CP          H
  1019  0f5c  ca002e                JP          Z,DO_TURN_LEFT
  1020  0f5f  3ee3                  LD          A,$e3                                  ;Compare to JOY disc UL
  1021  0f61  bd                    CP          L
  1022  0f62  ca002e                JP          Z,DO_TURN_LEFT
  1023  0f65  bc                    CP          H
  1024  0f66  ca002e                JP          Z,DO_TURN_LEFT
  1025  0f69  3ef7                  LD          A,$f7                                  ;Compare to JOY disc LEFT
  1026  0f6b  bd                    CP          L
  1027  0f6c  ca002e                JP          Z,DO_TURN_LEFT
  1028  0f6f  bc                    CP          H
  1029  0f70  ca002e                JP          Z,DO_TURN_LEFT
  1030  0f73  3ef6                  LD          A,$f6                                  ;Compare to JOY disc LDL
  1031  0f75  bd                    CP          L
  1032  0f76  ca482e                JP          Z,DO_GLANCE_LEFT
  1033  0f79  bc                    CP          H
  1034  0f7a  ca482e                JP          Z,DO_GLANCE_LEFT
  1035  0f7d  3ee6                  LD          A,$e6                                  ;Compare to JOY disc DL
  1036  0f7f  bd                    CP          L
  1037  0f80  ca482e                JP          Z,DO_GLANCE_LEFT
  1038  0f83  bc                    CP          H
  1039  0f84  ca482e                JP          Z,DO_GLANCE_LEFT
  1040  0f87  3eed                  LD          A,$ed                                  ;Compare to JOY disc RDR
  1041  0f89  bd                    CP          L
  1042  0f8a  ca322e                JP          Z,DO_GLANCE_RIGHT
  1043  0f8d  bc                    CP          H
  1044  0f8e  ca322e                JP          Z,DO_GLANCE_RIGHT
  1045  0f91  3eec                  LD          A,$ec                                  ;Compare to JOY disc DR
  1046  0f93  bd                    CP          L
  1047  0f94  ca322e                JP          Z,DO_GLANCE_RIGHT
  1048  0f97  bc                    CP          H
  1049  0f98  ca322e                JP          Z,DO_GLANCE_RIGHT
  1050  0f9b  3efc                  LD          A,$fc                                  ;Compare to JOY disc DDR
  1051  0f9d  bd                    CP          L
  1052  0f9e  cad021                JP          Z,DO_JUMP_BACK
  1053  0fa1  bc                    CP          H
  1054  0fa2  cad021                JP          Z,DO_JUMP_BACK
  1055  0fa5  3efe                  LD          A,$fe                                  ;Compare to JOY disc DOWN
  1056  0fa7  bd                    CP          L
  1057  0fa8  cad021                JP          Z,DO_JUMP_BACK
  1058  0fab  bc                    CP          H
  1059  0fac  cad021                JP          Z,DO_JUMP_BACK
  1060  0faf  3eee                  LD          A,$ee                                  ;Compare to JOY disc DDL
  1061  0fb1  bd                    CP          L
  1062  0fb2  cad021                JP          Z,DO_JUMP_BACK
  1063  0fb5  bc                    CP          H
  1064  0fb6  cad021                JP          Z,DO_JUMP_BACK
  1065  0fb9  3edf                  LD          A,$df                                  ;Compare to JOY K4
  1066  0fbb  bd                    CP          L
  1067  0fbc  ca1c11                JP          Z,TOGGLE_SHIFT_MODE
  1068  0fbf  bc                    CP          H
  1069  0fc0  ca1c11                JP          Z,TOGGLE_SHIFT_MODE
  1070  0fc3  3ab93a                LD          A,(GAME_BOOLEANS)
  1071  0fc6  cb4f                  BIT         0x1,A
  1072  0fc8  c20010                JP          NZ,DO_HC_SHIFT_ACTIONS
  1073                          DO_HC_BUTTON_ACTIONS:
  1074  0fcb  3ebf                  LD          A,$bf                                  ;Compare to JOY K1
  1075  0fcd  bd                    CP          L
  1076  0fce  ca5e2e                JP          Z,DO_USE_ATTACK
  1077  0fd1  bc                    CP          H
  1078  0fd2  ca5e2e                JP          Z,DO_USE_ATTACK
  1079  0fd5  3e7b                  LD          A,$7b                                  ;Compare to JOY K2
  1080  0fd7  bd                    CP          L
  1081  0fd8  cadb2c                JP          Z,DO_OPEN_CLOSE
  1082  0fdb  bc                    CP          H
  1083  0fdc  cadb2c                JP          Z,DO_OPEN_CLOSE
  1084  0fdf  3e5f                  LD          A,$5f                                  ;Compare to JOY K3
  1085  0fe1  bd                    CP          L
  1086  0fe2  cacc27                JP          Z,DO_PICK_UP
  1087  0fe5  bc                    CP          H
  1088  0fe6  cacc27                JP          Z,DO_PICK_UP
  1089  0fe9  3e7d                  LD          A,$7d                                  ;Compare to JOY K5
  1090  0feb  bd                    CP          L
  1091  0fec  ca682a                JP          Z,DO_SWAP_PACK
  1092  0fef  bc                    CP          H
  1093  0ff0  ca682a                JP          Z,DO_SWAP_PACK
  1094  0ff3  3e7e                  LD          A,$7e                                  ;Compare to JOY K6
  1095  0ff5  bd                    CP          L
  1096  0ff6  caf829                JP          Z,DO_ROTATE_PACK
  1097  0ff9  bc                    CP          H
  1098  0ffa  caf829                JP          Z,DO_ROTATE_PACK
  1099  0ffd  c33022                JP          NO_ACTION_TAKEN
  1100                          DO_HC_SHIFT_ACTIONS:
  1101  1000  3ebf                  LD          A,$bf                                  ;Compare to JOY K1
  1102  1002  bd                    CP          L
  1103  1003  caa332                JP          Z,DO_USE_LADDER
  1104  1006  bc                    CP          H
  1105  1007  caa332                JP          Z,DO_USE_LADDER
  1106  100a  3e7b                  LD          A,$7b                                  ;Compare to JOY K2
  1107  100c  bd                    CP          L
  1108  100d  ca1422                JP          Z,DO_COUNT_FOOD
  1109  1010  bc                    CP          H
  1110  1011  ca1422                JP          Z,DO_COUNT_FOOD
  1111  1014  3e5f                  LD          A,$5f                                  ;Compare to JOY K3
  1112  1016  bd                    CP          L
  1113  1017  ca2b22                JP          Z,DO_COUNT_ARROWS
  1114  101a  bc                    CP          H
  1115  101b  ca2b22                JP          Z,DO_COUNT_ARROWS
  1116  101e  3e7d                  LD          A,$7d                                  ;Compare to JOY K5
  1117  1020  bd                    CP          L
  1118  1021  cacc26                JP          Z,DO_SWAP_HANDS
  1119  1024  bc                    CP          H
  1120  1025  cacc26                JP          Z,DO_SWAP_HANDS
  1121  1028  3e7e                  LD          A,$7e                                  ;Compare to JOY K6
  1122  102a  bd                    CP          L
  1123  102b  ca6b3b                JP          Z,DO_REST
  1124  102e  bc                    CP          H
  1125  102f  ca6b3b                JP          Z,DO_REST
  1126  1032  3ecc                  LD          A,$cc                                  ;Compare to K4 + DR chord
  1127  1034  bd                    CP          L
  1128  1035  caee3c                JP          Z,MAX_HEALTH_ARROWS_FOOD
  1129  1038  bc                    CP          H
  1130  1039  caee3c                JP          Z,MAX_HEALTH_ARROWS_FOOD
  1131  103c  3ec6                  LD          A,$c6                                  ;Compare to K4 + DL chord
  1132  103e  bd                    CP          L
  1133  103f  ca303d                JP          Z,DO_TELEPORT
  1134  1042  bc                    CP          H
  1135  1043  ca303d                JP          Z,DO_TELEPORT
  1136  1046  c33022                JP          NO_ACTION_TAKEN
  1137                          DRAW_BKGD:
  1138  1049  3e20                  LD          A,$20                                  ;Set VIEWPORT fill chars to SPACE
  1139  104b  212830                LD          HL,$3028
  1140  104e  011818                LD          BC,$1818                               ;24 x 24 cells
  1141  1051  cd3609                CALL        FILL_CHRCOL_RECT
  1142  1054  0e08                  LD          C,0x8                                   ;8 rows of ceiling
  1143  1056  212834                LD          HL,$3428
  1144  1059  3ef0                  LD          A,$f0                                  ;DKGRY on BLK
  1145  105b  cd3909                CALL        DRAW_CHRCOLS
  1146  105e  0e06                  LD          C,0x6                                   ;6 more rows of ceiling
  1147  1060  19                    ADD         HL,DE
  1148  1061  3e00                  LD          A,0x0                                   ;BLK on BLK
  1149  1063  cd3909                CALL        DRAW_CHRCOLS
  1150  1066  0e0a                  LD          C,0xa                                   ;10 rows of floor
  1151  1068  19                    ADD         HL,DE
  1152  1069  3edf                  LD          A,$df                                  ;DKGRN on DKGRY
  1153  106b  cd3909                CALL        DRAW_CHRCOLS
  1154  106e  3aa33a                LD          A,(CURR_MONSTER_PHYS)
  1155  1071  fe00                  CP          0x0
  1156  1073  ca8210                JP          Z,NOT_IN_BATTLE
  1157  1076  3aa23a                LD          A,(CURR_MONSTER_SPRT)
  1158  1079  fe00                  CP          0x0
  1159  107b  ca8210                JP          Z,NOT_IN_BATTLE
  1160  107e  cd6932                CALL        REDRAW_MONSTER_HEALTH
  1161  1081  c9                    RET
  1162                          NOT_IN_BATTLE:
  1163  1082  c9                    RET
  1164                          WIPE_VARIABLE_SPACE:
  1165  1083  3e00                  LD          A,0x0
  1166  1085  210039                LD          HL,$3900
  1167  1088  06ff                  LD          B,$ff
  1168                          CLEAR_MAP_SPACE:
  1169  108a  77                    LD          (HL),A
  1170  108b  23                    INC         HL
  1171  108c  77                    LD          (HL),A
  1172  108d  23                    INC         HL
  1173  108e  77                    LD          (HL),A
  1174  108f  23                    INC         HL
  1175  1090  10f8                  DJNZ        CLEAR_MAP_SPACE
  1176  1092  21623a                LD          HL,$3a62
  1177  1095  22ba3a                LD          (NEXT_BLINK_CHECK),HL
  1178  1098  c9                    RET
  1179                          DRAW_WHITE_MAP:
  1180  1099  217400                LD          HL,$74
  1181  109c  cd1523                CALL        MAP_ITEM_MONSTER
  1182                          UPDATE_ITEM_CELLS:
  1183  109f  ca9422                JP          Z,DRAW_PURPLE_MAP
  1184  10a2  0a                    LD          A,(BC)
  1185  10a3  0c                    INC         C
  1186  10a4  0c                    INC         C
  1187  10a5  d9                    EXX
  1188  10a6  16b6                  LD          D,$b6
  1189  10a8  cd2723                CALL        UPDATE_COLRAM_FROM_OFFSET
  1190  10ab  d9                    EXX
  1191  10ac  cd1823                CALL        FIND_NEXT_ITEM_MONSTER_LOOP
  1192  10af  c39f10                JP          UPDATE_ITEM_CELLS
  1193  10b2  c39422                JP          DRAW_PURPLE_MAP
  1194                          PLAY_POOF_ANIM:
  1195  10b5  e5                    PUSH        HL                                      ;Save HL register value
  1196  10b6  11a607                LD          DE,POOF_1                               ;DE = Start of POOF animation graphic
  1197  10b9  0670                  LD          B,$70                                  ;Set color to WHT on BLK
  1198  10bb  d9                    EXX                                                 ;Swap BC DE HL with BC' DE' HL'
  1199  10bc  cdca0d                CALL        POOF_SOUND
  1200  10bf  d9                    EXX                                                 ;Swap BC DE HL with BC' DE' HL'
  1201  10c0  cd3533                CALL        GFX_DRAW
  1202  10c3  e1                    POP         HL                  ;Restore DE register value
  1203  10c4  cdf410                CALL        TOGGLE_ITEM_POOF_AND_WAIT
  1204  10c7  e5                    PUSH        HL
  1205  10c8  cd3533                CALL        GFX_DRAW
  1206  10cb  e1                    POP         HL
  1207  10cc  d5                    PUSH        DE
  1208  10cd  112900                LD          DE,$29
  1209  10d0  ed52                  SBC         HL,DE
  1210  10d2  d1                    POP         DE                              ;= $D7,$C9,$01
  1211  10d3  cdf410                CALL        TOGGLE_ITEM_POOF_AND_WAIT
  1212  10d6  e5                    PUSH        HL
  1213  10d7  cd3533                CALL        GFX_DRAW
  1214  10da  e1                    POP         HL
  1215  10db  e5                    PUSH        HL
  1216  10dc  0680                  LD          B,$80
  1217  10de  cd3533                CALL        GFX_DRAW
  1218  10e1  cdf410                CALL        TOGGLE_ITEM_POOF_AND_WAIT
  1219  10e4  e1                    POP         HL
  1220  10e5  e5                    PUSH        HL
  1221  10e6  cd3533                CALL        GFX_DRAW
  1222  10e9  cdf410                CALL        TOGGLE_ITEM_POOF_AND_WAIT
  1223  10ec  06d0                  LD          B,$d0
  1224  10ee  e1                    POP         HL
  1225  10ef  cd3533                CALL        GFX_DRAW
  1226  10f2  08                    EX          AF,AF'
  1227  10f3  c9                    RET
  1228                          TOGGLE_ITEM_POOF_AND_WAIT:
  1229  10f4  d9                    EXX
  1230  10f5  010032                LD          BC,DAT_ram_3200                         ;= $20
  1231  10f8  cd4b1d                CALL        SLEEP                                   ;byte SLEEP(short cycleCount)
  1232  10fb  d9                    EXX
  1233  10fc  c9                    RET
  1234                          MONSTER_KILLED:
  1235  10fd  213b32                LD          HL,CHRRAM_MONSTER_POOF_IDX              ;= $20
  1236  1100  cdb510                CALL        PLAY_POOF_ANIM
  1237  1103  3a793a                LD          A,(PLAYER_MAP_POS)                      ;A  = Player position in map
  1238  1106  2a603a                LD          HL,(DIR_FACING_FW)                      ;HL = FW adjustment value
  1239  1109  84                    ADD         A,H                                     ;A  = Player position in map
  1240                                                                                  ;one step forward
  1241  110a  cdf337                CALL        ITEM_MAP_CHECK                          ;Upon return,
  1242                                                                                  ;A  = itemNum one step forward
  1243                                                                                  ;BC = itemMapRAMLocation
  1244  110d  fe9f                  CP          $9f                                    ;Check to see if it is
  1245                                                                                  ;the Minotaur ($9f)
  1246  110f  caf43a                JP          Z,MINOTAUR_DEAD
  1247  1112  3efe                  LD          A,$fe                                  ;A  = $fe (empty item space)
  1248  1114  02                    LD          (BC),A                                  ;itemMapLocRAM = $fe (empty)
  1249  1115  cdab25                CALL        CLEAR_MONSTER_STATS
  1250  1118  e1                    POP         HL
  1251  1119  c3962a                JP          UPDATE_VIEWPORT
  1252                          TOGGLE_SHIFT_MODE:
  1253  111c  3ab93a                LD          A,(GAME_BOOLEANS)
  1254  111f  cb4f                  BIT         0x1,A                                   ;NZ if SHIFT MODE
  1255  1121  c23111                JP          NZ,RESET_SHIFT_MODE
  1256                          SET_SHIFT_MODE:
  1257  1124  cbcf                  SET         0x1,A                                   ;Set SHIFT MODE boolean
  1258  1126  32b93a                LD          (GAME_BOOLEANS),A
  1259  1129  3ed0                  LD          A,$d0                                  ;DKGRN on BLK
  1260  112b  320534                LD          (COLRAM_SHIFT_MODE_IDX),A               ;= $60    `
  1261  112e  c39c2a                JP          INPUT_DEBOUNCE
  1262                          RESET_SHIFT_MODE:
  1263  1131  3ab93a                LD          A,(GAME_BOOLEANS)                       ;Reset SHIFT MODE boolean
  1264  1134  cb8f                  RES         0x1,A
  1265  1136  32b93a                LD          (GAME_BOOLEANS),A
  1266  1139  3ef0                  LD          A,$f0
  1267  113b  320534                LD          (COLRAM_SHIFT_MODE_IDX),A               ;= $60    `
  1268  113e  c39c2a                JP          INPUT_DEBOUNCE
  1269                          SHOW_AUTHOR:
  1270  1141  214833                LD          HL,CHRRAM_AUTHORS_IDX                   ;= $20
  1271  1144  11f707                LD          DE,AUTHORS                              ;= "   Originally programmed by Tom L...
  1272  1147  0620                  LD          B,$20
  1273  1149  cd3533                CALL        GFX_DRAW
  1274  114c  3eff                  LD          A,$ff
  1275  114e  c39f2a                JP          WAIT_FOR_INPUT
  1276                          TIMER_UPDATE:
  1277  1151  2a693a                LD          HL,(TIMER_A)
  1278  1154  010100                LD          BC,0x1
  1279  1157  09                    ADD         HL,BC
  1280  1158  22693a                LD          (TIMER_A),HL
  1281  115b  c9                    RET
  1282                          BLINK_ROUTINE:
  1283  115c  f5                    PUSH        AF
  1284  115d  3ab93a                LD          A,(GAME_BOOLEANS)
  1285  1160  cb47                  BIT         0x0,A
  1286  1162  ca6d11                JP          Z,STILL_ON_TITLE
  1287  1165  c36b11                JP          BLINK_EXIT_AF
  1288                          BLINK_EXIT_ALL:
  1289  1168  d1                    POP         DE
  1290  1169  e1                    POP         HL
  1291                          BLINK_EXIT_BCAF:
  1292  116a  c1                    POP         BC
  1293                          BLINK_EXIT_AF:
  1294  116b  f1                    POP         AF
  1295  116c  c9                    RET
  1296                          STILL_ON_TITLE:
  1297  116d  c5                    PUSH        BC
  1298  116e  3a6a3a                LD          A,(TIMER_B)
  1299  1171  47                    LD          B,A
  1300  1172  3aba3a                LD          A,(NEXT_BLINK_CHECK)
  1301  1175  b8                    CP          B
  1302  1176  c26a11                JP          NZ,BLINK_EXIT_BCAF
  1303  1179  ed5f                  LD          A,R
  1304  117b  32ba3a                LD          (NEXT_BLINK_CHECK),A
  1305  117e  e5                    PUSH        HL
  1306  117f  d5                    PUSH        DE
  1307  1180  cda611                CALL        DO_CLOSE_EYES
  1308  1183  010080                LD          BC,$8000
  1309  1186  cd4b1d                CALL        SLEEP                                   ;byte SLEEP(short cycleCount)
  1310  1189  cd8f11                CALL        DO_OPEN_EYES
  1311  118c  c36811                JP          BLINK_EXIT_ALL
  1312                          DO_OPEN_EYES:
  1313  118f  11d632                LD          DE,$32d6
  1314  1192  210000                LD          HL,TS_EYES_OPEN_CHR                    ; Pinned to TITLE_SCREEN (0xD800) + 726; WAS 0xdad6
  1315  1195  014400                LD          BC,$44
  1316  1198  edb0                  LDIR
  1317  119a  11d636                LD          DE,$36d6
  1318  119d  210000                LD          HL,TS_EYES_OPTN_COL                    ; Pinned to TITLE_SCREEN (0XD800) + 1750; WAS 0xded6
  1319  11a0  014400                LD          BC,$44
  1320  11a3  edb0                  LDIR
  1321  11a5  c9                    RET
  1322                          DO_CLOSE_EYES:
  1323  11a6  21d632                LD          HL,$32d6
  1324  11a9  01d0d1                LD          BC,$d1d0                    ; Value, not an address
  1325  11ac  70                    LD          (HL),B
  1326  11ad  23                    INC         HL
  1327  11ae  70                    LD          (HL),B
  1328  11af  111a00                LD          DE,$1a
  1329  11b2  19                    ADD         HL,DE
  1330  11b3  70                    LD          (HL),B
  1331  11b4  2b                    DEC         HL
  1332  11b5  70                    LD          (HL),B
  1333  11b6  21fe32                LD          HL,$32fe
  1334  11b9  71                    LD          (HL),C
  1335  11ba  23                    INC         HL
  1336  11bb  70                    LD          (HL),B
  1337  11bc  19                    ADD         HL,DE
  1338  11bd  70                    LD          (HL),B
  1339  11be  2b                    DEC         HL
  1340  11bf  71                    LD          (HL),C
  1341  11c0  21d636                LD          HL,$36d6
  1342  11c3  010ff0                LD          BC,$f00f                    ; Value, not an address
  1343  11c6  70                    LD          (HL),B
  1344  11c7  23                    INC         HL
  1345  11c8  71                    LD          (HL),C
  1346  11c9  19                    ADD         HL,DE
  1347  11ca  71                    LD          (HL),C
  1348  11cb  2b                    DEC         HL
  1349  11cc  70                    LD          (HL),B
  1350  11cd  21fe36                LD          HL,$36fe
  1351  11d0  70                    LD          (HL),B
  1352  11d1  23                    INC         HL
  1353  11d2  70                    LD          (HL),B
  1354  11d3  19                    ADD         HL,DE
  1355  11d4  70                    LD          (HL),B
  1356  11d5  2b                    DEC         HL
  1357  11d6  70                    LD          (HL),B
  1358  11d7  c9                    RET
  1359                          DRAW_ICON_BAR:
  1360  11d8  f5                    PUSH        AF
  1361  11d9  e5                    PUSH        HL
  1362  11da  210130                LD          HL,CHRRAM_LEVEL_IND_L                   ;= $20
  1363  11dd  3685                  LD          (HL),$85           ;Right side halftone CHR
  1364  11df  23                    INC         HL
  1365  11e0  23                    INC         HL
  1366  11e1  23                    INC         HL
  1367  11e2  3695                  LD          (HL),$95           ;Left side halftone CHR
  1368  11e4  23                    INC         HL
  1369  11e5  3608                  LD          (HL),0x8         ;Up arrow CHR
  1370  11e7  23                    INC         HL
  1371  11e8  23                    INC         HL
  1372  11e9  3648                  LD          (HL),$48            ;Ladder (H) CHR
  1373  11eb  23                    INC         HL
  1374  11ec  23                    INC         HL
  1375  11ed  36d3                  LD          (HL),$d3              ;Item CHR
  1376  11ef  23                    INC         HL
  1377  11f0  23                    INC         HL
  1378  11f1  3693                  LD          (HL),$93           ;Monster CHR
  1379  11f3  23                    INC         HL
  1380  11f4  23                    INC         HL
  1381  11f5  3685                  LD          (HL),$85              ;Right side halftone CHR
  1382  11f7  23                    INC         HL
  1383  11f8  23                    INC         HL
  1384  11f9  23                    INC         HL
  1385  11fa  23                    INC         HL                                      ;Map CHR
  1386  11fb  36d1                  LD          (HL),$d1               ;= $20
  1387  11fd  23                    INC         HL
  1388  11fe  23                    INC         HL                                      ;Armor CHR
  1389  11ff  369d                  LD          (HL),$9d             ;= $20
  1390  1201  23                    INC         HL
  1391  1202  23                    INC         HL                                      ;Helmet CHR
  1392  1203  360e                  LD          (HL),0xe             ;= $20
  1393  1205  23                    INC         HL
  1394  1206  23                    INC         HL                                      ;Ring (o) CHR
  1395  1207  366f                  LD          (HL),$6f              ;= $20
  1396  1209  e1                    POP         HL
  1397  120a  f1                    POP         AF
  1398  120b  c9                    RET
  1399                          DRAW_COMPASS:
  1400  120c  f5                    PUSH        AF                                      ;DKBLU on BLK
  1401  120d  c5                    PUSH        BC
  1402  120e  e5                    PUSH        HL
  1403  120f  d5                    PUSH        DE
  1404  1210  06b0                  LD          B,$b0
  1405  1212  21af31                LD          HL,DAT_ram_31af                         ;= $20
  1406  1215  119a07                LD          DE,COMPASS                              ;= $D7,"n",$C9,$01
  1407  1218  cd3533                CALL        GFX_DRAW
  1408  121b  21d835                LD          HL,DAT_ram_35d8                         ;= $60
  1409  121e  3610                  LD          (HL),$10                 ;= $60
  1410  1220  d1                    POP         DE
  1411  1221  e1                    POP         HL
  1412  1222  c1                    POP         BC
  1413  1223  f1                    POP         AF
  1414  1224  c9                    RET
  1415                          WIPE_WALLS:
  1416  1225  f5                    PUSH        AF
  1417  1226  c5                    PUSH        BC
  1418  1227  e5                    PUSH        HL
  1419  1228  210038                LD          HL,$3800
  1420  122b  010000                LD          BC,0x0
  1421  122e  3e00                  LD          A,0x0
  1422                          WIPE_WALLS_LOOP:
  1423  1230  77                    LD          (HL),A
  1424  1231  23                    INC         HL
  1425  1232  10fc                  DJNZ        WIPE_WALLS_LOOP
  1426  1234  e1                    POP         HL
  1427  1235  c1                    POP         BC
  1428  1236  f1                    POP         AF
  1429  1237  cd962a                CALL        UPDATE_VIEWPORT
  1430  123a  c39c2a                JP          INPUT_DEBOUNCE
  1431                          DRAW_WALL_FL22_EMPTY:
  1432  123d  21b835                LD          HL,COLRAM_FL22_WALL_IDX                 ;= $60    `
  1433  1240  010404                LD          BC,$404                                ;4 x 4 rectangle
  1434  1243  3e00                  LD          A,0x0                                   ;BLK on BLK
  1435  1245  cd3609                CALL        FILL_CHRCOL_RECT
  1436  1248  213032                LD          HL,DAT_ram_3230                         ;= $20
  1437  124b  010104                LD          BC,$401                                ;4 x 1 rectangle
  1438  124e  3e20                  LD          A,$20                                  ;SPACE char
  1439  1250  c33609                JP          FILL_CHRCOL_RECT
  1440                          DRAW_WALL_FL2_NEW:
  1441  1253  213432                LD          HL,$3234                               ;Bottom CHARRAM IDX of FL2
  1442  1256  010104                LD          BC,$401                                ;4 x 1 rectangle
  1443  1259  3e90                  LD          A,$90                                  ;Thin base line char
  1444  125b  cd3609                CALL        FILL_CHRCOL_RECT
  1445  125e  21bc35                LD          HL,$35bc
  1446  1261  010402                LD          BC,$204                                ;2 x 4 rectangle
  1447  1264  3e0f                  LD          A,0xf                                   ;BLK on DKGRY
  1448  1266  cd3609                CALL        FILL_CHRCOL_RECT
  1449  1269  0e04                  LD          C,0x4
  1450  126b  21be35                LD          HL,$35be
  1451  126e  3e0f                  LD          A,0xf
  1452  1270  c33909                JP          DRAW_CHRCOLS
  1453                          FIX_ICON_COLORS:
  1454  1273  210134                LD          HL,COLRAM_LEVEL_IDX_L                   ;= $60
  1455  1276  3a6c3a                LD          A,(INPUT_HOLDER)
  1456  1279  87                    ADD         A,A
  1457  127a  d601                  SUB         0x1
  1458  127c  77                    LD          (HL),A              ;= $60
  1459  127d  2c                    INC         L
  1460  127e  77                    LD          (HL),A             ;= $60
  1461  127f  2c                    INC         L
  1462  1280  77                    LD          (HL),A              ;= $60
  1463  1281  2c                    INC         L
  1464  1282  77                    LD          (HL),A              ;= $60
  1465  1283  210534                LD          HL,COLRAM_SHIFT_MODE_IDX                ;= $60    `
  1466  1286  010013                LD          BC,$1300
  1467  1289  2b                    DEC         HL
  1468                          ICON_GREY_FILL_LOOP:
  1469  128a  23                    INC         HL
  1470  128b  36f0                  LD          (HL),$f0
  1471  128d  10fb                  DJNZ        ICON_GREY_FILL_LOOP
  1472  128f  c9                    RET
  1473                          
src/asterion.asm:
     8  1290  0000000000000000     defs         $1800 - $, $00
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
     9                          
    10                          TITLE_SCREEN:
    11  1800  2020202020202020  INCBIN "asterion_title.scr"
              2020e0fcfcb02020  
              2020202020202020  
              2020202020202020  
              e0f0202020202020  
              20202020202020e8  
              fffcbfa3a3efb4ff  
              20eab5e8ffb4eaff  
              80b4ffeab520ffe8  
              bfabb5c420202020  
              20202020202020fe  
              8ffff5f5fdffffff  
              20eab5fe8ffdeab5  
              dbc3ffeab520ffaa  
              fd1fb02020202020  
              d02020202020e8ff  
              ffffb0ebb4f5ffff  
              b0eaffffffffffff  
              ffa1ffeaf520ffe0  
              a2abfd20202020d0  
              d1d1d0202020fea5  
              20aafdf0f0fef7aa  
              ffffffa520aaffb5  
              ebf5ffa2efffffea  
              fdfebf2020d0d1d1  
              20d0d0d1d0202020  
              d020a2afafa3effd  
              b0436f6d70757465  
              722053797374656d  
              a2a320d0d1d0d020  
              d1d1d1d0d0d0d1d0  
              d0d0d020d0d0d0d0  
              d020d0d0d0d0d0d0  
              20d0d020d0d0d0d0  
              d0d1d0d0d1d0d1d1  
              d0d1d020d1d1d020  
              d0d1d0d1d0d1d0d0  
              d0d1d0d1d1d0d1d1  
              d1d0d1d0d020d0d0  
              20d0d1d020d0d1d0  
              2020d0d1d020d0d1  
              d0d0d0d1d1d0d1d1  
              d1d1d0d1d1d0d1d1  
              d1d1d0d1d1d0d0d0  
              d1d020d0d1d12020  
              202020d0d1d0d0d0  
              d1d1d0d0d1d1d1d0  
              d0d1d0d0d1d0d0d1  
              d1d1d1d1d1d1d0d1  
              d020d0d1d0202020  
              eafffcffb0feffb0  
              fefdb5fdffb4d0d0  
              e8fff5e0fffffcff  
              fffdfdffb4fffdff  
              eab5faffb0ffffb4  
              e0b5ffeab5faebb5  
              a1fae5bfd0a1d0d0  
              e0b7ffeaf5d0a1ea  
              b5e0bfd0a1fae0ff  
              eaf5ffeaf5faeab5  
              eab5ffeab5fffeb5  
              e8bfeaffffd04f46  
              eafdffaaffffb4ea  
              b5eaffffd0ffffa5  
              eaffb5d0ffffeab5  
              eab5ffeab5ffebb5  
              ffa5b2fdd0b0d0d0  
              eab7ffe0d0ebb5ea  
              b5a2fd20b0ffeab5  
              eab7ffeab7ffeab5  
              eab5ffeab5ffeab5  
              bfffa5bfffa5d0d0  
              eab5ffaaffffa1ea  
              b5d0bfffa5ffa2ff  
              eab5ebffa1ffeab5  
              d0d0d1d1d1d1d1d0  
              d0d1d1d0d0d0d0d0  
              d1d1d0d0d0d0d0d0  
              d0d0d0d0d0d0d0d0  
              d1d1d1d1d1d1d120  
              d12020d0d0d1d1d1  
              d1d0d0d0d0d0d0d0  
              d0d0d0d0d0d0d0d0  
              d0d0d0d0d0d0d1d1  
              d1d1d0d0d020d0d0  
              20d02020d0d1d0d1  
              d1d1d15072657373  
              d133d1666f72d145  
              415359d1d1d1d1d1  
              d0d1d1d020202020  
              d020202020d020c6  
              d0d1d15072657373  
              d132d1666f72d14d  
              454449554dd1d1d1  
              20c6d020202020d0  
              2020202020d02020  
              d0d1d15072657373  
              d131d1666f72d148  
              415244d1d1d1d1d0  
              2020d02020202020  
              202020d02020d0d0  
              d1d0d15072657373  
              d134d1666f72d148  
              415244455354d0d1  
              d0d0202020202020  
              20202020202020d0  
              d0d0d0d1d1d1d0d1  
              d1d1d1d1d1d1d1d0  
              d1d1d1d1d1d1d020  
              202020d020202020  
              20202020d0202020  
              d0d0d1d0d1d0d1d0  
              d0d1d0d0d0d1d0d1  
              d0d0d0d1d0d120d0  
              2020d02020202020  
              2043616e20796f75  
              20636f6e71756572  
              20746865206d696e  
              6f746175722cd041  
              73746572696f6e3f  
              2020202020202020  
              2020202020202020  
              2020202020202020  
              2020202020202020  
              2020202020202020  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              7030303030303030  
              3030404040403030  
              3030303030303030  
              3030303030303030  
              4040303030303030  
              3030303030303040  
              404041434d4d4040  
              3040404040404040  
              4040404040304040  
              4040404030303030  
              3030303030303040  
              0440e1133dd34040  
              3040404004404040  
              0440404040304040  
              4040403030303030  
              b030303030304040  
              40404e1e133d4040  
              4040404040404040  
              4040404040304040  
              40404030303030b0  
              0ff0b03030304040  
              30404e4e41434040  
              4040404030404040  
              4040404040404040  
              4040403030b0f00f  
              0fbf0f0fb0303030  
              f030404040404040  
              4080808080808080  
              8030808080808080  
              404030b00f0fbf0f  
              0f0fbfbfbf0ff0f0  
              f0f0f030f0f0f0f0  
              f030f0f0f0f0f0f0  
              30f0f030f0f0f0f0  
              f00f0fbfbfbf0f0f  
              f0f00f0fbfbfbf0f  
              b0f0f0f0f0f0f0f0  
              f0f0b0f0f0f0f0f0  
              f0b0f0f0f030b00f  
              0fbfbfbf0f0ff0f0  
              3030f0f00f0fbfbf  
              bf0f0ff0f0f0f0f0  
              f00f0f0f0f0f0ff0  
              f0f0f0f0f0b00fbf  
              bfbf0f0f0ff03030  
              303030f0f00f0fbf  
              bfbf0f0f0ff00f0f  
              0f0f0f0f0f0f0f0f  
              0ff0f0f00f0fbfbf  
              bf0f0f0ff0303030  
              303f3030303f303f  
              3f3f3f3f303f0f0f  
              3f303f3f30303f30  
              303f3f303f303f30  
              3f3f3f3f303f3f30  
              30303f303030303f  
              3f3f3f300f3f0f0f  
              3f3f3f3f3f0f3f3f  
              3f3f3f0f3f3f3f3f  
              30303f3030303030  
              30303f30303f303f  
              3f3f3f303f0f3f3f  
              3f3f303f3f3f3f3f  
              3f3f3f3f0f303f3f  
              3f3f30f030303030  
              30303f30303f303f  
              303f3f300f3f0f0f  
              3f3f303f0f3f3f3f  
              3f3f3f3f3f303f3f  
              3f303f3030303030  
              303030303030303f  
              30303f30303f0f0f  
              3f3f303f303f3f3f  
              3f0f30303f303f3f  
              3f3f3f3f303f3030  
              f0f0f0f00f0f0f0f  
              0ff00f0f0f0f0f0f  
              0f0f0f0f0f0f0f0f  
              0f0f0f0f0f0f0f0f  
              0ff0f0f0f00ff030  
              f03030f0f0f0f0f0  
              0f0f0f0f0f0f0f0f  
              0f0f0f0f0f0f0f0f  
              0f0f0f0f0f0f0ff0  
              f0f0f0f0f030f0b0  
              30f03030f0f0bfbf  
              f00f0f1f1f1f1f1f  
              0f010f1f1f1f0f1f  
              1f1f1f0f0f0f0ff0  
              bfbff0f030303030  
              f030303030f03040  
              bf0f0f3f3f3f3f3f  
              0ff30f3f3f3f0f3f  
              3f3f3f3f3f0f0f0f  
              3040b030303030f0  
              3030303030f03030  
              0ff00f5f5f5f5f5f  
              0ff50f5f5f5f0f5f  
              5f5f5f0f0f0ff00f  
              3030f03030303030  
              303030f03030f0f0  
              f0f0f07f7f7f7f7f  
              0ff70f7f7f7f0f7f  
              7f7f7f7f7f7ff0f0  
              f0f0303030303030  
              30303030303030f0  
              f0f0f0f0f0f0f0f0  
              f0f0f0f0f0f0f0f0  
              f0f0f0f0f0f0f030  
              303030f030303030  
              30303030f0303030  
              f0f0f0f0f0f0f0f0  
              f0f0f0f0f0f0f0f0  
              f0f0f0f0f0f030f0  
              3030f03030303030  
              30d0d0d030d0d0d0  
              30d0d0d0d0d0d0d0  
              30d0d0d030d0d0d0  
              d0d0d0d0d0d0f020  
              20202020202020d0  
              3030303030303030  
              3030303030303030  
              3030303030303030  
              3030303030303030  
              3030303030303030  
              0000000000000000  
              0000000000000000  
              0000000000000000  
    12                          
    13                          TS_EYES_OPEN_CHR EQU TITLE_SCREEN + 726
    14                          TITLE_SCREEN_COL EQU TITLE_SCREEN + 1024
    15                          TS_EYES_OPTN_COL EQU TITLE_SCREEN + 1750
    16                          
    17                          include "scramblecode.asm"
src/scramblecode.asm:
     1                          ; Aquarius SCRAMBLECODE include file
     2                          SCRAMBLECODE:
     3  2000  3e5b5e00              DB 0x3e,0x5b,0x5e,0x00
     4  2004  009c00b0              DB 0x00,0x9c,0x00,0xb0
     5  2008  006c0064              DB 0x00,0x6c,0x00,0x64
     6  200c  00a85e70              DB 0x00,0xa8,0x5e,0x70
     7                          
src/asterion.asm:
    18                          
    19                          include "asterion_high_rom.asm"
src/asterion_high_rom.asm:
     1                          GAMEINIT:
     2  2010  31ff3f                LD          SP,$3fff                      ;Set SP to top of BANK0 RAM
     3  2013  cd8310                CALL        WIPE_VARIABLE_SPACE                     ;Wipe variable space first...
     4  2016  3602                  LD          (HL),0x2              ;($3a62) = 0x2
     5  2018  2c                    INC         L                                       ;HL = $3a63
     6  2019  3e32                  LD          A,$32                                  ;A = $32
     7  201b  77                    LD          (HL),A                          ;($3a63) = $32
     8  201c  2c                    INC         L                                       ;HL = $3a64
     9  201d  77                    LD          (HL),A                          ;($3a64) = $32
    10  201e  2c                    INC         L                                       ;HL = $3a65
    11  201f  77                    LD          (HL),A                          ;($3a65) = $32
    12  2020  2c                    INC         L                                       ;HL = $3a66
    13  2021  3d                    DEC         A                                       ;A = $31
    14  2022  77                    LD          (HL),A                          ;($3a66) = $31
    15  2023  2c                    INC         L                                       ;HL = $3a67
    16  2024  77                    LD          (HL),A                          ;($3a67) = $31
    17  2025  2c                    INC         L                                       ;HL = $3a68
    18  2026  0612                  LD          B,$12                                  ;B = $12
    19  2028  af                    XOR         A                                       ;A = 0x0, F = $44 (Z and P set)
    20                          LAB_ram_e029:
    21  2029  77                    LD          (HL),A                   ;($3a68) = $00
    22  202a  2c                    INC         L                                       ;HL = $3a69 to $3a7a,
    23                                                                                  ;A = 0x0, F = $28
    24  202b  10fc                  DJNZ        LAB_ram_e029                            ;Loop if Not Z (B is decremented)
    25  202d  3e18                  LD          A,$18                                  ;A = $18 (HL = $3a7a, B = 0x0)
    26  202f  77                    LD          (HL),A                         ;($3a7a) = $18
    27  2030  23                    INC         HL                                      ;HL = $3a7b
    28  2031  3efe                  LD          A,$fe                                  ;A = $fe
    29  2033  0610                  LD          B,$10                                  ;B = $10
    30                          LAB_ram_e035:
    31  2035  77                    LD          (HL),A                         ;= $60
    32  2036  23                    INC         HL
    33  2037  10fc                  DJNZ        LAB_ram_e035                            ;Loop if Not Z (B is decremented)
    34  2039  0620                  LD          B,$20                                  ;Set fill CHR to SPACE 32/$20
    35  203b  210030                LD          HL,CHRRAM                               ;HL = $3000 (Start of CHRRAM)
    36  203e  cd591e                CALL        FILL_FULL_1024                          ;byte FILL_FULL_1024(word chrColValue...
    37  2041  215e00                LD          HL,$5e                                 ;HL = $005e
    38  2044  229c3a                LD          (TIMER_E),HL                            ;($3a9c) = $0053
    39  2047  ed5f                  LD          A,R                                     ;Semi-random number into A
    40  2049  67                    LD          H,A
    41  204a  22913a                LD          (RNDHOLD_AA),HL
    42  204d  017f00                LD          BC,$7f
    43  2050  3e07                  LD          A,0x7
    44  2052  ed79                  OUT         (C),A                          ;= db
    45  2054  0d                    DEC         C
    46  2055  3e3f                  LD          A,$3f
    47  2057  ed79                  OUT         (C),A                          ;= db
    48  2059  0606                  LD          B,0x6                                   ;BLK on CYN
    49  205b  210034                LD          HL,COLRAM                               ;= $60
    50  205e  cd591e                CALL        FILL_FULL_1024                          ;byte FILL_FULL_1024(word chrColValue...
    51  2061  cdac2c                CALL        CHK_ITEM
    52  2064  cd6b20                CALL        DRAW_TITLE
    53  2067  c39c2a                JP          INPUT_DEBOUNCE
    54  206a  00                    NOP
    55                          DRAW_TITLE:
    56  206b  110030                LD          DE,CHRRAM                               ;= $20
    57  206e  210018                LD          HL,TITLE_SCREEN                    ; Pinned to TITLE_SCREEN ; WAS 0xD800
    58  2071  01e803                LD          BC,$3e8
    59  2074  edb0                  LDIR                                                ;= $20
    60  2076  110034                LD          DE,COLRAM                               ;= $60
    61  2079  210000                LD          HL,TITLE_SCREEN_COL                    ; Pinned to TITLE_SCREEN ; WAS 0xD800 + 1024
    62  207c  01e803                LD          BC,$3e8
    63  207f  edb0                  LDIR                                                ;= $60
    64                                                                                  ;= $70
    65  2081  c9                    RET
    66  2082  00                    db          $00
    67  2083  00                    db          $00
    68  2084  00                    db          $00
    69  2085  00                    db          $00
    70  2086  00                    db          $00
    71  2087  00                    db          $00
    72  2088  00                    db          $00
    73  2089  00                    db          $00
    74  208a  00                    db          $00
    75  208b  00                    db          $00
    76  208c  00                    db          $00
    77  208d  00                    db          $00
    78  208e  00                    db          $00
    79  208f  00                    db          $00
    80  2090  00                    db          $00
    81  2091  00                    db          $00
    82  2092  00                    db          $00
    83  2093  00                    db          $00
    84  2094  00                    db          $00
    85  2095  00                    db          $00
    86                          BLANK_SCRN:
    87  2096  210030                LD          HL,CHRRAM                               ;= $20
    88  2099  0620                  LD          B,$20                                  ;SPACE char
    89  209b  cd591e                CALL        FILL_FULL_1024                          ;byte FILL_FULL_1024(word chrColValue...
    90  209e  210034                LD          HL,COLRAM                               ;= $60
    91  20a1  06d0                  LD          B,$d0                                  ;DKGRN on BLK
    92  20a3  cd591e                CALL        FILL_FULL_1024                          ;byte FILL_FULL_1024(word chrColValue...
    93  20a6  116c07                LD          DE,STATS_TXT                            ;DE = STATS_TXT
    94  20a9  211930                LD          HL,CHRRAM_STATS_TOP                     ;HL = CHRRAM_STATS_TOP
    95  20ac  06d0                  LD          B,$d0                                  ;DKGRN on BLK
    96  20ae  cd3533                CALL        GFX_DRAW
    97  20b1  214530                LD          HL,IDX_HEALTH_SPACER                    ;= $20
    98  20b4  cd3533                CALL        GFX_DRAW
    99  20b7  213000                LD          HL,$30                                 ;Set starting PHYS HEALTH = 30
   100  20ba  1e15                  LD          E,$15                                  ;Set starting SPRT HEALTH = 15
   101  20bc  22933a                LD          (PLAYER_PHYS_HEALTH),HL
   102  20bf  22953a                LD          (PLAYER_PHYS_HEALTH_MAX),HL
   103  20c2  7b                    LD          A,E
   104  20c3  32973a                LD          (PLAYER_SPRT_HEALTH),A
   105  20c6  32983a                LD          (PLAYER_SPRT_HEALTH_MAX),A
   106  20c9  cd5d3d                CALL        REDRAW_STATS
   107  20cc  212000                LD          HL,$20
   108  20cf  22a93a                LD          (BYTE_ram_3aa9),HL
   109  20d2  3e14                  LD          A,$14
   110  20d4  32ab3a                LD          (FOOD_INV),A                            ;Set starting FOOD_INV  = 14
   111  20d7  32ac3a                LD          (ARROW_INV),A                           ;Set starting ARROW INV = 14
   112  20da  0610                  LD          B,$10                                  ;RED on BLK
   113  20dc  217132                LD          HL,CHRRAM_LEFT_HAND_ITEM_IDX            ;= $20
   114  20df  11b200                LD          DE,BOW                                  ;= $01,$01,$01,$01,$01
   115  20e2  cd3533                CALL        GFX_DRAW
   116  20e5  cd7312                CALL        FIX_ICON_COLORS
   117  20e8  cd0c12                CALL        DRAW_COMPASS
   118  20eb  00                    NOP
   119  20ec  00                    NOP
   120  20ed  00                    NOP
   121  20ee  00                    NOP
   122  20ef  00                    NOP
   123  20f0  00                    NOP
   124  20f1  00                    NOP
   125  20f2  00                    NOP
   126  20f3  00                    NOP
   127  20f4  3d                    DEC         A
   128  20f5  47                    LD          B,A
   129  20f6  3e03                  LD          A,0x3
   130  20f8  90                    SUB         B
   131  20f9  327a3a                LD          (RIGHT_HAND_ITEM),A
   132  20fc  0f                    RRCA
   133  20fd  3804                  JR          C,LAB_ram_e103
   134  20ff  0610                  LD          B,$10                                  ;Right hand RED SHIELD_L
   135  2101  1802                  JR          ADJUST_SHIELD_LEVEL
   136                          LAB_ram_e103:
   137  2103  0630                  LD          B,$30
   138                          ADJUST_SHIELD_LEVEL:
   139  2105  0f                    RRCA
   140  2106  3004                  JR          NC,LAB_ram_e10c
   141  2108  3e40                  LD          A,$40
   142  210a  80                    ADD         A,B
   143  210b  47                    LD          B,A
   144                          LAB_ram_e10c:
   145  210c  3e18                  LD          A,$18                                  ;Left hand RED BOW
   146  210e  327b3a                LD          (LEFT_HAND_ITEM),A
   147  2111  217b32                LD          HL,CHRRAM_RIGHT_HAND_ITEM_IDX           ;= $20
   148  2114  110100                LD          DE,BUCKLER                              ;= $01,$01,$01,$01,$01
   149  2117  cd3533                CALL        GFX_DRAW
   150  211a  cda333                CALL        BUILD_MAP
   151  211d  cd180e                CALL        SUB_ram_cdbf
   152  2120  cdc432                CALL        SUB_ram_f2c4
   153  2123  cde634                CALL        REDRAW_START
   154  2126  cd0438                CALL        REDRAW_VIEWPORT
   155  2129  c3cc26                JP          DO_SWAP_HANDS
   156  212c  00                    db          $00
   157  212d  00                    db          $00
   158  212e  00                    db          $00
   159  212f  00                    db          $00
   160  2130  00                    db          $00
   161  2131  00                    db          $00
   162  2132  00                    db          $00
   163  2133  00                    db          $00
   164  2134  00                    db          $00
   165  2135  00                    db          $00
   166  2136  00                    db          $00
   167  2137  00                    db          $00
   168  2138  00                    db          $00
   169  2139  00                    db          $00
   170  213a  00                    db          $00
   171  213b  00                    db          $00
   172  213c  00                    db          $00
   173  213d  00                    db          $00
   174  213e  00                    db          $00
   175  213f  00                    db          $00
   176  2140  00                    db          $00
   177  2141  00                    db          $00
   178  2142  00                    db          $00
   179  2143  00                    db          $00
   180  2144  00                    db          $00
   181  2145  00                    db          $00
   182  2146  00                    db          $00
   183  2147  00                    db          $00
   184  2148  00                    db          $00
   185  2149  00                    db          $00
   186  214a  00                    db          $00
   187  214b  00                    db          $00
   188  214c  00                    db          $00
   189  214d  00                    db          $00
   190  214e  00                    db          $00
   191  214f  00                    db          $00
   192  2150  00                    db          $00
   193  2151  00                    db          $00
   194  2152  00                    db          $00
   195  2153  00                    db          $00
   196  2154  00                    db          $00
   197  2155  00                    db          $00
   198  2156  00                    db          $00
   199  2157  00                    db          $00
   200  2158  00                    db          $00
   201  2159  00                    db          $00
   202  215a  00                    db          $00
   203  215b  00                    db          $00
   204  215c  00                    db          $00
   205  215d  00                    db          $00
   206  215e  00                    db          $00
   207  215f  00                    db          $00
   208  2160  00                    db          $00
   209  2161  00                    db          $00
   210  2162  00                    db          $00
   211  2163  00                    db          $00
   212  2164  00                    db          $00
   213  2165  00                    db          $00
   214  2166  00                    db          $00
   215  2167  00                    db          $00
   216  2168  00                    db          $00
   217  2169  00                    db          $00
   218  216a  00                    db          $00
   219  216b  00                    db          $00
   220  216c  00                    db          $00
   221  216d  00                    db          $00
   222  216e  00                    db          $00
   223  216f  00                    db          $00
   224  2170  00                    db          $00
   225  2171  00                    db          $00
   226  2172  00                    db          $00
   227  2173  00                    db          $00
   228  2174  00                    db          $00
   229  2175  00                    db          $00
   230  2176  00                    db          $00
   231  2177  00                    db          $00
   232  2178  00                    db          $00
   233  2179  00                    db          $00
   234  217a  00                    db          $00
   235  217b  00                    db          $00
   236  217c  00                    db          $00
   237  217d  00                    db          $00
   238  217e  00                    db          $00
   239  217f  00                    db          $00
   240  2180  00                    db          $00
   241  2181  00                    db          $00
   242  2182  00                    db          $00
   243  2183  00                    db          $00
   244  2184  00                    db          $00
   245  2185  00                    db          $00
   246  2186  00                    db          $00
   247  2187  00                    db          $00
   248  2188  00                    db          $00
   249  2189  00                    db          $00
   250  218a  00                    db          $00
   251  218b  00                    db          $00
   252  218c  00                    db          $00
   253  218d  00                    db          $00
   254  218e  00                    db          $00
   255  218f  00                    db          $00
   256  2190  00                    db          $00
   257  2191  00                    db          $00
   258  2192  00                    db          $00
   259  2193  00                    db          $00
   260  2194  00                    db          $00
   261  2195  00                    db          $00
   262  2196  00                    db          $00
   263  2197  00                    db          $00
   264  2198  00                    db          $00
   265  2199  00                    db          $00
   266  219a  00                    db          $00
   267  219b  00                    db          $00
   268  219c  00                    db          $00
   269  219d  00                    db          $00
   270                          DO_MOVE_FW_CHK_WALLS:
   271  219e  3ae833                LD          A,(WALL_F0_STATE)                       ;= $20
   272  21a1  fe00                  CP          0x0                                     ;Check for no wall in F0
   273  21a3  caab21                JP          Z,FW_WALLS_CLEAR_CHK_MONSTER
   274  21a6  cb57                  BIT         0x2,A                                   ;Check for closed door
   275  21a8  ca3022                JP          Z,NO_ACTION_TAKEN
   276                          FW_WALLS_CLEAR_CHK_MONSTER:
   277  21ab  3ae937                LD          A,(ITEM_F1)                             ;= $60
   278  21ae  3c                    INC         A
   279  21af  3c                    INC         A
   280  21b0  fe7a                  CP          $7a                                    ;Check for monster in F1
   281  21b2  d23022                JP          NC,NO_ACTION_TAKEN                      ;Monster in your way!
   282                                                                                  ;Do nothing.
   283  21b5  ed4b603a              LD          BC,(DIR_FACING_FW)                      ;Way is clear!
   284                                                                                  ;Move forward.
   285  21b9  ed439e3a              LD          (BYTE_ram_3a9e),BC
   286  21bd  3a623a                LD          A,(DIR_FACING_SHORT)
   287  21c0  32a03a                LD          (BYTE_ram_3aa0),A
   288  21c3  3a793a                LD          A,(PLAYER_MAP_POS)
   289  21c6  32773a                LD          (PLAYER_PREV_MAP_LOC),A
   290  21c9  80                    ADD         A,B
   291  21ca  32793a                LD          (PLAYER_MAP_POS),A
   292  21cd  c3962a                JP          UPDATE_VIEWPORT
   293                          DO_JUMP_BACK:
   294  21d0  21793a                LD          HL,PLAYER_MAP_POS
   295  21d3  3a773a                LD          A,(PLAYER_PREV_MAP_LOC)
   296  21d6  be                    CP          (HL)
   297  21d7  ca0122                JP          Z,LAB_ram_e201
   298  21da  08                    EX          AF,AF'
   299  21db  2a9e3a                LD          HL,(BYTE_ram_3a9e)
   300  21de  3a613a                LD          A,(DIR_FACING_BW)
   301  21e1  ed44                  NEG                                                 ;Negate A
   302  21e3  bc                    CP          H
   303  21e4  ca3022                JP          Z,NO_ACTION_TAKEN
   304  21e7  08                    EX          AF,AF'
   305  21e8  32793a                LD          (PLAYER_MAP_POS),A
   306  21eb  22603a                LD          (DIR_FACING_FW),HL
   307  21ee  3aa03a                LD          A,(BYTE_ram_3aa0)
   308  21f1  32623a                LD          (DIR_FACING_SHORT),A
   309  21f4  3a783a                LD          A,(LAST_ITEM_HELD)
   310  21f7  a7                    AND         A
   311  21f8  ca962a                JP          Z,UPDATE_VIEWPORT
   312  21fb  cdab25                CALL        CLEAR_MONSTER_STATS
   313  21fe  c34e32                JP          INIT_MELEE_ANIM
   314                          LAB_ram_e201:
   315  2201  010005                LD          BC,$500
   316  2204  112000                LD          DE,$20
   317  2207  cd3c22                CALL        PLAY_SOUND_LOOP
   318  220a  3a783a                LD          A,(LAST_ITEM_HELD)
   319  220d  a7                    AND         A
   320  220e  ca9f2a                JP          Z,WAIT_FOR_INPUT
   321  2211  c34e32                JP          INIT_MELEE_ANIM
   322                          DO_COUNT_FOOD:
   323  2214  3aab3a                LD          A,(FOOD_INV)
   324                          COUNT_INV:
   325  2217  57                    LD          D,A
   326  2218  14                    INC         D
   327  2219  af                    XOR         A
   328                          PLAY_INV_COUNT_BLIPS:
   329  221a  15                    DEC         D
   330  221b  ca9c2a                JP          Z,INPUT_DEBOUNCE
   331  221e  08                    EX          AF,AF'
   332  221f  010024                LD          BC,BYTE_ram_2400                        ;= $FF
   333  2222  cd4b1d                CALL        SLEEP                                   ;byte SLEEP(short cycleCount)
   334  2225  08                    EX          AF,AF'
   335  2226  d3fc                  OUT         (SPEAKER),A                             ;= db
   336  2228  3d                    DEC         A
   337  2229  18ef                  JR          PLAY_INV_COUNT_BLIPS
   338                          DO_COUNT_ARROWS:
   339  222b  3aac3a                LD          A,(ARROW_INV)
   340  222e  18e7                  JR          COUNT_INV
   341                          NO_ACTION_TAKEN:
   342  2230  010005                LD          BC,$500
   343  2233  112000                LD          DE,$20
   344  2236  cd3c22                CALL        PLAY_SOUND_LOOP
   345  2239  c39f2a                JP          WAIT_FOR_INPUT
   346                          PLAY_SOUND_LOOP:
   347  223c  1b                    DEC         DE
   348  223d  7b                    LD          A,E
   349  223e  b2                    OR          D
   350  223f  c8                    RET         Z
   351  2240  d3fc                  OUT         (SPEAKER),A                             ;Send sound to speaker
   352  2242  60                    LD          H,B
   353  2243  69                    LD          L,C
   354                          LAB_ram_e244:
   355  2244  2b                    DEC         HL
   356  2245  7d                    LD          A,L
   357  2246  b4                    OR          H
   358  2247  c24422                JP          NZ,LAB_ram_e244
   359  224a  c33c22                JP          PLAY_SOUND_LOOP
   360                          USE_MAP:
   361  224d  3ab93a                LD          A,(GAME_BOOLEANS)
   362  2250  cb57                  BIT         0x2,A                                   ;See if HAVE MAP bit is set
   363  2252  ca3022                JP          Z,NO_ACTION_TAKEN
   364  2255  3aad3a                LD          A,(MAP_INV_SLOT)
   365  2258  a7                    AND         A
   366  2259  ca4e32                JP          Z,INIT_MELEE_ANIM
   367  225c  d9                    EXX                                                 ;Swap BC  DE  HL
   368                                                                                  ;with BC' DE' HL'
   369  225d  011818                LD          BC,$1818                               ;24 x 24
   370  2260  212830                LD          HL,IDX_VIEWPORT_CHRRAM                  ;= $20
   371  2263  3e20                  LD          A,$20                                  ;SPACE character fill
   372  2265  cd3609                CALL        FILL_CHRCOL_RECT                        ;Fill map CHARs with SPACES
   373  2268  cda10e                CALL        SOUND_03
   374  226b  011818                LD          BC,$1818                               ;24 x 24
   375  226e  212834                LD          HL,COLRAM_VIEWPORT_IDX                  ;= $60    `
   376  2271  3eb0                  LD          A,$b0                                  ;DKBLU on BLK
   377                                                                                  ;Was DKGN on BLK
   378  2273  cd3609                CALL        FILL_CHRCOL_RECT                        ;Fill map colors
   379  2276  d9                    EXX                                                 ;Swap BC  DE  HL
   380                                                                                  ;with BC' DE' HL'
   381  2277  f5                    PUSH        AF
   382  2278  3aad3a                LD          A,(MAP_INV_SLOT)
   383  227b  47                    LD          B,A
   384  227c  f1                    POP         AF
   385  227d  00                    NOP                                                 ;Reset N flag
   386  227e  05                    DEC         B
   387  227f  cab322                JP          Z,DRAW_RED_MAP                          ;Walls and player
   388  2282  05                    DEC         B
   389  2283  caab22                JP          Z,DRAW_YELLOW_MAP                       ;Walls, player, and ladder
   390  2286  05                    DEC         B
   391  2287  ca9422                JP          Z,DRAW_PURPLE_MAP                       ;Walls, player, ladder,
   392                                                                                  ;and monsters
   393  228a  c39910                JP          DRAW_WHITE_MAP                          ;Walls, player, ladder,
   394                                                                                  ;monsters, and items
   395  228d  00                    db          $00
   396  228e  00                    db          $00
   397  228f  00                    db          $00
   398  2290  00                    db          $00
   399  2291  00                    db          $00
   400  2292  00                    db          $00
   401  2293  00                    db          $00
   402                          DRAW_PURPLE_MAP:
   403  2294  21a878                LD          HL,$78a8                               ;Item range for monsters:
   404                                                                                  ;78 - skeleton
   405                                                                                  ;a8 - db?
   406  2297  cd1523                CALL        MAP_ITEM_MONSTER
   407                          UPDATE_MONSTER_CELLS:
   408  229a  280f                  JR          Z,DRAW_YELLOW_MAP
   409  229c  0a                    LD          A,(BC)
   410  229d  0c                    INC         C
   411  229e  0c                    INC         C
   412  229f  d9                    EXX                                                 ;Swap BC  DE  HL
   413                                                                                  ;with BC' DE' HL'
   414  22a0  16b1                  LD          D,$b1                                  ;Set current map position color
   415                                                                                  ;to $b1 DKBLU on RED
   416                                                                                  ;was DKGRN on YEL
   417  22a2  cd2723                CALL        UPDATE_COLRAM_FROM_OFFSET
   418  22a5  d9                    EXX                                                 ;Swap BC  DE  HL
   419                                                                                  ;with BC' DE' HL'
   420  22a6  cd1823                CALL        FIND_NEXT_ITEM_MONSTER_LOOP
   421  22a9  18ef                  JR          UPDATE_MONSTER_CELLS
   422                          DRAW_YELLOW_MAP:
   423  22ab  16b5                  LD          D,$b5                                  ;Set current map position color
   424                                                                                  ;to $b5, DKBLU on PUR
   425                                                                                  ;was DKGRN on PUR
   426  22ad  3aa13a                LD          A,(ITEM_HOLDER)
   427  22b0  cd2723                CALL        UPDATE_COLRAM_FROM_OFFSET
   428                          DRAW_RED_MAP:
   429  22b3  011810                LD          BC,$1018                               ;16 x 20
   430  22b6  11ff37                LD          DE,HC_LAST_INPUT
   431  22b9  21cc30                LD          HL,CHRRAM_WALL_F0_IDX                   ;= $20
   432                          CALC_MINIMAP_WALL:
   433  22bc  13                    INC         DE
   434  22bd  7a                    LD          A,D
   435  22be  fe39                  CP          $39
   436  22c0  2824                  JR          Z,SET_MINIMAP_PLAYER_LOC
   437  22c2  1a                    LD          A,(DE)
   438  22c3  b7                    OR          A
   439  22c4  2808                  JR          Z,SET_MINIMAP_NO_WALLS
   440  22c6  e60f                  AND         0xf
   441  22c8  200c                  JR          NZ,LAB_ram_e2d6
   442                          SET_MINIMAP_N_WALL:
   443  22ca  3ea3                  LD          A,$a3                                  ;A = $a3, map CHAR N wall
   444  22cc  180f                  JR          DRAW_MINIMAP_WALL
   445                          SET_MINIMAP_NO_WALLS:
   446  22ce  3ea0                  LD          A,$a0                                  ;A = $a0, map CHAR no walls
   447  22d0  180b                  JR          DRAW_MINIMAP_WALL
   448                          SET_MINIMAP_NW_WALLS:
   449  22d2  3eb7                  LD          A,$b7                                  ;A = $b7, map CHAR N and W walls
   450  22d4  1807                  JR          DRAW_MINIMAP_WALL
   451                          LAB_ram_e2d6:
   452  22d6  1a                    LD          A,(DE)
   453  22d7  e6f0                  AND         $f0
   454  22d9  20f7                  JR          NZ,SET_MINIMAP_NW_WALLS
   455                          SET_MINIMAP_W_WALL:
   456  22db  3eb5                  LD          A,$b5                                  ;A = $b5, map CHAR W wall
   457                          DRAW_MINIMAP_WALL:
   458  22dd  77                    LD          (HL),A              ;= $20
   459  22de  23                    INC         HL
   460  22df  10db                  DJNZ        CALC_MINIMAP_WALL
   461  22e1  09                    ADD         HL,BC
   462  22e2  0610                  LD          B,$10
   463  22e4  18d6                  JR          CALC_MINIMAP_WALL
   464                          SET_MINIMAP_PLAYER_LOC:
   465  22e6  3a793a                LD          A,(PLAYER_MAP_POS)
   466  22e9  16b7                  LD          D,$b7                                  ;Set player position color
   467                                                                                  ;to $b7 DKBLU on WHT
   468                                                                                  ;was DKGRN on WHT
   469  22eb  cd2723                CALL        UPDATE_COLRAM_FROM_OFFSET
   470  22ee  cd3b29                CALL        WAIT_A_TICK
   471                          READ_KEY:
   472  22f1  01ff00                LD          BC,$ff
   473  22f4  ed78                  IN          A,(C)
   474  22f6  3c                    INC         A
   475  22f7  20f8                  JR          NZ,READ_KEY
   476                          ENABLE_HC:
   477  22f9  0ef7                  LD          C,$f7
   478  22fb  3e0f                  LD          A,0xf
   479  22fd  ed79                  OUT         (C),A                              ;= db
   480  22ff  0d                    DEC         C
   481                          READ_HC:
   482  2300  ed78                  IN          A,(C)                     ;= db
   483  2302  3c                    INC         A
   484  2303  c2f122                JP          NZ,READ_KEY
   485  2306  0c                    INC         C
   486  2307  3e0e                  LD          A,0xe
   487                          DISABLE_HC:
   488  2309  ed79                  OUT         (C),A                              ;= db
   489  230b  0d                    DEC         C
   490  230c  ed78                  IN          A,(C)                     ;= db
   491  230e  3c                    INC         A
   492  230f  c2f122                JP          NZ,READ_KEY
   493  2312  c3962a                JP          UPDATE_VIEWPORT
   494                          MAP_ITEM_MONSTER:
   495  2315  010039                LD          BC,MAP_LADDER_OFFSET
   496                          FIND_NEXT_ITEM_MONSTER_LOOP:
   497  2318  0a                    LD          A,(BC)
   498  2319  03                    INC         BC
   499  231a  3c                    INC         A
   500  231b  c8                    RET         Z
   501  231c  0a                    LD          A,(BC)
   502  231d  bc                    CP          H                                       ;CP A to H (low end of itemRange)
   503  231e  03                    INC         BC
   504  231f  38f7                  JR          C,FIND_NEXT_ITEM_MONSTER_LOOP
   505  2321  bd                    CP          L                                       ;CP A to L (high end of itemRange)
   506  2322  30f4                  JR          NC,FIND_NEXT_ITEM_MONSTER_LOOP
   507  2324  0d                    DEC         C
   508  2325  0b                    DEC         BC
   509  2326  c9                    RET
   510                          UPDATE_COLRAM_FROM_OFFSET:
   511  2327  f5                    PUSH        AF
   512  2328  e60f                  AND         0xf
   513  232a  21cc34                LD          HL,COLRAM_F0_WALL_MAP_IDX               ;= $60    `
   514  232d  4f                    LD          C,A
   515  232e  0600                  LD          B,0x0
   516  2330  09                    ADD         HL,BC
   517  2331  f1                    POP         AF
   518  2332  e6f0                  AND         $f0
   519  2334  1f                    RRA
   520  2335  4f                    LD          C,A
   521  2336  09                    ADD         HL,BC
   522  2337  17                    RLA
   523  2338  17                    RLA
   524  2339  cb10                  RL          B
   525  233b  4f                    LD          C,A
   526  233c  09                    ADD         HL,BC
   527  233d  72                    LD          (HL),D                                  ;LD (HL),D
   528  233e  c9                    RET
   529                          CHK_ITEM_BREAK:
   530  233f  78                    LD          A,B                                     ;A  = itemLevel (0-3)
   531  2340  07                    RLCA                                                ;A  = A * 2
   532  2341  07                    RLCA                                                ;A  = A * 2
   533  2342  07                    RLCA                                                ;A  = A * 2
   534  2343  4f                    LD          C,A                                     ;B  = A
   535  2344  cdac3a                CALL        MAKE_RANDOM_BYTE                        ;A  = Random Byte
   536  2347  81                    ADD         A,C                                     ;A  = A + B (orig A * 8)
   537  2348  3806                  JR          C,ITEM_POOFS_RH                         ;If A > 255, item breaks
   538  234a  c605                  ADD         A,0x5                                   ;A  = A + 5
   539  234c  d0                    RET         NC                                      ;If A < 255, item doesn't break
   540  234d  00                    db          $00
   541  234e  00                    db          $00
   542  234f  00                    db          $00
   543                          ITEM_POOFS_RH:
   544  2350  37                    SCF                                                 ;Set C
   545  2351  08                    EX          AF,AF'
   546  2352  216c33                LD          HL,CHRRAM_RH_POOF_IDX                   ;= $20
   547  2355  cdb510                CALL        PLAY_POOF_ANIM
   548  2358  00                    db          $00
   549  2359  00                    db          $00
   550  235a  00                    db          $00
   551  235b  00                    db          $00
   552  235c  00                    db          $00
   553  235d  00                    db          $00
   554  235e  00                    db          $00
   555  235f  00                    db          $00
   556  2360  00                    db          $00
   557  2361  00                    db          $00
   558  2362  00                    db          $00
   559  2363  00                    db          $00
   560                          FIX_RH_COLORS:
   561  2364  f5                    PUSH        AF
   562  2365  c5                    PUSH        BC
   563  2366  e5                    PUSH        HL
   564  2367  3ef0                  LD          A,$f0                                  ;DKGRN on BLK
   565  2369  010404                LD          BC,$404                                ; 4 x 4 rectangle
   566  236c  214337                LD          HL,COLRAM_RH_ITEM_IDX                   ;= $60    `
   567  236f  cd3609                CALL        FILL_CHRCOL_RECT
   568  2372  e1                    POP         HL
   569  2373  c1                    POP         BC
   570  2374  f1                    POP         AF
   571  2375  37                    SCF
   572  2376  c9                    RET
   573  2377  00                    db          $00
   574  2378  00                    db          $00
   575  2379  00                    db          $00
   576  237a  00                    db          $00
   577  237b  00                    db          $00
   578  237c  00                    db          $00
   579  237d  00                    db          $00
   580  237e  00                    db          $00
   581  237f  00                    db          $00
   582  2380  00                    db          $00
   583  2381  00                    db          $00
   584  2382  00                    db          $00
   585  2383  00                    db          $00
   586  2384  00                    db          $00
   587  2385  00                    db          $00
   588  2386  00                    db          $00
   589  2387  00                    db          $00
   590  2388  00                    db          $00
   591  2389  00                    db          $00
   592  238a  00                    db          $00
   593  238b  00                    db          $00
   594  238c  00                    db          $00
   595  238d  00                    db          $00
   596  238e  00                    db          $00
   597  238f  00                    db          $00
   598  2390  00                    db          $00
   599  2391  00                    db          $00
   600  2392  00                    db          $00
   601  2393  00                    db          $00
   602  2394  00                    db          $00
   603  2395  00                    db          $00
   604  2396  00                    db          $00
   605  2397  00                    db          $00
   606  2398  00                    db          $00
   607  2399  00                    db          $00
   608                          SUB_ram_e39a:
   609  239a  cdc90e                CALL        SOUND_05
   610  239d  3a873a                LD          A,(BYTE_ram_3a87)
   611  23a0  2a853a                LD          HL,(BYTE_ram_3a85)
   612  23a3  3d                    DEC         A
   613  23a4  c2cd23                JP          NZ,LAB_ram_e3cd
   614  23a7  2d                    DEC         L
   615  23a8  c2b623                JP          NZ,LAB_ram_e3b6
   616  23ab  25                    DEC         H
   617  23ac  ca5a24                JP          Z,LAB_ram_e45a
   618  23af  3e31                  LD          A,$31
   619  23b1  32643a                LD          (RAM_AC),A
   620  23b4  2e04                  LD          L,0x4
   621                          LAB_ram_e3b6:
   622  23b6  3e04                  LD          A,0x4
   623  23b8  32873a                LD          (BYTE_ram_3a87),A
   624  23bb  22853a                LD          (BYTE_ram_3a85),HL
   625  23be  2a833a                LD          HL,(BYTE_ram_3a83)
   626  23c1  012900                LD          BC,$29
   627  23c4  af                    XOR         A
   628  23c5  ed42                  SBC         HL,BC
   629  23c7  22833a                LD          (BYTE_ram_3a83),HL
   630  23ca  c3d723                JP          LAB_ram_e3d7
   631                          LAB_ram_e3cd:
   632  23cd  32873a                LD          (BYTE_ram_3a87),A
   633  23d0  2a833a                LD          HL,(BYTE_ram_3a83)
   634  23d3  2b                    DEC         HL
   635  23d4  22833a                LD          (BYTE_ram_3a83),HL
   636                          LAB_ram_e3d7:
   637  23d7  01c800                LD          BC,$c8
   638  23da  af                    XOR         A
   639  23db  ed42                  SBC         HL,BC
   640  23dd  e5                    PUSH        HL
   641  23de  09                    ADD         HL,BC
   642  23df  11003a                LD          DE,ITEM_MOVE_CHR_BUFFER
   643  23e2  cd6029                CALL        UPDATE_MELEE_OBJECTS
   644  23e5  e1                    POP         HL
   645  23e6  4d                    LD          C,L
   646  23e7  3a643a                LD          A,(RAM_AC)
   647  23ea  32633a                LD          (MON_FS),A
   648  23ed  3a823a                LD          A,(BYTE_ram_3a82)
   649  23f0  cdac2c                CALL        CHK_ITEM
   650  23f3  3e32                  LD          A,$32
   651  23f5  32633a                LD          (MON_FS),A
   652  23f8  3a693a                LD          A,(TIMER_A)
   653  23fb  c6ff                  ADD         A,$ff
   654  23fd  32893a                LD          (BYTE_ram_3a89),A
   655  2400  c9                    RET
   656                          SUB_ram_e401:
   657  2401  7d                    LD          A,L
   658  2402  e60f                  AND         0xf
   659  2404  47                    LD          B,A
   660  2405  04                    INC         B
   661  2406  cd1d24                CALL        SUB_ram_e41d
   662  2409  4f                    LD          C,A
   663  240a  7d                    LD          A,L
   664  240b  e6f0                  AND         $f0
   665  240d  07                    RLCA
   666  240e  07                    RLCA
   667  240f  07                    RLCA
   668  2410  07                    RLCA
   669  2411  47                    LD          B,A
   670  2412  04                    INC         B
   671  2413  cd1d24                CALL        SUB_ram_e41d
   672  2416  07                    RLCA
   673  2417  07                    RLCA
   674  2418  07                    RLCA
   675  2419  07                    RLCA
   676  241a  81                    ADD         A,C
   677  241b  6f                    LD          L,A
   678  241c  c9                    RET
   679                          SUB_ram_e41d:
   680  241d  cdca3a                CALL        UPDATE_SCR_SAVER_TIMER
   681  2420  e60f                  AND         0xf
   682                          LAB_ram_e422:
   683  2422  90                    SUB         B
   684  2423  30fd                  JR          NC,LAB_ram_e422
   685  2425  80                    ADD         A,B
   686  2426  c9                    RET
   687                          SUB_ram_e427:
   688  2427  7d                    LD          A,L
   689  2428  83                    ADD         A,E
   690  2429  27                    DAA
   691  242a  6f                    LD          L,A
   692  242b  7a                    LD          A,D
   693  242c  8c                    ADC         A,H
   694  242d  27                    DAA
   695  242e  67                    LD          H,A
   696  242f  c9                    RET
   697                          RECALC_PHYS_HEALTH:
   698  2430  7d                    LD          A,L
   699  2431  93                    SUB         E
   700  2432  27                    DAA                                                 ;Normalize BCD
   701  2433  6f                    LD          L,A
   702  2434  7c                    LD          A,H
   703  2435  9a                    SBC         A,D
   704  2436  27                    DAA                                                 ;Normalize BCD
   705  2437  67                    LD          H,A
   706  2438  c9                    RET
   707                          SUB_ram_e439:
   708  2439  af                    XOR         A
   709  243a  cb1c                  RR          H
   710  243c  3008                  JR          NC,LAB_ram_e446
   711  243e  cb1d                  RR          L
   712  2440  7d                    LD          A,L
   713  2441  d630                  SUB         $30
   714  2443  6f                    LD          L,A
   715  2444  1802                  JR          LAB_ram_e448
   716                          LAB_ram_e446:
   717  2446  cb1d                  RR          L
   718                          LAB_ram_e448:
   719  2448  cb5d                  BIT         0x3,L
   720  244a  c8                    RET         Z
   721  244b  7d                    LD          A,L
   722  244c  d603                  SUB         0x3
   723  244e  6f                    LD          L,A
   724  244f  c9                    RET
   725                          SUB_ram_e450:
   726  2450  ed5b833a              LD          DE,(BYTE_ram_3a83)
   727  2454  21003a                LD          HL,ITEM_MOVE_CHR_BUFFER
   728  2457  c37d29                JP          SUB_ram_e97d
   729                          LAB_ram_e45a:
   730  245a  cd5024                CALL        SUB_ram_e450
   731  245d  3e32                  LD          A,$32
   732  245f  32643a                LD          (RAM_AC),A
   733  2462  32653a                LD          (RAM_AD),A
   734  2465  3a9b3a                LD          A,(WEAPON_SPRT)
   735  2468  5f                    LD          E,A
   736  2469  1600                  LD          D,0x0
   737  246b  fe00                  CP          0x0
   738  246d  c20f25                JP          NZ,LAB_ram_e50f
   739  2470  ed5b993a              LD          DE,(WEAPON_PHYS)
   740  2474  d9                    EXX
   741  2475  cd4227                CALL        NEW_RIGHT_HAND_ITEM
   742  2478  d9                    EXX
   743  2479  2a953a                LD          HL,(PLAYER_PHYS_HEALTH_MAX)
   744  247c  cd3924                CALL        SUB_ram_e439
   745  247f  cd3024                CALL        RECALC_PHYS_HEALTH
   746  2482  3003                  JR          NC,LAB_ram_e487
   747  2484  210000                LD          HL,0x0
   748                          LAB_ram_e487:
   749  2487  cd0124                CALL        SUB_ram_e401
   750  248a  6c                    LD          L,H
   751  248b  67                    LD          H,A
   752  248c  cd0124                CALL        SUB_ram_e401
   753  248f  6c                    LD          L,H
   754  2490  67                    LD          H,A
   755  2491  eb                    EX          DE,HL
   756  2492  cd3924                CALL        SUB_ram_e439
   757  2495  eb                    EX          DE,HL
   758  2496  cd2724                CALL        SUB_ram_e427
   759  2499  eb                    EX          DE,HL
   760  249a  cd0124                CALL        SUB_ram_e401
   761  249d  cd2724                CALL        SUB_ram_e427
   762  24a0  ed5ba63a              LD          DE,(NEW_DAMAGE)
   763  24a4  cd3024                CALL        RECALC_PHYS_HEALTH
   764  24a7  3812                  JR          C,LAB_ram_e4bb
   765                          LAB_ram_e4a9:
   766  24a9  eb                    EX          DE,HL
   767  24aa  2aa33a                LD          HL,(CURR_MONSTER_PHYS)
   768  24ad  cd3024                CALL        RECALC_PHYS_HEALTH
   769  24b0  3811                  JR          C,LAB_ram_e4c3
   770  24b2  b5                    OR          L
   771  24b3  280e                  JR          Z,LAB_ram_e4c3
   772  24b5  22a33a                LD          (CURR_MONSTER_PHYS),HL
   773  24b8  c36932                JP          REDRAW_MONSTER_HEALTH
   774                          LAB_ram_e4bb:
   775  24bb  210600                LD          HL,0x6
   776  24be  cd0124                CALL        SUB_ram_e401
   777  24c1  18e6                  JR          LAB_ram_e4a9
   778                          LAB_ram_e4c3:
   779  24c3  d9                    EXX
   780  24c4  210000                LD          HL,0x0
   781  24c7  22a33a                LD          (CURR_MONSTER_PHYS),HL
   782  24ca  cd6932                CALL        REDRAW_MONSTER_HEALTH
   783  24cd  d9                    EXX
   784  24ce  2c                    INC         L
   785  24cf  3e99                  LD          A,$99
   786  24d1  bc                    CP          H
   787  24d2  c2fd10                JP          NZ,MONSTER_KILLED
   788  24d5  3e61                  LD          A,$61
   789  24d7  bd                    CP          L
   790  24d8  d2fd10                JP          NC,MONSTER_KILLED
   791  24db  3a4134                LD          A,(COLRAM_PHYS_STATS_1000)              ;= $60
   792  24de  cdba25                CALL        SUB_ram_e5ba
   793  24e1  2a953a                LD          HL,(PLAYER_PHYS_HEALTH_MAX)
   794  24e4  cd3924                CALL        SUB_ram_e439
   795  24e7  7d                    LD          A,L
   796  24e8  b8                    CP          B
   797  24e9  d2fd10                JP          NC,MONSTER_KILLED
   798                          LAB_ram_e4ec:
   799  24ec  cdca3a                CALL        UPDATE_SCR_SAVER_TIMER
   800  24ef  d640                  SUB         $40
   801  24f1  3804                  JR          C,INCREASE_MAX_PHYS_HEALTH
   802  24f3  b9                    CP          C
   803  24f4  d2fd10                JP          NC,MONSTER_KILLED
   804                          INCREASE_MAX_PHYS_HEALTH:
   805  24f7  2a953a                LD          HL,(PLAYER_PHYS_HEALTH_MAX)
   806  24fa  7d                    LD          A,L
   807  24fb  c601                  ADD         A,0x1
   808  24fd  27                    DAA                                                 ;Correct for BCD
   809  24fe  6f                    LD          L,A
   810  24ff  7c                    LD          A,H
   811  2500  ce00                  ADC         A,0x0
   812  2502  67                    LD          H,A
   813  2503  22953a                LD          (PLAYER_PHYS_HEALTH_MAX),HL
   814  2506  79                    LD          A,C
   815  2507  d610                  SUB         $10
   816  2509  dafd10                JP          C,MONSTER_KILLED
   817  250c  4f                    LD          C,A
   818  250d  18dd                  JR          LAB_ram_e4ec
   819                          LAB_ram_e50f:
   820  250f  3a983a                LD          A,(PLAYER_SPRT_HEALTH_MAX)
   821  2512  2600                  LD          H,0x0
   822  2514  6f                    LD          L,A
   823  2515  d9                    EXX
   824  2516  cd4227                CALL        NEW_RIGHT_HAND_ITEM
   825  2519  d9                    EXX
   826  251a  cd3924                CALL        SUB_ram_e439
   827  251d  7d                    LD          A,L
   828  251e  93                    SUB         E
   829  251f  27                    DAA
   830  2520  6f                    LD          L,A
   831  2521  3002                  JR          NC,LAB_ram_e525
   832  2523  2e00                  LD          L,0x0
   833                          LAB_ram_e525:
   834  2525  cd0124                CALL        SUB_ram_e401
   835  2528  eb                    EX          DE,HL
   836  2529  cd3924                CALL        SUB_ram_e439
   837  252c  7d                    LD          A,L
   838  252d  83                    ADD         A,E
   839  252e  27                    DAA
   840  252f  5f                    LD          E,A
   841  2530  cd0124                CALL        SUB_ram_e401
   842  2533  83                    ADD         A,E
   843  2534  27                    DAA
   844  2535  6f                    LD          L,A
   845  2536  3aa53a                LD          A,(BYTE_ram_3aa5)
   846  2539  5f                    LD          E,A
   847  253a  7d                    LD          A,L
   848  253b  93                    SUB         E
   849  253c  27                    DAA
   850  253d  3810                  JR          C,LAB_ram_e54f
   851  253f  6f                    LD          L,A
   852                          MONSTER_TAKES_SPRT_DAMAGE:
   853  2540  3aa23a                LD          A,(CURR_MONSTER_SPRT)
   854  2543  95                    SUB         L
   855  2544  27                    DAA
   856  2545  3810                  JR          C,LAB_ram_e557
   857  2547  280e                  JR          Z,LAB_ram_e557
   858  2549  32a23a                LD          (CURR_MONSTER_SPRT),A
   859  254c  c36932                JP          REDRAW_MONSTER_HEALTH
   860                          LAB_ram_e54f:
   861  254f  210300                LD          HL,0x3
   862  2552  cd0124                CALL        SUB_ram_e401
   863  2555  18e9                  JR          MONSTER_TAKES_SPRT_DAMAGE
   864                          LAB_ram_e557:
   865  2557  f5                    PUSH        AF
   866  2558  af                    XOR         A
   867  2559  32a23a                LD          (CURR_MONSTER_SPRT),A
   868  255c  cd6932                CALL        REDRAW_MONSTER_HEALTH
   869  255f  f1                    POP         AF
   870  2560  3d                    DEC         A
   871  2561  fe86                  CP          $86
   872  2563  3827                  JR          C,ITEM_USED_UP
   873  2565  3a4634                LD          A,(COLRAM_SPRT_STATS_10)                ;= $60
   874  2568  cdba25                CALL        SUB_ram_e5ba
   875  256b  3a983a                LD          A,(PLAYER_SPRT_HEALTH_MAX)
   876  256e  b8                    CP          B
   877  256f  301b                  JR          NC,ITEM_USED_UP
   878                          REDUCE_ITEM_BY_30:
   879  2571  cdca3a                CALL        UPDATE_SCR_SAVER_TIMER
   880  2574  d630                  SUB         $30
   881  2576  3803                  JR          C,INCREASE_MAX_SPRT_HEALTH
   882  2578  b9                    CP          C
   883  2579  3011                  JR          NC,ITEM_USED_UP
   884                          INCREASE_MAX_SPRT_HEALTH:
   885  257b  3a983a                LD          A,(PLAYER_SPRT_HEALTH_MAX)
   886  257e  c601                  ADD         A,0x1
   887  2580  27                    DAA                                                 ;Correct for BCD
   888  2581  32983a                LD          (PLAYER_SPRT_HEALTH_MAX),A
   889  2584  79                    LD          A,C
   890  2585  d610                  SUB         $10
   891  2587  3803                  JR          C,ITEM_USED_UP
   892  2589  4f                    LD          C,A
   893  258a  18e5                  JR          REDUCE_ITEM_BY_30
   894                          ITEM_USED_UP:
   895  258c  c3fd10                JP          MONSTER_KILLED
   896  258f  00                    db          $00
   897  2590  00                    db          $00
   898  2591  00                    db          $00
   899  2592  00                    db          $00
   900  2593  00                    db          $00
   901  2594  00                    db          $00
   902  2595  00                    db          $00
   903  2596  00                    db          $00
   904  2597  00                    db          $00
   905  2598  00                    db          $00
   906  2599  00                    db          $00
   907  259a  00                    db          $00
   908  259b  00                    db          $00
   909  259c  00                    db          $00
   910  259d  00                    db          $00
   911  259e  00                    db          $00
   912  259f  00                    db          $00
   913  25a0  00                    db          $00
   914  25a1  00                    db          $00
   915  25a2  00                    db          $00
   916  25a3  00                    db          $00
   917  25a4  00                    db          $00
   918  25a5  00                    db          $00
   919  25a6  00                    db          $00
   920  25a7  00                    db          $00
   921  25a8  00                    db          $00
   922  25a9  00                    db          $00
   923  25aa  00                    db          $00
   924                          CLEAR_MONSTER_STATS:
   925  25ab  af                    XOR         A                                       ;A  = $fe on entry (usually)
   926                                                                                  ;A  = $00 after
   927                                                                                  ;Reset C & N, Set Z
   928                                                                                  ;
   929  25ac  32783a                LD          (LAST_ITEM_HELD),A                   ;ItemHolder = $00
   930  25af  010304                LD          BC,$403
   931  25b2  213d33                LD          HL,CHRRAM_LEVEL_IDX                     ;= $20
   932  25b5  3e20                  LD          A,$20
   933  25b7  c33609                JP          FILL_CHRCOL_RECT
   934                          SUB_ram_e5ba:
   935  25ba  e60f                  AND         0xf
   936  25bc  3c                    INC         A
   937  25bd  3c                    INC         A
   938  25be  47                    LD          B,A
   939  25bf  07                    RLCA
   940  25c0  07                    RLCA
   941  25c1  07                    RLCA
   942  25c2  07                    RLCA
   943  25c3  4f                    LD          C,A
   944  25c4  78                    LD          A,B
   945  25c5  87                    ADD         A,A
   946  25c6  27                    DAA
   947  25c7  87                    ADD         A,A
   948  25c8  27                    DAA
   949  25c9  87                    ADD         A,A
   950  25ca  27                    DAA
   951  25cb  87                    ADD         A,A
   952  25cc  27                    DAA
   953  25cd  47                    LD          B,A
   954  25ce  c9                    RET
   955                          MELEE_ANIM_LOOP:
   956  25cf  cdc90e                CALL        SOUND_05
   957  25d2  3a8b3a                LD          A,(MELEE_ANIM_STATE)
   958  25d5  2a8d3a                LD          HL,(MONSTER_ATT_POS_COUNT)
   959  25d8  3d                    DEC         A
   960  25d9  c20026                JP          NZ,LAB_ram_e600
   961  25dc  2d                    DEC         L
   962  25dd  c2eb25                JP          NZ,LAB_ram_e5eb
   963  25e0  25                    DEC         H
   964  25e1  ca3f26                JP          Z,LAB_ram_e63f
   965  25e4  3e32                  LD          A,$32
   966  25e6  32673a                LD          (RAM_AF),A
   967  25e9  2e02                  LD          L,0x2
   968                          LAB_ram_e5eb:
   969  25eb  3e03                  LD          A,0x3
   970  25ed  328b3a                LD          (MELEE_ANIM_STATE),A
   971  25f0  228d3a                LD          (MONSTER_ATT_POS_COUNT),HL
   972  25f3  2a8f3a                LD          HL,(MONSTER_ATT_POS_OFFSET)
   973  25f6  012900                LD          BC,$29
   974  25f9  09                    ADD         HL,BC
   975  25fa  228f3a                LD          (MONSTER_ATT_POS_OFFSET),HL
   976  25fd  c30a26                JP          ANIMATE_MELEE_ROUND
   977                          LAB_ram_e600:
   978  2600  328b3a                LD          (MELEE_ANIM_STATE),A
   979  2603  2a8f3a                LD          HL,(MONSTER_ATT_POS_OFFSET)
   980  2606  23                    INC         HL
   981  2607  228f3a                LD          (MONSTER_ATT_POS_OFFSET),HL
   982                          ANIMATE_MELEE_ROUND:
   983  260a  01c800                LD          BC,$c8
   984  260d  af                    XOR         A
   985  260e  ed42                  SBC         HL,BC
   986  2610  e5                    PUSH        HL
   987  2611  09                    ADD         HL,BC
   988  2612  11203a                LD          DE,BYTE_ram_3a20
   989  2615  cd6029                CALL        UPDATE_MELEE_OBJECTS
   990  2618  c1                    POP         BC
   991  2619  0600                  LD          B,0x0
   992  261b  3a673a                LD          A,(RAM_AF)
   993  261e  32633a                LD          (MON_FS),A
   994  2621  3a8a3a                LD          A,(BYTE_ram_3a8a)
   995  2624  cdac2c                CALL        CHK_ITEM
   996  2627  3e32                  LD          A,$32
   997  2629  32633a                LD          (MON_FS),A
   998  262c  3a693a                LD          A,(TIMER_A)
   999  262f  c6ff                  ADD         A,$ff
  1000  2631  328c3a                LD          (BYTE_ram_3a8c),A
  1001  2634  c9                    RET
  1002                          SUB_ram_e635:
  1003  2635  ed5b8f3a              LD          DE,(MONSTER_ATT_POS_OFFSET)
  1004  2639  21203a                LD          HL,BYTE_ram_3a20
  1005  263c  c37d29                JP          SUB_ram_e97d
  1006                          LAB_ram_e63f:
  1007  263f  cd3526                CALL        SUB_ram_e635
  1008  2642  3e31                  LD          A,$31
  1009  2644  32673a                LD          (RAM_AF),A
  1010  2647  32663a                LD          (RAM_AE),A
  1011  264a  3a6c3a                LD          A,(INPUT_HOLDER)
  1012  264d  47                    LD          B,A
  1013  264e  2600                  LD          H,0x0
  1014  2650  3aa83a                LD          A,(WEAPON_VALUE_HOLDER)
  1015  2653  6f                    LD          L,A
  1016  2654  1802                  JR          LAB_ram_e658
  1017                          LAB_ram_e656:
  1018  2656  85                    ADD         A,L
  1019  2657  27                    DAA
  1020                          LAB_ram_e658:
  1021  2658  10fc                  DJNZ        LAB_ram_e656
  1022  265a  6f                    LD          L,A
  1023  265b  3a8a3a                LD          A,(BYTE_ram_3a8a)
  1024  265e  e6fc                  AND         $fc
  1025  2660  fe24                  CP          $24
  1026  2662  202f                  JR          NZ,LAB_ram_e693
  1027  2664  3a733a                LD          A,(SHIELD_SPRT)
  1028  2667  5f                    LD          E,A
  1029  2668  cd3924                CALL        SUB_ram_e439
  1030  266b  55                    LD          D,L
  1031  266c  cd0124                CALL        SUB_ram_e401
  1032  266f  7d                    LD          A,L
  1033  2670  82                    ADD         A,D
  1034  2671  27                    DAA
  1035  2672  93                    SUB         E
  1036  2673  27                    DAA
  1037  2674  3814                  JR          C,LAB_ram_e68a
  1038  2676  5f                    LD          E,A
  1039                          LAB_ram_e677:
  1040  2677  3a973a                LD          A,(PLAYER_SPRT_HEALTH)
  1041  267a  93                    SUB         E
  1042  267b  27                    DAA
  1043  267c  daa92f                JP          C,PLAYER_DIES
  1044  267f  caa92f                JP          Z,PLAYER_DIES
  1045  2682  32973a                LD          (PLAYER_SPRT_HEALTH),A
  1046  2685  cd5d3d                CALL        REDRAW_STATS
  1047  2688  1834                  JR          LAB_ram_e6be
  1048                          LAB_ram_e68a:
  1049  268a  210200                LD          HL,0x2
  1050  268d  cd0124                CALL        SUB_ram_e401
  1051  2690  5d                    LD          E,L
  1052  2691  18e4                  JR          LAB_ram_e677
  1053                          LAB_ram_e693:
  1054  2693  cd0124                CALL        SUB_ram_e401
  1055  2696  3aa83a                LD          A,(WEAPON_VALUE_HOLDER)
  1056  2699  85                    ADD         A,L
  1057  269a  27                    DAA
  1058  269b  6f                    LD          L,A
  1059  269c  7c                    LD          A,H
  1060  269d  ce00                  ADC         A,0x0
  1061  269f  27                    DAA
  1062  26a0  67                    LD          H,A
  1063  26a1  ed5b713a              LD          DE,(SHIELD_PHYS)
  1064  26a5  cd3024                CALL        RECALC_PHYS_HEALTH
  1065  26a8  381a                  JR          C,LAB_ram_e6c4
  1066                          LAB_ram_e6aa:
  1067  26aa  eb                    EX          DE,HL
  1068  26ab  2a933a                LD          HL,(PLAYER_PHYS_HEALTH)
  1069  26ae  cd3024                CALL        RECALC_PHYS_HEALTH
  1070  26b1  daa92f                JP          C,PLAYER_DIES
  1071  26b4  b5                    OR          L
  1072  26b5  caa92f                JP          Z,PLAYER_DIES
  1073  26b8  22933a                LD          (PLAYER_PHYS_HEALTH),HL
  1074  26bb  cd5d3d                CALL        REDRAW_STATS
  1075                          LAB_ram_e6be:
  1076  26be  cde634                CALL        REDRAW_START
  1077  26c1  c30438                JP          REDRAW_VIEWPORT
  1078                          LAB_ram_e6c4:
  1079  26c4  210300                LD          HL,0x3
  1080  26c7  cd0124                CALL        SUB_ram_e401
  1081  26ca  18de                  JR          LAB_ram_e6aa
  1082                          DO_SWAP_HANDS:
  1083  26cc  217a3a                LD          HL,RIGHT_HAND_ITEM
  1084  26cf  017b3a                LD          BC,LEFT_HAND_ITEM
  1085  26d2  cd622a                CALL        SUB_ram_ea62
  1086  26d5  214333                LD          HL,CHRRAM_RIGHT_HD_GFX_IDX              ;= $20
  1087  26d8  11003a                LD          DE,ITEM_MOVE_CHR_BUFFER
  1088  26db  cd6029                CALL        UPDATE_MELEE_OBJECTS
  1089  26de  213933                LD          HL,CHRRAM_LEFT_HD_GFX_IDX               ;= $20
  1090  26e1  114333                LD          DE,CHRRAM_RIGHT_HD_GFX_IDX              ;= $20
  1091  26e4  cd9e29                CALL        SUB_ram_e99e
  1092  26e7  21003a                LD          HL,ITEM_MOVE_CHR_BUFFER
  1093  26ea  113933                LD          DE,CHRRAM_LEFT_HD_GFX_IDX               ;= $20
  1094  26ed  cd7d29                CALL        SUB_ram_e97d
  1095  26f0  cd4227                CALL        NEW_RIGHT_HAND_ITEM
  1096  26f3  010000                LD          BC,0x0
  1097  26f6  217a3a                LD          HL,RIGHT_HAND_ITEM
  1098  26f9  cd2027                CALL        SUB_ram_e720
  1099  26fc  3a733a                LD          A,(SHIELD_SPRT)
  1100  26ff  91                    SUB         C
  1101  2700  27                    DAA
  1102  2701  32733a                LD          (SHIELD_SPRT),A
  1103  2704  3a713a                LD          A,(SHIELD_PHYS)
  1104  2707  90                    SUB         B
  1105  2708  27                    DAA
  1106  2709  32713a                LD          (SHIELD_PHYS),A
  1107  270c  3a723a                LD          A,(SHIELD_PHYS+1)
  1108  270f  de00                  SBC         A,0x0
  1109  2711  32723a                LD          (SHIELD_PHYS+1),A
  1110  2714  010000                LD          BC,0x0
  1111  2717  217b3a                LD          HL,LEFT_HAND_ITEM
  1112  271a  cd2027                CALL        SUB_ram_e720
  1113  271d  c31228                JP          LAB_ram_e812
  1114                          SUB_ram_e720:
  1115  2720  7e                    LD          A,(HL)
  1116  2721  fe14                  CP          $14
  1117  2723  d0                    RET         NC
  1118  2724  fe10                  CP          $10
  1119  2726  3003                  JR          NC,LAB_ram_e72b
  1120  2728  fe04                  CP          0x4
  1121  272a  d0                    RET         NC
  1122                          LAB_ram_e72b:
  1123  272b  e603                  AND         0x3
  1124  272d  3c                    INC         A
  1125  272e  cdc129                CALL        SUB_ram_e9c1
  1126  2731  7e                    LD          A,(HL)
  1127  2732  e6fc                  AND         $fc
  1128  2734  c0                    RET         NZ
  1129  2735  2600                  LD          H,0x0
  1130  2737  68                    LD          L,B
  1131  2738  cd3924                CALL        SUB_ram_e439
  1132  273b  45                    LD          B,L
  1133  273c  69                    LD          L,C
  1134  273d  cd3924                CALL        SUB_ram_e439
  1135  2740  4d                    LD          C,L
  1136  2741  c9                    RET
  1137                          NEW_RIGHT_HAND_ITEM:
  1138  2742  3a7a3a                LD          A,(RIGHT_HAND_ITEM)
  1139  2745  fe18                  CP          $18                                    ;Less than RED Bow
  1140  2747  3877                  JR          C,LAB_ram_e7c0
  1141  2749  fe34                  CP          $34                                    ;Greater than WHITE Crossbow
  1142  274b  3073                  JR          NC,LAB_ram_e7c0
  1143  274d  010000                LD          BC,0x0                                  ;C = 0
  1144  2750  1e00                  LD          E,0x0                                   ;E = 0
  1145  2752  cb3f                  SRL         A                                       ;Div A by 2
  1146  2754  cb18                  RR          B
  1147  2756  1f                    RRA
  1148  2757  cb10                  RL          B
  1149  2759  cb10                  RL          B
  1150  275b  d606                  SUB         0x6
  1151  275d  2004                  JR          NZ,LAB_ram_e763
  1152  275f  1606                  LD          D,0x6
  1153  2761  1828                  JR          LAB_ram_e78b
  1154                          LAB_ram_e763:
  1155  2763  3d                    DEC         A
  1156  2764  2004                  JR          NZ,LAB_ram_e76a
  1157  2766  1606                  LD          D,0x6
  1158  2768  1834                  JR          LAB_ram_e79e
  1159                          LAB_ram_e76a:
  1160  276a  3d                    DEC         A
  1161  276b  2004                  JR          NZ,LAB_ram_e771
  1162  276d  1616                  LD          D,$16
  1163  276f  181a                  JR          LAB_ram_e78b
  1164                          LAB_ram_e771:
  1165  2771  3d                    DEC         A
  1166  2772  2004                  JR          NZ,LAB_ram_e778
  1167  2774  1620                  LD          D,$20
  1168  2776  1826                  JR          LAB_ram_e79e
  1169                          LAB_ram_e778:
  1170  2778  3d                    DEC         A
  1171  2779  2004                  JR          NZ,LAB_ram_e77f
  1172  277b  1624                  LD          D,$24
  1173  277d  180c                  JR          LAB_ram_e78b
  1174                          LAB_ram_e77f:
  1175  277f  3d                    DEC         A
  1176  2780  2004                  JR          NZ,LAB_ram_e786
  1177  2782  1615                  LD          D,$15
  1178  2784  1818                  JR          LAB_ram_e79e
  1179                          LAB_ram_e786:
  1180  2786  3d                    DEC         A
  1181  2787  1618                  LD          D,$18
  1182  2789  00                    NOP
  1183  278a  00                    NOP
  1184                          LAB_ram_e78b:
  1185  278b  cd8532                CALL        CALC_WEAPON_VALUE
  1186  278e  87                    ADD         A,A
  1187  278f  27                    DAA                                                 ;BCD Correction
  1188  2790  6f                    LD          L,A
  1189  2791  3e00                  LD          A,0x0
  1190  2793  17                    RLA
  1191  2794  67                    LD          H,A
  1192  2795  22993a                LD          (WEAPON_PHYS),HL
  1193  2798  af                    XOR         A
  1194  2799  329b3a                LD          (WEAPON_SPRT),A
  1195  279c  180c                  JR          LAB_ram_e7aa
  1196                          LAB_ram_e79e:
  1197  279e  cd8532                CALL        CALC_WEAPON_VALUE
  1198  27a1  329b3a                LD          (WEAPON_SPRT),A
  1199  27a4  210000                LD          HL,0x0
  1200  27a7  22993a                LD          (WEAPON_PHYS),HL
  1201                          LAB_ram_e7aa:
  1202  27aa  119130                LD          DE,CHRRAM_PHYS_WEAPON_IDX               ;= $20
  1203  27ad  21993a                LD          HL,WEAPON_PHYS
  1204  27b0  0602                  LD          B,0x2
  1205  27b2  cdfd32                CALL        RECALC_AND_REDRAW_BCD
  1206  27b5  119730                LD          DE,CHRRAM_SPRT_WEAPON_IDX               ;= $20
  1207  27b8  219b3a                LD          HL,WEAPON_SPRT
  1208  27bb  0601                  LD          B,0x1
  1209  27bd  c3fd32                JP          RECALC_AND_REDRAW_BCD
  1210                          LAB_ram_e7c0:
  1211  27c0  210000                LD          HL,0x0                                  ;HL = 0
  1212  27c3  af                    XOR         A                                       ;A  = 0
  1213  27c4  22993a                LD          (WEAPON_PHYS),HL
  1214  27c7  329b3a                LD          (WEAPON_SPRT),A
  1215  27ca  18de                  JR          LAB_ram_e7aa
  1216                          DO_PICK_UP:
  1217  27cc  3aa13a                LD          A,(ITEM_HOLDER)
  1218  27cf  47                    LD          B,A
  1219  27d0  3a793a                LD          A,(PLAYER_MAP_POS)
  1220  27d3  b8                    CP          B                                       ;Check difference between
  1221                                                                                  ;item and item location
  1222  27d4  ca3022                JP          Z,NO_ACTION_TAKEN
  1223  27d7  3c                    INC         A
  1224  27d8  ca3022                JP          Z,NO_ACTION_TAKEN
  1225  27db  3d                    DEC         A
  1226  27dc  cdf337                CALL        ITEM_MAP_CHECK
  1227  27df  2863                  JR          Z,LAB_ram_e844
  1228  27e1  fe04                  CP          0x4                                     ;Compare to RING (0x4)
  1229  27e3  3862                  JR          C,CHECK_FOOD_ARROWS                     ;Jump if less than RING (C)
  1230  27e5  fe10                  CP          $10                                    ;Compare to PAVICE ($10)
  1231  27e7  305e                  JR          NC,CHECK_FOOD_ARROWS                    ;Jump if PAVICE or greater (NC)
  1232                          PROCESS_RHA:
  1233  27e9  cd4129                CALL        PICK_UP_F0_ITEM
  1234  27ec  21743a                LD          HL,ARMOR_INV_SLOT                       ;Start with ARMOR slot
  1235  27ef  3d                    DEC         A                                       ;Subtract 1 from A:
  1236                                                                                  ;- Armor
  1237  27f0  2002                  JR          NZ,NOT_ARMOR                            ;Treat as NOT ARMOR
  1238  27f2  23                    INC         HL                                      ;HL = HELMET_INV_SLOT
  1239  27f3  23                    INC         HL                                      ;HL = RING_INV_SLOT
  1240                          NOT_ARMOR:
  1241  27f4  3d                    DEC         A
  1242  27f5  2001                  JR          NZ,NOT_HELMET
  1243  27f7  23                    INC         HL
  1244                          NOT_HELMET:
  1245  27f8  7e                    LD          A,(HL)
  1246  27f9  14                    INC         D
  1247  27fa  ba                    CP          D
  1248  27fb  d29c2a                JP          NC,INPUT_DEBOUNCE
  1249  27fe  08                    EX          AF,AF'
  1250  27ff  7a                    LD          A,D
  1251  2800  77                    LD          (HL),A
  1252  2801  cdc129                CALL        SUB_ram_e9c1
  1253  2804  59                    LD          E,C
  1254  2805  50                    LD          D,B
  1255  2806  08                    EX          AF,AF'
  1256  2807  cdc129                CALL        SUB_ram_e9c1
  1257  280a  7b                    LD          A,E
  1258  280b  91                    SUB         C
  1259  280c  27                    DAA                                                 ;BCD Correction
  1260  280d  4f                    LD          C,A
  1261  280e  7a                    LD          A,D
  1262  280f  90                    SUB         B
  1263  2810  27                    DAA                                                 ;BCD Correction
  1264  2811  47                    LD          B,A
  1265                          LAB_ram_e812:
  1266  2812  3a733a                LD          A,(SHIELD_SPRT)
  1267  2815  81                    ADD         A,C
  1268  2816  27                    DAA                                                 ;BCD Correction
  1269  2817  32733a                LD          (SHIELD_SPRT),A
  1270  281a  3a713a                LD          A,(SHIELD_PHYS)
  1271  281d  80                    ADD         A,B
  1272  281e  27                    DAA                                                 ;BCD Correction
  1273  281f  32713a                LD          (SHIELD_PHYS),A
  1274  2822  3a723a                LD          A,(SHIELD_PHYS+1)
  1275  2825  ce00                  ADC         A,0x0
  1276  2827  27                    DAA                                                 ;BCD Correction
  1277  2828  32723a                LD          (SHIELD_PHYS+1),A
  1278  282b  21713a                LD          HL,SHIELD_PHYS
  1279  282e  116930                LD          DE,CHRRAM_PHYS_SHIELD_IDX               ;= $20
  1280  2831  0602                  LD          B,0x2
  1281  2833  cdfd32                CALL        RECALC_AND_REDRAW_BCD
  1282  2836  21733a                LD          HL,SHIELD_SPRT
  1283  2839  116f30                LD          DE,CHRRAM_SPRT_SHIELD_IDX               ;= $20
  1284  283c  0601                  LD          B,0x1
  1285  283e  cdfd32                CALL        RECALC_AND_REDRAW_BCD
  1286  2841  c3e43d                JP          RHA_REDRAW                              ;Was JP AWAITING_INPUT
  1287                                                                                  ;(c3 9c ea)
  1288                          LAB_ram_e844:
  1289  2844  cce129                CALL        Z,SUB_ram_e9e1
  1290                          CHECK_FOOD_ARROWS:
  1291  2847  fe48                  CP          $48
  1292  2849  384a                  JR          C,CHECK_MAP_NECKLACE_CHARMS             ;CHEST or lower
  1293  284b  fe50                  CP          $50
  1294  284d  3046                  JR          NC,CHECK_MAP_NECKLACE_CHARMS            ;LOCKED CHEST or higher
  1295  284f  cd4129                CALL        PICK_UP_F0_ITEM
  1296  2852  14                    INC         D
  1297  2853  cb12                  RL          D
  1298  2855  14                    INC         D
  1299  2856  fe12                  CP          $12
  1300  2858  202b                  JR          NZ,PICK_UP_ARROWS
  1301  285a  d5                    PUSH        DE
  1302  285b  cd6528                CALL        PICK_UP_FOOD
  1303  285e  d1                    POP         DE
  1304  285f  cd6528                CALL        PICK_UP_FOOD
  1305  2862  c39c2a                JP          INPUT_DEBOUNCE
  1306                          PICK_UP_FOOD:
  1307  2865  3aab3a                LD          A,(FOOD_INV)
  1308  2868  82                    ADD         A,D
  1309  2869  3007                  JR          NC,LAB_ram_e872
  1310  286b  3c                    INC         A
  1311  286c  4f                    LD          C,A
  1312  286d  7a                    LD          A,D
  1313  286e  91                    SUB         C
  1314  286f  57                    LD          D,A
  1315  2870  18f3                  JR          PICK_UP_FOOD
  1316                          LAB_ram_e872:
  1317  2872  32ab3a                LD          (FOOD_INV),A
  1318  2875  2aa93a                LD          HL,(BYTE_ram_3aa9)
  1319  2878  7a                    LD          A,D
  1320  2879  85                    ADD         A,L
  1321  287a  27                    DAA                                                 ;BCD correct
  1322  287b  6f                    LD          L,A
  1323  287c  7c                    LD          A,H
  1324  287d  ce00                  ADC         A,0x0
  1325  287f  27                    DAA                                                 ;BCD correct
  1326  2880  67                    LD          H,A
  1327  2881  22a93a                LD          (BYTE_ram_3aa9),HL
  1328  2884  c9                    RET
  1329                          PICK_UP_ARROWS:
  1330  2885  3aac3a                LD          A,(ARROW_INV)
  1331  2888  82                    ADD         A,D
  1332  2889  fe33                  CP          $33
  1333  288b  3802                  JR          C,ADD_ARROWS_TO_INV
  1334  288d  3e32                  LD          A,$32
  1335                          ADD_ARROWS_TO_INV:
  1336  288f  32ac3a                LD          (ARROW_INV),A
  1337  2892  c39c2a                JP          INPUT_DEBOUNCE
  1338                          CHECK_MAP_NECKLACE_CHARMS:
  1339  2895  fe6c                  CP          $6c                                    ;Red MAP
  1340  2897  2821                  JR          Z,PROCESS_MAP
  1341  2899  fe6d                  CP          $6d                                    ;Yellow MAP
  1342  289b  281d                  JR          Z,PROCESS_MAP
  1343  289d  fede                  CP          $de                                    ;Purple MAP
  1344  289f  2819                  JR          Z,PROCESS_MAP
  1345  28a1  fedf                  CP          $df                                    ;White MAP
  1346  28a3  2815                  JR          Z,PROCESS_MAP
  1347  28a5  00                    db          $00
  1348  28a6  00                    db          $00
  1349  28a7  00                    db          $00
  1350  28a8  00                    db          $00
  1351  28a9  00                    db          $00
  1352  28aa  00                    db          $00
  1353  28ab  00                    db          $00
  1354  28ac  fe5c                  CP          $5c                                    ;WHITE KEY or lower
  1355  28ae  3829                  JR          C,PICK_UP_NON_TREASURE
  1356  28b0  fe64                  CP          $64
  1357  28b2  3025                  JR          NC,PICK_UP_NON_TREASURE                 ;WARRIOR POTION or higher
  1358  28b4  cd4129                CALL        PICK_UP_F0_ITEM
  1359  28b7  c39c2a                JP          INPUT_DEBOUNCE
  1360                          PROCESS_MAP:
  1361  28ba  f5                    PUSH        AF
  1362  28bb  3ab93a                LD          A,(GAME_BOOLEANS)
  1363  28be  cbd7                  SET         0x2,A
  1364  28c0  32b93a                LD          (GAME_BOOLEANS),A
  1365  28c3  f1                    POP         AF
  1366  28c4  cd4129                CALL        PICK_UP_F0_ITEM
  1367  28c7  ed53ad3a              LD          (MAP_INV_SLOT),DE
  1368  28cb  f5                    PUSH        AF
  1369  28cc  3aad3a                LD          A,(MAP_INV_SLOT)
  1370  28cf  cdd83d                CALL        LEVEL_TO_COLRAM_FIX
  1371  28d2  321134                LD          (COLRAM_MAP_IDX),A                      ;= $60    `
  1372  28d5  f1                    POP         AF
  1373  28d6  c39c2a                JP          INPUT_DEBOUNCE
  1374                          PICK_UP_NON_TREASURE:
  1375  28d9  217a3a                LD          HL,RIGHT_HAND_ITEM
  1376  28dc  7e                    LD          A,(HL)
  1377  28dd  32ea37                LD          (ITEM_F0),A                             ;= $60
  1378  28e0  cd622a                CALL        SUB_ram_ea62
  1379  28e3  214333                LD          HL,CHRRAM_RIGHT_HD_GFX_IDX              ;= $20
  1380  28e6  11003a                LD          DE,ITEM_MOVE_CHR_BUFFER
  1381  28e9  cd6029                CALL        UPDATE_MELEE_OBJECTS
  1382  28ec  215233                LD          HL,CHRRAM_FO_ITEM_IDX                   ;= $20
  1383  28ef  114333                LD          DE,CHRRAM_RIGHT_HD_GFX_IDX              ;= $20
  1384  28f2  cd9e29                CALL        SUB_ram_e99e
  1385  28f5  21003a                LD          HL,ITEM_MOVE_CHR_BUFFER
  1386  28f8  115233                LD          DE,CHRRAM_FO_ITEM_IDX                   ;= $20
  1387  28fb  cd7d29                CALL        SUB_ram_e97d
  1388  28fe  215237                LD          HL,COLRAM_FO_ITEM_IDX                   ;= $60    `
  1389  2901  11000f                LD          DE,$f00                                ;BLK on DKGY /
  1390                                                                                  ;BLK on BLK
  1391                                                                                  ;WAS BLK on DKCYN /
  1392                                                                                  ;    BLK on BLK
  1393                                                                                  ;WAS LD DE,$0900
  1394  2904  0ef0                  LD          C,$f0                                  ;Floor color (for compare)
  1395                                                                                  ;DKGRY on BLK
  1396                                                                                  ;WAS DKCYN on BLK
  1397  2906  cd1a29                CALL        RECOLOR_ITEM
  1398  2909  214337                LD          HL,COLRAM_RH_ITEM_IDX                   ;= $60    `
  1399  290c  11f000                LD          DE,$f0                                 ;Floor color (for fill)
  1400                                                                                  ;DKGRY on BLK
  1401                                                                                  ;WAS DKCYN on BLK
  1402  290f  0e00                  LD          C,0x0
  1403  2911  cd1a29                CALL        RECOLOR_ITEM
  1404  2914  cd4227                CALL        NEW_RIGHT_HAND_ITEM
  1405  2917  c39c2a                JP          INPUT_DEBOUNCE
  1406                          RECOLOR_ITEM:
  1407  291a  3e04                  LD          A,0x4
  1408                          LAB_ram_e91c:
  1409  291c  08                    EX          AF,AF'
  1410  291d  0604                  LD          B,0x4
  1411                          LAB_ram_e91f:
  1412  291f  7e                    LD          A,(HL)
  1413  2920  e6f0                  AND         $f0
  1414  2922  bb                    CP          E
  1415  2923  2810                  JR          Z,LAB_ram_e935
  1416  2925  b2                    OR          D
  1417                          LAB_ram_e926:
  1418  2926  77                    LD          (HL),A
  1419  2927  23                    INC         HL
  1420  2928  10f5                  DJNZ        LAB_ram_e91f
  1421  292a  d5                    PUSH        DE
  1422  292b  112400                LD          DE,$24                                 ;Jump ahead 36 cells
  1423                                                                                  ;(40 - 4)
  1424  292e  19                    ADD         HL,DE
  1425  292f  d1                    POP         DE
  1426  2930  08                    EX          AF,AF'
  1427  2931  3d                    DEC         A
  1428  2932  20e8                  JR          NZ,LAB_ram_e91c
  1429  2934  c9                    RET
  1430                          LAB_ram_e935:
  1431  2935  7e                    LD          A,(HL)
  1432  2936  e60f                  AND         0xf
  1433  2938  b1                    OR          C
  1434  2939  18eb                  JR          LAB_ram_e926
  1435                          WAIT_A_TICK:
  1436  293b  010086                LD          BC,$8600                               ;Sleep for 134 "cycles"
  1437  293e  c34b1d                JP          SLEEP                                   ;byte SLEEP(short cycleCount)
  1438                          PICK_UP_F0_ITEM:
  1439  2941  a7                    AND         A                                       ;Reset flags
  1440  2942  08                    EX          AF,AF'                                  ;Save item
  1441  2943  3efe                  LD          A,$fe                                  ;Empty item
  1442  2945  02                    LD          (BC),A
  1443  2946  215233                LD          HL,CHRRAM_FO_ITEM_IDX                   ;= $20
  1444  2949  3e20                  LD          A,$20                                  ;SPACE char
  1445  294b  cda209                CALL        UPDATE_FO_ITEM
  1446  294e  215237                LD          HL,COLRAM_FO_ITEM_IDX                   ;= $60    `
  1447  2951  3edf                  LD          A,$df                                  ;DKGRN on DKGRY
  1448  2953  cda209                CALL        UPDATE_FO_ITEM
  1449  2956  08                    EX          AF,AF'                                  ;Restore item
  1450  2957  1f                    RRA                                                 ;Rotate A right, A:0 to carry
  1451  2958  cb1a                  RR          D                                       ;Rotate D right
  1452                                                                                  ;Carry (from A:0) to D:7
  1453  295a  1f                    RRA                                                 ;Rotate A right, A:0 (was A:1) to carry
  1454  295b  cb12                  RL          D                                       ;Rotate D left, carry to D:0
  1455                                                                                  ;D:7 to carry
  1456  295d  cb12                  RL          D                                       ;Rotate D left, carry to D;0
  1457                                                                                  ;D:7 to carry
  1458                                                                                  ;D  = item level
  1459  295f  c9                    RET
  1460                          UPDATE_MELEE_OBJECTS:
  1461  2960  3e04                  LD          A,0x4
  1462                          LAB_ram_e962:
  1463  2962  010400                LD          BC,0x4
  1464  2965  edb0                  LDIR                                                ;= "OM"
  1465  2967  3d                    DEC         A
  1466  2968  ca7229                JP          Z,LAB_ram_e972
  1467  296b  012400                LD          BC,$24
  1468  296e  09                    ADD         HL,BC
  1469  296f  c36229                JP          LAB_ram_e962
  1470                          LAB_ram_e972:
  1471  2972  7c                    LD          A,H
  1472  2973  fe34                  CP          $34
  1473  2975  d0                    RET         NC
  1474  2976  018403                LD          BC,$384
  1475  2979  09                    ADD         HL,BC
  1476  297a  c36029                JP          UPDATE_MELEE_OBJECTS
  1477                          SUB_ram_e97d:
  1478  297d  3e04                  LD          A,0x4
  1479                          LAB_ram_e97f:
  1480  297f  010400                LD          BC,0x4
  1481  2982  edb0                  LDIR                                                ;= "OM"
  1482  2984  3d                    DEC         A
  1483  2985  ca9129                JP          Z,LAB_ram_e991
  1484  2988  eb                    EX          DE,HL
  1485  2989  012400                LD          BC,$24
  1486  298c  09                    ADD         HL,BC
  1487  298d  eb                    EX          DE,HL
  1488  298e  c37f29                JP          LAB_ram_e97f
  1489                          LAB_ram_e991:
  1490  2991  7a                    LD          A,D
  1491  2992  fe34                  CP          $34
  1492  2994  d0                    RET         NC
  1493  2995  018403                LD          BC,$384
  1494  2998  eb                    EX          DE,HL
  1495  2999  09                    ADD         HL,BC
  1496  299a  eb                    EX          DE,HL
  1497  299b  c37d29                JP          SUB_ram_e97d
  1498                          SUB_ram_e99e:
  1499  299e  3e04                  LD          A,0x4
  1500                          LAB_ram_e9a0:
  1501  29a0  010400                LD          BC,0x4
  1502  29a3  edb0                  LDIR                                                ;= "OM"
  1503  29a5  3d                    DEC         A
  1504  29a6  cab329                JP          Z,LAB_ram_e9b3
  1505  29a9  012400                LD          BC,$24
  1506  29ac  09                    ADD         HL,BC
  1507  29ad  eb                    EX          DE,HL
  1508  29ae  09                    ADD         HL,BC
  1509  29af  eb                    EX          DE,HL
  1510  29b0  c3a029                JP          LAB_ram_e9a0
  1511                          LAB_ram_e9b3:
  1512  29b3  7c                    LD          A,H
  1513  29b4  fe34                  CP          $34
  1514  29b6  d0                    RET         NC
  1515  29b7  018403                LD          BC,$384
  1516  29ba  09                    ADD         HL,BC
  1517  29bb  eb                    EX          DE,HL
  1518  29bc  09                    ADD         HL,BC
  1519  29bd  eb                    EX          DE,HL
  1520  29be  c39e29                JP          SUB_ram_e99e
  1521                          SUB_ram_e9c1:
  1522  29c1  3d                    DEC         A
  1523  29c2  2004                  JR          NZ,LAB_ram_e9c8
  1524  29c4  010105                LD          BC,$501                                ;PHYS = 5
  1525                                                                                  ;SPRT = 1
  1526  29c7  c9                    RET
  1527                          LAB_ram_e9c8:
  1528  29c8  3d                    DEC         A
  1529  29c9  2004                  JR          NZ,LAB_ram_e9cf
  1530  29cb  010408                LD          BC,$804
  1531  29ce  c9                    RET
  1532                          LAB_ram_e9cf:
  1533  29cf  3d                    DEC         A
  1534  29d0  2004                  JR          NZ,LAB_ram_e9d6
  1535  29d2  010812                LD          BC,LAB_ram_1208
  1536  29d5  c9                    RET
  1537                          LAB_ram_e9d6:
  1538  29d6  3d                    DEC         A
  1539  29d7  2004                  JR          NZ,LAB_ram_e9dd
  1540  29d9  011326                LD          BC,BYTE_ram_2613                        ;= $FF
  1541  29dc  c9                    RET
  1542                          LAB_ram_e9dd:
  1543  29dd  010000                LD          BC,0x0
  1544  29e0  c9                    RET
  1545                          SUB_ram_e9e1:
  1546  29e1  3a7a3a                LD          A,(RIGHT_HAND_ITEM)
  1547  29e4  fefe                  CP          $fe
  1548  29e6  2004                  JR          NZ,LAB_ram_e9ec
  1549  29e8  e1                    POP         HL
  1550  29e9  c33022                JP          NO_ACTION_TAKEN
  1551                          LAB_ram_e9ec:
  1552  29ec  3eff                  LD          A,$ff
  1553  29ee  02                    LD          (BC),A
  1554  29ef  0d                    DEC         C
  1555  29f0  0d                    DEC         C
  1556  29f1  7c                    LD          A,H
  1557  29f2  02                    LD          (BC),A
  1558  29f3  0c                    INC         C
  1559  29f4  3efe                  LD          A,$fe
  1560  29f6  02                    LD          (BC),A
  1561  29f7  c9                    RET
  1562                          DO_ROTATE_PACK:
  1563  29f8  217c3a                LD          HL,INV_ITEM_SLOT_1
  1564  29fb  01103a                LD          BC,ITEM_MOVE_COL_BUFFER
  1565  29fe  af                    XOR         A
  1566  29ff  02                    LD          (BC),A
  1567  2a00  cd622a                CALL        SUB_ram_ea62
  1568  2a03  23                    INC         HL
  1569  2a04  017c3a                LD          BC,INV_ITEM_SLOT_1
  1570  2a07  cd622a                CALL        SUB_ram_ea62
  1571  2a0a  1e04                  LD          E,0x4
  1572                          LAB_ram_ea0c:
  1573  2a0c  23                    INC         HL
  1574  2a0d  03                    INC         BC
  1575  2a0e  cd622a                CALL        SUB_ram_ea62
  1576  2a11  1d                    DEC         E
  1577  2a12  c20c2a                JP          NZ,LAB_ram_ea0c
  1578  2a15  21103a                LD          HL,ITEM_MOVE_COL_BUFFER
  1579  2a18  03                    INC         BC
  1580  2a19  cd622a                CALL        SUB_ram_ea62
  1581  2a1c  21b431                LD          HL,DAT_ram_31b4                         ;= $20
  1582  2a1f  11003a                LD          DE,ITEM_MOVE_CHR_BUFFER
  1583  2a22  cd6029                CALL        UPDATE_MELEE_OBJECTS
  1584  2a25  211131                LD          HL,DAT_ram_3111                         ;= $20
  1585  2a28  11b431                LD          DE,DAT_ram_31b4                         ;= $20
  1586  2a2b  cd9e29                CALL        SUB_ram_e99e
  1587  2a2e  210c31                LD          HL,DAT_ram_310c                         ;= $20
  1588  2a31  111131                LD          DE,DAT_ram_3111                         ;= $20
  1589  2a34  cd9e29                CALL        SUB_ram_e99e
  1590  2a37  21a931                LD          HL,CHHRAM_INV_4_IDX                     ;= $20
  1591  2a3a  110c31                LD          DE,DAT_ram_310c                         ;= $20
  1592  2a3d  cd9e29                CALL        SUB_ram_e99e
  1593  2a40  214c32                LD          HL,DAT_ram_324c                         ;= $20
  1594  2a43  11a931                LD          DE,CHHRAM_INV_4_IDX                     ;= $20
  1595  2a46  cd9e29                CALL        SUB_ram_e99e
  1596  2a49  215132                LD          HL,CHHRAM_INV_6_IDX                     ;= $20
  1597  2a4c  114c32                LD          DE,DAT_ram_324c                         ;= $20
  1598  2a4f  cd9e29                CALL        SUB_ram_e99e
  1599  2a52  219f2a                LD          HL,WAIT_FOR_INPUT                    ; WAIT FOR INPUT label --- UNDO???
  1600  2a55  e5                    PUSH        HL
  1601  2a56  21003a                LD          HL,ITEM_MOVE_CHR_BUFFER
  1602  2a59  115132                LD          DE,CHHRAM_INV_6_IDX                     ;= $20
  1603  2a5c  cd7d29                CALL        SUB_ram_e97d
  1604  2a5f  c33b29                JP          WAIT_A_TICK
  1605                          SUB_ram_ea62:
  1606  2a62  56                    LD          D,(HL)
  1607  2a63  0a                    LD          A,(BC)
  1608  2a64  77                    LD          (HL),A
  1609  2a65  7a                    LD          A,D
  1610  2a66  02                    LD          (BC),A
  1611  2a67  c9                    RET
  1612                          DO_SWAP_PACK:
  1613  2a68  217c3a                LD          HL,INV_ITEM_SLOT_1
  1614  2a6b  017a3a                LD          BC,RIGHT_HAND_ITEM
  1615  2a6e  cd622a                CALL        SUB_ram_ea62
  1616  2a71  214333                LD          HL,CHRRAM_RIGHT_HD_GFX_IDX              ;= $20
  1617  2a74  11003a                LD          DE,ITEM_MOVE_CHR_BUFFER
  1618  2a77  cd6029                CALL        UPDATE_MELEE_OBJECTS
  1619  2a7a  21b431                LD          HL,DAT_ram_31b4                         ;= $20
  1620  2a7d  114333                LD          DE,CHRRAM_RIGHT_HD_GFX_IDX              ;= $20
  1621  2a80  cd9e29                CALL        SUB_ram_e99e
  1622  2a83  219f2a                LD          HL,WAIT_FOR_INPUT                    ; WAIT FOR INPUT label --- UNDO???
  1623  2a86  e5                    PUSH        HL
  1624  2a87  21003a                LD          HL,ITEM_MOVE_CHR_BUFFER
  1625  2a8a  11b431                LD          DE,DAT_ram_31b4                         ;= $20
  1626  2a8d  cd7d29                CALL        SUB_ram_e97d
  1627  2a90  cd4227                CALL        NEW_RIGHT_HAND_ITEM
  1628  2a93  c33b29                JP          WAIT_A_TICK
  1629                          UPDATE_VIEWPORT:
  1630  2a96  cde634                CALL        REDRAW_START
  1631  2a99  cd0438                CALL        REDRAW_VIEWPORT
  1632                          INPUT_DEBOUNCE:
  1633  2a9c  cd3b29                CALL        WAIT_A_TICK
  1634                          WAIT_FOR_INPUT:
  1635  2a9f  cd5111                CALL        TIMER_UPDATE
  1636  2aa2  cd5c11                CALL        BLINK_ROUTINE
  1637  2aa5  00                    NOP
  1638  2aa6  00                    NOP
  1639  2aa7  00                    NOP
  1640  2aa8  00                    NOP
  1641  2aa9  305b                  JR          NC,TIMER_UPDATED_CHECK_INPUT
  1642  2aab  216b3a                LD          HL,TIMER_C
  1643  2aae  34                    INC         (HL)
  1644  2aaf  7e                    LD          A,(HL)
  1645  2ab0  fe15                  CP          $15
  1646  2ab2  da062b                JP          C,TIMER_UPDATED_CHECK_INPUT
  1647  2ab5  af                    XOR         A
  1648  2ab6  77                    LD          (HL),A
  1649                          SCREEN_SAVER_FULL_SCREEN:
  1650  2ab7  210008                LD          HL,$800
  1651                          SCREEN_SAVER_REDRAW_LOOP:
  1652  2aba  110034                LD          DE,COLRAM                               ;= $60
  1653                          RECALC_SCREEN_SAVER_COLORS:
  1654  2abd  1a                    LD          A,(DE)                          ;= $60
  1655  2abe  0f                    RRCA
  1656  2abf  12                    LD          (DE),A                          ;= $60
  1657  2ac0  13                    INC         DE
  1658  2ac1  3e38                  LD          A,$38
  1659  2ac3  ba                    CP          D
  1660  2ac4  20f7                  JR          NZ,RECALC_SCREEN_SAVER_COLORS
  1661  2ac6  25                    DEC         H
  1662  2ac7  2002                  JR          NZ,CHECK_INPUT_DURING_SCREEN_SAVER
  1663  2ac9  2608                  LD          H,0x8
  1664                          CHECK_INPUT_DURING_SCREEN_SAVER:
  1665  2acb  2d                    DEC         L
  1666  2acc  28ec                  JR          Z,SCREEN_SAVER_REDRAW_LOOP
  1667  2ace  014001                LD          BC,$140
  1668  2ad1  cd4b1d                CALL        SLEEP                                   ;byte SLEEP(short cycleCount)
  1669  2ad4  01ff00                LD          BC,$ff
  1670  2ad7  ed78                  IN          A,(C)
  1671  2ad9  3c                    INC         A
  1672  2ada  2019                  JR          NZ,LAB_ram_eaf5
  1673  2adc  0ef7                  LD          C,$f7
  1674  2ade  3e0f                  LD          A,0xf
  1675  2ae0  ed79                  OUT         (C),A                              ;= db
  1676  2ae2  0d                    DEC         C
  1677  2ae3  ed78                  IN          A,(C)                     ;= db
  1678  2ae5  3c                    INC         A
  1679  2ae6  c2f52a                JP          NZ,LAB_ram_eaf5
  1680  2ae9  0c                    INC         C
  1681  2aea  3e0e                  LD          A,0xe
  1682  2aec  ed79                  OUT         (C),A                              ;= db
  1683  2aee  0d                    DEC         C
  1684  2aef  ed78                  IN          A,(C)                     ;= db
  1685  2af1  3c                    INC         A
  1686  2af2  cacb2a                JP          Z,CHECK_INPUT_DURING_SCREEN_SAVER
  1687                          LAB_ram_eaf5:
  1688  2af5  110034                LD          DE,COLRAM                               ;= $60
  1689                          LAB_ram_eaf8:
  1690  2af8  44                    LD          B,H
  1691  2af9  1a                    LD          A,(DE)                          ;= $60
  1692                          LAB_ram_eafa:
  1693  2afa  0f                    RRCA
  1694  2afb  10fd                  DJNZ        LAB_ram_eafa
  1695  2afd  12                    LD          (DE),A                          ;= $60
  1696  2afe  13                    INC         DE                  ;= $60
  1697  2aff  3e38                  LD          A,$38
  1698  2b01  ba                    CP          D
  1699  2b02  20f4                  JR          NZ,LAB_ram_eaf8
  1700  2b04  1896                  JR          INPUT_DEBOUNCE
  1701                          TIMER_UPDATED_CHECK_INPUT:
  1702  2b06  3a653a                LD          A,(RAM_AD)
  1703  2b09  fe32                  CP          $32
  1704  2b0b  2846                  JR          Z,LAB_ram_eb53
  1705  2b0d  3a663a                LD          A,(RAM_AE)
  1706  2b10  fe31                  CP          $31
  1707  2b12  2013                  JR          NZ,LAB_ram_eb27
  1708  2b14  21693a                LD          HL,TIMER_A
  1709  2b17  3a893a                LD          A,(BYTE_ram_3a89)
  1710  2b1a  be                    CP          (HL)
  1711  2b1b  c29f2a                JP          NZ,WAIT_FOR_INPUT
  1712  2b1e  cd5024                CALL        SUB_ram_e450
  1713  2b21  cd9a23                CALL        SUB_ram_e39a
  1714  2b24  c39f2a                JP          WAIT_FOR_INPUT
  1715                          LAB_ram_eb27:
  1716  2b27  21693a                LD          HL,TIMER_A
  1717  2b2a  3a8c3a                LD          A,(BYTE_ram_3a8c)
  1718  2b2d  be                    CP          (HL)
  1719  2b2e  c29f2a                JP          NZ,WAIT_FOR_INPUT
  1720  2b31  cd3526                CALL        SUB_ram_e635
  1721  2b34  cd5024                CALL        SUB_ram_e450
  1722  2b37  cd9a23                CALL        SUB_ram_e39a
  1723  2b3a  cdcf25                CALL        MELEE_ANIM_LOOP
  1724  2b3d  c39f2a                JP          WAIT_FOR_INPUT
  1725                          LAB_ram_eb40:
  1726  2b40  21693a                LD          HL,TIMER_A
  1727  2b43  3a8c3a                LD          A,(BYTE_ram_3a8c)
  1728  2b46  be                    CP          (HL)
  1729  2b47  c29f2a                JP          NZ,WAIT_FOR_INPUT
  1730  2b4a  cd3526                CALL        SUB_ram_e635
  1731  2b4d  cdcf25                CALL        MELEE_ANIM_LOOP
  1732  2b50  c39f2a                JP          WAIT_FOR_INPUT
  1733                          LAB_ram_eb53:
  1734  2b53  3a663a                LD          A,(RAM_AE)
  1735  2b56  fe31                  CP          $31
  1736  2b58  20e6                  JR          NZ,LAB_ram_eb40
  1737  2b5a  cdca3a                CALL        UPDATE_SCR_SAVER_TIMER
  1738  2b5d  3a783a                LD          A,(LAST_ITEM_HELD)
  1739  2b60  a7                    AND         A
  1740  2b61  c2d62b                JP          NZ,LAB_ram_ebd6
  1741  2b64  0604                  LD          B,0x4
  1742  2b66  21e937                LD          HL,ITEM_F1                              ;= $60
  1743  2b69  7e                    LD          A,(HL)                         ;= $60
  1744  2b6a  3c                    INC         A
  1745  2b6b  3c                    INC         A
  1746  2b6c  21ec37                LD          HL,ITEM_FR1                             ;= $60
  1747                          LAB_ram_eb6f:
  1748  2b6f  fe7a                  CP          $7a
  1749  2b71  3008                  JR          NC,LAB_ram_eb7b
  1750  2b73  23                    INC         HL
  1751  2b74  7e                    LD          A,(HL)                         ;= $60
  1752  2b75  3c                    INC         A
  1753  2b76  3c                    INC         A
  1754  2b77  10f6                  DJNZ        LAB_ram_eb6f
  1755  2b79  185b                  JR          LAB_ram_ebd6
  1756                          LAB_ram_eb7b:
  1757  2b7b  3a883a                LD          A,(TIMER_D)
  1758  2b7e  fe05                  CP          0x5
  1759  2b80  3054                  JR          NC,LAB_ram_ebd6
  1760  2b82  cdac3a                CALL        MAKE_RANDOM_BYTE
  1761  2b85  c608                  ADD         A,0x8
  1762  2b87  304d                  JR          NC,LAB_ram_ebd6
  1763  2b89  05                    DEC         B
  1764  2b8a  2012                  JR          NZ,LAB_ram_eb9e
  1765  2b8c  3afd33                LD          A,(DAT_ram_33fd)                        ;= $20
  1766  2b8f  cb57                  BIT         0x2,A
  1767  2b91  2003                  JR          NZ,LAB_ram_eb96
  1768  2b93  a7                    AND         A
  1769  2b94  2040                  JR          NZ,LAB_ram_ebd6
  1770                          LAB_ram_eb96:
  1771  2b96  cd232e                CALL        SUB_ram_ee23
  1772  2b99  cd232e                CALL        SUB_ram_ee23
  1773  2b9c  1822                  JR          LAB_ram_ebc0
  1774                          LAB_ram_eb9e:
  1775  2b9e  05                    DEC         B
  1776  2b9f  200f                  JR          NZ,LAB_ram_ebb0
  1777  2ba1  3af533                LD          A,(DAT_ram_33f5)                        ;= $20
  1778  2ba4  cb57                  BIT         0x2,A
  1779  2ba6  2003                  JR          NZ,LAB_ram_ebab
  1780  2ba8  a7                    AND         A
  1781  2ba9  202b                  JR          NZ,LAB_ram_ebd6
  1782                          LAB_ram_ebab:
  1783  2bab  cd0b2e                CALL        SUB_ram_ee0b
  1784  2bae  1810                  JR          LAB_ram_ebc0
  1785                          LAB_ram_ebb0:
  1786  2bb0  05                    DEC         B
  1787  2bb1  2019                  JR          NZ,LAB_ram_ebcc
  1788  2bb3  3af933                LD          A,(DAT_ram_33f9)                        ;= $20
  1789  2bb6  cb57                  BIT         0x2,A
  1790  2bb8  2003                  JR          NZ,LAB_ram_ebbd
  1791  2bba  a7                    AND         A
  1792  2bbb  2019                  JR          NZ,LAB_ram_ebd6
  1793                          LAB_ram_ebbd:
  1794  2bbd  cd232e                CALL        SUB_ram_ee23
  1795                          LAB_ram_ebc0:
  1796  2bc0  cde634                CALL        REDRAW_START
  1797  2bc3  cd0438                CALL        REDRAW_VIEWPORT
  1798                          LAB_ram_ebc6:
  1799  2bc6  cdb70d                CALL        SUB_ram_cd5f
  1800  2bc9  c33031                JP          SUB_ram_f130
  1801                          LAB_ram_ebcc:
  1802  2bcc  3ae833                LD          A,(WALL_F0_STATE)                       ;= $20
  1803  2bcf  cb57                  BIT         0x2,A
  1804  2bd1  20f3                  JR          NZ,LAB_ram_ebc6
  1805  2bd3  a7                    AND         A
  1806  2bd4  28f0                  JR          Z,LAB_ram_ebc6
  1807                          LAB_ram_ebd6:
  1808  2bd6  01ff00                LD          BC,$ff
  1809  2bd9  ed78                  IN          A,(C)
  1810  2bdb  3c                    INC         A
  1811  2bdc  c2522c                JP          NZ,LAB_ram_ec52
  1812  2bdf  0ef7                  LD          C,$f7
  1813  2be1  3e0f                  LD          A,0xf
  1814  2be3  ed79                  OUT         (C),A                              ;= db
  1815  2be5  0d                    DEC         C
  1816  2be6  ed78                  IN          A,(C)                     ;= db
  1817  2be8  3c                    INC         A
  1818  2be9  200c                  JR          NZ,LAB_ram_ebf7
  1819  2beb  0c                    INC         C
  1820  2bec  3e0e                  LD          A,0xe
  1821  2bee  ed79                  OUT         (C),A                              ;= db
  1822  2bf0  0d                    DEC         C
  1823  2bf1  ed78                  IN          A,(C)                     ;= db
  1824  2bf3  3c                    INC         A
  1825  2bf4  ca9f2a                JP          Z,WAIT_FOR_INPUT
  1826                          LAB_ram_ebf7:
  1827  2bf7  cd362c                CALL        PLAY_DESCENDING_SOUND
  1828  2bfa  21fe37                LD          HL,HC_INPUT_HOLDER                      ;= $6060
  1829                          DISABLE_JOY_04:
  1830  2bfd  0ef7                  LD          C,$f7
  1831  2bff  3e0f                  LD          A,0xf
  1832  2c01  ed79                  OUT         (C),A                              ;= db
  1833  2c03  0d                    DEC         C
  1834  2c04  ed78                  IN          A,(C)                     ;= db
  1835  2c06  77                    LD          (HL),A                 ;= $6060
  1836  2c07  23                    INC         HL
  1837  2c08  0c                    INC         C
  1838                          ENABLE_JOY_04:
  1839  2c09  3e0e                  LD          A,0xe
  1840  2c0b  ed79                  OUT         (C),A                              ;= db
  1841  2c0d  0d                    DEC         C
  1842  2c0e  ed78                  IN          A,(C)                     ;= db
  1843  2c10  77                    LD          (HL),A
  1844  2c11  3a6c3a                LD          A,(INPUT_HOLDER)
  1845  2c14  a7                    AND         A
  1846  2c15  c20e0f                JP          NZ,HC_JOY_INPUT_COMPARE
  1847  2c18  3a683a                LD          A,(DUNGEON_LEVEL)
  1848  2c1b  a7                    AND         A
  1849  2c1c  c21020                JP          NZ,GAMEINIT
  1850  2c1f  7e                    LD          A,(HL)
  1851  2c20  3c                    INC         A
  1852  2c21  280e                  JR          Z,TITLE_CHK_FOR_HC_INPUT
  1853                          HC_LEVEL_SELECT_LOOP:
  1854  2c23  fe60                  CP          $60                                    ;K3 pressed on title screen
  1855  2c25  2874                  JR          Z,SET_DIFFICULTY_1
  1856  2c27  fe7c                  CP          $7c
  1857  2c29  2874                  JR          Z,SET_DIFFICULTY_2
  1858  2c2b  fec0                  CP          $c0
  1859  2c2d  2874                  JR          Z,SET_DIFFICULTY_3
  1860  2c2f  185a                  JR          SET_DIFFICULTY_4
  1861                          TITLE_CHK_FOR_HC_INPUT:
  1862  2c31  2b                    DEC         HL
  1863  2c32  7e                    LD          A,(HL)                 ;= $6060
  1864  2c33  3c                    INC         A
  1865  2c34  18ed                  JR          HC_LEVEL_SELECT_LOOP
  1866                          PLAY_DESCENDING_SOUND:
  1867  2c36  af                    XOR         A
  1868  2c37  32693a                LD          (TIMER_A),A
  1869  2c3a  326a3a                LD          (TIMER_B),A
  1870  2c3d  326b3a                LD          (TIMER_C),A
  1871  2c40  d3fc                  OUT         (SPEAKER),A                             ;= db
  1872  2c42  01f000                LD          BC,$f0
  1873  2c45  cd4b1d                CALL        SLEEP                                   ;byte SLEEP(short cycleCount)
  1874  2c48  3c                    INC         A
  1875  2c49  d3fc                  OUT         (SPEAKER),A                             ;= db
  1876  2c4b  01c004                LD          BC,$4c0
  1877  2c4e  cd4b1d                CALL        SLEEP                                   ;byte SLEEP(short cycleCount)
  1878  2c51  c9                    RET
  1879                          LAB_ram_ec52:
  1880  2c52  cd362c                CALL        PLAY_DESCENDING_SOUND
  1881  2c55  21f637                LD          HL,KEY_INPUT_COL0                       ;= $60
  1882  2c58  01fffe                LD          BC,0xfeff                               ; Was LD, BC, GFX_POINTERS
  1883  2c5b  1608                  LD          D,0x8
  1884                          SELECT_DIFFICULTY_LOOP:
  1885  2c5d  ed78                  IN          A,(C)
  1886  2c5f  77                    LD          (HL),A                  ;= $20
  1887                                                                                  ;= $60
  1888  2c60  2c                    INC         L
  1889  2c61  cb00                  RLC         B
  1890  2c63  15                    DEC         D
  1891  2c64  20f7                  JR          NZ,SELECT_DIFFICULTY_LOOP
  1892  2c66  3a6c3a                LD          A,(INPUT_HOLDER)
  1893  2c69  a7                    AND         A
  1894  2c6a  c2e03b                JP          NZ,KEY_COMPARE                          ;OLD = e12c ; NEW = fbe0
  1895  2c6d  3a683a                LD          A,(DUNGEON_LEVEL)
  1896  2c70  a7                    AND         A
  1897  2c71  c21020                JP          NZ,GAMEINIT
  1898  2c74  3afc37                LD          A,(KEY_INPUT_COL6)                      ;= $60
  1899  2c77  fefe                  CP          $fe
  1900  2c79  2820                  JR          Z,SET_DIFFICULTY_1                      ;Key 3 pressed on Title Screen
  1901  2c7b  fedf                  CP          $df
  1902  2c7d  ca4111                JP          Z,SHOW_AUTHOR                           ;Key A pressed (and held)
  1903                                                                                  ;on title screen
  1904  2c80  3afd37                LD          A,(KEY_INPUT_COL7)                      ;= $60
  1905  2c83  fefe                  CP          $fe
  1906  2c85  2818                  JR          Z,SET_DIFFICULTY_2                      ;Key 2 pressed on Title Screen
  1907  2c87  fefb                  CP          $fb
  1908  2c89  2818                  JR          Z,SET_DIFFICULTY_3                      ;Key 1 pressed on Title Screen
  1909                          SET_DIFFICULTY_4:
  1910  2c8b  3e00                  LD          A,0x0                                   ;Some other key pressed on Title Screen
  1911                          GOTO_GAME_START:
  1912  2c8d  326c3a                LD          (INPUT_HOLDER),A
  1913  2c90  3ab93a                LD          A,(GAME_BOOLEANS)
  1914  2c93  cbc7                  SET         0x0,A
  1915  2c95  32b93a                LD          (GAME_BOOLEANS),A
  1916  2c98  c39620                JP          BLANK_SCRN
  1917                          SET_DIFFICULTY_1:
  1918  2c9b  3e01                  LD          A,0x1
  1919  2c9d  18ee                  JR          GOTO_GAME_START
  1920                          SET_DIFFICULTY_2:
  1921  2c9f  3e02                  LD          A,0x2
  1922  2ca1  18ea                  JR          GOTO_GAME_START
  1923                          SET_DIFFICULTY_3:
  1924  2ca3  3e03                  LD          A,0x3
  1925  2ca5  18e6                  JR          GOTO_GAME_START
  1926  2ca7  00                    NOP
  1927  2ca8  00                    NOP
  1928  2ca9  00                    NOP
  1929  2caa  00                    NOP
  1930  2cab  00                    NOP
  1931                          CHK_ITEM:
  1932  2cac  fefe                  CP          $fe                             ; Compare A to $FE
  1933  2cae  c8                    RET         Z                               ; If A == Z, exit ($FE = no item)
  1934  2caf  cb3f                  SRL         A                               ; Shift A right logical, Bit 0 to C
  1935  2cb1  5f                    LD          E,A                             ; New value A into E
  1936  2cb2  daba2c                JP          C,ITEM_WAS_YL_WH                ; If C (ITEM was YEL or WHT), jump ahead
  1937  2cb5  1610                  LD          D,$10                           ; (ITEM was RED or MAG) D = $10
  1938  2cb7  c3bc2c                JP          ITEM_WAS_RD_MG                  ; Jump ahead
  1939                          ITEM_WAS_YL_WH:
  1940  2cba  1630                  LD          D,$30                           ; (ITEM was YEL or WHTD D = $30
  1941                          ITEM_WAS_RD_MG:
  1942  2cbc  cb3f                  SRL         A                               ; Shift A right logical, Bit 0 to C
  1943  2cbe  d2c52c                JP          NC,ITEM_NOT_RD_YL               ; If not C (ITEM was not RED or YEL), jump ahead
  1944  2cc1  3e40                  LD          A,$40                           ; A = $40
  1945  2cc3  82                    ADD         A,D                             ; Add D to A
  1946  2cc4  57                    LD          D,A                             ; D = $40 + $10 (RD MG) or D = $40 + $30 (YL WH)
  1947                          ITEM_NOT_RD_YL:
  1948  2cc5  cb83                  RES         0x0,E                           ; Set Bit 0 of E (old ITEM SRL)
  1949  2cc7  7b                    LD          A,E                             ; Save E back into A
  1950  2cc8  cb27                  SLA         A                               ; Shift A right logical
  1951  2cca  83                    ADD         A,E                             ; Add E () to A
  1952  2ccb  80                    ADD         A,B                             ; Add B (color?) to A
  1953  2ccc  42                    LD          B,D                             ; Put D ($10, $30, or $40) into B
  1954  2ccd  6f                    LD          L,A                             ; Put A into L
  1955  2cce  26ff                  LD          H,$ff                           ; Put $FF into H
  1956  2cd0  5e                    LD          E,(HL)                          ; ITEM/MONSTER GFX_PTR, E = low byte
  1957  2cd1  23                    INC         HL                              ; Increment HL
  1958  2cd2  56                    LD          D,(HL)                          ; ITEM/MONSTER GFX_PTR, D = high byte
  1959  2cd3  3a633a                LD          A,(MON_FS)
  1960  2cd6  67                    LD          H,A
  1961  2cd7  69                    LD          L,C
  1962  2cd8  c33533                JP          GFX_DRAW
  1963                          DO_OPEN_CLOSE:
  1964  2cdb  3aea37                LD          A,(ITEM_F0)                             ;= $60
  1965  2cde  0e00                  LD          C,0x0                                   ;C  = 0
  1966  2ce0  cb3f                  SRL         A                                       ;Move item LEVEL
  1967                                                                                  ;into C
  1968  2ce2  cb19                  RR          C
  1969  2ce4  cb3f                  SRL         A
  1970  2ce6  cb11                  RL          C
  1971  2ce8  cb11                  RL          C
  1972  2cea  fe11                  CP          $11                                    ;Compare to BOX
  1973                                                                                  ;44,45,46,47 2 @ SRL = 11
  1974  2cec  202d                  JR          NZ,LAB_ram_ed1b
  1975  2cee  79                    LD          A,C                                     ;A = C (item level)
  1976  2cef  a7                    AND         A
  1977  2cf0  2809                  JR          Z,DO_OPEN_BOX
  1978  2cf2  cdca3a                CALL        UPDATE_SCR_SAVER_TIMER
  1979  2cf5  0c                    INC         C
  1980                          LAB_ram_ecf6:
  1981  2cf6  91                    SUB         C
  1982  2cf7  30fd                  JR          NC,LAB_ram_ecf6
  1983  2cf9  81                    ADD         A,C
  1984  2cfa  4f                    LD          C,A
  1985                          DO_OPEN_BOX:
  1986  2cfb  ed5f                  LD          A,R                                     ;Semi-random number into A
  1987  2cfd  e607                  AND         0x7
  1988                          PICK_RANDOM_ITEM:
  1989  2cff  d607                  SUB         0x7
  1990  2d01  30fc                  JR          NC,PICK_RANDOM_ITEM
  1991  2d03  c61d                  ADD         A,$1d                                  ;$1d is +1 above range
  1992  2d05  cb19                  RR          C
  1993  2d07  cb18                  RR          B
  1994  2d09  cb19                  RR          C                                       ;C = C/8
  1995  2d0b  17                    RLA
  1996  2d0c  cb10                  RL          B
  1997  2d0e  17                    RLA
  1998  2d0f  08                    EX          AF,AF'
  1999  2d10  3a793a                LD          A,(PLAYER_MAP_POS)
  2000  2d13  cdf337                CALL        ITEM_MAP_CHECK
  2001  2d16  08                    EX          AF,AF'
  2002  2d17  02                    LD          (BC),A
  2003  2d18  c3962a                JP          UPDATE_VIEWPORT
  2004                          LAB_ram_ed1b:
  2005  2d1b  3a793a                LD          A,(PLAYER_MAP_POS)
  2006  2d1e  2638                  LD          H,$38
  2007  2d20  6f                    LD          L,A
  2008  2d21  3a623a                LD          A,(DIR_FACING_SHORT)
  2009  2d24  3d                    DEC         A
  2010  2d25  280a                  JR          Z,NORTH_OPEN_CLOSE_DOOR                 ;Is facing NORTH
  2011  2d27  3d                    DEC         A
  2012  2d28  2820                  JR          Z,SHIFT_EAST_OPEN_CLOSE_DOOR            ;Is facing EAST
  2013  2d2a  3d                    DEC         A
  2014  2d2b  201e                  JR          NZ,LAB_ram_ed4b                         ;Is facing WEST
  2015  2d2d  7d                    LD          A,L                                     ;Is facing SOUTH
  2016  2d2e  c610                  ADD         A,$10
  2017  2d30  6f                    LD          L,A                                     ;Shift SOUTH and process as NORTH
  2018                          NORTH_OPEN_CLOSE_DOOR:
  2019  2d31  cb76                  BIT         0x6,(HL)                                ;N WALL check
  2020  2d33  ca3022                JP          Z,NO_ACTION_TAKEN                       ;...if no N WALL
  2021  2d36  cb6e                  BIT         0x5,(HL)                                ;N hidden DOOR check
  2022  2d38  2804                  JR          Z,SET_N_DOOR_MASK                       ;...if no N hidden DOOR
  2023  2d3a  3e44                  LD          A,$44                                  ;WALL mask
  2024  2d3c  1802                  JR          OPEN_N_CHECK
  2025                          SET_N_DOOR_MASK:
  2026  2d3e  3e22                  LD          A,$22                                  ;DOOR mask
  2027                          OPEN_N_CHECK:
  2028  2d40  cb7e                  BIT         0x7,(HL)                                ;N DOOR-OPEN check
  2029  2d42  c2c12d                JP          NZ,CLOSE_N_DOOR                         ;...if N DOOR not OPEN
  2030  2d45  cbfe                  SET         0x7,(HL)                                ;Set N door closed on wall map
  2031  2d47  c3632d                JP          SET_F0_DOOR_OPEN
  2032                          SHIFT_EAST_OPEN_CLOSE_DOOR:
  2033  2d4a  2c                    INC         L                                       ;Shift EAST and process as WEST
  2034                          LAB_ram_ed4b:
  2035  2d4b  cb4e                  BIT         0x1,(HL)                                ;W WALL check
  2036  2d4d  ca3022                JP          Z,NO_ACTION_TAKEN                       ;...if no W WALL
  2037  2d50  cb46                  BIT         0x0,(HL)                                ;W DOOR check
  2038  2d52  ca5a2d                JP          Z,SET_W_DOOR_MASK                       ;...if no W DOOR
  2039  2d55  3e44                  LD          A,$44                                  ;WALL mask
  2040  2d57  c35c2d                JP          LAB_ram_ed5c
  2041                          SET_W_DOOR_MASK:
  2042  2d5a  3e22                  LD          A,$22
  2043                          LAB_ram_ed5c:
  2044  2d5c  cb56                  BIT         0x2,(HL)                                ;DOOR-OPEN check
  2045  2d5e  c2c62d                JP          NZ,CLOSE_W_DOOR                         ;...if DOOR-OPEN
  2046  2d61  cbd6                  SET         0x2,(HL)                                ;Set W door closed on wall map
  2047                          SET_F0_DOOR_OPEN:
  2048  2d63  21e833                LD          HL,WALL_F0_STATE                        ;= $20
  2049  2d66  cbd6                  SET         0x2,(HL)                 ;= $20
  2050  2d68  08                    EX          AF,AF'                                  ;Save MASK state from A
  2051                          WAIT_TO_REDRAW_F0_DOOR:
  2052  2d69  dbfd                  IN          A,(VSYNC)                               ;= db
  2053  2d6b  3c                    INC         A
  2054  2d6c  28fb                  JR          Z,WAIT_TO_REDRAW_F0_DOOR
  2055  2d6e  3e00                  LD          A,0x0                                   ;BLK on BLK
  2056                                                                                  ;WAS BLU on BLU
  2057                                                                                  ;WAS LD A,$bb
  2058  2d70  cd5609                CALL        DRAW_DOOR_F0
  2059  2d73  3ae937                LD          A,(ITEM_F1)                             ;= $60
  2060  2d76  018a02                LD          BC,$28a
  2061  2d79  cdac2c                CALL        CHK_ITEM
  2062  2d7c  217035                LD          HL,COLRAM_F0_DOOR_IDX                   ;= $60
  2063  2d7f  11003a                LD          DE,ITEM_MOVE_CHR_BUFFER
  2064  2d82  cdaf2d                CALL        SUB_ram_edaf
  2065  2d85  cd540e                CALL        SETUP_OPEN_DOOR_SOUND
  2066  2d88  d9                    EXX
  2067  2d89  21583a                LD          HL,BYTE_ram_3a58
  2068  2d8c  112837                LD          DE,DAT_ram_3728                         ;= $60
  2069  2d8f  3e0c                  LD          A,0xc
  2070                          LAB_ram_ed91:
  2071  2d91  08                    EX          AF,AF'
  2072  2d92  d9                    EXX
  2073  2d93  cd5a0e                CALL        LO_HI_PITCH_SOUND
  2074  2d96  d9                    EXX
  2075  2d97  010800                LD          BC,0x8
  2076  2d9a  edb0                  LDIR                                                ;= $60
  2077  2d9c  011000                LD          BC,$10
  2078  2d9f  ed42                  SBC         HL,BC
  2079  2da1  eb                    EX          DE,HL
  2080  2da2  013000                LD          BC,$30
  2081  2da5  ed42                  SBC         HL,BC
  2082  2da7  eb                    EX          DE,HL
  2083  2da8  08                    EX          AF,AF'
  2084  2da9  3d                    DEC         A
  2085  2daa  ca9f2a                JP          Z,WAIT_FOR_INPUT
  2086  2dad  18e2                  JR          LAB_ram_ed91
  2087                          SUB_ram_edaf:
  2088  2daf  3e0c                  LD          A,0xc
  2089                          LAB_ram_edb1:
  2090  2db1  010800                LD          BC,0x8
  2091  2db4  edb0                  LDIR
  2092  2db6  012000                LD          BC,$20
  2093  2db9  09                    ADD         HL,BC
  2094  2dba  3d                    DEC         A
  2095  2dbb  20f4                  JR          NZ,LAB_ram_edb1
  2096  2dbd  08                    EX          AF,AF'
  2097  2dbe  c35609                JP          DRAW_DOOR_F0
  2098                          CLOSE_N_DOOR:
  2099  2dc1  cbbe                  RES         0x7,(HL)                                ;Set N Door map flag to closed
  2100  2dc3  c3c82d                JP          START_DOOR_CLOSE_ANIM
  2101                          CLOSE_W_DOOR:
  2102  2dc6  cb96                  RES         0x2,(HL)                                ;Set W Door map flag to closed
  2103                          START_DOOR_CLOSE_ANIM:
  2104  2dc8  21e833                LD          HL,WALL_F0_STATE                        ;= $20
  2105  2dcb  cb96                  RES         0x2,(HL)                 ;= $20
  2106  2dcd  08                    EX          AF,AF'
  2107  2dce  3a793a                LD          A,(PLAYER_MAP_POS)
  2108  2dd1  32773a                LD          (PLAYER_PREV_MAP_LOC),A
  2109  2dd4  cd680e                CALL        SETUP_CLOSE_DOOR_SOUND
  2110  2dd7  d9                    EXX
  2111  2dd8  08                    EX          AF,AF'
  2112  2dd9  217035                LD          HL,COLRAM_F0_DOOR_IDX                   ;= $60
  2113  2ddc  112000                LD          DE,$20
  2114  2ddf  01080c                LD          BC,$c08
  2115                          DOOR_CLOSE_ANIM_LOOP:
  2116  2de2  77                    LD          (HL),A              ;= $60
  2117  2de3  2c                    INC         L
  2118  2de4  0d                    DEC         C
  2119  2de5  c2e22d                JP          NZ,DOOR_CLOSE_ANIM_LOOP
  2120  2de8  d9                    EXX
  2121  2de9  08                    EX          AF,AF'
  2122  2dea  cd6e0e                CALL        HI_LO_PITCH_SOUND
  2123  2ded  08                    EX          AF,AF'
  2124  2dee  d9                    EXX
  2125  2def  0e08                  LD          C,0x8
  2126  2df1  19                    ADD         HL,DE
  2127  2df2  10ee                  DJNZ        DOOR_CLOSE_ANIM_LOOP
  2128  2df4  cdab25                CALL        CLEAR_MONSTER_STATS
  2129  2df7  c39f2a                JP          WAIT_FOR_INPUT
  2130  2dfa  010016                LD          BC,$1600
  2131  2dfd  c34b1d                JP          SLEEP                                   ;byte SLEEP(short cycleCount)
  2132                          DO_TURN_LEFT:
  2133  2e00  3a783a                LD          A,(LAST_ITEM_HELD)
  2134  2e03  a7                    AND         A
  2135  2e04  c23022                JP          NZ,NO_ACTION_TAKEN
  2136  2e07  21962a                LD          HL,UPDATE_VIEWPORT
  2137  2e0a  e5                    PUSH        HL
  2138                          SUB_ram_ee0b:
  2139  2e0b  3a623a                LD          A,(DIR_FACING_SHORT)
  2140  2e0e  3d                    DEC         A
  2141  2e0f  c2142e                JP          NZ,LAB_ram_ee14
  2142  2e12  3e04                  LD          A,0x4
  2143                          LAB_ram_ee14:
  2144  2e14  32623a                LD          (DIR_FACING_SHORT),A
  2145  2e17  c9                    RET
  2146                          DO_TURN_RIGHT:
  2147  2e18  3a783a                LD          A,(LAST_ITEM_HELD)
  2148  2e1b  a7                    AND         A
  2149  2e1c  c23022                JP          NZ,NO_ACTION_TAKEN
  2150  2e1f  21962a                LD          HL,UPDATE_VIEWPORT
  2151  2e22  e5                    PUSH        HL
  2152                          SUB_ram_ee23:
  2153  2e23  3a623a                LD          A,(DIR_FACING_SHORT)
  2154  2e26  3c                    INC         A
  2155  2e27  fe05                  CP          0x5
  2156  2e29  c22e2e                JP          NZ,LAB_ram_ee2e
  2157  2e2c  3e01                  LD          A,0x1
  2158                          LAB_ram_ee2e:
  2159  2e2e  32623a                LD          (DIR_FACING_SHORT),A
  2160  2e31  c9                    RET
  2161                          DO_GLANCE_RIGHT:
  2162  2e32  3a783a                LD          A,(LAST_ITEM_HELD)
  2163  2e35  a7                    AND         A
  2164  2e36  c23022                JP          NZ,NO_ACTION_TAKEN
  2165  2e39  cd232e                CALL        SUB_ram_ee23
  2166  2e3c  cde634                CALL        REDRAW_START
  2167  2e3f  cd0438                CALL        REDRAW_VIEWPORT
  2168  2e42  cd481d                CALL        SLEEP_ZERO                              ;byte SLEEP_ZERO(void)
  2169  2e45  c3002e                JP          DO_TURN_LEFT
  2170                          DO_GLANCE_LEFT:
  2171  2e48  3a783a                LD          A,(LAST_ITEM_HELD)
  2172  2e4b  a7                    AND         A
  2173  2e4c  c23022                JP          NZ,NO_ACTION_TAKEN
  2174  2e4f  cd0b2e                CALL        SUB_ram_ee0b
  2175  2e52  cde634                CALL        REDRAW_START
  2176  2e55  cd0438                CALL        REDRAW_VIEWPORT
  2177  2e58  cd481d                CALL        SLEEP_ZERO                              ;byte SLEEP_ZERO(void)
  2178  2e5b  c3182e                JP          DO_TURN_RIGHT
  2179                          DO_USE_ATTACK:
  2180  2e5e  3a7a3a                LD          A,(RIGHT_HAND_ITEM)
  2181  2e61  0600                  LD          B,0x0
  2182  2e63  cb3f                  SRL         A                                       ;Remove "color/level" in bit 0
  2183                                                                                  ;to compare item type, below.
  2184  2e65  cb18                  RR          B                                       ;Push bit 0 from A
  2185                                                                                  ;(via Carry Flag) to B
  2186  2e67  cb3f                  SRL         A                                       ;Remove second "color/level" in bit 1
  2187                                                                                  ;to compare item type, below
  2188  2e69  cb10                  RL          B                                       ;Move bits 0 & 1
  2189                                                                                  ;from A to B...
  2190  2e6b  cb10                  RL          B                                       ;B now has the LEVEL value (0-3)
  2191  2e6d  00                    NOP                                                 ;Was USE_MAP
  2192  2e6e  00                    NOP
  2193  2e6f  00                    NOP
  2194  2e70  00                    NOP
  2195  2e71  00                    NOP
  2196  2e72  fe16                  CP          $16                                    ;Compare to KEY
  2197                                                                                  ;58,59,5A,5B 2 @ SRL = 16
  2198  2e74  ca2130                JP          Z,DO_USE_KEY
  2199  2e77  fe19                  CP          $19                                    ;Compare to PHYS POTION
  2200                                                                                  ;64,65,66,67 2 @ SRL = 19
  2201  2e79  caf12f                JP          Z,DO_USE_PHYS_POTION
  2202  2e7c  fe1a                  CP          $1a                                    ;Compare to SPRT POTION
  2203                                                                                  ;68,69,6A,6B 2 @ SRL = 1A
  2204  2e7e  ca0930                JP          Z,DO_USE_SPRT_POTION
  2205  2e81  fe1c                  CP          $1c                                    ;Compare to CHAOS POTION
  2206                                                                                  ;70,71,72,73 2 @ SRL = 1c
  2207  2e83  c28230                JP          NZ,USE_SOMETHING_ELSE
  2208                          DO_USE_CHAOS_POTION:
  2209  2e86  cd9d2e                CALL        PLAY_USE_PHYS_POTION_SOUND
  2210  2e89  04                    INC         B
  2211  2e8a  05                    DEC         B
  2212  2e8b  2052                  JR          NZ,CHECK_YELLOW_L_POTION                ;If NZ, handle other colors
  2213                                                                                  ;of LARGE POTION
  2214  2e8d  cdbc2e                CALL        TOTAL_HEAL                              ;LARGE Potion is RED
  2215                                                                                  ;so do TOTAL HEAL
  2216                          PROCESS_POTION_UPDATES:
  2217  2e90  cd5d3d                CALL        REDRAW_STATS
  2218  2e93  3a783a                LD          A,(LAST_ITEM_HELD)
  2219  2e96  a7                    AND         A
  2220  2e97  c24e32                JP          NZ,INIT_MELEE_ANIM
  2221  2e9a  c39c2a                JP          INPUT_DEBOUNCE
  2222                          PLAY_USE_PHYS_POTION_SOUND:
  2223  2e9d  d9                    EXX
  2224  2e9e  cda10e                CALL        SOUND_03
  2225  2ea1  cda10e                CALL        SOUND_03
  2226  2ea4  cda10e                CALL        SOUND_03
  2227  2ea7  1801                  JR          CLEAR_RIGHT_HAND
  2228                          SUB_ram_eea9:
  2229  2ea9  d9                    EXX
  2230                          CLEAR_RIGHT_HAND:
  2231  2eaa  3efe                  LD          A,$fe
  2232  2eac  327a3a                LD          (RIGHT_HAND_ITEM),A
  2233  2eaf  11e307                LD          DE,POOF_6                               ;= "    ",$01
  2234  2eb2  214333                LD          HL,CHRRAM_RIGHT_HD_GFX_IDX              ;= $20
  2235  2eb5  06d0                  LD          B,$d0
  2236  2eb7  cd3533                CALL        GFX_DRAW
  2237  2eba  d9                    EXX
  2238  2ebb  c9                    RET
  2239                          TOTAL_HEAL:
  2240  2ebc  2a953a                LD          HL,(PLAYER_PHYS_HEALTH_MAX)
  2241  2ebf  22933a                LD          (PLAYER_PHYS_HEALTH),HL
  2242  2ec2  3a983a                LD          A,(PLAYER_SPRT_HEALTH_MAX)
  2243  2ec5  32973a                LD          (PLAYER_SPRT_HEALTH),A
  2244  2ec8  c9                    RET
  2245                          REDRAW_STATS_OLD:
  2246  2ec9  21933a                LD          HL,PLAYER_PHYS_HEALTH
  2247  2ecc  114130                LD          DE,CHRRAM_PHYS_HEALTH_1000              ;= $20
  2248  2ecf  0602                  LD          B,0x2
  2249  2ed1  cdfd32                CALL        RECALC_AND_REDRAW_BCD
  2250  2ed4  21973a                LD          HL,PLAYER_SPRT_HEALTH
  2251  2ed7  114730                LD          DE,CHRRAM_SPRT_HEALTH_10                ;= $20
  2252  2eda  0601                  LD          B,0x1
  2253  2edc  c3fd32                JP          RECALC_AND_REDRAW_BCD                   ;Waz JP FUN_ram_f2fd
  2254                                                                                  ;(c3 fd f2)
  2255                          CHECK_YELLOW_L_POTION:
  2256  2edf  05                    DEC         B
  2257  2ee0  200d                  JR          NZ,CHECK_PURPLE_L_POTION
  2258  2ee2  011000                LD          BC,$10                                 ;Set PHYS increase to 10
  2259  2ee5  1e00                  LD          E,0x0                                   ;Set SPRT increase to 0
  2260                          PROCESS_LARGE_POTION:
  2261  2ee7  cd322f                CALL        CALC_CURR_PHYS_HEALTH
  2262  2eea  cd572f                CALL        CALC_MAX_PHYS_HEALTH
  2263  2eed  18a1                  JR          PROCESS_POTION_UPDATES
  2264                          CHECK_PURPLE_L_POTION:
  2265  2eef  05                    DEC         B
  2266  2ef0  2007                  JR          NZ,CHECK_WHITE_L_POTION
  2267  2ef2  010000                LD          BC,0x0                                  ;Set PHYS increase to 0
  2268  2ef5  1e06                  LD          E,0x6                    ;Set SPRT increase to 6
  2269  2ef7  18ee                  JR          PROCESS_LARGE_POTION
  2270                          CHECK_WHITE_L_POTION:
  2271  2ef9  cdac3a                CALL        MAKE_RANDOM_BYTE                        ;Get RANDOM BYTE
  2272                                                                                  ;and put into A
  2273  2efc  e603                  AND         0x3                                     ;Range it to 0-3
  2274  2efe  3d                    DEC         A
  2275  2eff  2007                  JR          NZ,LAB_ram_ef08                         ;If NZ, check for case 1
  2276  2f01  1e00                  LD          E,0x0                    ;Case 0: set SPRT increase to 0
  2277  2f03  012000                LD          BC,$20                                 ;Set PHYS increase to 20
  2278  2f06  18df                  JR          PROCESS_LARGE_POTION                    ;...and reprocess
  2279                          LAB_ram_ef08:
  2280  2f08  3d                    DEC         A
  2281  2f09  2007                  JR          NZ,LAB_ram_ef12
  2282  2f0b  010000                LD          BC,0x0                                  ;Set PHYS increase to 0
  2283  2f0e  1e12                  LD          E,$12                ;Set SPRT increase to 12
  2284  2f10  18d5                  JR          PROCESS_LARGE_POTION
  2285                          LAB_ram_ef12:
  2286  2f12  3d                    DEC         A
  2287  2f13  200a                  JR          NZ,CHECK_CASE_3_WL_POTION
  2288  2f15  cdbc2e                CALL        TOTAL_HEAL                              ;Fill up PHYS and SPRT
  2289  2f18  011000                LD          BC,$10                                 ;Set PHYS increase to 10
  2290  2f1b  1e06                  LD          E,0x6                    ;Set SPRT increase to 6
  2291  2f1d  18c8                  JR          PROCESS_LARGE_POTION
  2292                          CHECK_CASE_3_WL_POTION:
  2293  2f1f  013000                LD          BC,$30                                 ;Set PHYS decrease to 30
  2294  2f22  1e15                  LD          E,$15                                  ;Set SPRT decrease to 15
  2295  2f24  cd732f                CALL        REDUCE_HEALTH_BIG
  2296  2f27  011500                LD          BC,$15
  2297  2f2a  1e07                  LD          E,0x7
  2298  2f2c  cd8e2f                CALL        REDUCE_HEALTH_SMALL
  2299  2f2f  c3902e                JP          PROCESS_POTION_UPDATES
  2300                          CALC_CURR_PHYS_HEALTH:
  2301  2f32  2a933a                LD          HL,(PLAYER_PHYS_HEALTH)                 ;Load current PHYS Health
  2302                                                                                  ;into HL
  2303  2f35  7d                    LD          A,L
  2304  2f36  81                    ADD         A,C
  2305  2f37  27                    DAA                                                 ;Correct 1000s & 100s
  2306                                                                                  ;for BCD
  2307  2f38  6f                    LD          L,A
  2308  2f39  7c                    LD          A,H
  2309  2f3a  88                    ADC         A,B
  2310  2f3b  27                    DAA                                                 ;Correct 10s & 1s
  2311                                                                                  ;for BCD
  2312  2f3c  fe02                  CP          0x2
  2313  2f3e  67                    LD          H,A
  2314  2f3f  2004                  JR          NZ,UPDATE_HEALTH_VALUES
  2315  2f41  2601                  LD          H,0x1
  2316  2f43  2e99                  LD          L,$99                                  ;Max PHYS Health of 199
  2317                          UPDATE_HEALTH_VALUES:
  2318  2f45  22933a                LD          (PLAYER_PHYS_HEALTH),HL
  2319  2f48  3a973a                LD          A,(PLAYER_SPRT_HEALTH)
  2320  2f4b  83                    ADD         A,E
  2321  2f4c  27                    DAA                                                 ;Correct for BCD
  2322  2f4d  32973a                LD          (PLAYER_SPRT_HEALTH),A
  2323  2f50  d0                    RET         NC
  2324  2f51  3e99                  LD          A,$99                                  ;Max SPRT Health of 99
  2325  2f53  32973a                LD          (PLAYER_SPRT_HEALTH),A
  2326  2f56  c9                    RET
  2327                          CALC_MAX_PHYS_HEALTH:
  2328  2f57  2a933a                LD          HL,(PLAYER_PHYS_HEALTH)
  2329  2f5a  ed4b953a              LD          BC,(PLAYER_PHYS_HEALTH_MAX)
  2330  2f5e  7c                    LD          A,H
  2331  2f5f  b8                    CP          B
  2332  2f60  3807                  JR          C,CALC_MAX_SPRT_HEALTH
  2333  2f62  7d                    LD          A,L
  2334  2f63  b9                    CP          C
  2335  2f64  3803                  JR          C,CALC_MAX_SPRT_HEALTH
  2336  2f66  22953a                LD          (PLAYER_PHYS_HEALTH_MAX),HL
  2337                          CALC_MAX_SPRT_HEALTH:
  2338  2f69  21983a                LD          HL,PLAYER_SPRT_HEALTH_MAX
  2339  2f6c  3a973a                LD          A,(PLAYER_SPRT_HEALTH)
  2340  2f6f  be                    CP          (HL)
  2341  2f70  d8                    RET         C
  2342  2f71  77                    LD          (HL),A
  2343  2f72  c9                    RET
  2344                          REDUCE_HEALTH_BIG:
  2345  2f73  2a933a                LD          HL,(PLAYER_PHYS_HEALTH)
  2346  2f76  7d                    LD          A,L
  2347  2f77  91                    SUB         C
  2348  2f78  27                    DAA
  2349  2f79  6f                    LD          L,A
  2350  2f7a  7c                    LD          A,H
  2351  2f7b  98                    SBC         A,B
  2352  2f7c  27                    DAA
  2353  2f7d  67                    LD          H,A
  2354  2f7e  3829                  JR          C,PLAYER_DIES
  2355  2f80  22933a                LD          (PLAYER_PHYS_HEALTH),HL
  2356  2f83  3a973a                LD          A,(PLAYER_SPRT_HEALTH)
  2357  2f86  93                    SUB         E
  2358  2f87  27                    DAA
  2359  2f88  381f                  JR          C,PLAYER_DIES
  2360  2f8a  32973a                LD          (PLAYER_SPRT_HEALTH),A
  2361  2f8d  c9                    RET
  2362                          REDUCE_HEALTH_SMALL:
  2363  2f8e  2a953a                LD          HL,(PLAYER_PHYS_HEALTH_MAX)
  2364  2f91  7d                    LD          A,L
  2365  2f92  91                    SUB         C
  2366  2f93  27                    DAA
  2367  2f94  6f                    LD          L,A
  2368  2f95  7c                    LD          A,H
  2369  2f96  98                    SBC         A,B
  2370  2f97  27                    DAA
  2371  2f98  67                    LD          H,A
  2372  2f99  380e                  JR          C,PLAYER_DIES
  2373  2f9b  22953a                LD          (PLAYER_PHYS_HEALTH_MAX),HL
  2374  2f9e  3a983a                LD          A,(PLAYER_SPRT_HEALTH_MAX)
  2375  2fa1  93                    SUB         E
  2376  2fa2  27                    DAA
  2377  2fa3  3804                  JR          C,PLAYER_DIES
  2378  2fa5  32983a                LD          (PLAYER_SPRT_HEALTH_MAX),A
  2379  2fa8  c9                    RET
  2380                          PLAYER_DIES:
  2381  2fa9  212834                LD          HL,COLRAM_VIEWPORT_IDX                  ;= $60    `
  2382  2fac  011818                LD          BC,$1818                               ;18 x 18 rectangle
  2383  2faf  af                    XOR         A
  2384  2fb0  cd3609                CALL        FILL_CHRCOL_RECT
  2385  2fb3  21e731                LD          HL,CHRRAM_YOU_DIED_IDX                  ;= $20
  2386  2fb6  11c808                LD          DE,YOU_DIED_TXT
  2387  2fb9  3a6c3a                LD          A,(INPUT_HOLDER)
  2388  2fbc  32783a                LD          (LAST_ITEM_HELD),A
  2389  2fbf  07                    RLCA
  2390  2fc0  07                    RLCA
  2391  2fc1  07                    RLCA
  2392  2fc2  07                    RLCA
  2393  2fc3  47                    LD          B,A
  2394  2fc4  cd3533                CALL        GFX_DRAW
  2395  2fc7  210000                LD          HL,0x0
  2396  2fca  22933a                LD          (PLAYER_PHYS_HEALTH),HL
  2397  2fcd  af                    XOR         A
  2398  2fce  32973a                LD          (PLAYER_SPRT_HEALTH),A
  2399  2fd1  326c3a                LD          (INPUT_HOLDER),A
  2400  2fd4  cd5d3d                CALL        REDRAW_STATS
  2401  2fd7  3e32                  LD          A,$32
  2402  2fd9  32653a                LD          (RAM_AD),A
  2403  2fdc  cd2c0e                CALL        SUB_ram_cdd3
  2404  2fdf  cd481d                CALL        SLEEP_ZERO                              ;byte SLEEP_ZERO(void)
  2405  2fe2  c3b72a                JP          SCREEN_SAVER_FULL_SCREEN
  2406                          
  2407                          ; Delete next during high rom reshuffle
  2408                          YOU_DIED_TXT_OLD:
  2409  2fe5  7fa0596f75206469      DB          $7F,$A0,"You died ",$FF
              656420ff          
  2410                          
  2411                          DO_USE_PHYS_POTION:
  2412  2ff1  cd9d2e                CALL        PLAY_USE_PHYS_POTION_SOUND
  2413  2ff4  04                    INC         B                                       ;Change from LEVEL to
  2414                                                                                  ;COLOR value (Level + 1)
  2415  2ff5  60                    LD          H,B
  2416  2ff6  68                    LD          L,B
  2417  2ff7  224134                LD          (COLRAM_PHYS_STATS_1000),HL             ;Update PHYS color (1000s & 100s)
  2418                                                                                  ;to potion level on BLK
  2419  2ffa  224334                LD          (COLRAM_PHYS_STATS_10),HL               ;Update PHYS color (10s & 1s)
  2420                                                                                  ;to potion level on BLK
  2421  2ffd  26d0                  LD          H,$d0                                  ;DKGRN on BLK
  2422  2fff  6c                    LD          L,H
  2423  3000  224634                LD          (COLRAM_SPRT_STATS_10),HL               ;Update SPRT color (10s)
  2424                                                                                  ;to DKGRN on BLACK
  2425  3003  224734                LD          (COLRAM_SPRT_STATS_1),HL                ;Update SPRT color (1s)
  2426                                                                                  ;to DKGRN on BLACK
  2427  3006  c3902e                JP          PROCESS_POTION_UPDATES
  2428                          DO_USE_SPRT_POTION:
  2429  3009  cd9d2e                CALL        PLAY_USE_PHYS_POTION_SOUND
  2430  300c  04                    INC         B                                       ;Change from LEVEL to
  2431                                                                                  ;COLOR value (Level + 1)
  2432  300d  60                    LD          H,B
  2433  300e  68                    LD          L,B
  2434  300f  224634                LD          (COLRAM_SPRT_STATS_10),HL               ;Update SPRT color (10s)
  2435                                                                                  ;to potion level on BLK
  2436  3012  224734                LD          (COLRAM_SPRT_STATS_1),HL                ;Update SPRT color (1s)
  2437                                                                                  ;to potion level on BLK
  2438  3015  26d0                  LD          H,$d0                                  ;DKGRN on BLK
  2439  3017  6c                    LD          L,H
  2440  3018  224134                LD          (COLRAM_PHYS_STATS_1000),HL             ;Update PHYS color (1000s & 100s)
  2441                                                                                  ;to DKGRN on BLK
  2442  301b  224334                LD          (COLRAM_PHYS_STATS_10),HL               ;Update PHYS color (10s & 1s)
  2443                                                                                  ;to DKGRN on BLK
  2444  301e  c3902e                JP          PROCESS_POTION_UPDATES
  2445                          DO_USE_KEY:
  2446  3021  3aea37                LD          A,(ITEM_F0)                             ;= $60
  2447  3024  0e00                  LD          C,0x0
  2448  3026  cb3f                  SRL         A
  2449  3028  cb19                  RR          C
  2450  302a  cb3f                  SRL         A
  2451  302c  cb11                  RL          C
  2452  302e  cb11                  RL          C
  2453  3030  fe14                  CP          $14
  2454  3032  c23022                JP          NZ,NO_ACTION_TAKEN
  2455  3035  78                    LD          A,B
  2456  3036  b9                    CP          C
  2457  3037  da3022                JP          C,NO_ACTION_TAKEN
  2458  303a  79                    LD          A,C
  2459  303b  47                    LD          B,A
  2460  303c  a7                    AND         A
  2461  303d  2809                  JR          Z,LAB_ram_f048
  2462  303f  cdca3a                CALL        UPDATE_SCR_SAVER_TIMER
  2463  3042  0c                    INC         C
  2464                          LAB_ram_f043:
  2465  3043  91                    SUB         C
  2466  3044  30fd                  JR          NC,LAB_ram_f043
  2467  3046  81                    ADD         A,C
  2468  3047  47                    LD          B,A
  2469                          LAB_ram_f048:
  2470  3048  ed5f                  LD          A,R                                     ;Semi-random number into A
  2471  304a  e607                  AND         0x7
  2472                          LAB_ram_f04c:
  2473  304c  2823                  JR          Z,LAB_ram_f071
  2474  304e  d607                  SUB         0x7
  2475                          LAB_ram_f050:
  2476  3050  30fa                  JR          NC,LAB_ram_f04c
  2477  3052  c61d                  ADD         A,$1d
  2478                          LAB_ram_f054:
  2479  3054  cb18                  RR          B
  2480  3056  cb19                  RR          C
  2481  3058  cb18                  RR          B
  2482  305a  17                    RLA
  2483  305b  cb11                  RL          C
  2484  305d  17                    RLA
  2485  305e  08                    EX          AF,AF'
  2486  305f  3a793a                LD          A,(PLAYER_MAP_POS)
  2487  3062  cdf337                CALL        ITEM_MAP_CHECK
  2488  3065  08                    EX          AF,AF'
  2489  3066  02                    LD          (BC),A
  2490  3067  3a783a                LD          A,(LAST_ITEM_HELD)
  2491  306a  a7                    AND         A
  2492  306b  c24e32                JP          NZ,INIT_MELEE_ANIM
  2493  306e  c3962a                JP          UPDATE_VIEWPORT
  2494                          LAB_ram_f071:
  2495  3071  79                    LD          A,C
  2496  3072  fe04                  CP          0x4
  2497  3074  ca7c30                JP          Z,LAB_ram_f07c
  2498  3077  47                    LD          B,A
  2499  3078  3e16                  LD          A,$16
  2500  307a  18d8                  JR          LAB_ram_f054
  2501                          LAB_ram_f07c:
  2502  307c  0603                  LD          B,0x3
  2503  307e  3e1c                  LD          A,$1c
  2504  3080  18d2                  JR          LAB_ram_f054
  2505                          USE_SOMETHING_ELSE:
  2506  3082  08                    EX          AF,AF'
  2507  3083  3ae833                LD          A,(WALL_F0_STATE)                       ;= $20
  2508  3086  a7                    AND         A
  2509  3087  2804                  JR          Z,CHECK_FOR_NON_ITEMS
  2510  3089  cb57                  BIT         0x2,A
  2511  308b  280b                  JR          Z,CHECK_FOR_END_ITEM
  2512                          CHECK_FOR_NON_ITEMS:
  2513  308d  3ae937                LD          A,(ITEM_F1)                             ;= $60
  2514  3090  fefe                  CP          $fe                                    ;Compare to EMPTY
  2515  3092  2804                  JR          Z,CHECK_FOR_END_ITEM
  2516  3094  fe78                  CP          $78                                    ;Compare to MONSTERS
  2517  3096  3007                  JR          NC,CHECK_IF_BOW_XBOW
  2518                          CHECK_FOR_END_ITEM:
  2519  3098  08                    EX          AF,AF'
  2520  3099  feff                  CP          $ff                                    ;Compare to EMPTY-END
  2521  309b  c23022                JP          NZ,NO_ACTION_TAKEN
  2522  309e  08                    EX          AF,AF'
  2523                          CHECK_IF_BOW_XBOW:
  2524  309f  08                    EX          AF,AF'
  2525  30a0  fe06                  CP          0x6                                     ;Compare to BOW
  2526  30a2  201b                  JR          NZ,CHECK_IF_SCROLL_STAFF
  2527                          USE_BOW_XBOW:
  2528  30a4  c5                    PUSH        BC                                      ;Save BC
  2529  30a5  3aac3a                LD          A,(ARROW_INV)                           ;Get Arrow Inventory
  2530  30a8  d601                  SUB         0x1                                     ;Decrease by 1
  2531  30aa  da3022                JP          C,NO_ACTION_TAKEN                       ;If Arrow Inv <1, end
  2532  30ad  32ac3a                LD          (ARROW_INV),A
  2533  30b0  cd3f23                CALL        CHK_ITEM_BREAK
  2534  30b3  c1                    POP         BC
  2535  30b4  3005                  JR          NC,BOW_XBOW_NO_BREAK
  2536  30b6  3efe                  LD          A,$fe                                  ;$fe = EMPTY ITEM
  2537  30b8  327a3a                LD          (RIGHT_HAND_ITEM),A                     ;Put EMPTY ITEM into Right Hand
  2538                          BOW_XBOW_NO_BREAK:
  2539  30bb  1605                  LD          D,0x5
  2540  30bd  182a                  JR          LAB_ram_f0e9
  2541                          CHECK_IF_SCROLL_STAFF:
  2542  30bf  fe07                  CP          0x7                                     ;Compare to SCROLL
  2543  30c1  2010                  JR          NZ,CHECK_OTHERS
  2544                          USE_SCROLL_STAFF:
  2545  30c3  c5                    PUSH        BC
  2546  30c4  cd3f23                CALL        CHK_ITEM_BREAK
  2547  30c7  c1                    POP         BC
  2548  30c8  3005                  JR          NC,SCROLL_STAFF_NO_BREAK
  2549  30ca  3efe                  LD          A,$fe
  2550  30cc  327a3a                LD          (RIGHT_HAND_ITEM),A
  2551                          SCROLL_STAFF_NO_BREAK:
  2552  30cf  1609                  LD          D,0x9                                   ;Use FIREBALL ammo
  2553  30d1  1816                  JR          LAB_ram_f0e9
  2554                          CHECK_OTHERS:
  2555  30d3  fe0b                  CP          0xb                                     ;Compare to STAFF
  2556  30d5  28ec                  JR          Z,USE_SCROLL_STAFF
  2557  30d7  fe0c                  CP          0xc                                     ;Compare to XBOW
  2558  30d9  28c9                  JR          Z,USE_BOW_XBOW
  2559  30db  fe06                  CP          0x6                                     ;Compare to BOW
  2560  30dd  da3022                JP          C,NO_ACTION_TAKEN
  2561  30e0  fe10                  CP          $10                                    ;Compare to LADDER
  2562  30e2  d21331                JP          NC,LAB_ram_f113
  2563  30e5  57                    LD          D,A
  2564  30e6  cda92e                CALL        SUB_ram_eea9
  2565                          LAB_ram_f0e9:
  2566  30e9  cdf230                CALL        SUB_ram_f0f2
  2567  30ec  c33031                JP          SUB_ram_f130
  2568                          SUB_ram_f0ef:
  2569  30ef  cda92e                CALL        SUB_ram_eea9
  2570                          SUB_ram_f0f2:
  2571  30f2  3e03                  LD          A,0x3
  2572  30f4  32873a                LD          (BYTE_ram_3a87),A
  2573  30f7  7a                    LD          A,D
  2574  30f8  cb27                  SLA         A
  2575  30fa  cb27                  SLA         A
  2576  30fc  b0                    OR          B
  2577  30fd  32823a                LD          (BYTE_ram_3a82),A
  2578  3100  210302                LD          HL,$203
  2579  3103  22853a                LD          (BYTE_ram_3a85),HL
  2580  3106  214333                LD          HL,CHRRAM_RIGHT_HD_GFX_IDX              ;= $20
  2581  3109  22833a                LD          (BYTE_ram_3a83),HL
  2582  310c  7d                    LD          A,L
  2583  310d  32653a                LD          (RAM_AD),A
  2584  3110  c3d723                JP          LAB_ram_e3d7
  2585                          LAB_ram_f113:
  2586  3113  fe11                  CP          $11
  2587  3115  2002                  JR          NZ,LAB_ram_f119
  2588  3117  1805                  JR          LAB_ram_f11e
  2589                          LAB_ram_f119:
  2590  3119  fe14                  CP          $14
  2591  311b  c23022                JP          NZ,NO_ACTION_TAKEN
  2592                          LAB_ram_f11e:
  2593  311e  57                    LD          D,A
  2594  311f  3a783a                LD          A,(LAST_ITEM_HELD)
  2595  3122  a7                    AND         A
  2596  3123  ca3022                JP          Z,NO_ACTION_TAKEN
  2597  3126  af                    XOR         A                                       ;A  = $00
  2598                                                                                  ;Reset C & N, Set Z
  2599  3127  32783a                LD          (LAST_ITEM_HELD),A
  2600  312a  cdef30                CALL        SUB_ram_f0ef
  2601  312d  c39f2a                JP          WAIT_FOR_INPUT
  2602                          SUB_ram_f130:
  2603  3130  3a783a                LD          A,(LAST_ITEM_HELD)
  2604  3133  a7                    AND         A
  2605  3134  c24e32                JP          NZ,INIT_MELEE_ANIM
  2606  3137  3c                    INC         A
  2607  3138  32783a                LD          (LAST_ITEM_HELD),A
  2608  313b  3ae937                LD          A,(ITEM_F1)                             ;= $60
  2609  313e  0600                  LD          B,0x0
  2610  3140  cb3f                  SRL         A
  2611  3142  cb18                  RR          B
  2612  3144  1f                    RRA
  2613  3145  cb10                  RL          B
  2614  3147  cb10                  RL          B
  2615  3149  08                    EX          AF,AF'
  2616  314a  af                    XOR         A
  2617  314b  21683a                LD          HL,DUNGEON_LEVEL
  2618  314e  ed6f                  RLD
  2619  3150  57                    LD          D,A
  2620  3151  cb3f                  SRL         A
  2621  3153  3002                  JR          NC,LAB_ram_f157
  2622  3155  c650                  ADD         A,$50
  2623                          LAB_ram_f157:
  2624  3157  07                    RLCA
  2625  3158  07                    RLCA
  2626  3159  07                    RLCA
  2627  315a  07                    RLCA
  2628  315b  5f                    LD          E,A
  2629  315c  7a                    LD          A,D
  2630  315d  ed6f                  RLD
  2631  315f  57                    LD          D,A
  2632  3160  cb3f                  SRL         A
  2633  3162  83                    ADD         A,E
  2634  3163  c603                  ADD         A,0x3
  2635  3165  27                    DAA
  2636  3166  4f                    LD          C,A
  2637  3167  7a                    LD          A,D
  2638  3168  ed6f                  RLD
  2639  316a  08                    EX          AF,AF'
  2640  316b  d61e                  SUB         $1e
  2641  316d  200e                  JR          NZ,LAB_ram_f17d
  2642  316f  1607                  LD          D,0x7
  2643  3171  210403                LD          HL,$304
  2644  3174  3e3c                  LD          A,$3c
  2645  3176  80                    ADD         A,B
  2646  3177  328a3a                LD          (BYTE_ram_3a8a),A
  2647  317a  c32b32                JP          LAB_ram_f22b
  2648                          LAB_ram_f17d:
  2649  317d  3d                    DEC         A
  2650  317e  200e                  JR          NZ,LAB_ram_f18e
  2651  3180  1603                  LD          D,0x3
  2652  3182  210101                LD          HL,$101
  2653  3185  3e3c                  LD          A,$3c
  2654  3187  80                    ADD         A,B
  2655  3188  328a3a                LD          (BYTE_ram_3a8a),A
  2656  318b  c32b32                JP          LAB_ram_f22b
  2657                          LAB_ram_f18e:
  2658  318e  3d                    DEC         A
  2659  318f  200e                  JR          NZ,LAB_ram_f19f
  2660  3191  1604                  LD          D,0x4
  2661  3193  210200                LD          HL,0x2
  2662  3196  3e24                  LD          A,$24
  2663  3198  80                    ADD         A,B
  2664  3199  328a3a                LD          (BYTE_ram_3a8a),A
  2665  319c  c32b32                JP          LAB_ram_f22b
  2666                          LAB_ram_f19f:
  2667  319f  3d                    DEC         A
  2668  31a0  200d                  JR          NZ,LAB_ram_f1af
  2669  31a2  1605                  LD          D,0x5
  2670  31a4  210302                LD          HL,$203
  2671  31a7  3e3c                  LD          A,$3c
  2672  31a9  80                    ADD         A,B
  2673  31aa  328a3a                LD          (BYTE_ram_3a8a),A
  2674  31ad  187c                  JR          LAB_ram_f22b
  2675                          LAB_ram_f1af:
  2676  31af  3d                    DEC         A
  2677  31b0  200d                  JR          NZ,LAB_ram_f1bf
  2678  31b2  1603                  LD          D,0x3
  2679  31b4  210203                LD          HL,$302
  2680  31b7  3e24                  LD          A,$24
  2681  31b9  80                    ADD         A,B
  2682  31ba  328a3a                LD          (BYTE_ram_3a8a),A
  2683  31bd  186c                  JR          LAB_ram_f22b
  2684                          LAB_ram_f1bf:
  2685  31bf  3d                    DEC         A
  2686  31c0  200d                  JR          NZ,LAB_ram_f1cf
  2687  31c2  1608                  LD          D,0x8
  2688  31c4  210504                LD          HL,$405
  2689  31c7  3e24                  LD          A,$24
  2690  31c9  80                    ADD         A,B
  2691  31ca  328a3a                LD          (BYTE_ram_3a8a),A
  2692  31cd  185c                  JR          LAB_ram_f22b
  2693                          LAB_ram_f1cf:
  2694  31cf  3d                    DEC         A
  2695  31d0  c2e031                JP          NZ,LAB_ram_f1e0
  2696  31d3  1606                  LD          D,0x6
  2697  31d5  210402                LD          HL,$204
  2698  31d8  3e3c                  LD          A,$3c
  2699  31da  80                    ADD         A,B
  2700  31db  328a3a                LD          (BYTE_ram_3a8a),A
  2701  31de  184b                  JR          LAB_ram_f22b
  2702                          LAB_ram_f1e0:
  2703  31e0  3d                    DEC         A
  2704  31e1  200d                  JR          NZ,LAB_ram_f1f0
  2705  31e3  1613                  LD          D,$13
  2706  31e5  210505                LD          HL,$505
  2707  31e8  3e24                  LD          A,$24
  2708  31ea  80                    ADD         A,B
  2709  31eb  328a3a                LD          (BYTE_ram_3a8a),A
  2710  31ee  183b                  JR          LAB_ram_f22b
  2711                          LAB_ram_f1f0:
  2712  31f0  3d                    DEC         A
  2713  31f1  200d                  JR          NZ,LAB_ram_f200
  2714  31f3  1604                  LD          D,0x4
  2715  31f5  210504                LD          HL,$405
  2716  31f8  3e3c                  LD          A,$3c
  2717  31fa  80                    ADD         A,B
  2718  31fb  328a3a                LD          (BYTE_ram_3a8a),A
  2719  31fe  182b                  JR          LAB_ram_f22b
  2720                          LAB_ram_f200:
  2721  3200  3d                    DEC         A
  2722  3201  2025                  JR          NZ,LAB_ram_f228
  2723  3203  1611                  LD          D,$11
  2724  3205  210504                LD          HL,$405
  2725  3208  d9                    EXX
  2726  3209  2a933a                LD          HL,(PLAYER_PHYS_HEALTH)
  2727  320c  cd3924                CALL        SUB_ram_e439
  2728  320f  eb                    EX          DE,HL
  2729  3210  3a973a                LD          A,(PLAYER_SPRT_HEALTH)
  2730  3213  6f                    LD          L,A
  2731  3214  2600                  LD          H,0x0
  2732  3216  cd3024                CALL        RECALC_PHYS_HEALTH
  2733  3219  d9                    EXX
  2734  321a  3008                  JR          NC,LAB_ram_f224
  2735  321c  3e24                  LD          A,$24
  2736                          LAB_ram_f21e:
  2737  321e  80                    ADD         A,B
  2738  321f  328a3a                LD          (BYTE_ram_3a8a),A
  2739  3222  1807                  JR          LAB_ram_f22b
  2740                          LAB_ram_f224:
  2741  3224  3e3c                  LD          A,$3c
  2742  3226  18f6                  JR          LAB_ram_f21e
  2743                          LAB_ram_f228:
  2744  3228  c33022                JP          NO_ACTION_TAKEN
  2745                          LAB_ram_f22b:
  2746  322b  cd7f32                CALL        SUB_ram_f27f
  2747  322e  e5                    PUSH        HL
  2748  322f  21a23a                LD          HL,CURR_MONSTER_SPRT
  2749  3232  cd9832                CALL        SUB_ram_f298
  2750  3235  e1                    POP         HL
  2751  3236  54                    LD          D,H
  2752  3237  cd7f32                CALL        SUB_ram_f27f
  2753  323a  e5                    PUSH        HL
  2754  323b  21a53a                LD          HL,BYTE_ram_3aa5
  2755  323e  cd9832                CALL        SUB_ram_f298
  2756  3241  e1                    POP         HL
  2757  3242  55                    LD          D,L
  2758  3243  1e00                  LD          E,0x0
  2759  3245  cd8532                CALL        CALC_WEAPON_VALUE
  2760  3248  32a83a                LD          (WEAPON_VALUE_HOLDER),A
  2761  324b  cd6932                CALL        REDRAW_MONSTER_HEALTH
  2762                          INIT_MELEE_ANIM:
  2763  324e  3e03                  LD          A,0x3                                   ;A  = $03
  2764  3250  328b3a                LD          (MELEE_ANIM_STATE),A
  2765  3253  210602                LD          HL,$206                                ;HL = $ce
  2766  3256  228d3a                LD          (MONSTER_ATT_POS_COUNT),HL
  2767  3259  21ea31                LD          HL,$31ea                               ;HL = $0020 db?
  2768                                                                                  ;Always $20 (SPACE char)?
  2769  325c  228f3a                LD          (MONSTER_ATT_POS_OFFSET),HL
  2770  325f  7d                    LD          A,L
  2771  3260  32663a                LD          (RAM_AE),A
  2772  3263  cd0a26                CALL        ANIMATE_MELEE_ROUND
  2773  3266  c39f2a                JP          WAIT_FOR_INPUT
  2774                          REDRAW_MONSTER_HEALTH:
  2775  3269  118930                LD          DE,CHRRAM_MONSTER_PHYS                  ;WAS LD DE,$333d
  2776  326c  21a33a                LD          HL,CURR_MONSTER_PHYS
  2777  326f  0602                  LD          B,0x2
  2778  3271  cdfd32                CALL        RECALC_AND_REDRAW_BCD
  2779  3274  116330                LD          DE,CHRRAM_MONSTER_SPRT                  ;WAS LD DE,$338f
  2780  3277  21a23a                LD          HL,CURR_MONSTER_SPRT
  2781  327a  0601                  LD          B,0x1
  2782  327c  c3fd32                JP          RECALC_AND_REDRAW_BCD
  2783                          SUB_ram_f27f:
  2784  327f  cdca3a                CALL        UPDATE_SCR_SAVER_TIMER
  2785  3282  e607                  AND         0x7
  2786  3284  5f                    LD          E,A
  2787                          CALC_WEAPON_VALUE:
  2788  3285  c5                    PUSH        BC                                      ;Save original weaponLevel
  2789  3286  04                    INC         B                                       ;B = B + 1
  2790  3287  7a                    LD          A,D                                     ;A = D
  2791  3288  1802                  JR          LAB_ram_f28c
  2792                          LAB_ram_f28a:
  2793  328a  82                    ADD         A,D                                     ;A = A + D
  2794  328b  27                    DAA                                                 ;Normalize for BCD
  2795                          LAB_ram_f28c:
  2796  328c  10fc                  DJNZ        LAB_ram_f28a                            ;B = B - 1
  2797  328e  93                    SUB         E                                       ;A = A - E
  2798  328f  27                    DAA                                                 ;Normalize for BCD
  2799  3290  3002                  JR          NC,LAB_ram_f294
  2800  3292  8b                    ADC         A,E                                     ;A = A + E (and CARRY)
  2801  3293  27                    DAA                                                 ;Normalize for BCD
  2802                          LAB_ram_f294:
  2803  3294  81                    ADD         A,C                                     ;A = A + C
  2804  3295  27                    DAA                                                 ;Normalize for BCD
  2805  3296  c1                    POP         BC                                      ;BC = Original weaponLevel
  2806  3297  c9                    RET                                                 ;A = new weaponValue
  2807                          SUB_ram_f298:
  2808  3298  77                    LD          (HL),A
  2809  3299  23                    INC         HL
  2810  329a  87                    ADD         A,A
  2811  329b  27                    DAA
  2812  329c  77                    LD          (HL),A
  2813  329d  23                    INC         HL
  2814  329e  3e00                  LD          A,0x0
  2815  32a0  17                    RLA
  2816  32a1  77                    LD          (HL),A
  2817  32a2  c9                    RET
  2818                          DO_USE_LADDER:
  2819  32a3  3a783a                LD          A,(LAST_ITEM_HELD)
  2820  32a6  a7                    AND         A
  2821  32a7  c23022                JP          NZ,NO_ACTION_TAKEN
  2822  32aa  3aea37                LD          A,(ITEM_F0)                             ;= $60
  2823  32ad  fe42                  CP          $42
  2824  32af  c23022                JP          NZ,NO_ACTION_TAKEN
  2825  32b2  3a793a                LD          A,(PLAYER_MAP_POS)
  2826  32b5  32773a                LD          (PLAYER_PREV_MAP_LOC),A
  2827  32b8  cda333                CALL        BUILD_MAP
  2828  32bb  cd180e                CALL        SUB_ram_cdbf
  2829  32be  cdc432                CALL        SUB_ram_f2c4
  2830  32c1  c33111                JP          RESET_SHIFT_MODE
  2831                          SUB_ram_f2c4:
  2832  32c4  110230                LD          DE,$3002                               ;WAS $33df
  2833  32c7  21683a                LD          HL,DUNGEON_LEVEL
  2834  32ca  3e01                  LD          A,0x1
  2835  32cc  86                    ADD         A,(HL)
  2836  32cd  27                    DAA
  2837  32ce  380c                  JR          C,LAB_ram_f2dc
  2838                          LAB_ram_f2d0:
  2839  32d0  77                    LD          (HL),A
  2840  32d1  0601                  LD          B,0x1
  2841  32d3  cdfd32                CALL        RECALC_AND_REDRAW_BCD
  2842  32d6  cde634                CALL        REDRAW_START
  2843  32d9  c30438                JP          REDRAW_VIEWPORT
  2844                          LAB_ram_f2dc:
  2845  32dc  cd4910                CALL        DRAW_BKGD
  2846  32df  215130                LD          HL,DAT_ram_3051                         ;= $20
  2847  32e2  114908                LD          DE,LEVEL_99_LOOP                        ;= "Looks like this dungeon",$01
  2848  32e5  06f0                  LD          B,$f0
  2849  32e7  cd3533                CALL        GFX_DRAW
  2850  32ea  061e                  LD          B,$1e
  2851                          LAB_ram_f2ec:
  2852  32ec  d9                    EXX
  2853  32ed  cd481d                CALL        SLEEP_ZERO                              ;byte SLEEP_ZERO(void)
  2854  32f0  d9                    EXX
  2855  32f1  10f9                  DJNZ        LAB_ram_f2ec
  2856  32f3  3e90                  LD          A,$90
  2857  32f5  21683a                LD          HL,DUNGEON_LEVEL
  2858  32f8  11df33                LD          DE,CHHRAM_LVL_IDX                       ;= $20
  2859  32fb  18d3                  JR          LAB_ram_f2d0
  2860                          RECALC_AND_REDRAW_BCD:
  2861  32fd  d5                    PUSH        DE
  2862  32fe  11503a                LD          DE,$3a50
  2863  3301  78                    LD          A,B
  2864  3302  cb27                  SLA         A
  2865  3304  3d                    DEC         A
  2866  3305  08                    EX          AF,AF'
  2867                          LAB_ram_f306:
  2868  3306  7e                    LD          A,(HL)
  2869  3307  e60f                  AND         0xf                                     ;Wipe upper nybble
  2870  3309  c630                  ADD         A,$30                                  ;Numeric char offset
  2871  330b  12                    LD          (DE),A
  2872  330c  7e                    LD          A,(HL)
  2873  330d  e6f0                  AND         $f0                                    ;Wipe lower nybble
  2874  330f  0f                    RRCA                                                ;Move upper
  2875  3310  0f                    RRCA                                                ;nybble to
  2876  3311  0f                    RRCA                                                ;lower
  2877  3312  0f                    RRCA                                                ;nybble
  2878  3313  c630                  ADD         A,$30                                  ;Numeric char offset
  2879  3315  13                    INC         DE
  2880  3316  12                    LD          (DE),A
  2881  3317  13                    INC         DE
  2882  3318  23                    INC         HL
  2883  3319  10eb                  DJNZ        LAB_ram_f306
  2884  331b  1b                    DEC         DE
  2885  331c  e1                    POP         HL
  2886  331d  08                    EX          AF,AF'
  2887  331e  47                    LD          B,A
  2888                          LAB_ram_f31f:
  2889  331f  1a                    LD          A,(DE)
  2890  3320  fe30                  CP          $30                                    ;Numeric char offset
  2891  3322  2009                  JR          NZ,LAB_ram_f32d
  2892  3324  3620                  LD          (HL),$20                               ;SPACE char for ZERO
  2893  3326  23                    INC         HL                                      ;Move forward one cell
  2894  3327  1b                    DEC         DE                                      ;Move backwards one byte
  2895                                                                                  ;(big endian)
  2896  3328  10f5                  DJNZ        LAB_ram_f31f
  2897  332a  1a                    LD          A,(DE)
  2898  332b  1806                  JR          LAB_ram_f333
  2899                          LAB_ram_f32d:
  2900  332d  77                    LD          (HL),A
  2901  332e  23                    INC         HL                                      ;Move forward one cell
  2902  332f  1b                    DEC         DE                                      ;Move backwards one byte
  2903                                                                                  ;(big endian)
  2904  3330  1a                    LD          A,(DE)
  2905  3331  10fa                  DJNZ        LAB_ram_f32d
  2906                          LAB_ram_f333:
  2907  3333  77                    LD          (HL),A
  2908  3334  c9                    RET
  2909                          GFX_DRAW:
  2910  3335  e5                    PUSH        HL
  2911  3336  0e28                  LD          C,$28                                  ;$28 = +40, down one row
  2912                          LAB_ram_f338:
  2913  3338  1a                    LD          A,(DE)                       ;= "\b",$FF
  2914                                                                                  ;= $FF
  2915  3339  13                    INC         DE
  2916  333a  3c                    INC         A
  2917  333b  2002                  JR          NZ,LAB_ram_f33f                         ;Check for $ff end of graphic char
  2918  333d  e1                    POP         HL
  2919  333e  c9                    RET
  2920                          LAB_ram_f33f:
  2921  333f  3d                    DEC         A                                       ;$00 = no char, move right one column...
  2922  3340  2003                  JR          NZ,LAB_ram_f345
  2923  3342  23                    INC         HL
  2924  3343  18f3                  JR          LAB_ram_f338
  2925                          LAB_ram_f345:
  2926  3345  fe01                  CP          0x1                                     ;$01 = down one row, back to index
  2927  3347  2009                  JR          NZ,LAB_ram_f352
  2928  3349  78                    LD          A,B
  2929  334a  0600                  LD          B,0x0
  2930  334c  e1                    POP         HL
  2931  334d  09                    ADD         HL,BC
  2932  334e  e5                    PUSH        HL
  2933  334f  47                    LD          B,A
  2934  3350  18e6                  JR          LAB_ram_f338
  2935                          LAB_ram_f352:
  2936  3352  fe02                  CP          0x2                                     ;$02 = back up one column
  2937  3354  2003                  JR          NZ,LAB_ram_f359
  2938  3356  2b                    DEC         HL
  2939  3357  18df                  JR          LAB_ram_f338
  2940                          LAB_ram_f359:
  2941  3359  fe03                  CP          0x3                                     ;$03 = down one row, same column
  2942  335b  200a                  JR          NZ,LAB_ram_f367
  2943  335d  78                    LD          A,B
  2944  335e  0600                  LD          B,0x0
  2945  3360  09                    ADD         HL,BC
  2946  3361  e3                    EX          (SP),HL
  2947  3362  09                    ADD         HL,BC
  2948  3363  e3                    EX          (SP),HL
  2949  3364  47                    LD          B,A
  2950  3365  18d1                  JR          LAB_ram_f338
  2951                          LAB_ram_f367:
  2952  3367  fe04                  CP          0x4                                     ;$04 = up one row, same column
  2953  3369  200c                  JR          NZ,LAB_ram_f377
  2954  336b  78                    LD          A,B
  2955  336c  0600                  LD          B,0x0
  2956  336e  ed42                  SBC         HL,BC
  2957  3370  e3                    EX          (SP),HL
  2958  3371  ed42                  SBC         HL,BC
  2959  3373  e3                    EX          (SP),HL
  2960  3374  47                    LD          B,A
  2961  3375  18c1                  JR          LAB_ram_f338
  2962                          LAB_ram_f377:
  2963  3377  fea0                  CP          $a0                                    ;$a0 = reverse FG & BG colors
  2964  3379  200a                  JR          NZ,LAB_ram_f385
  2965  337b  cb08                  RRC         B                                       ;Swap hi and lo nybbles (FG & BG colo...
  2966  337d  cb08                  RRC         B
  2967  337f  cb08                  RRC         B
  2968  3381  cb08                  RRC         B
  2969  3383  18b3                  JR          LAB_ram_f338
  2970                          LAB_ram_f385:
  2971  3385  77                    LD          (HL),A              ;= $20
  2972  3386  24                    INC         H
  2973  3387  24                    INC         H
  2974  3388  24                    INC         H
  2975  3389  24                    INC         H
  2976  338a  3e0f                  LD          A,0xf
  2977  338c  b8                    CP          B
  2978  338d  7e                    LD          A,(HL)                    ;= $60
  2979  338e  3808                  JR          C,LAB_ram_f398
  2980  3390  07                    RLCA
  2981  3391  07                    RLCA
  2982  3392  07                    RLCA
  2983  3393  07                    RLCA
  2984  3394  e6f0                  AND         $f0
  2985  3396  1802                  JR          LAB_ram_f39a
  2986                          LAB_ram_f398:
  2987  3398  e60f                  AND         0xf
  2988                          LAB_ram_f39a:
  2989  339a  b0                    OR          B
  2990  339b  77                    LD          (HL),A                    ;= $60
  2991  339c  25                    DEC         H
  2992  339d  25                    DEC         H
  2993  339e  25                    DEC         H
  2994  339f  25                    DEC         H
  2995  33a0  23                    INC         HL
  2996  33a1  1895                  JR          LAB_ram_f338
  2997                          BUILD_MAP:
  2998  33a3  210038                LD          HL,MAPSPACE_WALLS
  2999  33a6  0600                  LD          B,0x0
  3000                          GENERATE_MAPWALLS_LOOP:
  3001  33a8  cdac3a                CALL        MAKE_RANDOM_BYTE
  3002  33ab  5f                    LD          E,A
  3003  33ac  cdac3a                CALL        MAKE_RANDOM_BYTE
  3004  33af  a3                    AND         E
  3005  33b0  e663                  AND         $63
  3006  33b2  77                    LD          (HL),A
  3007  33b3  2c                    INC         L
  3008  33b4  10f2                  DJNZ        GENERATE_MAPWALLS_LOOP
  3009  33b6  3a793a                LD          A,(PLAYER_MAP_POS)
  3010  33b9  6f                    LD          L,A
  3011  33ba  3642                  LD          (HL),$42
  3012                          GEN_MAP_NW_WALL_LOOP:
  3013  33bc  cdca3a                CALL        UPDATE_SCR_SAVER_TIMER
  3014  33bf  3c                    INC         A
  3015  33c0  28fa                  JR          Z,GEN_MAP_NW_WALL_LOOP
  3016  33c2  3d                    DEC         A
  3017  33c3  32a13a                LD          (ITEM_HOLDER),A
  3018  33c6  6f                    LD          L,A
  3019  33c7  3663                  LD          (HL),$63
  3020  33c9  210039                LD          HL,MAP_LADDER_OFFSET
  3021  33cc  77                    LD          (HL),A
  3022  33cd  2c                    INC         L
  3023  33ce  3642                  LD          (HL),$42                   ;Put ladder object into map
  3024                                                                                  ;(always 1st item after offset)
  3025  33d0  2c                    INC         L
  3026  33d1  3a6c3a                LD          A,(INPUT_HOLDER)
  3027  33d4  47                    LD          B,A
  3028  33d5  3e02                  LD          A,0x2
  3029  33d7  1802                  JR          LAB_ram_f3db
  3030                          LAB_ram_f3d9:
  3031  33d9  87                    ADD         A,A
  3032  33da  27                    DAA
  3033                          LAB_ram_f3db:
  3034  33db  10fc                  DJNZ        LAB_ram_f3d9
  3035  33dd  4f                    LD          C,A
  3036  33de  3a683a                LD          A,(DUNGEON_LEVEL)
  3037  33e1  b9                    CP          C
  3038  33e2  3819                  JR          C,LAB_ram_f3fd
  3039                          GEN_ITEM_MAP:
  3040  33e4  cdca3a                CALL        UPDATE_SCR_SAVER_TIMER
  3041  33e7  3c                    INC         A
  3042  33e8  28fa                  JR          Z,GEN_ITEM_MAP
  3043  33ea  3d                    DEC         A
  3044  33eb  4f                    LD          C,A
  3045  33ec  3aa13a                LD          A,(ITEM_HOLDER)
  3046  33ef  b9                    CP          C
  3047  33f0  28f2                  JR          Z,GEN_ITEM_MAP
  3048  33f2  3a793a                LD          A,(PLAYER_MAP_POS)
  3049  33f5  b9                    CP          C
  3050  33f6  28ec                  JR          Z,GEN_ITEM_MAP
  3051  33f8  71                    LD          (HL),C
  3052  33f9  23                    INC         HL
  3053  33fa  369f                  LD          (HL),$9f                ;Full ITEM_monster range $009f
  3054  33fc  23                    INC         HL
  3055                          LAB_ram_f3fd:
  3056  33fd  0650                  LD          B,$50                                  ;Max 50 items+monstersdb?
  3057                          GEN_RND_ITEM:
  3058  33ff  cdac3a                CALL        MAKE_RANDOM_BYTE
  3059  3402  3c                    INC         A
  3060  3403  28fa                  JR          Z,GEN_RND_ITEM
  3061  3405  3d                    DEC         A
  3062  3406  08                    EX          AF,AF'
  3063  3407  3a683a                LD          A,(DUNGEON_LEVEL)
  3064  340a  a7                    AND         A
  3065  340b  200a                  JR          NZ,LAB_ram_f417
  3066  340d  08                    EX          AF,AF'
  3067  340e  fe01                  CP          0x1
  3068  3410  28ed                  JR          Z,GEN_RND_ITEM
  3069  3412  fe10                  CP          $10
  3070  3414  28e9                  JR          Z,GEN_RND_ITEM
  3071  3416  08                    EX          AF,AF'
  3072                          LAB_ram_f417:
  3073  3417  08                    EX          AF,AF'
  3074  3418  5f                    LD          E,A
  3075  3419  3a793a                LD          A,(PLAYER_MAP_POS)
  3076  341c  bb                    CP          E
  3077  341d  28e0                  JR          Z,GEN_RND_ITEM
  3078  341f  3aa13a                LD          A,(ITEM_HOLDER)
  3079  3422  bb                    CP          E
  3080  3423  28da                  JR          Z,GEN_RND_ITEM
  3081  3425  73                    LD          (HL),E
  3082  3426  2c                    INC         L
  3083  3427  cdca3a                CALL        UPDATE_SCR_SAVER_TIMER
  3084  342a  e6c0                  AND         $c0
  3085  342c  07                    RLCA
  3086  342d  07                    RLCA
  3087  342e  3d                    DEC         A
  3088  342f  2006                  JR          NZ,LAB_ram_f437
  3089  3431  0e05                  LD          C,0x5
  3090  3433  1600                  LD          D,0x0
  3091  3435  182e                  JR          LAB_ram_f465
  3092                          LAB_ram_f437:
  3093  3437  3d                    DEC         A
  3094  3438  200f                  JR          NZ,LAB_ram_f449
  3095  343a  0e05                  LD          C,0x5
  3096  343c  1606                  LD          D,0x6
  3097  343e  3a683a                LD          A,(DUNGEON_LEVEL)
  3098  3441  fe06                  CP          0x6
  3099  3443  3820                  JR          C,LAB_ram_f465
  3100  3445  0e07                  LD          C,0x7
  3101  3447  181c                  JR          LAB_ram_f465
  3102                          LAB_ram_f449:
  3103  3449  3d                    DEC         A
  3104  344a  2006                  JR          NZ,LAB_ram_f452
  3105  344c  0e04                  LD          C,0x4
  3106  344e  1611                  LD          D,$11
  3107  3450  1813                  JR          LAB_ram_f465
  3108                          LAB_ram_f452:
  3109  3452  161e                  LD          D,$1e
  3110  3454  0e05                  LD          C,0x5
  3111  3456  3a683a                LD          A,(DUNGEON_LEVEL)
  3112  3459  fe06                  CP          0x6
  3113  345b  3808                  JR          C,LAB_ram_f465
  3114  345d  0e07                  LD          C,0x7
  3115  345f  fe16                  CP          $16
  3116  3461  3802                  JR          C,LAB_ram_f465
  3117  3463  0e09                  LD          C,0x9
  3118                          LAB_ram_f465:
  3119  3465  cdac3a                CALL        MAKE_RANDOM_BYTE
  3120  3468  e60f                  AND         0xf
  3121                          LAB_ram_f46a:
  3122  346a  91                    SUB         C
  3123  346b  30fd                  JR          NC,LAB_ram_f46a
  3124  346d  81                    ADD         A,C
  3125  346e  82                    ADD         A,D
  3126  346f  4f                    LD          C,A
  3127  3470  3a683a                LD          A,(DUNGEON_LEVEL)
  3128  3473  3c                    INC         A
  3129  3474  3c                    INC         A
  3130  3475  cb3f                  SRL         A
  3131  3477  57                    LD          D,A
  3132  3478  cdca3a                CALL        UPDATE_SCR_SAVER_TIMER
  3133  347b  5f                    LD          E,A
  3134  347c  cdac3a                CALL        MAKE_RANDOM_BYTE
  3135  347f  a3                    AND         E
  3136  3480  e603                  AND         0x3
  3137                          LAB_ram_f482:
  3138  3482  92                    SUB         D
  3139  3483  30fd                  JR          NC,LAB_ram_f482
  3140  3485  82                    ADD         A,D
  3141  3486  1f                    RRA
  3142  3487  1f                    RRA
  3143  3488  cb11                  RL          C
  3144  348a  17                    RLA
  3145  348b  cb11                  RL          C
  3146  348d  71                    LD          (HL),C
  3147  348e  2c                    INC         L
  3148  348f  05                    DEC         B
  3149  3490  c2ff33                JP          NZ,GEN_RND_ITEM
  3150  3493  36ff                  LD          (HL),$ff
  3151  3495  11003b                LD          DE,TEMP_MAP
  3152  3498  210039                LD          HL,MAP_LADDER_OFFSET
  3153  349b  0600                  LD          B,0x0
  3154                          LAB_ram_f49d:
  3155  349d  7e                    LD          A,(HL)
  3156  349e  feff                  CP          $ff
  3157  34a0  281f                  JR          Z,SETUP_MAP_COPY
  3158  34a2  04                    INC         B
  3159  34a3  cdd434                CALL        SUB_ram_f4d4
  3160  34a6  d9                    EXX
  3161  34a7  280e                  JR          Z,LAB_ram_f4b7
  3162  34a9  12                    LD          (DE),A
  3163  34aa  13                    INC         DE
  3164  34ab  23                    INC         HL
  3165  34ac  7e                    LD          A,(HL)
  3166  34ad  fefe                  CP          $fe
  3167  34af  280b                  JR          Z,LAB_ram_f4bc
  3168  34b1  04                    INC         B
  3169  34b2  12                    LD          (DE),A
  3170  34b3  13                    INC         DE
  3171  34b4  23                    INC         HL
  3172  34b5  18e6                  JR          LAB_ram_f49d
  3173                          LAB_ram_f4b7:
  3174  34b7  23                    INC         HL
  3175  34b8  23                    INC         HL
  3176  34b9  05                    DEC         B
  3177  34ba  18e1                  JR          LAB_ram_f49d
  3178                          LAB_ram_f4bc:
  3179  34bc  23                    INC         HL
  3180  34bd  1b                    DEC         DE
  3181  34be  05                    DEC         B
  3182  34bf  18dc                  JR          LAB_ram_f49d
  3183                          SETUP_MAP_COPY:
  3184  34c1  11003b                LD          DE,TEMP_MAP                             ;DE = Temp Map
  3185  34c4  210039                LD          HL,MAP_LADDER_OFFSET                    ;HL = Real Map
  3186  34c7  04                    INC         B
  3187  34c8  05                    DEC         B
  3188  34c9  2806                  JR          Z,MAP_DONE
  3189                          COPY_TEMP_MAP_TO_REAL_MAP:
  3190  34cb  1a                    LD          A,(DE)
  3191  34cc  77                    LD          (HL),A
  3192  34cd  23                    INC         HL
  3193  34ce  13                    INC         DE
  3194  34cf  10fa                  DJNZ        COPY_TEMP_MAP_TO_REAL_MAP               ;Loop while B is not zero
  3195                          MAP_DONE:
  3196  34d1  36ff                  LD          (HL),$ff
  3197  34d3  c9                    RET
  3198                          SUB_ram_f4d4:
  3199  34d4  c5                    PUSH        BC
  3200  34d5  d9                    EXX
  3201  34d6  c1                    POP         BC
  3202  34d7  05                    DEC         B
  3203  34d8  280a                  JR          Z,LAB_ram_f4e4
  3204  34da  21003b                LD          HL,TEMP_MAP
  3205                          LAB_ram_f4dd:
  3206  34dd  be                    CP          (HL)
  3207  34de  c8                    RET         Z
  3208  34df  05                    DEC         B
  3209  34e0  23                    INC         HL
  3210  34e1  23                    INC         HL
  3211  34e2  10f9                  DJNZ        LAB_ram_f4dd
  3212                          LAB_ram_f4e4:
  3213  34e4  05                    DEC         B
  3214  34e5  c9                    RET
  3215                          REDRAW_START:
  3216  34e6  21a137                LD          HL,CALC_WEST_REDRAW_2                            ; CALC_WEST_REDRAW (0xF79B) + 7... UNDO? was 0xF7A1
  3217  34e9  e5                    PUSH        HL
  3218  34ea  21793a                LD          HL,PLAYER_MAP_POS
  3219  34ed  5e                    LD          E,(HL)
  3220  34ee  1638                  LD          D,$38                                  ;DE = Player map position in RAM
  3221  34f0  21e833                LD          HL,WALL_F0_STATE                        ;= $20
  3222  34f3  0e05                  LD          C,0x5
  3223  34f5  3a623a                LD          A,(DIR_FACING_SHORT)
  3224  34f8  3d                    DEC         A
  3225  34f9  cab435                JP          Z,FACING_NORTH
  3226  34fc  3d                    DEC         A
  3227  34fd  caff36                JP          Z,FACING_EAST
  3228  3500  3d                    DEC         A
  3229  3501  ca4936                JP          Z,FACING_SOUTH
  3230  3504  1a                    LD          A,(DE)
  3231  3505  e607                  AND         0x7                                     ;Keep low 3 bits, reset top 5 bits
  3232  3507  77                    LD          (HL),A                   ;= $20
  3233  3508  1d                    DEC         E
  3234  3509  cd9b37                CALL        CALC_WEST_REDRAW
  3235  350c  1d                    DEC         E
  3236  350d  cd9b37                CALL        CALC_WEST_REDRAW
  3237  3510  7b                    LD          A,E
  3238  3511  c610                  ADD         A,$10
  3239  3513  5f                    LD          E,A
  3240  3514  cda035                CALL        REDRAW_VIEW
  3241  3517  2c                    INC         L
  3242  3518  77                    LD          (HL),A                   ;= $20
  3243  3519  1a                    LD          A,(DE)
  3244  351a  e607                  AND         0x7
  3245  351c  cda735                CALL        REDRAW_NORTH
  3246  351f  7b                    LD          A,E
  3247  3520  d610                  SUB         $10
  3248  3522  5f                    LD          E,A
  3249  3523  cda035                CALL        REDRAW_VIEW
  3250  3526  77                    LD          (HL),A                   ;= $20
  3251  3527  7b                    LD          A,E
  3252  3528  d610                  SUB         $10
  3253  352a  5f                    LD          E,A
  3254  352b  1a                    LD          A,(DE)
  3255  352c  e607                  AND         0x7
  3256  352e  cda735                CALL        REDRAW_NORTH
  3257  3531  7b                    LD          A,E
  3258  3532  c621                  ADD         A,$21
  3259  3534  5f                    LD          E,A
  3260  3535  cda035                CALL        REDRAW_VIEW
  3261  3538  77                    LD          (HL),A                   ;= $20
  3262  3539  1a                    LD          A,(DE)
  3263  353a  e607                  AND         0x7
  3264  353c  cda735                CALL        REDRAW_NORTH
  3265  353f  7b                    LD          A,E
  3266  3540  d610                  SUB         $10
  3267  3542  5f                    LD          E,A
  3268  3543  cda035                CALL        REDRAW_VIEW
  3269  3546  2c                    INC         L
  3270  3547  77                    LD          (HL),A                   ;= $20
  3271  3548  7b                    LD          A,E
  3272  3549  d610                  SUB         $10
  3273  354b  5f                    LD          E,A
  3274  354c  1a                    LD          A,(DE)
  3275  354d  e607                  AND         0x7
  3276  354f  cda735                CALL        REDRAW_NORTH
  3277  3552  7b                    LD          A,E
  3278  3553  c621                  ADD         A,$21
  3279  3555  5f                    LD          E,A
  3280  3556  cda035                CALL        REDRAW_VIEW
  3281  3559  2c                    INC         L
  3282  355a  77                    LD          (HL),A                   ;= $20
  3283  355b  cd9b37                CALL        CALC_WEST_REDRAW
  3284  355e  7b                    LD          A,E
  3285  355f  c60e                  ADD         A,0xe
  3286  3561  5f                    LD          E,A
  3287  3562  cda035                CALL        REDRAW_VIEW
  3288  3565  2c                    INC         L
  3289  3566  2c                    INC         L
  3290  3567  77                    LD          (HL),A                    ;= $20
  3291  3568  7b                    LD          A,E
  3292  3569  d61e                  SUB         $1e
  3293  356b  5f                    LD          E,A
  3294  356c  cda035                CALL        REDRAW_VIEW
  3295  356f  2c                    INC         L
  3296  3570  77                    LD          (HL),A                    ;= $20
  3297  3571  7b                    LD          A,E
  3298  3572  d610                  SUB         $10
  3299  3574  5f                    LD          E,A
  3300  3575  cd9b37                CALL        CALC_WEST_REDRAW
  3301  3578  1d                    DEC         E
  3302  3579  1d                    DEC         E
  3303  357a  cda035                CALL        REDRAW_VIEW
  3304  357d  2c                    INC         L
  3305  357e  2c                    INC         L
  3306  357f  77                    LD          (HL),A                    ;= $20
  3307  3580  7b                    LD          A,E
  3308  3581  c613                  ADD         A,$13
  3309  3583  5f                    LD          E,A
  3310  3584  cd9b37                CALL        CALC_WEST_REDRAW
  3311  3587  16ff                  LD          D,$ff
  3312  3589  1ef0                  LD          E,$f0
  3313  358b  ed53603a              LD          (DIR_FACING_FW),DE                      ;DE = 0xFFF0 (WEST)
  3314  358f  0610                  LD          B,$10                                  ;RED on BLK
  3315  3591  21d831                LD          HL,CHRRAM_POINTER_IDX                   ;WAS $31d6
  3316  3594  119a35                LD          DE,WEST_TXT                             ;= "\a",$FF
  3317  3597  c33533                JP          GFX_DRAW
  3318                          WEST_TXT:
  3319  359a  07ff                  db          "\a",$FF
  3320  359c  00                    db          $00
  3321  359d  00                    db          $00
  3322  359e  00                    db          $00
  3323  359f  00                    db          $00
  3324                          REDRAW_VIEW:
  3325  35a0  1a                    LD          A,(DE)
  3326  35a1  e6e0                  AND         $e0
  3327  35a3  07                    RLCA
  3328  35a4  07                    RLCA
  3329  35a5  07                    RLCA
  3330  35a6  c9                    RET
  3331                          REDRAW_NORTH:
  3332  35a7  2c                    INC         L
  3333  35a8  77                    LD          (HL),A
  3334  35a9  47                    LD          B,A
  3335  35aa  7d                    LD          A,L
  3336  35ab  81                    ADD         A,C
  3337  35ac  6f                    LD          L,A
  3338  35ad  70                    LD          (HL),B
  3339  35ae  7d                    LD          A,L
  3340  35af  91                    SUB         C
  3341  35b0  6f                    LD          L,A
  3342  35b1  2c                    INC         L
  3343  35b2  0c                    INC         C
  3344  35b3  c9                    RET
  3345                          FACING_NORTH:
  3346  35b4  cda035                CALL        REDRAW_VIEW
  3347  35b7  77                    LD          (HL),A
  3348  35b8  7b                    LD          A,E
  3349  35b9  d610                  SUB         $10
  3350  35bb  5f                    LD          E,A
  3351  35bc  cda035                CALL        REDRAW_VIEW
  3352  35bf  2c                    INC         L
  3353  35c0  77                    LD          (HL),A
  3354  35c1  7b                    LD          A,E
  3355  35c2  d610                  SUB         $10
  3356  35c4  5f                    LD          E,A
  3357  35c5  cda035                CALL        REDRAW_VIEW
  3358  35c8  2c                    INC         L
  3359  35c9  77                    LD          (HL),A
  3360  35ca  cd9b37                CALL        CALC_WEST_REDRAW
  3361  35cd  1d                    DEC         E
  3362  35ce  cda035                CALL        REDRAW_VIEW
  3363  35d1  cda735                CALL        REDRAW_NORTH
  3364  35d4  1c                    INC         E
  3365  35d5  1c                    INC         E
  3366  35d6  1a                    LD          A,(DE)
  3367  35d7  e607                  AND         0x7
  3368  35d9  77                    LD          (HL),A
  3369  35da  cda035                CALL        REDRAW_VIEW
  3370  35dd  cda735                CALL        REDRAW_NORTH
  3371  35e0  7b                    LD          A,E
  3372  35e1  c60f                  ADD         A,0xf
  3373  35e3  5f                    LD          E,A
  3374  35e4  1a                    LD          A,(DE)
  3375  35e5  e607                  AND         0x7
  3376  35e7  77                    LD          (HL),A
  3377  35e8  1d                    DEC         E
  3378  35e9  cda035                CALL        REDRAW_VIEW
  3379  35ec  cda735                CALL        REDRAW_NORTH
  3380  35ef  1c                    INC         E
  3381  35f0  1c                    INC         E
  3382  35f1  cd9b37                CALL        CALC_WEST_REDRAW
  3383  35f4  cda035                CALL        REDRAW_VIEW
  3384  35f7  cda735                CALL        REDRAW_NORTH
  3385  35fa  7b                    LD          A,E
  3386  35fb  c60f                  ADD         A,0xf
  3387  35fd  5f                    LD          E,A
  3388  35fe  cd9b37                CALL        CALC_WEST_REDRAW
  3389  3601  1d                    DEC         E
  3390  3602  cda035                CALL        REDRAW_VIEW
  3391  3605  2c                    INC         L
  3392  3606  77                    LD          (HL),A
  3393  3607  7b                    LD          A,E
  3394  3608  d620                  SUB         $20
  3395  360a  5f                    LD          E,A
  3396  360b  1a                    LD          A,(DE)
  3397  360c  e607                  AND         0x7
  3398  360e  2c                    INC         L
  3399  360f  2c                    INC         L
  3400  3610  77                    LD          (HL),A
  3401  3611  7b                    LD          A,E
  3402  3612  c622                  ADD         A,$22
  3403  3614  5f                    LD          E,A
  3404  3615  cd9b37                CALL        CALC_WEST_REDRAW
  3405  3618  cda035                CALL        REDRAW_VIEW
  3406  361b  2c                    INC         L
  3407  361c  77                    LD          (HL),A
  3408  361d  7b                    LD          A,E
  3409  361e  d61f                  SUB         $1f
  3410  3620  5f                    LD          E,A
  3411  3621  1a                    LD          A,(DE)
  3412  3622  e607                  AND         0x7
  3413  3624  2c                    INC         L
  3414  3625  2c                    INC         L
  3415  3626  77                    LD          (HL),A
  3416  3627  7b                    LD          A,E
  3417  3628  c62e                  ADD         A,$2e
  3418  362a  5f                    LD          E,A
  3419  362b  cda035                CALL        REDRAW_VIEW
  3420  362e  2c                    INC         L
  3421  362f  77                    LD          (HL),A
  3422  3630  16f0                  LD          D,$f0
  3423  3632  1e01                  LD          E,0x1
  3424  3634  ed53603a              LD          (DIR_FACING_FW),DE
  3425  3638  0610                  LD          B,$10                                  ;RED on BLK
  3426  363a  21d831                LD          HL,CHRRAM_POINTER_IDX                   ;WAS $31d6
  3427  363d  114336                LD          DE,NORTH_TXT                            ;= "\b",$FF
  3428  3640  c33533                JP          GFX_DRAW
  3429                          NORTH_TXT:
  3430  3643  08ff                  db          "\b",$FF
  3431  3645  00                    db          $00
  3432  3646  00                    db          $00
  3433  3647  00                    db          $00
  3434  3648  00                    db          $00
  3435                          FACING_SOUTH:
  3436  3649  7b                    LD          A,E
  3437  364a  c610                  ADD         A,$10
  3438  364c  5f                    LD          E,A
  3439  364d  cda035                CALL        REDRAW_VIEW
  3440  3650  77                    LD          (HL),A                   ;= $20
  3441  3651  7b                    LD          A,E
  3442  3652  c610                  ADD         A,$10
  3443  3654  5f                    LD          E,A
  3444  3655  cda035                CALL        REDRAW_VIEW
  3445  3658  2c                    INC         L
  3446  3659  77                    LD          (HL),A                   ;= $20
  3447  365a  7b                    LD          A,E
  3448  365b  c610                  ADD         A,$10
  3449  365d  5f                    LD          E,A
  3450  365e  cda035                CALL        REDRAW_VIEW
  3451  3661  2c                    INC         L
  3452  3662  77                    LD          (HL),A                   ;= $20
  3453  3663  7b                    LD          A,E
  3454  3664  d60f                  SUB         0xf
  3455  3666  5f                    LD          E,A
  3456  3667  cd9b37                CALL        CALC_WEST_REDRAW
  3457  366a  7b                    LD          A,E
  3458  366b  c610                  ADD         A,$10
  3459  366d  5f                    LD          E,A
  3460  366e  cda035                CALL        REDRAW_VIEW
  3461  3671  cda735                CALL        REDRAW_NORTH
  3462  3674  7b                    LD          A,E
  3463  3675  d611                  SUB         $11
  3464  3677  5f                    LD          E,A
  3465  3678  1a                    LD          A,(DE)
  3466  3679  e607                  AND         0x7
  3467  367b  77                    LD          (HL),A                   ;= $20
  3468  367c  7b                    LD          A,E
  3469  367d  c60f                  ADD         A,0xf
  3470  367f  5f                    LD          E,A
  3471  3680  cda035                CALL        REDRAW_VIEW
  3472  3683  cda735                CALL        REDRAW_NORTH
  3473  3686  7b                    LD          A,E
  3474  3687  d61e                  SUB         $1e
  3475  3689  5f                    LD          E,A
  3476  368a  1a                    LD          A,(DE)
  3477  368b  e607                  AND         0x7
  3478  368d  77                    LD          (HL),A                   ;= $20
  3479  368e  7b                    LD          A,E
  3480  368f  c610                  ADD         A,$10
  3481  3691  5f                    LD          E,A
  3482  3692  cda035                CALL        REDRAW_VIEW
  3483  3695  cda735                CALL        REDRAW_NORTH
  3484  3698  7b                    LD          A,E
  3485  3699  d611                  SUB         $11
  3486  369b  5f                    LD          E,A
  3487  369c  cd9b37                CALL        CALC_WEST_REDRAW
  3488  369f  7b                    LD          A,E
  3489  36a0  c60f                  ADD         A,0xf
  3490  36a2  5f                    LD          E,A
  3491  36a3  cda035                CALL        REDRAW_VIEW
  3492  36a6  cda735                CALL        REDRAW_NORTH
  3493  36a9  7b                    LD          A,E
  3494  36aa  d61e                  SUB         $1e
  3495  36ac  5f                    LD          E,A
  3496  36ad  cd9b37                CALL        CALC_WEST_REDRAW
  3497  36b0  7b                    LD          A,E
  3498  36b1  c610                  ADD         A,$10
  3499  36b3  5f                    LD          E,A
  3500  36b4  cda035                CALL        REDRAW_VIEW
  3501  36b7  2c                    INC         L
  3502  36b8  77                    LD          (HL),A                   ;= $20
  3503  36b9  7b                    LD          A,E
  3504  36ba  c611                  ADD         A,$11
  3505  36bc  5f                    LD          E,A
  3506  36bd  1a                    LD          A,(DE)
  3507  36be  e607                  AND         0x7
  3508  36c0  2c                    INC         L
  3509  36c1  2c                    INC         L
  3510  36c2  77                    LD          (HL),A                    ;= $20
  3511  36c3  7b                    LD          A,E
  3512  36c4  d622                  SUB         $22
  3513  36c6  5f                    LD          E,A
  3514  36c7  cd9b37                CALL        CALC_WEST_REDRAW
  3515  36ca  7b                    LD          A,E
  3516  36cb  c60f                  ADD         A,0xf
  3517  36cd  5f                    LD          E,A
  3518  36ce  cda035                CALL        REDRAW_VIEW
  3519  36d1  2c                    INC         L
  3520  36d2  77                    LD          (HL),A                    ;= $20
  3521  36d3  7b                    LD          A,E
  3522  36d4  c610                  ADD         A,$10
  3523  36d6  5f                    LD          E,A
  3524  36d7  1a                    LD          A,(DE)
  3525  36d8  e607                  AND         0x7
  3526  36da  2c                    INC         L
  3527  36db  2c                    INC         L
  3528  36dc  77                    LD          (HL),A                    ;= $20
  3529  36dd  7b                    LD          A,E
  3530  36de  d61f                  SUB         $1f
  3531  36e0  5f                    LD          E,A
  3532  36e1  cda035                CALL        REDRAW_VIEW
  3533  36e4  2c                    INC         L
  3534  36e5  77                    LD          (HL),A                    ;= $20
  3535  36e6  1610                  LD          D,$10
  3536  36e8  1eff                  LD          E,$ff
  3537  36ea  ed53603a              LD          (DIR_FACING_FW),DE
  3538  36ee  0610                  LD          B,$10                                  ;RED on BLK
  3539  36f0  21d831                LD          HL,CHRRAM_POINTER_IDX                   ;WAS $31d6
  3540  36f3  11f936                LD          DE,SOUTH_TXT                            ;= "\t",$FF
  3541  36f6  c33533                JP          GFX_DRAW
  3542                          SOUTH_TXT:
  3543  36f9  09ff                  db          "\t",$FF
  3544  36fb  00                    db          $00
  3545  36fc  00                    db          $00
  3546  36fd  00                    db          $00
  3547  36fe  00                    db          $00
  3548                          FACING_EAST:
  3549  36ff  1c                    INC         E
  3550  3700  1a                    LD          A,(DE)
  3551  3701  e607                  AND         0x7
  3552  3703  77                    LD          (HL),A                   ;= $20
  3553  3704  1c                    INC         E
  3554  3705  cd9b37                CALL        CALC_WEST_REDRAW
  3555  3708  1c                    INC         E
  3556  3709  cd9b37                CALL        CALC_WEST_REDRAW
  3557  370c  1d                    DEC         E
  3558  370d  cda035                CALL        REDRAW_VIEW
  3559  3710  2c                    INC         L
  3560  3711  77                    LD          (HL),A                   ;= $20
  3561  3712  7b                    LD          A,E
  3562  3713  d60f                  SUB         0xf
  3563  3715  5f                    LD          E,A
  3564  3716  1a                    LD          A,(DE)
  3565  3717  e607                  AND         0x7
  3566  3719  cda735                CALL        REDRAW_NORTH
  3567  371c  7b                    LD          A,E
  3568  371d  c61f                  ADD         A,$1f
  3569  371f  5f                    LD          E,A
  3570  3720  cda035                CALL        REDRAW_VIEW
  3571  3723  77                    LD          (HL),A                   ;= $20
  3572  3724  1c                    INC         E
  3573  3725  1a                    LD          A,(DE)
  3574  3726  e607                  AND         0x7
  3575  3728  cda735                CALL        REDRAW_NORTH
  3576  372b  7b                    LD          A,E
  3577  372c  d612                  SUB         $12
  3578  372e  5f                    LD          E,A
  3579  372f  cda035                CALL        REDRAW_VIEW
  3580  3732  77                    LD          (HL),A                   ;= $20
  3581  3733  7b                    LD          A,E
  3582  3734  d60f                  SUB         0xf
  3583  3736  5f                    LD          E,A
  3584  3737  1a                    LD          A,(DE)
  3585  3738  e607                  AND         0x7
  3586  373a  cda735                CALL        REDRAW_NORTH
  3587  373d  7b                    LD          A,E
  3588  373e  c61f                  ADD         A,$1f
  3589  3740  5f                    LD          E,A
  3590  3741  cda035                CALL        REDRAW_VIEW
  3591  3744  2c                    INC         L
  3592  3745  77                    LD          (HL),A                   ;= $20
  3593  3746  1c                    INC         E
  3594  3747  1a                    LD          A,(DE)
  3595  3748  e607                  AND         0x7
  3596  374a  cda735                CALL        REDRAW_NORTH
  3597  374d  7b                    LD          A,E
  3598  374e  d612                  SUB         $12
  3599  3750  5f                    LD          E,A
  3600  3751  cda035                CALL        REDRAW_VIEW
  3601  3754  2c                    INC         L
  3602  3755  77                    LD          (HL),A                   ;= $20
  3603  3756  7b                    LD          A,E
  3604  3757  d60f                  SUB         0xf
  3605  3759  5f                    LD          E,A
  3606  375a  cd9b37                CALL        CALC_WEST_REDRAW
  3607  375d  1c                    INC         E
  3608  375e  cda035                CALL        REDRAW_VIEW
  3609  3761  2c                    INC         L
  3610  3762  2c                    INC         L
  3611  3763  77                    LD          (HL),A                    ;= $20
  3612  3764  7b                    LD          A,E
  3613  3765  c61e                  ADD         A,$1e
  3614  3767  5f                    LD          E,A
  3615  3768  cda035                CALL        REDRAW_VIEW
  3616  376b  2c                    INC         L
  3617  376c  77                    LD          (HL),A                    ;= $20
  3618  376d  1c                    INC         E
  3619  376e  cd9b37                CALL        CALC_WEST_REDRAW
  3620  3771  7b                    LD          A,E
  3621  3772  c611                  ADD         A,$11
  3622  3774  5f                    LD          E,A
  3623  3775  cda035                CALL        REDRAW_VIEW
  3624  3778  2c                    INC         L
  3625  3779  2c                    INC         L
  3626  377a  77                    LD          (HL),A                    ;= $20
  3627  377b  7b                    LD          A,E
  3628  377c  d622                  SUB         $22
  3629  377e  5f                    LD          E,A
  3630  377f  cd9b37                CALL        CALC_WEST_REDRAW
  3631  3782  1601                  LD          D,0x1
  3632  3784  1e10                  LD          E,$10
  3633  3786  ed53603a              LD          (DIR_FACING_FW),DE
  3634  378a  0610                  LD          B,$10                                  ;RED on BLK
  3635  378c  21d831                LD          HL,CHRRAM_POINTER_IDX                   ;WAS $31d6
  3636  378f  119537                LD          DE,EAST_TXT                             ;= $06,$FF
  3637  3792  c33533                JP          GFX_DRAW
  3638                          EAST_TXT:
  3639  3795  06ff                  db          $06,$FF
  3640  3797  00                    db          $00
  3641  3798  00                    db          $00
  3642  3799  00                    db          $00
  3643  379a  00                    db          $00
  3644                          CALC_WEST_REDRAW:
  3645  379b  1a                    LD          A,(DE)
  3646  379c  e607                  AND         0x7
  3647  379e  2c                    INC         L
  3648  379f  77                    LD          (HL),A
  3649  37a0  c9                    RET
  3650                          CALC_WEST_REDRAW_2:
  3651  37a1  dd21e837              LD          IX,ITEM_F2                              ;= $60
  3652  37a5  ed5b603a              LD          DE,(DIR_FACING_FW)
  3653  37a9  3a793a                LD          A,(PLAYER_MAP_POS)
  3654  37ac  82                    ADD         A,D
  3655  37ad  82                    ADD         A,D
  3656  37ae  cdf337                CALL        ITEM_MAP_CHECK
  3657  37b1  dd7700                LD          (IX+0),A                     ;= $60
  3658  37b4  7c                    LD          A,H
  3659  37b5  92                    SUB         D
  3660  37b6  cdf337                CALL        ITEM_MAP_CHECK
  3661  37b9  dd7701                LD          (IX+1),A                     ;= $60
  3662  37bc  7c                    LD          A,H
  3663  37bd  92                    SUB         D
  3664  37be  cdf337                CALL        ITEM_MAP_CHECK
  3665  37c1  dd7702                LD          (IX+2),A                     ;= $60
  3666  37c4  7c                    LD          A,H
  3667  37c5  82                    ADD         A,D
  3668  37c6  93                    SUB         E
  3669  37c7  cdf337                CALL        ITEM_MAP_CHECK
  3670  37ca  dd7703                LD          (IX+3),A                    ;= $60
  3671  37cd  7c                    LD          A,H
  3672  37ce  83                    ADD         A,E
  3673  37cf  83                    ADD         A,E
  3674  37d0  cdf337                CALL        ITEM_MAP_CHECK
  3675  37d3  dd7704                LD          (IX+4),A                    ;= $60
  3676  37d6  7c                    LD          A,H
  3677  37d7  92                    SUB         D
  3678  37d8  cdf337                CALL        ITEM_MAP_CHECK
  3679  37db  dd7705                LD          (IX+5),A                     ;= $60
  3680  37de  7c                    LD          A,H
  3681  37df  93                    SUB         E
  3682  37e0  93                    SUB         E
  3683  37e1  cdf337                CALL        ITEM_MAP_CHECK
  3684  37e4  dd7706                LD          (IX+6),A                     ;= $60
  3685  37e7  7c                    LD          A,H
  3686  37e8  92                    SUB         D
  3687  37e9  83                    ADD         A,E
  3688  37ea  cdf337                CALL        ITEM_MAP_CHECK
  3689  37ed  dd7707                LD          (IX+7),A                     ;= $60
  3690                          LAB_ram_f7f0:
  3691  37f0  3efe                  LD          A,$fe
  3692  37f2  c9                    RET
  3693                          ITEM_MAP_CHECK:
  3694  37f3  67                    LD          H,A
  3695  37f4  010039                LD          BC,MAP_LADDER_OFFSET
  3696                          LAB_ram_f7f7:
  3697  37f7  0a                    LD          A,(BC)
  3698  37f8  03                    INC         BC
  3699  37f9  03                    INC         BC
  3700  37fa  3c                    INC         A
  3701  37fb  28f3                  JR          Z,LAB_ram_f7f0
  3702  37fd  3d                    DEC         A
  3703  37fe  bc                    CP          H
  3704  37ff  20f6                  JR          NZ,LAB_ram_f7f7
  3705  3801  0d                    DEC         C
  3706  3802  0a                    LD          A,(BC)
  3707  3803  c9                    RET
  3708                          REDRAW_VIEWPORT:
  3709  3804  cd4910                CALL        DRAW_BKGD
  3710  3807  01e837                LD          BC,ITEM_F2                              ;BC = ITEM_F2
  3711  380a  11e833                LD          DE,WALL_F0_STATE                        ;DE = wallAheadTemp
  3712  380d  1a                    LD          A,(DE)                   ;A = (wallAheadTemp)
  3713  380e  0f                    RRCA
  3714  380f  d22538                JP          NC,F0_NO_HD                             ;Jump if no hidden door
  3715  3812  08                    EX          AF,AF'
  3716  3813  cd4609                CALL        DRAW_F0_WALL
  3717  3816  08                    EX          AF,AF'
  3718  3817  0f                    RRCA
  3719  3818  d28f39                JP          NC,F0_HD_NO_WALL                        ;Jump if no wall
  3720  381b  0f                    RRCA
  3721  381c  d28f39                JP          NC,F0_HD_NO_WALL                        ;Jump if door closed
  3722                          F0_NO_HD_WALL_OPEN:
  3723  381f  cd5f09                CALL        DRAW_WALL_F0_AND_OPEN_DOOR
  3724  3822  c38639                JP          LAB_ram_f986
  3725                          F0_NO_HD:
  3726  3825  0f                    RRCA
  3727  3826  d23338                JP          NC,F0_NO_HD_NO_WALL                     ;Jump if no wall
  3728  3829  0f                    RRCA
  3729  382a  da1f38                JP          C,F0_NO_HD_WALL_OPEN                    ;Jump if door open
  3730  382d  cd5109                CALL        DRAW_F0_WALL_AND_CLOSED_DOOR
  3731  3830  c38f39                JP          F0_HD_NO_WALL
  3732                          F0_NO_HD_NO_WALL:
  3733  3833  13                    INC         DE
  3734  3834  1a                    LD          A,(DE)                   ;= $20
  3735  3835  0f                    RRCA
  3736  3836  d24c38                JP          NC,F1_NO_HD                             ;Jump if no hidden door
  3737  3839  08                    EX          AF,AF'
  3738  383a  cd6709                CALL        DRAW_WALL_F1
  3739  383d  08                    EX          AF,AF'
  3740  383e  0f                    RRCA
  3741  383f  d2c038                JP          NC,F1_HD_NO_WALL                        ;Jump if no wall
  3742  3842  0f                    RRCA
  3743  3843  d2c038                JP          NC,F1_HD_NO_WALL                        ;Jump if door closed
  3744                          F1_NO_HD_WALL_OPEN:
  3745  3846  cd8a09                CALL        DRAW_WALL_F1_AND_OPEN_DOOR
  3746  3849  c3b738                JP          LAB_ram_f8b7
  3747                          F1_NO_HD:
  3748  384c  0f                    RRCA
  3749  384d  d25a38                JP          NC,LAB_ram_f85a
  3750  3850  0f                    RRCA
  3751  3851  da4638                JP          C,F1_NO_HD_WALL_OPEN
  3752  3854  cd7c09                CALL        DRAW_WALL_F1_AND_CLOSED_DOOR
  3753  3857  c3c038                JP          F1_HD_NO_WALL
  3754                          LAB_ram_f85a:
  3755  385a  13                    INC         DE
  3756  385b  1a                    LD          A,(DE)                   ;= $20
  3757  385c  0f                    RRCA
  3758  385d  d26638                JP          NC,CHECK_WALL_F2
  3759                          F2_WALL:
  3760  3860  cd9209                CALL        DRAW_WALL_F2
  3761  3863  c36d38                JP          LAB_ram_f86d
  3762                          CHECK_WALL_F2:
  3763  3866  0f                    RRCA
  3764  3867  da6038                JP          C,F2_WALL
  3765  386a  cd9d09                CALL        DRAW_DOOR_F2_OPEN
  3766                          LAB_ram_f86d:
  3767  386d  11eb33                LD          DE,WALL_F3_STATE                        ;= $20
  3768  3870  1a                    LD          A,(DE)                   ;= $20
  3769  3871  0f                    RRCA
  3770  3872  d27b38                JP          NC,LAB_ram_f87b
  3771                          LAB_ram_f875:
  3772  3875  cd420b                CALL        DRAW_WALL_FL2_EMPTY
  3773  3878  c39238                JP          LAB_ram_f892
  3774                          LAB_ram_f87b:
  3775  387b  0f                    RRCA
  3776  387c  da7538                JP          C,LAB_ram_f875
  3777  387f  13                    INC         DE
  3778  3880  1a                    LD          A,(DE)                    ;= $20
  3779  3881  0f                    RRCA
  3780  3882  d28b38                JP          NC,LAB_ram_f88b
  3781                          LAB_ram_f885:
  3782  3885  cd8d0b                CALL        DRAW_WALL_L2_C
  3783  3888  c39238                JP          LAB_ram_f892
  3784                          LAB_ram_f88b:
  3785  388b  0f                    RRCA
  3786  388c  da8538                JP          C,LAB_ram_f885
  3787  388f  cd980b                CALL        DRAW_WALL_L2_C_EMPTY
  3788                          LAB_ram_f892:
  3789  3892  11ed33                LD          DE,DAT_ram_33ed                         ;= $20
  3790  3895  1a                    LD          A,(DE)                    ;= $20
  3791  3896  0f                    RRCA
  3792  3897  d2a038                JP          NC,LAB_ram_f8a0
  3793                          LAB_ram_f89a:
  3794  389a  cd3b0d                CALL        DRAW_WALL_FR2
  3795  389d  c3b738                JP          LAB_ram_f8b7
  3796                          LAB_ram_f8a0:
  3797  38a0  0f                    RRCA
  3798  38a1  da9a38                JP          C,LAB_ram_f89a
  3799  38a4  13                    INC         DE
  3800  38a5  1a                    LD          A,(DE)                    ;= $20
  3801  38a6  0f                    RRCA
  3802  38a7  d2b038                JP          NC,LAB_ram_f8b0
  3803                          LAB_ram_f8aa:
  3804  38aa  cd790d                CALL        SUB_ram_cd21
  3805  38ad  c3b738                JP          LAB_ram_f8b7
  3806                          LAB_ram_f8b0:
  3807  38b0  0f                    RRCA
  3808  38b1  daaa38                JP          C,LAB_ram_f8aa
  3809  38b4  cd840d                CALL        SUB_ram_cd2c
  3810                          LAB_ram_f8b7:
  3811  38b7  3ae837                LD          A,(ITEM_F2)                             ;= $60
  3812  38ba  018a04                LD          BC,$48a
  3813  38bd  cdac2c                CALL        CHK_ITEM
  3814                          F1_HD_NO_WALL:
  3815  38c0  11ef33                LD          DE,DAT_ram_33ef                         ;= $20
  3816  38c3  1a                    LD          A,(DE)                    ;= $20
  3817  38c4  0f                    RRCA
  3818  38c5  d2db38                JP          NC,LAB_ram_f8db
  3819  38c8  08                    EX          AF,AF'
  3820  38c9  cd920a                CALL        DRAW_L1_WALL
  3821  38cc  08                    EX          AF,AF'
  3822  38cd  0f                    RRCA
  3823  38ce  d22339                JP          NC,LAB_ram_f923
  3824  38d1  0f                    RRCA
  3825  38d2  d22339                JP          NC,LAB_ram_f923
  3826                          LAB_ram_f8d5:
  3827  38d5  cdd50a                CALL        DRAW_FL1_DOOR
  3828  38d8  c32339                JP          LAB_ram_f923
  3829                          LAB_ram_f8db:
  3830  38db  0f                    RRCA
  3831  38dc  d2e938                JP          NC,LAB_ram_f8e9
  3832  38df  0f                    RRCA
  3833  38e0  dad538                JP          C,LAB_ram_f8d5
  3834  38e3  cde30a                CALL        DRAW_L1
  3835  38e6  c32339                JP          LAB_ram_f923
  3836                          LAB_ram_f8e9:
  3837  38e9  1c                    INC         E
  3838  38ea  1a                    LD          A,(DE)                    ;= $20
  3839  38eb  0f                    RRCA
  3840  38ec  d20239                JP          NC,LAB_ram_f902
  3841  38ef  08                    EX          AF,AF'
  3842  38f0  cd030b                CALL        SUB_ram_cab0
  3843  38f3  08                    EX          AF,AF'
  3844  38f4  0f                    RRCA
  3845  38f5  d22339                JP          NC,LAB_ram_f923
  3846  38f8  0f                    RRCA
  3847  38f9  d22339                JP          NC,LAB_ram_f923
  3848                          LAB_ram_f8fc:
  3849  38fc  cd180b                CALL        SUB_ram_cac5
  3850  38ff  c32339                JP          LAB_ram_f923
  3851                          LAB_ram_f902:
  3852  3902  0f                    RRCA
  3853  3903  d21039                JP          NC,LAB_ram_f910
  3854  3906  0f                    RRCA
  3855  3907  dafc38                JP          C,LAB_ram_f8fc
  3856  390a  cd1f0b                CALL        DRAW_L1_DOOR_CLOSED
  3857  390d  c32339                JP          LAB_ram_f923
  3858                          LAB_ram_f910:
  3859  3910  1c                    INC         E
  3860  3911  1a                    LD          A,(DE)                    ;= $20
  3861  3912  0f                    RRCA
  3862  3913  d21c39                JP          NC,LAB_ram_f91c
  3863                          LAB_ram_f916:
  3864  3916  cd5312                CALL        DRAW_WALL_FL2_NEW
  3865  3919  c32339                JP          LAB_ram_f923
  3866                          LAB_ram_f91c:
  3867  391c  0f                    RRCA
  3868  391d  da1639                JP          C,LAB_ram_f916
  3869  3920  cd420b                CALL        DRAW_WALL_FL2_EMPTY
  3870                          LAB_ram_f923:
  3871  3923  11f233                LD          DE,DAT_ram_33f2                         ;= $20
  3872  3926  1a                    LD          A,(DE)                    ;= $20
  3873  3927  0f                    RRCA
  3874  3928  d23e39                JP          NC,LAB_ram_f93e
  3875  392b  08                    EX          AF,AF'
  3876  392c  cd810c                CALL        DRAW_WALL_FR1
  3877  392f  08                    EX          AF,AF'
  3878  3930  0f                    RRCA
  3879  3931  d28639                JP          NC,LAB_ram_f986
  3880  3934  0f                    RRCA
  3881  3935  d28639                JP          NC,LAB_ram_f986
  3882                          LAB_ram_f938:
  3883  3938  cdc30c                CALL        SUB_ram_cc6d
  3884  393b  c38639                JP          LAB_ram_f986
  3885                          LAB_ram_f93e:
  3886  393e  0f                    RRCA
  3887  393f  d24c39                JP          NC,LAB_ram_f94c
  3888  3942  0f                    RRCA
  3889  3943  da3839                JP          C,LAB_ram_f938
  3890  3946  cdd10c                CALL        SUB_ram_cc7a
  3891  3949  c38639                JP          LAB_ram_f986
  3892                          LAB_ram_f94c:
  3893  394c  1c                    INC         E
  3894  394d  1a                    LD          A,(DE)                    ;= $20
  3895  394e  0f                    RRCA
  3896  394f  d26539                JP          NC,LAB_ram_f965
  3897  3952  08                    EX          AF,AF'
  3898  3953  cdf10c                CALL        SUB_ram_cc9a
  3899  3956  08                    EX          AF,AF'
  3900  3957  0f                    RRCA
  3901  3958  d28639                JP          NC,LAB_ram_f986
  3902  395b  0f                    RRCA
  3903  395c  d28639                JP          NC,LAB_ram_f986
  3904                          LAB_ram_f95f:
  3905  395f  cd060d                CALL        SUB_ram_ccaf
  3906  3962  c38639                JP          LAB_ram_f986
  3907                          LAB_ram_f965:
  3908  3965  0f                    RRCA
  3909  3966  d27339                JP          NC,LAB_ram_f973
  3910  3969  0f                    RRCA
  3911  396a  da5f39                JP          C,LAB_ram_f95f
  3912  396d  cd0d0d                CALL        SUB_ram_ccb5
  3913  3970  c38639                JP          LAB_ram_f986
  3914                          LAB_ram_f973:
  3915  3973  1c                    INC         E
  3916  3974  1a                    LD          A,(DE)                    ;= $20
  3917  3975  0f                    RRCA
  3918  3976  d27f39                JP          NC,LAB_ram_f97f
  3919                          LAB_ram_f979:
  3920  3979  cd1b0d                CALL        SUB_ram_ccc3
  3921  397c  c38639                JP          LAB_ram_f986
  3922                          LAB_ram_f97f:
  3923  397f  0f                    RRCA
  3924  3980  da7939                JP          C,LAB_ram_f979
  3925  3983  cd300d                CALL        DRAW_WALL_FR2_EMPTY
  3926                          LAB_ram_f986:
  3927  3986  3ae937                LD          A,(ITEM_F1)                             ;= $60
  3928  3989  018a02                LD          BC,$28a
  3929  398c  cdac2c                CALL        CHK_ITEM
  3930                          F0_HD_NO_WALL:
  3931  398f  11f533                LD          DE,DAT_ram_33f5                         ;= $20
  3932  3992  1a                    LD          A,(DE)                    ;= $20
  3933  3993  0f                    RRCA
  3934  3994  d2aa39                JP          NC,LAB_ram_f9aa
  3935  3997  08                    EX          AF,AF'
  3936  3998  cda809                CALL        DRAW_WALL_FL0
  3937  399b  08                    EX          AF,AF'
  3938  399c  0f                    RRCA
  3939  399d  d2193a                JP          NC,LAB_ram_fa19
  3940  39a0  0f                    RRCA
  3941  39a1  d2193a                JP          NC,LAB_ram_fa19
  3942                          LAB_ram_f9a4:
  3943  39a4  cddc09                CALL        DRAW_DOOR_FLO
  3944  39a7  c3193a                JP          LAB_ram_fa19
  3945                          LAB_ram_f9aa:
  3946  39aa  0f                    RRCA
  3947  39ab  d2b839                JP          NC,LAB_ram_f9b8
  3948  39ae  0f                    RRCA
  3949  39af  daa439                JP          C,LAB_ram_f9a4
  3950  39b2  cde709                CALL        SUB_ram_c996
  3951  39b5  c3193a                JP          LAB_ram_fa19
  3952                          LAB_ram_f9b8:
  3953  39b8  1c                    INC         E
  3954  39b9  1a                    LD          A,(DE)                    ;= $20
  3955  39ba  0f                    RRCA
  3956  39bb  d2c439                JP          NC,LAB_ram_f9c4
  3957                          LAB_ram_f9be:
  3958  39be  cd160a                CALL        SUB_ram_c9c5
  3959  39c1  c3193a                JP          LAB_ram_fa19
  3960                          LAB_ram_f9c4:
  3961  39c4  0f                    RRCA
  3962  39c5  dabe39                JP          C,LAB_ram_f9be
  3963  39c8  1c                    INC         E
  3964  39c9  1a                    LD          A,(DE)                    ;= $20
  3965  39ca  0f                    RRCA
  3966  39cb  d2f039                JP          NC,LAB_ram_f9f0
  3967  39ce  08                    EX          AF,AF'
  3968  39cf  cd210a                CALL        SUB_ram_c9d0
  3969  39d2  cde739                CALL        SUB_ram_f9e7
  3970  39d5  08                    EX          AF,AF'
  3971  39d6  0f                    RRCA
  3972  39d7  d2193a                JP          NC,LAB_ram_fa19
  3973  39da  0f                    RRCA
  3974  39db  d2193a                JP          NC,LAB_ram_fa19
  3975                          LAB_ram_f9de:
  3976  39de  cd440a                CALL        SUB_ram_c9f3
  3977  39e1  cde739                CALL        SUB_ram_f9e7
  3978  39e4  c3193a                JP          LAB_ram_fa19
  3979                          SUB_ram_f9e7:
  3980  39e7  3aeb37                LD          A,(ITEM_FL1)                            ;= $60
  3981  39ea  01d004                LD          BC,$4d0
  3982  39ed  c3ac2c                JP          CHK_ITEM
  3983                          LAB_ram_f9f0:
  3984  39f0  0f                    RRCA
  3985  39f1  d2013a                JP          NC,LAB_ram_fa01
  3986  39f4  0f                    RRCA
  3987  39f5  dade39                JP          C,LAB_ram_f9de
  3988  39f8  cd360a                CALL        SUB_ram_c9e5
  3989  39fb  cde739                CALL        SUB_ram_f9e7
  3990  39fe  c3193a                JP          LAB_ram_fa19
  3991                          LAB_ram_fa01:
  3992  3a01  1c                    INC         E
  3993  3a02  0f                    RRCA
  3994  3a03  d20f3a                JP          NC,LAB_ram_fa0f
  3995                          LAB_ram_fa06:
  3996  3a06  cd4b0a                CALL        SUB_ram_c9f9
  3997  3a09  cde739                CALL        SUB_ram_f9e7
  3998  3a0c  c3193a                JP          LAB_ram_fa19
  3999                          LAB_ram_fa0f:
  4000  3a0f  0f                    RRCA
  4001  3a10  da063a                JP          C,LAB_ram_fa06
  4002  3a13  cd3d12                CALL        DRAW_WALL_FL22_EMPTY
  4003  3a16  cde739                CALL        SUB_ram_f9e7
  4004                          LAB_ram_fa19:
  4005  3a19  11f933                LD          DE,DAT_ram_33f9                         ;= $20
  4006  3a1c  1a                    LD          A,(DE)                    ;= $20
  4007  3a1d  0f                    RRCA
  4008  3a1e  d2343a                JP          NC,LAB_ram_fa34
  4009  3a21  08                    EX          AF,AF'
  4010  3a22  cda30b                CALL        SUB_ram_cb4f
  4011  3a25  08                    EX          AF,AF'
  4012  3a26  0f                    RRCA
  4013  3a27  d2a33a                JP          NC,LAB_ram_faa3
  4014  3a2a  0f                    RRCA
  4015  3a2b  d2a33a                JP          NC,LAB_ram_faa3
  4016                          LAB_ram_fa2e:
  4017  3a2e  cdc80b                CALL        DRAW_FRO_DOOR
  4018  3a31  c3a33a                JP          LAB_ram_faa3
  4019                          LAB_ram_fa34:
  4020  3a34  0f                    RRCA
  4021  3a35  d2423a                JP          NC,LAB_ram_fa42
  4022  3a38  0f                    RRCA
  4023  3a39  da2e3a                JP          C,LAB_ram_fa2e
  4024  3a3c  cdd30b                CALL        SUB_ram_cb7e
  4025  3a3f  c3a33a                JP          LAB_ram_faa3
  4026                          LAB_ram_fa42:
  4027  3a42  1c                    INC         E
  4028  3a43  1a                    LD          A,(DE)                    ;= $20
  4029  3a44  0f                    RRCA
  4030  3a45  d2573a                JP          NC,LAB_ram_fa57
  4031                          LAB_ram_fa48:
  4032  3a48  cd030c                CALL        SUB_ram_cbae
  4033  3a4b  c3a33a                JP          LAB_ram_faa3
  4034                          SUB_ram_fa4e:
  4035  3a4e  3aec37                LD          A,(ITEM_FR1)                            ;= $60
  4036  3a51  01e404                LD          BC,$4e4
  4037  3a54  c3ac2c                JP          CHK_ITEM
  4038                          LAB_ram_fa57:
  4039  3a57  0f                    RRCA
  4040  3a58  da483a                JP          C,LAB_ram_fa48
  4041  3a5b  1c                    INC         E
  4042  3a5c  1a                    LD          A,(DE)                    ;= $20
  4043  3a5d  0f                    RRCA
  4044  3a5e  d27a3a                JP          NC,LAB_ram_fa7a
  4045  3a61  08                    EX          AF,AF'
  4046  3a62  cd0e0c                CALL        SUB_ram_cbb9
  4047  3a65  cd4e3a                CALL        SUB_ram_fa4e
  4048  3a68  08                    EX          AF,AF'
  4049  3a69  0f                    RRCA
  4050  3a6a  d2a33a                JP          NC,LAB_ram_faa3
  4051  3a6d  0f                    RRCA
  4052  3a6e  d2a33a                JP          NC,LAB_ram_faa3
  4053                          LAB_ram_fa71:
  4054  3a71  cd230c                CALL        SUB_ram_cbce
  4055  3a74  cd4e3a                CALL        SUB_ram_fa4e
  4056  3a77  c3a33a                JP          LAB_ram_faa3
  4057                          LAB_ram_fa7a:
  4058  3a7a  0f                    RRCA
  4059  3a7b  d28b3a                JP          NC,LAB_ram_fa8b
  4060  3a7e  0f                    RRCA
  4061  3a7f  da713a                JP          C,LAB_ram_fa71
  4062  3a82  cd2a0c                CALL        SUB_ram_cbd4
  4063  3a85  cd4e3a                CALL        SUB_ram_fa4e
  4064  3a88  c3a33a                JP          LAB_ram_faa3
  4065                          LAB_ram_fa8b:
  4066  3a8b  1c                    INC         E
  4067  3a8c  0f                    RRCA
  4068  3a8d  d2993a                JP          NC,LAB_ram_fa99
  4069                          LAB_ram_fa90:
  4070  3a90  cd380c                CALL        SUB_ram_cbe2
  4071  3a93  cd4e3a                CALL        SUB_ram_fa4e
  4072  3a96  c3a33a                JP          LAB_ram_faa3
  4073                          LAB_ram_fa99:
  4074  3a99  0f                    RRCA
  4075  3a9a  da903a                JP          C,LAB_ram_fa90
  4076  3a9d  cd760c                CALL        DRAW_WALL_FR222_EMPTY
  4077  3aa0  cd4e3a                CALL        SUB_ram_fa4e
  4078                          LAB_ram_faa3:
  4079  3aa3  3aea37                LD          A,(ITEM_F0)                             ;= $60
  4080  3aa6  018a00                LD          BC,$8a
  4081  3aa9  c3ac2c                JP          CHK_ITEM
  4082                          MAKE_RANDOM_BYTE:
  4083  3aac  c5                    PUSH        BC
  4084  3aad  e5                    PUSH        HL
  4085  3aae  0605                  LD          B,0x5                                   ;Run data randomizer 5x
  4086  3ab0  2a913a                LD          HL,(RNDHOLD_AA)
  4087                          RANDOM_BYTE_LOOP:
  4088  3ab3  cb25                  SLA         L                                       ;L x 2
  4089  3ab5  cb14                  RL          H
  4090  3ab7  3808                  JR          C,FINISH_BYTE_LOOP
  4091  3ab9  3e87                  LD          A,$87
  4092  3abb  ad                    XOR         L
  4093  3abc  6f                    LD          L,A
  4094  3abd  3e1d                  LD          A,$1d
  4095  3abf  ac                    XOR         H
  4096  3ac0  67                    LD          H,A
  4097                          FINISH_BYTE_LOOP:
  4098  3ac1  10f0                  DJNZ        RANDOM_BYTE_LOOP
  4099  3ac3  22913a                LD          (RNDHOLD_AA),HL
  4100  3ac6  7c                    LD          A,H
  4101  3ac7  e1                    POP         HL
  4102  3ac8  c1                    POP         BC
  4103  3ac9  c9                    RET
  4104                          UPDATE_SCR_SAVER_TIMER:
  4105  3aca  c5                    PUSH        BC
  4106  3acb  e5                    PUSH        HL
  4107  3acc  2a9c3a                LD          HL,(TIMER_E)
  4108  3acf  44                    LD          B,H
  4109  3ad0  4d                    LD          C,L
  4110  3ad1  cb21                  SLA         C
  4111  3ad3  cb10                  RL          B
  4112  3ad5  cb21                  SLA         C
  4113  3ad7  cb10                  RL          B
  4114  3ad9  09                    ADD         HL,BC
  4115  3ada  7c                    LD          A,H
  4116  3adb  ad                    XOR         L
  4117  3adc  32883a                LD          (TIMER_D),A
  4118  3adf  44                    LD          B,H
  4119  3ae0  4d                    LD          C,L
  4120  3ae1  cb21                  SLA         C
  4121  3ae3  cb10                  RL          B
  4122  3ae5  cb21                  SLA         C
  4123  3ae7  cb10                  RL          B
  4124  3ae9  09                    ADD         HL,BC
  4125  3aea  011300                LD          BC,$13
  4126  3aed  09                    ADD         HL,BC
  4127  3aee  229c3a                LD          (TIMER_E),HL
  4128  3af1  e1                    POP         HL
  4129  3af2  c1                    POP         BC
  4130  3af3  c9                    RET
  4131                          MINOTAUR_DEAD:
  4132  3af4  cd4910                CALL        DRAW_BKGD
  4133  3af7  215030                LD          HL,DAT_ram_3050                         ;= $20
  4134  3afa  11a408                LD          DE,THE_END_PART_A                       ;WAS LD DE, 0xC25D
  4135  3afd  0610                  LD          B,$10                                  ;RED on BLK
  4136  3aff  cd3533                CALL        GFX_DRAW
  4137  3b02  21a030                LD          HL,DAT_ram_30a0                         ;= $20
  4138  3b05  cd3533                CALL        GFX_DRAW
  4139  3b08  cdac3a                CALL        MAKE_RANDOM_BYTE
  4140  3b0b  e603                  AND         0x3
  4141  3b0d  c60a                  ADD         A,0xa
  4142  3b0f  47                    LD          B,A
  4143  3b10  00                    db          $00
  4144  3b11  00                    db          $00
  4145  3b12  00                    db          $00
  4146  3b13  00                    db          $00
  4147  3b14  00                    db          $00
  4148  3b15  00                    db          $00
  4149  3b16  00                    db          $00
  4150  3b17  00                    db          $00
  4151  3b18  00                    db          $00
  4152  3b19  3a6c3a                LD          A,(INPUT_HOLDER)
  4153  3b1c  07                    RLCA
  4154  3b1d  07                    RLCA
  4155  3b1e  07                    RLCA
  4156  3b1f  07                    RLCA
  4157  3b20  47                    LD          B,A
  4158  3b21  af                    XOR         A
  4159  3b22  326c3a                LD          (INPUT_HOLDER),A
  4160  3b25  110f07                LD          DE,MINOTAUR                             ;= $04,$04,$04,$04
  4161  3b28  21da32                LD          HL,DAT_ram_32da                         ;= $20
  4162  3b2b  cd3533                CALL        GFX_DRAW
  4163  3b2e  cdbc2e                CALL        TOTAL_HEAL
  4164  3b31  cd5d3d                CALL        REDRAW_STATS
  4165  3b34  0602                  LD          B,0x2                                   ;Was LD B,0x6
  4166                          MINOTAUR_DEAD_SOUND_LOOP:
  4167  3b36  d9                    EXX
  4168  3b37  cdb70d                CALL        SUB_ram_cd5f
  4169  3b3a  cdd40d                CALL        END_OF_GAME_SOUND
  4170  3b3d  d9                    EXX
  4171  3b3e  10f6                  DJNZ        MINOTAUR_DEAD_SOUND_LOOP
  4172  3b40  c3b72a                JP          SCREEN_SAVER_FULL_SCREEN
  4173  3b43  00                    db          $00
  4174  3b44  00                    db          $00
  4175  3b45  00                    db          $00
  4176  3b46  00                    db          $00
  4177  3b47  00                    db          $00
  4178  3b48  00                    db          $00
  4179  3b49  00                    db          $00
  4180  3b4a  00                    db          $00
  4181  3b4b  00                    db          $00
  4182  3b4c  00                    db          $00
  4183  3b4d  00                    db          $00
  4184  3b4e  00                    db          $00
  4185  3b4f  00                    db          $00
  4186  3b50  00                    db          $00
  4187  3b51  00                    db          $00
  4188  3b52  00                    db          $00
  4189  3b53  00                    db          $00
  4190  3b54  00                    db          $00
  4191  3b55  00                    db          $00
  4192  3b56  00                    db          $00
  4193  3b57  00                    db          $00
  4194  3b58  00                    db          $00
  4195  3b59  00                    db          $00
  4196  3b5a  00                    db          $00
  4197  3b5b  00                    db          $00
  4198  3b5c  00                    db          $00
  4199  3b5d  00                    db          $00
  4200  3b5e  00                    db          $00
  4201  3b5f  00                    db          $00
  4202  3b60  00                    db          $00
  4203  3b61  00                    db          $00
  4204  3b62  00                    db          $00
  4205  3b63  00                    db          $00
  4206  3b64  00                    db          $00
  4207  3b65  00                    db          $00
  4208  3b66  00                    db          $00
  4209  3b67  00                    db          $00
  4210  3b68  00                    db          $00
  4211  3b69  00                    db          $00
  4212  3b6a  00                    db          $00
  4213                          DO_REST:
  4214  3b6b  3a783a                LD          A,(LAST_ITEM_HELD)                   ;Load food inventory into A
  4215  3b6e  a7                    AND         A
  4216  3b6f  c23022                JP          NZ,NO_ACTION_TAKEN                      ;If food is empty, do nothing
  4217                          CHK_NEEDS_HEALING:
  4218  3b72  2a953a                LD          HL,(PLAYER_PHYS_HEALTH_MAX)             ;HL = max PHYS health
  4219  3b75  ed5b933a              LD          DE,(PLAYER_PHYS_HEALTH)                 ;DE = current PHYS health
  4220  3b79  cd3024                CALL        RECALC_PHYS_HEALTH
  4221  3b7c  b5                    OR          L
  4222  3b7d  200d                  JR          NZ,HEAL_PLAYER_PHYS_HEALTH
  4223  3b7f  3a983a                LD          A,(PLAYER_SPRT_HEALTH_MAX)
  4224  3b82  4f                    LD          C,A
  4225  3b83  3a973a                LD          A,(PLAYER_SPRT_HEALTH)
  4226  3b86  b9                    CP          C
  4227  3b87  ca9c2a                JP          Z,INPUT_DEBOUNCE
  4228  3b8a  182a                  JR          HEAL_PLAYER_SPRT_HEALTH
  4229                          HEAL_PLAYER_PHYS_HEALTH:
  4230  3b8c  2aa93a                LD          HL,(BYTE_ram_3aa9)
  4231  3b8f  110100                LD          DE,0x1
  4232  3b92  cd3024                CALL        RECALC_PHYS_HEALTH
  4233  3b95  da9c2a                JP          C,INPUT_DEBOUNCE
  4234  3b98  22a93a                LD          (BYTE_ram_3aa9),HL
  4235  3b9b  21ab3a                LD          HL,FOOD_INV
  4236  3b9e  35                    DEC         (HL)
  4237  3b9f  2a933a                LD          HL,(PLAYER_PHYS_HEALTH)
  4238  3ba2  cd2724                CALL        SUB_ram_e427
  4239  3ba5  22933a                LD          (PLAYER_PHYS_HEALTH),HL
  4240  3ba8  cd5d3d                CALL        REDRAW_STATS
  4241  3bab  3a983a                LD          A,(PLAYER_SPRT_HEALTH_MAX)
  4242  3bae  4f                    LD          C,A
  4243  3baf  3a973a                LD          A,(PLAYER_SPRT_HEALTH)
  4244  3bb2  b9                    CP          C
  4245  3bb3  ca723b                JP          Z,CHK_NEEDS_HEALING
  4246                          HEAL_PLAYER_SPRT_HEALTH:
  4247  3bb6  2aa93a                LD          HL,(BYTE_ram_3aa9)
  4248  3bb9  110100                LD          DE,0x1
  4249  3bbc  cd3024                CALL        RECALC_PHYS_HEALTH
  4250  3bbf  da9c2a                JP          C,INPUT_DEBOUNCE
  4251  3bc2  22a93a                LD          (BYTE_ram_3aa9),HL
  4252  3bc5  21ab3a                LD          HL,FOOD_INV
  4253  3bc8  35                    DEC         (HL)
  4254  3bc9  3a973a                LD          A,(PLAYER_SPRT_HEALTH)
  4255  3bcc  c601                  ADD         A,0x1
  4256  3bce  27                    DAA
  4257  3bcf  32973a                LD          (PLAYER_SPRT_HEALTH),A
  4258  3bd2  cd5d3d                CALL        REDRAW_STATS
  4259  3bd5  189b                  JR          CHK_NEEDS_HEALING
  4260  3bd7  00                    db          $00
  4261  3bd8  00                    db          $00
  4262  3bd9  00                    db          $00
  4263  3bda  00                    db          $00
  4264  3bdb  00                    db          $00
  4265  3bdc  00                    db          $00
  4266  3bdd  00                    db          $00
  4267  3bde  00                    db          $00
  4268  3bdf  00                    db          $00
  4269                          KEY_COMPARE:
  4270  3be0  3a663a                LD          A,(RAM_AE)
  4271  3be3  fe31                  CP          $31                                    ;Compare to "1" db?
  4272  3be5  c29f2a                JP          NZ,WAIT_FOR_INPUT
  4273                          KEY_COL_0:
  4274  3be8  21f637                LD          HL,KEY_INPUT_COL0                       ;= $60
  4275  3beb  7e                    LD          A,(HL)                  ;A = Key Column 0
  4276  3bec  fefe                  CP          $fe                                    ;If Key Row = 0 "="
  4277  3bee  ca3022                JP          Z,NO_ACTION_TAKEN
  4278  3bf1  fefd                  CP          $fd                                    ;If Key Row = 1 "BKSP"
  4279  3bf3  ca3022                JP          Z,NO_ACTION_TAKEN
  4280  3bf6  fefb                  CP          $fb                                    ;If Key Row = 2 ":"
  4281  3bf8  ca3022                JP          Z,NO_ACTION_TAKEN
  4282  3bfb  fef7                  CP          $f7                                    ;If Key Row = 3 "RET"
  4283  3bfd  ca3022                JP          Z,NO_ACTION_TAKEN
  4284  3c00  feef                  CP          $ef                                    ;If Key Row = 4 ";"
  4285  3c02  ca322e                JP          Z,DO_GLANCE_RIGHT
  4286  3c05  fedf                  CP          $df                                    ;If Key Row = 5 "."
  4287  3c07  ca182e                JP          Z,DO_TURN_RIGHT
  4288                          KEY_COL_1:
  4289  3c0a  2c                    INC         L
  4290  3c0b  7e                    LD          A,(HL)                  ;A = Key Column 1
  4291  3c0c  fefe                  CP          $fe                                    ;If Key Row = 0 "-"
  4292  3c0e  ca3022                JP          Z,NO_ACTION_TAKEN
  4293  3c11  fefd                  CP          $fd                                    ;If Key Row = 1 "/"
  4294  3c13  ca3022                JP          Z,NO_ACTION_TAKEN
  4295  3c16  fefb                  CP          $fb                                    ;If Key Row = 2 "0"
  4296  3c18  ca3022                JP          Z,NO_ACTION_TAKEN
  4297  3c1b  fef7                  CP          $f7                                    ;If Key Row = 3 "P"
  4298  3c1d  ca3022                JP          Z,NO_ACTION_TAKEN
  4299  3c20  feef                  CP          $ef                                    ;If Key Row = 4 "L"
  4300  3c22  ca9e21                JP          Z,DO_MOVE_FW_CHK_WALLS
  4301  3c25  fedf                  CP          $df                                    ;If Key Row = 5 ","
  4302  3c27  cad021                JP          Z,DO_JUMP_BACK
  4303                          KEY_COL_2:
  4304  3c2a  2c                    INC         L
  4305  3c2b  7e                    LD          A,(HL)                  ;A = Key Column 2
  4306  3c2c  fefe                  CP          $fe                                    ;If Key Row = 0 "9"
  4307  3c2e  ca3022                JP          Z,NO_ACTION_TAKEN
  4308  3c31  fefd                  CP          $fd                                    ;If Key Row = 1 "O"
  4309  3c33  ca3022                JP          Z,NO_ACTION_TAKEN
  4310  3c36  fefb                  CP          $fb                                    ;If Key Row = 2 "K"
  4311  3c38  ca9e21                JP          Z,DO_MOVE_FW_CHK_WALLS
  4312  3c3b  fef7                  CP          $f7                                    ;If Key Row = 3 "M"
  4313  3c3d  ca002e                JP          Z,DO_TURN_LEFT
  4314  3c40  feef                  CP          $ef                                    ;If Key Row = 4 "N"
  4315  3c42  ca5e2e                JP          Z,DO_USE_ATTACK
  4316  3c45  fedf                  CP          $df                                    ;If Key Row = 5 "J"
  4317  3c47  ca482e                JP          Z,DO_GLANCE_LEFT
  4318                          KEY_COL_3:
  4319  3c4a  2c                    INC         L
  4320  3c4b  7e                    LD          A,(HL)                  ;A = Key Column 3
  4321  3c4c  fefe                  CP          $fe                                    ;If Key Row = 0 "8"
  4322  3c4e  ca3022                JP          Z,NO_ACTION_TAKEN
  4323  3c51  fefd                  CP          $fd                                    ;If Key Row = 1 "I"
  4324  3c53  ca3022                JP          Z,NO_ACTION_TAKEN
  4325  3c56  fefb                  CP          $fb                                    ;If Key Row = 2 "7"
  4326  3c58  ca3022                JP          Z,NO_ACTION_TAKEN
  4327  3c5b  fef7                  CP          $f7                                    ;If Key Row = 3 "U"
  4328  3c5d  ca3022                JP          Z,NO_ACTION_TAKEN
  4329  3c60  feef                  CP          $ef                                    ;If Key Row = 4 "H"
  4330  3c62  cadb2c                JP          Z,DO_OPEN_CLOSE
  4331  3c65  fedf                  CP          $df                                    ;If Key Row = 5 "B"
  4332  3c67  ca3022                JP          Z,NO_ACTION_TAKEN
  4333                          KEY_COL_4:
  4334  3c6a  2c                    INC         L
  4335  3c6b  7e                    LD          A,(HL)                  ;A = Key Column 4
  4336  3c6c  fefe                  CP          $fe                                    ;If Key Row = 0 "6"
  4337  3c6e  ca3022                JP          Z,NO_ACTION_TAKEN
  4338  3c71  fefd                  CP          $fd                                    ;If Key Row = 1 "Y"
  4339  3c73  ca4d22                JP          Z,USE_MAP
  4340  3c76  fefb                  CP          $fb                                    ;If Key Row = 2 "G"
  4341  3c78  ca3022                JP          Z,NO_ACTION_TAKEN
  4342  3c7b  fef7                  CP          $f7                                    ;If Key Row = 3 "V"
  4343  3c7d  ca3022                JP          Z,NO_ACTION_TAKEN
  4344  3c80  feef                  CP          $ef                                    ;If Key Row = 4 "C"
  4345  3c82  ca2b22                JP          Z,DO_COUNT_ARROWS
  4346  3c85  fedf                  CP          $df                                    ;If Key Row = 5 "F"
  4347  3c87  ca6b3b                JP          Z,DO_REST
  4348                          KEY_COL_5:
  4349  3c8a  2c                    INC         L
  4350  3c8b  7e                    LD          A,(HL)                  ;A = Key Column 5
  4351  3c8c  fefe                  CP          $fe                                    ;If Key Row = 0 "5"
  4352  3c8e  ca3022                JP          Z,NO_ACTION_TAKEN
  4353  3c91  fefd                  CP          $fd                                    ;If Key Row = 1 "T"
  4354  3c93  ca303d                JP          Z,DO_TELEPORT
  4355  3c96  fefb                  CP          $fb                                    ;If Key Row = 2 "4"
  4356  3c98  ca3022                JP          Z,NO_ACTION_TAKEN
  4357  3c9b  fef7                  CP          $f7                                    ;If Key Row = 3 "R"
  4358  3c9d  ca682a                JP          Z,DO_SWAP_PACK
  4359  3ca0  feef                  CP          $ef                                    ;If Key Row = 4 "D"
  4360  3ca2  caa332                JP          Z,DO_USE_LADDER
  4361  3ca5  fedf                  CP          $df                                    ;If Key Row = 5 "X"
  4362  3ca7  ca1422                JP          Z,DO_COUNT_FOOD
  4363                          KEY_COL_6:
  4364  3caa  2c                    INC         L
  4365  3cab  7e                    LD          A,(HL)                  ;A = Key Column 6
  4366  3cac  fefe                  CP          $fe                                    ;If Key Row = 0 "3"
  4367  3cae  ca3022                JP          Z,NO_ACTION_TAKEN
  4368  3cb1  fefd                  CP          $fd                                    ;If Key Row = 1 "E"
  4369  3cb3  cacc26                JP          Z,DO_SWAP_HANDS
  4370  3cb6  fefb                  CP          $fb                                    ;If Key Row = 2 "S"
  4371  3cb8  caf829                JP          Z,DO_ROTATE_PACK
  4372  3cbb  fef7                  CP          $f7                                    ;If Key Row = 3 "Z"
  4373  3cbd  ca2512                JP          Z,WIPE_WALLS
  4374  3cc0  feef                  CP          $ef                                    ;If Key Row = 4 "SPC"
  4375  3cc2  ca3022                JP          Z,NO_ACTION_TAKEN
  4376  3cc5  fedf                  CP          $df                                    ;If Key Row = 5 "A"
  4377  3cc7  ca3022                JP          Z,NO_ACTION_TAKEN
  4378                          KEY_COL_7:
  4379  3cca  2c                    INC         L
  4380  3ccb  7e                    LD          A,(HL)                  ;A = Key Column 7
  4381  3ccc  fefe                  CP          $fe                                    ;If Key Row = 0 "2"
  4382  3cce  ca3022                JP          Z,NO_ACTION_TAKEN
  4383  3cd1  fefd                  CP          $fd                                    ;If Key Row = 1 "W"
  4384  3cd3  cacc27                JP          Z,DO_PICK_UP
  4385  3cd6  fefb                  CP          $fb                                    ;If Key Row = 2 "1"
  4386  3cd8  ca3022                JP          Z,NO_ACTION_TAKEN
  4387  3cdb  fef7                  CP          $f7                                    ;If Key Row = 3 "Q"
  4388  3cdd  caee3c                JP          Z,MAX_HEALTH_ARROWS_FOOD
  4389  3ce0  feef                  CP          $ef                                    ;If Key Row = 4 "SHFT"
  4390  3ce2  ca3022                JP          Z,NO_ACTION_TAKEN
  4391  3ce5  fedf                  CP          $df                                    ;If Key Row = 5 "CTRL"
  4392  3ce7  ca3022                JP          Z,NO_ACTION_TAKEN
  4393  3cea  c33022                JP          NO_ACTION_TAKEN
  4394  3ced  00                    NOP
  4395                          MAX_HEALTH_ARROWS_FOOD:
  4396  3cee  21933a                LD          HL,PLAYER_PHYS_HEALTH
  4397  3cf1  3e99                  LD          A,$99
  4398  3cf3  77                    LD          (HL),A
  4399  3cf4  23                    INC         HL
  4400  3cf5  77                    LD          (HL),A
  4401  3cf6  23                    INC         HL
  4402  3cf7  77                    LD          (HL),A
  4403  3cf8  23                    INC         HL
  4404  3cf9  77                    LD          (HL),A
  4405  3cfa  23                    INC         HL
  4406  3cfb  77                    LD          (HL),A
  4407  3cfc  23                    INC         HL
  4408  3cfd  77                    LD          (HL),A
  4409  3cfe  21ab3a                LD          HL,FOOD_INV
  4410  3d01  77                    LD          (HL),A
  4411  3d02  23                    INC         HL
  4412  3d03  77                    LD          (HL),A
  4413  3d04  cd153e                CALL        PLAY_POWER_UP_SOUND
  4414  3d07  cd5d3d                CALL        REDRAW_STATS
  4415  3d0a  c39c2a                JP          INPUT_DEBOUNCE
  4416  3d0d  00                    db          $00
  4417  3d0e  00                    db          $00
  4418  3d0f  00                    db          $00
  4419  3d10  00                    db          $00
  4420  3d11  00                    db          $00
  4421  3d12  00                    db          $00
  4422  3d13  00                    db          $00
  4423  3d14  00                    db          $00
  4424  3d15  00                    db          $00
  4425  3d16  00                    db          $00
  4426  3d17  00                    db          $00
  4427  3d18  00                    db          $00
  4428  3d19  00                    db          $00
  4429  3d1a  00                    db          $00
  4430  3d1b  00                    db          $00
  4431  3d1c  00                    db          $00
  4432  3d1d  00                    db          $00
  4433  3d1e  00                    db          $00
  4434  3d1f  00                    db          $00
  4435  3d20  00                    db          $00
  4436  3d21  00                    db          $00
  4437  3d22  00                    db          $00
  4438  3d23  00                    db          $00
  4439  3d24  00                    db          $00
  4440  3d25  00                    db          $00
  4441  3d26  00                    db          $00
  4442  3d27  00                    db          $00
  4443  3d28  00                    db          $00
  4444  3d29  00                    db          $00
  4445  3d2a  00                    db          $00
  4446  3d2b  00                    db          $00
  4447  3d2c  00                    db          $00
  4448  3d2d  00                    db          $00
  4449  3d2e  00                    db          $00
  4450  3d2f  00                    db          $00
  4451                          DO_TELEPORT:
  4452  3d30  3a0039                LD          A,(MAP_LADDER_OFFSET)
  4453  3d33  32793a                LD          (PLAYER_MAP_POS),A
  4454  3d36  cdf03d                CALL        PLAY_TELEPORT_SOUND
  4455  3d39  c3962a                JP          UPDATE_VIEWPORT
  4456  3d3c  00                    db          $00
  4457  3d3d  00                    db          $00
  4458  3d3e  00                    db          $00
  4459  3d3f  00                    db          $00
  4460  3d40  00                    db          $00
  4461  3d41  00                    db          $00
  4462  3d42  00                    db          $00
  4463  3d43  00                    db          $00
  4464  3d44  00                    db          $00
  4465  3d45  00                    db          $00
  4466  3d46  00                    db          $00
  4467  3d47  00                    db          $00
  4468  3d48  00                    db          $00
  4469  3d49  00                    db          $00
  4470  3d4a  00                    db          $00
  4471  3d4b  00                    db          $00
  4472  3d4c  00                    db          $00
  4473  3d4d  00                    db          $00
  4474  3d4e  00                    db          $00
  4475  3d4f  00                    db          $00
  4476  3d50  00                    db          $00
  4477  3d51  00                    db          $00
  4478  3d52  00                    db          $00
  4479  3d53  00                    db          $00
  4480  3d54  00                    db          $00
  4481  3d55  00                    db          $00
  4482  3d56  00                    db          $00
  4483  3d57  00                    db          $00
  4484  3d58  00                    db          $00
  4485  3d59  00                    db          $00
  4486  3d5a  00                    db          $00
  4487  3d5b  00                    db          $00
  4488  3d5c  00                    db          $00
  4489                          REDRAW_STATS:
  4490  3d5d  cdd811                CALL        DRAW_ICON_BAR
  4491  3d60  21933a                LD          HL,PLAYER_PHYS_HEALTH
  4492  3d63  114130                LD          DE,CHRRAM_PHYS_HEALTH_1000              ;= $20
  4493  3d66  0602                  LD          B,0x2
  4494  3d68  cdfd32                CALL        RECALC_AND_REDRAW_BCD
  4495  3d6b  21973a                LD          HL,PLAYER_SPRT_HEALTH
  4496  3d6e  114730                LD          DE,CHRRAM_SPRT_HEALTH_10                ;= $20
  4497  3d71  0601                  LD          B,0x1
  4498  3d73  c3fd32                JP          RECALC_AND_REDRAW_BCD
  4499                          CHECK_RING:
  4500  3d76  f5                    PUSH        AF
  4501  3d77  3a763a                LD          A,(RING_INV_SLOT)
  4502  3d7a  cdd83d                CALL        LEVEL_TO_COLRAM_FIX
  4503  3d7d  321734                LD          (COLRAM_RING_IDX),A                     ;= $60    `
  4504  3d80  f1                    POP         AF
  4505  3d81  c9                    RET
  4506  3d82  00                    db          $00
  4507  3d83  00                    db          $00
  4508  3d84  00                    db          $00
  4509  3d85  00                    db          $00
  4510  3d86  00                    db          $00
  4511  3d87  00                    db          $00
  4512  3d88  00                    db          $00
  4513  3d89  00                    db          $00
  4514  3d8a  00                    db          $00
  4515  3d8b  00                    db          $00
  4516  3d8c  00                    db          $00
  4517  3d8d  00                    db          $00
  4518  3d8e  00                    db          $00
  4519  3d8f  00                    db          $00
  4520  3d90  00                    db          $00
  4521  3d91  00                    db          $00
  4522  3d92  00                    db          $00
  4523  3d93  00                    db          $00
  4524  3d94  00                    db          $00
  4525  3d95  00                    db          $00
  4526  3d96  00                    db          $00
  4527  3d97  00                    db          $00
  4528                          CHECK_HELMET:
  4529  3d98  f5                    PUSH        AF
  4530  3d99  3a753a                LD          A,(HELMET_INV_SLOT)
  4531  3d9c  cdd83d                CALL        LEVEL_TO_COLRAM_FIX
  4532  3d9f  321534                LD          (COLRAM_HELMET_IDX),A                   ;= $60    `
  4533  3da2  f1                    POP         AF
  4534  3da3  c9                    RET
  4535  3da4  00                    db          $00
  4536  3da5  00                    db          $00
  4537  3da6  00                    db          $00
  4538  3da7  00                    db          $00
  4539  3da8  00                    db          $00
  4540  3da9  00                    db          $00
  4541  3daa  00                    db          $00
  4542  3dab  00                    db          $00
  4543  3dac  00                    db          $00
  4544  3dad  00                    db          $00
  4545  3dae  00                    db          $00
  4546  3daf  00                    db          $00
  4547  3db0  00                    db          $00
  4548  3db1  00                    db          $00
  4549  3db2  00                    db          $00
  4550  3db3  00                    db          $00
  4551  3db4  00                    db          $00
  4552  3db5  00                    db          $00
  4553  3db6  00                    db          $00
  4554  3db7  00                    db          $00
  4555                          CHECK_ARMOR:
  4556  3db8  f5                    PUSH        AF
  4557  3db9  3a743a                LD          A,(ARMOR_INV_SLOT)
  4558  3dbc  cdd83d                CALL        LEVEL_TO_COLRAM_FIX
  4559  3dbf  321334                LD          (COLRAM_ARMOR_IDX),A                    ;= $60    `
  4560  3dc2  f1                    POP         AF
  4561  3dc3  c9                    RET
  4562  3dc4  00                    db          $00
  4563  3dc5  00                    db          $00
  4564  3dc6  00                    db          $00
  4565  3dc7  00                    db          $00
  4566  3dc8  00                    db          $00
  4567  3dc9  00                    db          $00
  4568  3dca  00                    db          $00
  4569  3dcb  00                    db          $00
  4570  3dcc  00                    db          $00
  4571  3dcd  00                    db          $00
  4572  3dce  00                    db          $00
  4573  3dcf  00                    db          $00
  4574  3dd0  00                    db          $00
  4575  3dd1  00                    db          $00
  4576  3dd2  00                    db          $00
  4577  3dd3  00                    db          $00
  4578  3dd4  00                    db          $00
  4579  3dd5  00                    db          $00
  4580  3dd6  00                    db          $00
  4581  3dd7  00                    db          $00
  4582                          LEVEL_TO_COLRAM_FIX:
  4583  3dd8  87                    ADD         A,A
  4584  3dd9  d601                  SUB         0x1
  4585  3ddb  cb27                  SLA         A
  4586  3ddd  cb27                  SLA         A
  4587  3ddf  cb27                  SLA         A
  4588  3de1  cb27                  SLA         A
  4589  3de3  c9                    RET
  4590                          RHA_REDRAW:
  4591  3de4  cd763d                CALL        CHECK_RING
  4592  3de7  cd983d                CALL        CHECK_HELMET
  4593  3dea  cdb83d                CALL        CHECK_ARMOR
  4594  3ded  c39c2a                JP          INPUT_DEBOUNCE
  4595                          PLAY_TELEPORT_SOUND:
  4596  3df0  012002                LD          BC,$220
  4597  3df3  111800                LD          DE,$18
  4598  3df6  cd3c22                CALL        PLAY_SOUND_LOOP
  4599  3df9  011001                LD          BC,$110
  4600  3dfc  111800                LD          DE,$18
  4601  3dff  cd3c22                CALL        PLAY_SOUND_LOOP
  4602  3e02  018800                LD          BC,$88
  4603  3e05  111800                LD          DE,$18
  4604  3e08  cd3c22                CALL        PLAY_SOUND_LOOP
  4605  3e0b  014400                LD          BC,$44
  4606  3e0e  111800                LD          DE,$18
  4607  3e11  cd3c22                CALL        PLAY_SOUND_LOOP
  4608  3e14  c9                    RET
  4609                          PLAY_POWER_UP_SOUND:
  4610  3e15  012002                LD          BC,$220
  4611  3e18  111800                LD          DE,$18
  4612  3e1b  cd3c22                CALL        PLAY_SOUND_LOOP
  4613  3e1e  010002                LD          BC,$200
  4614  3e21  111800                LD          DE,$18
  4615  3e24  cd3c22                CALL        PLAY_SOUND_LOOP
  4616  3e27  01e001                LD          BC,$1e0
  4617  3e2a  111800                LD          DE,$18
  4618  3e2d  cd3c22                CALL        PLAY_SOUND_LOOP
  4619  3e30  01c001                LD          BC,$1c0
  4620  3e33  116000                LD          DE,$60
  4621  3e36  cd3c22                CALL        PLAY_SOUND_LOOP
  4622  3e39  c9                    RET
  4623                          
src/asterion.asm:
    20  3e3a  0000000000000000      defs         $3EFF - $, $00
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000000000  
              0000000000        
    21                          
    22                          include "asterion_gfx_pointers.asm"
src/asterion_gfx_pointers.asm:
     1                          GFX_POINTERS:
     2  3eff  00                    db          0h
     3                          GFX_PTR_BUCKLER:
     4  3f00  0100                  dw        BUCKLER                                 ;= $01,$01,$01,$01,$01
     5                          GFX_PTR_BUCKLER_S:
     6  3f02  1400                  dw        BUCKLER_S                               ;= $01,$01
     7                          GFX_PTR_BUCKLER_T:
     8  3f04  1900                  dw        BUCKLER_T                               ;= $00,$87,$FF
     9                          GFX_PTR_RING:
    10  3f06  1c00                  dw        RING                                    ;= $01,$01,$01,$01,$01,$01,$01
    11                          GFX_PTR_RING_S:
    12  3f08  2600                  dw        RING_S                                  ;= $01,$01,$01
    13                          GFX_PTR_RING_T:
    14  3f0a  2c00                  dw        RING_T                                  ;= $00,".",$FF
    15                          GFX_PTR_HELMET:
    16  3f0c  2f00                  dw        HELMET                                  ;= $01,$01,$01,$01,$01,$01
    17                          GFX_PTR_HELMET_S:
    18  3f0e  3d00                  dw        HELMET_S                                ;= $01,$01,$01
    19                          GFX_PTR_HELMET_T:
    20  3f10  4700                  dw        HELMET_T                                ;= $00,"^",$FF
    21                          GFX_PTR_ARMOR:
    22  3f12  4a00                  dw        ARMOR                                   ;= $01,$01,$01,$01,$01
    23                          GFX_PTR_ARMOR_S:
    24  3f14  6200                  dw        ARMOR_S                                 ;= $01,$01
    25                          GFX_PTR_ARMOR_T:
    26  3f16  7300                  dw        ARMOR_T                                 ;= $00,$A0,$C7,$D9,$01
    27                          GFX_PTR_PAVISE:
    28  3f18  7d00                  dw        PAVICE                                  ;= $01,$01,$01,$01,$01
    29                          GFX_PTR_PAVISE_S:
    30  3f1a  9500                  dw        PAVICE_S                                ;= $01,$01
    31                          GFX_PTR_PAVISE_T:
    32  3f1c  a300                  dw        PAVICE_T                                ;= $00,$7F,$01
    33                          GFX_PTR_ARROW_L:
    34  3f1e  bf01                  dw        ARROW_FLYING_LEFT                       ;= $01,$01,$01,$01,$01,$01
    35                          GFX_PTR_ARROW_R:
    36  3f20  a900                  dw        ARROW_FLYING_RIGHT                      ;= $01,$01,$01,$01,$01,$01
    37                          GFX_PTR_ARROW_L_2:
    38  3f22  bf01                  dw        ARROW_FLYING_LEFT                       ;= $01,$01,$01,$01,$01,$01
    39                          GFX_PTR_BOW:
    40  3f24  b200                  dw        BOW                                     ;= $01,$01,$01,$01,$01
    41                          GFX_PTR_BOW_S:
    42  3f26  c600                  dw        BOW_S                                   ;= $01,$01
    43                          GFX_PTR_BOW_T:
    44  3f28  d100                  dw        BOW_T                                   ;= $00,"{",$FF
    45                          GFX_PTR_SCROLL:
    46  3f2a  d400                  dw        SCROLL                                  ;= $01,$01,$01,$01,$01
    47                          GFX_PTR_SCROLL_S:
    48  3f2c  ef00                  dw        SCROLL_S                                ;= $01,$01
    49                          GFX_PTR_SCROLL_NEW_T:
    50  3f2e  f900                  dw        SCROLL_T                                ;= $00,"H",$FF
    51                          GFX_PTR_AXE:
    52  3f30  fc00                  dw        AXE                                     ;= $01,$01,$01,$01,$01
    53                          GFX_PTR_AXE_S:
    54  3f32  1101                  dw        AXE_S                                   ;= $01,$01
    55                          GFX_PTR_AXE_T:
    56  3f34  2101                  dw        AXE_T                                   ;= $00,$11,$FF
    57                          GFX_PTR_FIREBALL:
    58  3f36  2401                  dw        FIREBALL                                ;= $01,$01,$01,$01,$01
    59                          GFX_PTR_FIREBALL_S:
    60  3f38  3501                  dw        FIREBALL_S                              ;= $01,$01
    61                          GFX_PTR_FIREBALL_T:
    62  3f3a  3a01                  dw        FIREBALL_T                              ;= $00,$D3,$FF
    63                          GFX_PTR_MACE:
    64  3f3c  3d01                  dw        MACE                                    ;= $01,$01,$01,$01,$01
    65                          GFX_PTR_MACE_S:
    66  3f3e  5801                  dw        MACE_S                                  ;= $01,$01
    67                          GFX_PTR_MACE_T:
    68  3f40  6a01                  dw        MACE_T                                  ;= $00,"T",$FF
    69                          GFX_PTR_STAFF:
    70  3f42  6d01                  dw        STAFF                                   ;= $01,$01,$01,$01,$01
    71                          GFX_PTR_STAFF_S:
    72  3f44  8001                  dw        STAFF_S                                 ;= $01,$01
    73                          GFX_PTR_STAFF_T:
    74  3f46  8901                  dw        STAFF_T                                 ;= $00,"\\",$FF
    75                          GFX_PTR_CROSSBOW:
    76  3f48  8c01                  dw        CROSSBOW                                ;= $01,$01,$01,$01,$01
    77                          GFX_PTR_CROSSBOW_S:
    78  3f4a  af01                  dw        CROSSBOW_S                              ;= $01,$01
    79                          GFX_PTR_CROSSBOW_T:
    80  3f4c  b701                  dw        CROSSBOW_T                              ;= $A0,$91,$A0,$D8,$02,$04,$90,$FF
    81  3f4e  8b03                  dw        EXCL_MARK_GFX
    82  3f50  8b03                  dw        EXCL_MARK_GFX
    83  3f52  8b03                  dw        EXCL_MARK_GFX
    84  3f54  8b03                  dw        EXCL_MARK_GFX
    85  3f56  8b03                  dw        EXCL_MARK_GFX
    86  3f58  8b03                  dw        EXCL_MARK_GFX
    87                          GFX_PTR_ARROW_R_2:
    88  3f5a  a900                  dw        ARROW_FLYING_RIGHT                      ;= $01,$01,$01,$01,$01,$01
    89  3f5c  8b03                  dw        EXCL_MARK_GFX
    90  3f5e  8b03                  dw        EXCL_MARK_GFX
    91                          GFX_PTR_LADDER:
    92  3f60  c801                  dw        LADDER                                  ;= $01,$01,$01,$01,$01
    93                          GFX_PTR_LADDER_S:
    94  3f62  e101                  dw        LADDER_S                                ;= $01,$01
    95                          GFX_PTR_LADDER_T:
    96  3f64  f101                  dw        LADDER_T                                ;= $00,$CD,$97,$FF
    97                          GFX_PTR_CHEST:
    98  3f66  f501                  dw        CHEST                                   ;= $01,$01,$01,$01,$01
    99                          GFX_PTR_CHEST_S:
   100  3f68  1402                  dw        CHEST_S                                 ;= $01,$E0,$1F,$1F,$B0,$01
   101                          GFX_PTR_CHEST_T:
   102  3f6a  2602                  dw        CHEST_T                                 ;= $00,$FC,$FF
   103                          GFX_PTR_FOOD:
   104  3f6c  2902                  dw        FOOD                                    ;= $01,$01,$01,$01,$01
   105                          GFX_PTR_FOOD_S:
   106  3f6e  4002                  dw        FOOD_S                                  ;= $01,$01
   107                          GFX_PTR_FOOD_T:
   108  3f70  4a02                  dw        FOOD_T                                  ;= $00,"#",$FF
   109                          GFX_PTR_QUIVER:
   110  3f72  4d02                  dw        QUIVER                                  ;= $01,$01,$01,$01,$01,$01
   111                          GFX_PTR_QUIVER_S:
   112  3f74  6402                  dw        QUIVER_S                                ;= $01,$01
   113                          GFX_PTR_QUIVER_T:
   114  3f76  6f02                  dw        QUIVER_T                                ;= $00,$F0,$FF
   115                          GFX_PTR_LOCK_CHEST:
   116  3f78  7202                  dw        LOCKED_CHEST                            ;= $01,$01,$01,$01,$01
   117                          GFX_PTR_LOCK_CHEST_S:
   118  3f7a  1402                  dw        CHEST_S                                 ;= $01,$E0,$1F,$1F,$B0,$01
   119                          GFX_PTR_LOCK_CHEST_T:
   120  3f7c  2602                  dw        CHEST_T                                 ;= $00,$FC,$FF
   121  3f7e  8b03                  dw        EXCL_MARK_GFX
   122  3f80  8b03                  dw        EXCL_MARK_GFX
   123  3f82  8b03                  dw        EXCL_MARK_GFX
   124                          GFX_PTR_KEY:
   125  3f84  9102                  dw        KEY                                     ;= $01,$01,$01,$01,$01,$01
   126                          GFX_PTR_KEY_S:
   127  3f86  a302                  dw        KEY_S                                   ;= $01,$01,$01
   128                          GFX_PTR_KEY_T:
   129  3f88  a902                  dw        KEY_T                                   ;= $FF,"-",$FF
   130                          GFX_PTR_AMULET:
   131  3f8a  ac02                  dw        AMULET                                  ;= $01,$01,$01,$01,$01
   132                          GFX_PTR_AMULET_S:
   133  3f8c  c402                  dw        AMULET_S                                ;= $01,$01
   134                          GFX_PTR_AMULET_T:
   135  3f8e  d402                  dw        AMULET_T                                ;= $00,"&",$FF
   136                          GFX_PTR_CHALICE:
   137  3f90  d702                  dw        CHALICE                                 ;= $01,$01,$01,$01,$01,$01
   138                          GFX_PTR_CHALICE_S:
   139  3f92  ea02                  dw        CHALICE_S                               ;= $01,$01
   140                          GFX_PTR_CHALICE_T:
   141  3f94  f202                  dw        CHALICE_T                               ;= $00,"Y",$FF
   142                          GFX_PTR_WARRIOR_POTION:
   143  3f96  f502                  dw        WARRIOR_POTION                          ;= $01,$01,$01,$01,$01
   144                          GFX_PTR_WARRIOR_POTION_S:
   145  3f98  0a03                  dw        WARRIOR_POTION_S                        ;= $01,$01
   146                          GFX_PTR_WARRIOR_POTION_T:
   147  3f9a  1503                  dw        POTION_T                                ;= $00,"U",$02,$04,"_",$FF
   148                          GFX_PTR_MAGE_POTION:
   149  3f9c  1b03                  dw        MAGE_POTION                             ;= $01,$01,$01,$01,$01
   150                          GFX_PTR_MAGE_POTION_S:
   151  3f9e  3003                  dw        MAGE_POTION_S                           ;= $01,$01
   152                          GFX_PTR_MAGE_POTION_T:
   153  3fa0  1503                  dw        POTION_T                                ;= $00,"U",$02,$04,"_",$FF
   154                          GFX_PTR_MAP:
   155  3fa2  3b03                  dw        MAP                                     ;= $01,$01,$01,$01,$01
   156                          GFX_PTR_MAP_S:
   157  3fa4  5a03                  dw        MAP_S                                   ;= $01,$01
   158                          GFX_PTR_MAP_T:
   159  3fa6  6803                  dw        MAP_T                                   ;= $00,$D5,$FF
   160                          GFX_PTR_CHAOS_POTION:
   161  3fa8  6b03                  dw        CHAOS_POTION                            ;= $01,$01,$01,$01,$01
   162                          GFX_PTR_CHAOS_POTION_S:
   163  3faa  8003                  dw        CHAOS_POTION_S                          ;= $01,$01
   164                          GFX_PTR_CHAOS_POTION_T:
   165  3fac  1503                  dw        POTION_T                                ;= $00,"U",$02,$04,"_",$FF
   166  3fae  8b03                  dw        EXCL_MARK_GFX
   167  3fb0  8b03                  dw        EXCL_MARK_GFX
   168  3fb2  8b03                  dw        EXCL_MARK_GFX
   169                          GFX_END_PT1:
   170  3fb4  0000                  dw        NO_GFX                                  ;= $FF
   171                          GFX_PTR_SKELETON:
   172  3fb6  8d03                  dw        SKELETON                                ;= $04,$04,$04,$04
   173                          GFX_PTR_SKELETON_S:
   174  3fb8  cb03                  dw        SKELETON_S                              ;= $04,$04,$04
   175  3fba  0000                  dw        NO_GFX                                  ;= $FF
   176                          GFX_PTR_SNAKE:
   177  3fbc  e103                  dw        SNAKE                                   ;= $04,$04,$04
   178                          GFX_PTR_SNAKE_S:
   179  3fbe  2204                  dw        SNAKE_S                                 ;= $04,$04,$04
   180  3fc0  0000                  dw        NO_GFX                                  ;= $FF
   181                          GFX_PTR_SPIDER:
   182  3fc2  3a04                  dw        SPIDER                                  ;= $04,$04
   183                          GFX_PTR_SPIDER_S:
   184  3fc4  6b04                  dw        SPIDER_S                                ;= $04,$04,$04,$04
   185  3fc6  0000                  dw        NO_GFX                                  ;= $FF
   186                          GFX_PTR_MIMIC:
   187  3fc8  8404                  dw        MIMIC                                   ;= $04,$02,$D7,$96,$00,$00,$96,$C9,$01
   188                          GFX_PTR_MIMIC_S:
   189  3fca  b704                  dw        MIMIC_S                                 ;= $01,$E0,$1F,$1F,$B0,$01
   190  3fcc  0000                  dw        NO_GFX                                  ;= $FF
   191                          GFX_PTR_MALOCCHIO:
   192  3fce  c904                  dw        MALOCCHIO                               ;= $04,$04,$04,$04
   193                          GFX_PTR_MALOCCHIO_S:
   194  3fd0  ff04                  dw        MALOCCHIO_S                             ;= $04,$04,$04,$04
   195  3fd2  0000                  dw        NO_GFX                                  ;= $FF
   196                          GFX_PTR_DRAGON:
   197  3fd4  1905                  dw        DRAGON                                  ;= $04,$04,$04,$04
   198                          GFX_PTR_DRAGON_S:
   199  3fd6  8505                  dw        DRAGON_S                                ;= $04,$04,$04,$C9,$C9,$C0,$C0,$01
   200                          GFX_PTR_END_A:
   201  3fd8  0000                  dw        NO_GFX                                  ;= $FF
   202                          GFX_PTR_MUMMY:
   203  3fda  a705                  dw        MUMMY                                   ;= $04,$04,$04,$04
   204                          GFX_PTR_MUMMY_S:
   205  3fdc  0a06                  dw        MUMMY_S                                 ;= $04,$04,$04
   206                          GFX_PTR_END_B:
   207  3fde  0000                  dw        NO_GFX                                  ;= $FF
   208                          GFX_PTR_NECRO:
   209  3fe0  2306                  dw        NECROMANCER                             ;= $04,$04,$04,$04
   210                          GFX_PTR_NECRO_S:
   211  3fe2  7e06                  dw        NECROMANCER_S                           ;= $04,$04,$04
   212                          GFX_PTR_END_C:
   213  3fe4  0000                  dw        NO_GFX                                  ;= $FF
   214                          GFX_PTR_GRYPHON:
   215  3fe6  9506                  dw        GRYPHON                                 ;= $04,$04,$04,$04
   216                          GFX_PTR_GRYPHON_S:
   217  3fe8  f506                  dw        GRYPHON_S                               ;= $04,$04,$04,$B8,$B8,$B0,$01
   218                          GFX_PTR_END_D:
   219  3fea  0000                  dw        NO_GFX                                  ;= $FF
   220                          GFX_PTR_MINOTAUR:
   221  3fec  0f07                  dw        MINOTAUR                                ;= $04,$04,$04,$04
   222                          GFX_PTR_MINOTAUR_S:
   223  3fee  5607                  dw        MINOTAUR_S                              ;= $04,$04,$04,$04
   224                          
src/asterion.asm:
    23  3ff0  0000000000000000      defs         $4000 - $, $00
              0000000000000000  
    24                          
